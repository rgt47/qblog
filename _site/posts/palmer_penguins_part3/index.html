<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Your Name">
<meta name="dcterms.date" content="2025-01-03">
<meta name="description" content="Part 3 of our 5-part series where we rigorously validate our models and introduce polynomial features and random forest competitors">

<title>Palmer Penguins Data Analysis Series (Part 3): Advanced Models and Cross-Validation – Thomas Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    "?",
    "/"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;1,400&amp;family=Open+Sans:ital,wght@0,400;0,600;1,400&amp;family=Fira+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/0fba9333d8.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">

<!-- Custom meta tags for social sharing -->
<meta property="og:site_name" content="Thomas Lab">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@rgt47">

<!-- Add responsive features -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Add analytics if needed -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXX');
</script> -->

<!-- Add custom javascript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Remove code tools button completely
  const codeButton = document.querySelector('.code-tools-button');
  if (codeButton) {
    codeButton.remove();
  }
  
  // Add any custom JavaScript functionality here
  
  // Example: Add smooth scrolling
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      
      document.querySelector(this.getAttribute('href')).scrollIntoView({
        behavior: 'smooth'
      });
    });
  });
  
  // Make sidebar category items clickable (but not TOC items)
  const categoryLinks = {
    'Programming & Development': '/posts/?category=Programming+%26+Development',
    'Data Analysis & Visualization': '/posts/?category=Data+Analysis+%26+Visualization',
    'Deployment & Operations': '/posts/?category=Deployment+%26+Operations',
    'Development Environment': '/posts/?category=Development+Environment',
    'Shiny Applications': '/posts/?category=Shiny+Applications',
    'AI & Automation': '/posts/?category=AI+%26+Automation',
    'System Administration': '/posts/?category=System+Administration'
  };
  
  // Only target sidebar items that are not in the TOC
  document.querySelectorAll('.sidebar-item-section .sidebar-item-text').forEach(item => {
    // Skip if this is inside the TOC
    if (item.closest('#TOC')) return;
    
    const text = item.textContent.trim();
    if (categoryLinks[text]) {
      item.addEventListener('click', function() {
        window.location.href = categoryLinks[text];
      });
    }
  });
});
</script>


<meta property="og:title" content="Palmer Penguins Data Analysis Series (Part 3): Advanced Models and Cross-Validation – Thomas Lab">
<meta property="og:description" content="Part 3 of our 5-part series where we rigorously validate our models and introduce polynomial features and random forest competitors">
<meta property="og:image" content="https://focusonr.org/posts/palmer_penguins_part3/penguin-hero-part3.png">
<meta property="og:site_name" content="Thomas Lab">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Thomas Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../white-papers/index.html"> 
<span class="menu-text">White Papers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../misc/index.html"> 
<span class="menu-text">Misc</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#setup-and-model-recap" id="toc-setup-and-model-recap" class="nav-link" data-scroll-target="#setup-and-model-recap"><span class="header-section-number">2</span> Setup and Model Recap</a></li>
  <li><a href="#cross-validation-framework" id="toc-cross-validation-framework" class="nav-link" data-scroll-target="#cross-validation-framework"><span class="header-section-number">3</span> Cross-Validation Framework</a>
  <ul class="collapse">
  <li><a href="#setting-up-cross-validation" id="toc-setting-up-cross-validation" class="nav-link" data-scroll-target="#setting-up-cross-validation"><span class="header-section-number">3.1</span> Setting Up Cross-Validation</a></li>
  <li><a href="#cross-validating-our-existing-models" id="toc-cross-validating-our-existing-models" class="nav-link" data-scroll-target="#cross-validating-our-existing-models"><span class="header-section-number">3.2</span> Cross-Validating Our Existing Models</a></li>
  <li><a href="#visualizing-cross-validation-results" id="toc-visualizing-cross-validation-results" class="nav-link" data-scroll-target="#visualizing-cross-validation-results"><span class="header-section-number">3.3</span> Visualizing Cross-Validation Results</a></li>
  </ul></li>
  <li><a href="#polynomial-features" id="toc-polynomial-features" class="nav-link" data-scroll-target="#polynomial-features"><span class="header-section-number">4</span> Polynomial Features</a>
  <ul class="collapse">
  <li><a href="#adding-quadratic-terms" id="toc-adding-quadratic-terms" class="nav-link" data-scroll-target="#adding-quadratic-terms"><span class="header-section-number">4.1</span> Adding Quadratic Terms</a></li>
  <li><a href="#visualizing-non-linear-relationships" id="toc-visualizing-non-linear-relationships" class="nav-link" data-scroll-target="#visualizing-non-linear-relationships"><span class="header-section-number">4.2</span> Visualizing Non-linear Relationships</a></li>
  </ul></li>
  <li><a href="#random-forest-models" id="toc-random-forest-models" class="nav-link" data-scroll-target="#random-forest-models"><span class="header-section-number">5</span> Random Forest Models</a>
  <ul class="collapse">
  <li><a href="#basic-random-forest" id="toc-basic-random-forest" class="nav-link" data-scroll-target="#basic-random-forest"><span class="header-section-number">5.1</span> Basic Random Forest</a></li>
  <li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance"><span class="header-section-number">5.2</span> Variable Importance</a></li>
  </ul></li>
  <li><a href="#comprehensive-model-comparison" id="toc-comprehensive-model-comparison" class="nav-link" data-scroll-target="#comprehensive-model-comparison"><span class="header-section-number">6</span> Comprehensive Model Comparison</a>
  <ul class="collapse">
  <li><a href="#performance-summary-table" id="toc-performance-summary-table" class="nav-link" data-scroll-target="#performance-summary-table"><span class="header-section-number">6.1</span> Performance Summary Table</a></li>
  <li><a href="#statistical-significance-testing" id="toc-statistical-significance-testing" class="nav-link" data-scroll-target="#statistical-significance-testing"><span class="header-section-number">6.2</span> Statistical Significance Testing</a></li>
  <li><a href="#performance-visualization" id="toc-performance-visualization" class="nav-link" data-scroll-target="#performance-visualization"><span class="header-section-number">6.3</span> Performance Visualization</a></li>
  </ul></li>
  <li><a href="#the-bias-variance-tradeoff" id="toc-the-bias-variance-tradeoff" class="nav-link" data-scroll-target="#the-bias-variance-tradeoff"><span class="header-section-number">7</span> The Bias-Variance Tradeoff</a>
  <ul class="collapse">
  <li><a href="#learning-curves" id="toc-learning-curves" class="nav-link" data-scroll-target="#learning-curves"><span class="header-section-number">7.1</span> Learning Curves</a></li>
  </ul></li>
  <li><a href="#key-insights-from-advanced-modeling" id="toc-key-insights-from-advanced-modeling" class="nav-link" data-scroll-target="#key-insights-from-advanced-modeling"><span class="header-section-number">8</span> Key Insights from Advanced Modeling</a>
  <ul class="collapse">
  <li><a href="#performance-hierarchy" id="toc-performance-hierarchy" class="nav-link" data-scroll-target="#performance-hierarchy"><span class="header-section-number">8.1</span> Performance Hierarchy</a></li>
  <li><a href="#model-selection-recommendations" id="toc-model-selection-recommendations" class="nav-link" data-scroll-target="#model-selection-recommendations"><span class="header-section-number">8.2</span> Model Selection Recommendations</a></li>
  </ul></li>
  <li><a href="#looking-ahead-to-part-4" id="toc-looking-ahead-to-part-4" class="nav-link" data-scroll-target="#looking-ahead-to-part-4"><span class="header-section-number">9</span> Looking Ahead to Part 4</a></li>
  <li><a href="#reproducibility-information" id="toc-reproducibility-information" class="nav-link" data-scroll-target="#reproducibility-information"><span class="header-section-number">10</span> Reproducibility Information</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Palmer Penguins Data Analysis Series (Part 3): Advanced Models and Cross-Validation</h1>
<p class="subtitle lead">Testing model robustness and exploring the machine learning frontier</p>
  <div class="quarto-categories">
    <div class="quarto-category">R Programming</div>
    <div class="quarto-category">Data Science</div>
    <div class="quarto-category">Statistical Computing</div>
    <div class="quarto-category">Cross-Validation</div>
    <div class="quarto-category">Machine Learning</div>
    <div class="quarto-category">Palmer Penguins</div>
  </div>
  </div>

<div>
  <div class="description">
    Part 3 of our 5-part series where we rigorously validate our models and introduce polynomial features and random forest competitors
  </div>
</div>


<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Your Name </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 3, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="penguin-hero-part3.png" class="img-fluid figure-img"></p>
<figcaption>A tech-savvy penguin with a laptop, diving deep into advanced modeling techniques and cross-validation!</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🐧 Palmer Penguins Data Analysis Series
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is <strong>Part 3</strong> of a 5-part series exploring penguin morphometrics:</p>
<ol type="1">
<li><a href="../palmer_penguins_part1/">Part 1: EDA and Simple Regression</a></li>
<li><a href="../palmer_penguins_part2/">Part 2: Multiple Regression and Species Effects</a></li>
<li><strong>Part 3: Advanced Models and Cross-Validation</strong> (This post)</li>
<li><a href="../palmer_penguins_part4/">Part 4: Model Diagnostics and Interpretation</a></li>
<li><a href="../palmer_penguins_part5/">Part 5: Random Forest vs Linear Models</a></li>
</ol>
</div>
</div>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Welcome to the third installment of our Palmer penguins adventure! In <a href="../palmer_penguins_part2/">Part 2</a>, we achieved remarkable results, boosting our R² from 76% to 86% by incorporating species information. But as any responsible data scientist knows, impressive performance on training data is only the beginning of the story.</p>
<p>The critical question remains: <strong>How well will our models perform on new, unseen penguin data?</strong> This is where rigorous validation techniques become essential. Today, we’ll put our models through their paces using cross-validation, explore whether non-linear relationships can improve our predictions, and introduce our first machine learning competitor.</p>
<p>In this post, we’ll explore:</p>
<ul>
<li>Cross-validation techniques for robust model evaluation</li>
<li>Polynomial features to capture non-linear relationships<br>
</li>
<li>Random forest models as a machine learning baseline</li>
<li>Systematic model comparison with proper uncertainty quantification</li>
<li>The bias-variance tradeoff in action</li>
</ul>
<p>By the end of this post, you’ll have confidence in your model’s generalizability and understand when additional complexity helps versus hurts predictive performance.</p>
</section>
<section id="setup-and-model-recap" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Setup and Model Recap</h1>
<p>Let’s reload our work and establish our baseline models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Conditional loading of car package</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"car"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(car)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"⚠️ Package 'car' not available. Install with: install.packages('car')</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set theme and colors</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>penguin_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Adelie"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"Chinstrap"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>, <span class="st">"Gentoo"</span> <span class="ot">=</span> <span class="st">"#45B7D1"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Load clean data</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(penguins)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>penguins_clean <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Recreate our key models from previous parts</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>simple_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm, <span class="at">data =</span> penguins_clean)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>multiple_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span> flipper_length_mm, </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> penguins_clean)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>species_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span> </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                    flipper_length_mm <span class="sc">+</span> species, <span class="at">data =</span> penguins_clean)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"📋 Baseline Model Performance (Training Data):</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>📋 Baseline Model Performance (Training Data):</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"===============================================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>===============================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Simple model R²: %.3f</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">glance</span>(simple_model)<span class="sc">$</span>r.squared))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple model R²: 0.762</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Multiple model R²: %.3f</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">glance</span>(multiple_model)<span class="sc">$</span>r.squared))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Multiple model R²: 0.764</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Species model R²: %.3f</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">glance</span>(species_model)<span class="sc">$</span>r.squared))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Species model R²: 0.849</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Sample size: %d penguins</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">nrow</span>(penguins_clean)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sample size: 333 penguins</code></pre>
</div>
</div>
</section>
<section id="cross-validation-framework" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Cross-Validation Framework</h1>
<p>Training performance can be misleading due to overfitting. Let’s implement k-fold cross-validation to get robust performance estimates:</p>
<section id="setting-up-cross-validation" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="setting-up-cross-validation"><span class="header-section-number">3.1</span> Setting Up Cross-Validation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  <span class="co"># For reproducible results</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up 10-fold cross-validation</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> <span class="st">"final"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">verboseIter =</span> <span class="cn">FALSE</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"🔄 Cross-Validation Setup:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>🔄 Cross-Validation Setup:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"==========================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==========================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Method: 10-fold cross-validation</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Method: 10-fold cross-validation</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Folds: 10</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Folds: 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Seed: 42 (for reproducibility)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Seed: 42 (for reproducibility)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Predictions saved: Yes</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Predictions saved: Yes</code></pre>
</div>
</div>
</section>
<section id="cross-validating-our-existing-models" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="cross-validating-our-existing-models"><span class="header-section-number">3.2</span> Cross-Validating Our Existing Models</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validate simple model</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>cv_simple <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  body_mass_g <span class="sc">~</span> flipper_length_mm,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> penguins_clean,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validate multiple regression model</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>cv_multiple <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span> flipper_length_mm,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> penguins_clean,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"lm"</span>, </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validate species model</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>cv_species <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span> flipper_length_mm <span class="sc">+</span> species,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> penguins_clean,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display cross-validation results</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">📊 Cross-Validation Results:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
📊 Cross-Validation Results:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=============================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=============================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Simple model - RMSE: %.1f (±%.1f), R²: %.3f (±%.3f)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>            cv_simple<span class="sc">$</span>results<span class="sc">$</span>RMSE, <span class="fu">sd</span>(cv_simple<span class="sc">$</span>resample<span class="sc">$</span>RMSE),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>            cv_simple<span class="sc">$</span>results<span class="sc">$</span>Rsquared, <span class="fu">sd</span>(cv_simple<span class="sc">$</span>resample<span class="sc">$</span>Rsquared)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple model - RMSE: 390.9 (±54.0), R²: 0.775 (±0.038)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Multiple model - RMSE: %.1f (±%.1f), R²: %.3f (±%.3f)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>            cv_multiple<span class="sc">$</span>results<span class="sc">$</span>RMSE, <span class="fu">sd</span>(cv_multiple<span class="sc">$</span>resample<span class="sc">$</span>RMSE),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>            cv_multiple<span class="sc">$</span>results<span class="sc">$</span>Rsquared, <span class="fu">sd</span>(cv_multiple<span class="sc">$</span>resample<span class="sc">$</span>Rsquared)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Multiple model - RMSE: 392.6 (±41.7), R²: 0.769 (±0.049)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Species model - RMSE: %.1f (±%.1f), R²: %.3f (±%.3f)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>            cv_species<span class="sc">$</span>results<span class="sc">$</span>RMSE, <span class="fu">sd</span>(cv_species<span class="sc">$</span>resample<span class="sc">$</span>RMSE),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>            cv_species<span class="sc">$</span>results<span class="sc">$</span>Rsquared, <span class="fu">sd</span>(cv_species<span class="sc">$</span>resample<span class="sc">$</span>Rsquared)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Species model - RMSE: 315.7 (±32.2), R²: 0.856 (±0.022)</code></pre>
</div>
</div>
</section>
<section id="visualizing-cross-validation-results" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="visualizing-cross-validation-results"><span class="header-section-number">3.3</span> Visualizing Cross-Validation Results</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comprehensive CV results dataframe</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Simple"</span>, <span class="st">"Multiple"</span>, <span class="st">"Species"</span>), <span class="at">each =</span> <span class="dv">10</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">c</span>(cv_simple<span class="sc">$</span>resample<span class="sc">$</span>RMSE, cv_multiple<span class="sc">$</span>resample<span class="sc">$</span>RMSE, cv_species<span class="sc">$</span>resample<span class="sc">$</span>RMSE),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Rsquared =</span> <span class="fu">c</span>(cv_simple<span class="sc">$</span>resample<span class="sc">$</span>Rsquared, cv_multiple<span class="sc">$</span>resample<span class="sc">$</span>Rsquared, cv_species<span class="sc">$</span>resample<span class="sc">$</span>Rsquared)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plots of CV performance</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(cv_results, <span class="fu">aes</span>(<span class="at">x =</span> Model, <span class="at">y =</span> RMSE, <span class="at">fill =</span> Model)) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cross-Validation RMSE Distribution"</span>,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Lower values indicate better performance"</span>,</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"RMSE (grams)"</span>) <span class="sc">+</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(cv_results, <span class="fu">aes</span>(<span class="at">x =</span> Model, <span class="at">y =</span> Rsquared, <span class="at">fill =</span> Model)) <span class="sc">+</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cross-Validation R² Distribution"</span>, </span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Higher values indicate better performance"</span>,</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"R-squared"</span>) <span class="sc">+</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>cv_performance_plot <span class="ot">&lt;-</span> p1 <span class="sc">+</span> p2</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cv_performance_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="cv-performance-distribution.png" class="img-fluid figure-img"></p>
<figcaption>Box plots showing the distribution of cross-validation performance metrics across folds</figcaption>
</figure>
</div>
</section>
</section>
<section id="polynomial-features" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Polynomial Features</h1>
<p>Linear relationships might not capture all the complexity in biological data. Let’s explore polynomial features:</p>
<section id="adding-quadratic-terms" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="adding-quadratic-terms"><span class="header-section-number">4.1</span> Adding Quadratic Terms</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create polynomial model with quadratic terms</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>poly_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> <span class="fu">poly</span>(flipper_length_mm, <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">poly</span>(bill_length_mm, <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">poly</span>(bill_depth_mm, <span class="dv">2</span>) <span class="sc">+</span> species, <span class="at">data =</span> penguins_clean)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poly_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = body_mass_g ~ poly(flipper_length_mm, 2) + poly(bill_length_mm, 
    2) + poly(bill_depth_mm, 2) + species, data = penguins_clean)

Residuals:
    Min      1Q  Median      3Q     Max 
-837.68 -209.78  -25.97  187.14 1012.84 

Coefficients:
                            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                  3935.52      69.77  56.404  &lt; 2e-16 ***
poly(flipper_length_mm, 2)1  5321.73     859.97   6.188 1.84e-09 ***
poly(flipper_length_mm, 2)2   391.41     407.10   0.961   0.3370    
poly(bill_length_mm, 2)1     3753.51     726.72   5.165 4.21e-07 ***
poly(bill_length_mm, 2)2     -856.40     345.09  -2.482   0.0136 *  
poly(bill_depth_mm, 2)1      5764.01     769.85   7.487 6.72e-13 ***
poly(bill_depth_mm, 2)2      -842.97     404.23  -2.085   0.0378 *  
speciesChinstrap             -470.97      84.01  -5.606 4.43e-08 ***
speciesGentoo                1028.96     161.74   6.362 6.79e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 310.1 on 324 degrees of freedom
Multiple R-squared:  0.8552,    Adjusted R-squared:  0.8516 
F-statistic: 239.2 on 8 and 324 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validate polynomial model</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>cv_poly <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  body_mass_g <span class="sc">~</span> <span class="fu">poly</span>(flipper_length_mm, <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">poly</span>(bill_length_mm, <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">poly</span>(bill_depth_mm, <span class="dv">2</span>) <span class="sc">+</span> species,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> penguins_clean,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"🔄 Polynomial Model Cross-Validation:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>🔄 Polynomial Model Cross-Validation:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=====================================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=====================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Polynomial model - RMSE: %.1f (±%.1f), R²: %.3f (±%.3f)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>            cv_poly<span class="sc">$</span>results<span class="sc">$</span>RMSE, <span class="fu">sd</span>(cv_poly<span class="sc">$</span>resample<span class="sc">$</span>RMSE),</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>            cv_poly<span class="sc">$</span>results<span class="sc">$</span>Rsquared, <span class="fu">sd</span>(cv_poly<span class="sc">$</span>resample<span class="sc">$</span>Rsquared)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Polynomial model - RMSE: 310.8 (±44.4), R²: 0.855 (±0.046)</code></pre>
</div>
</div>
</section>
<section id="visualizing-non-linear-relationships" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="visualizing-non-linear-relationships"><span class="header-section-number">4.2</span> Visualizing Non-linear Relationships</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create predictions for visualization</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>flipper_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(penguins_clean<span class="sc">$</span>flipper_length_mm), </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">max</span>(penguins_clean<span class="sc">$</span>flipper_length_mm), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare linear vs polynomial relationships for each species</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>prediction_data <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">flipper_length_mm =</span> flipper_range,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">species =</span> <span class="fu">unique</span>(penguins_clean<span class="sc">$</span>species)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">bill_length_mm =</span> <span class="fu">mean</span>(penguins_clean<span class="sc">$</span>bill_length_mm),</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">bill_depth_mm =</span> <span class="fu">mean</span>(penguins_clean<span class="sc">$</span>bill_depth_mm),</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">body_mass_g =</span> <span class="dv">0</span>  <span class="co"># placeholder</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions from both models</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>prediction_data<span class="sc">$</span>linear_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(species_model, <span class="at">newdata =</span> prediction_data)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>prediction_data<span class="sc">$</span>poly_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(poly_model, <span class="at">newdata =</span> prediction_data)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins_clean, <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> body_mass_g, <span class="at">color =</span> species)) <span class="sc">+</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> prediction_data, <span class="fu">aes</span>(<span class="at">y =</span> linear_pred, <span class="at">linetype =</span> <span class="st">"Linear"</span>), </span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> prediction_data, <span class="fu">aes</span>(<span class="at">y =</span> poly_pred, <span class="at">linetype =</span> <span class="st">"Polynomial"</span>), </span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> penguin_colors) <span class="sc">+</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Linear"</span> <span class="ot">=</span> <span class="st">"dashed"</span>, <span class="st">"Polynomial"</span> <span class="ot">=</span> <span class="st">"solid"</span>)) <span class="sc">+</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Linear vs Polynomial Relationships"</span>,</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Comparing model fits for flipper length (other variables held at mean)"</span>,</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Flipper Length (mm)"</span>, <span class="at">y =</span> <span class="st">"Body Mass (g)"</span>,</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Species"</span>, <span class="at">linetype =</span> <span class="st">"Model"</span>) <span class="sc">+</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>species) <span class="sc">+</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="linear-vs-polynomial.png" class="img-fluid figure-img"></p>
<figcaption>Comparison of linear versus polynomial model fits across species</figcaption>
</figure>
</div>
</section>
</section>
<section id="random-forest-models" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Random Forest Models</h1>
<p>Now let’s introduce our first machine learning approach - random forests:</p>
<section id="basic-random-forest" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="basic-random-forest"><span class="header-section-number">5.1</span> Basic Random Forest</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Train random forest using caret for consistency</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>cv_rf <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span> flipper_length_mm <span class="sc">+</span> species <span class="sc">+</span> sex <span class="sc">+</span> island,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> penguins_clean,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">500</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cv_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

333 samples
  6 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 299, 300, 300, 300, 299, 300, ... 
Resampling results across tuning parameters:

  mtry  RMSE      Rsquared   MAE     
  2     296.1693  0.8709290  235.7196
  5     300.8044  0.8666035  239.2056
  8     304.0154  0.8638966  242.7076

RMSE was used to select the optimal model using the smallest value.
The final value used for the model was mtry = 2.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">🌲 Random Forest Cross-Validation:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
🌲 Random Forest Cross-Validation:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"===================================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>===================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Random Forest - RMSE: %.1f (±%.1f), R²: %.3f (±%.3f)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">min</span>(cv_rf<span class="sc">$</span>results<span class="sc">$</span>RMSE), <span class="fu">sd</span>(cv_rf<span class="sc">$</span>resample<span class="sc">$</span>RMSE),</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">max</span>(cv_rf<span class="sc">$</span>results<span class="sc">$</span>Rsquared), <span class="fu">sd</span>(cv_rf<span class="sc">$</span>resample<span class="sc">$</span>Rsquared)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest - RMSE: 296.2 (±40.5), R²: 0.871 (±0.032)</code></pre>
</div>
</div>
</section>
<section id="variable-importance" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="variable-importance"><span class="header-section-number">5.2</span> Variable Importance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract variable importance</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>rf_importance <span class="ot">&lt;-</span> <span class="fu">varImp</span>(cv_rf)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_importance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>rf variable importance

                  Overall
sexmale            100.00
speciesGentoo       68.83
bill_depth_mm       68.63
flipper_length_mm   61.96
bill_length_mm      45.02
islandDream         27.56
speciesChinstrap    17.01
islandTorgersen      0.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize importance</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>importance_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rf_importance) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Random Forest Variable Importance"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Relative contribution to prediction accuracy"</span>) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(importance_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="rf-variable-importance.png" class="img-fluid figure-img"></p>
<figcaption>Variable importance plot showing which features contribute most to random forest predictions</figcaption>
</figure>
</div>
</section>
</section>
<section id="comprehensive-model-comparison" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Comprehensive Model Comparison</h1>
<p>Let’s create a complete comparison of all our models:</p>
<section id="performance-summary-table" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="performance-summary-table"><span class="header-section-number">6.1</span> Performance Summary Table</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile all cross-validation results</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>all_models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Simple"</span> <span class="ot">=</span> cv_simple,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Multiple"</span> <span class="ot">=</span> cv_multiple, </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Species"</span> <span class="ot">=</span> cv_species,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Polynomial"</span> <span class="ot">=</span> cv_poly,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Random Forest"</span> <span class="ot">=</span> cv_rf</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract performance metrics</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>model_performance <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(all_models, <span class="cf">function</span>(model) {</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE_mean =</span> <span class="fu">min</span>(model<span class="sc">$</span>results<span class="sc">$</span>RMSE),</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE_sd =</span> <span class="fu">sd</span>(model<span class="sc">$</span>resample<span class="sc">$</span>RMSE),</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rsquared_mean =</span> <span class="fu">max</span>(model<span class="sc">$</span>results<span class="sc">$</span>Rsquared),</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rsquared_sd =</span> <span class="fu">sd</span>(model<span class="sc">$</span>resample<span class="sc">$</span>Rsquared),</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAE_mean =</span> <span class="fu">min</span>(model<span class="sc">$</span>results<span class="sc">$</span>MAE)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>}, <span class="at">.id =</span> <span class="st">"Model"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(RMSE_mean)</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Format for display</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>model_performance_display <span class="ot">&lt;-</span> model_performance <span class="sc">%&gt;%</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, RMSE_mean, RMSE_sd),</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">R_squared =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f ± %.3f"</span>, Rsquared_mean, Rsquared_sd),</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAE =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f"</span>, MAE_mean)</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Model, RMSE, R_squared, MAE)</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(model_performance_display,</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Cross-Validation Performance Comparison (Mean ± Standard Deviation)"</span>,</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"RMSE (g)"</span>, <span class="st">"R²"</span>, <span class="st">"MAE (g)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Cross-Validation Performance Comparison (Mean ± Standard Deviation)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: left;">RMSE (g)</th>
<th style="text-align: left;">R²</th>
<th style="text-align: left;">MAE (g)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Random Forest</td>
<td style="text-align: left;">296.2 ± 40.5</td>
<td style="text-align: left;">0.871 ± 0.032</td>
<td style="text-align: left;">235.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Polynomial</td>
<td style="text-align: left;">310.8 ± 44.4</td>
<td style="text-align: left;">0.855 ± 0.046</td>
<td style="text-align: left;">249.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Species</td>
<td style="text-align: left;">315.7 ± 32.2</td>
<td style="text-align: left;">0.856 ± 0.022</td>
<td style="text-align: left;">251.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">Simple</td>
<td style="text-align: left;">390.9 ± 54.0</td>
<td style="text-align: left;">0.775 ± 0.038</td>
<td style="text-align: left;">314.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiple</td>
<td style="text-align: left;">392.6 ± 41.7</td>
<td style="text-align: left;">0.769 ± 0.049</td>
<td style="text-align: left;">312.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="statistical-significance-testing" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="statistical-significance-testing"><span class="header-section-number">6.2</span> Statistical Significance Testing</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform pairwise comparisons using resamples</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>model_resamples <span class="ot">&lt;-</span> <span class="fu">resamples</span>(all_models)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_resamples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
summary.resamples(object = model_resamples)

Models: Simple, Multiple, Species, Polynomial, Random Forest 
Number of resamples: 10 

MAE 
                  Min.  1st Qu.   Median     Mean  3rd Qu.     Max. NA's
Simple        241.3554 284.0399 320.8430 314.0739 338.4259 371.1883    0
Multiple      260.4224 299.3261 312.0693 312.9230 324.2053 361.2878    0
Species       221.3089 229.2132 249.0898 251.5796 266.4538 291.5125    0
Polynomial    202.4456 230.6144 239.4014 249.8384 260.2454 339.3528    0
Random Forest 160.8733 216.7519 228.7049 235.7196 262.9530 294.3425    0

RMSE 
                  Min.  1st Qu.   Median     Mean  3rd Qu.     Max. NA's
Simple        308.6200 349.3536 401.5457 390.8672 426.1235 458.9253    0
Multiple      313.5602 370.9372 386.3221 392.6475 414.3106 459.0243    0
Species       272.3076 291.1982 314.1444 315.7035 345.0607 357.2340    0
Polynomial    240.1316 291.2401 311.3770 310.8124 332.1709 397.4275    0
Random Forest 219.6603 272.3759 290.9904 296.1693 332.7067 345.1353    0

Rsquared 
                   Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA's
Simple        0.7338776 0.7504191 0.7629768 0.7753345 0.7986835 0.8402682    0
Multiple      0.6868671 0.7275708 0.7928215 0.7690730 0.7998317 0.8242159    0
Species       0.8296272 0.8381939 0.8522291 0.8558827 0.8744437 0.8906614    0
Polynomial    0.7579544 0.8363657 0.8517021 0.8548061 0.8848488 0.9257512    0
Random Forest 0.8231393 0.8479029 0.8780378 0.8709290 0.8823033 0.9407561    0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical comparison</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>model_differences <span class="ot">&lt;-</span> <span class="fu">diff</span>(model_resamples)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_differences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
summary.diff.resamples(object = model_differences)

p-value adjustment: bonferroni 
Upper diagonal: estimates of the difference
Lower diagonal: p-value for H0: difference = 0

MAE 
              Simple   Multiple Species  Polynomial Random Forest
Simple                  1.151   62.494   64.235     78.354       
Multiple      1.000000          61.343   63.085     77.203       
Species       0.073024 0.002911           1.741     15.860       
Polynomial    0.052589 0.003403 1.000000            14.119       
Random Forest 0.031252 0.002025 1.000000 1.000000                

RMSE 
              Simple   Multiple Species  Polynomial Random Forest
Simple                 -1.780   75.164   80.055     94.698       
Multiple      1.000000          76.944   81.835     96.478       
Species       0.089778 0.013250           4.891     19.534       
Polynomial    0.050086 0.001917 1.000000            14.643       
Random Forest 0.013082 0.000986 1.000000 1.000000                

Rsquared 
              Simple   Multiple  Species   Polynomial Random Forest
Simple                  0.006262 -0.080548 -0.079472  -0.095594    
Multiple      1.000000           -0.086810 -0.085733  -0.101856    
Species       0.008511 0.006787             0.001077  -0.015046    
Polynomial    0.061015 0.004296  1.000000             -0.016123    
Random Forest 0.001177 0.002549  1.000000  1.000000                </code></pre>
</div>
</div>
</section>
<section id="performance-visualization" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="performance-visualization"><span class="header-section-number">6.3</span> Performance Visualization</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comprehensive comparison plot</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>all_cv_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">names</span>(all_models), <span class="at">each =</span> <span class="dv">10</span>), <span class="at">levels =</span> <span class="fu">names</span>(all_models)),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">c</span>(cv_simple<span class="sc">$</span>resample<span class="sc">$</span>RMSE, cv_multiple<span class="sc">$</span>resample<span class="sc">$</span>RMSE, </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>           cv_species<span class="sc">$</span>resample<span class="sc">$</span>RMSE, cv_poly<span class="sc">$</span>resample<span class="sc">$</span>RMSE, cv_rf<span class="sc">$</span>resample<span class="sc">$</span>RMSE),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Rsquared =</span> <span class="fu">c</span>(cv_simple<span class="sc">$</span>resample<span class="sc">$</span>Rsquared, cv_multiple<span class="sc">$</span>resample<span class="sc">$</span>Rsquared,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>               cv_species<span class="sc">$</span>resample<span class="sc">$</span>Rsquared, cv_poly<span class="sc">$</span>resample<span class="sc">$</span>Rsquared, cv_rf<span class="sc">$</span>resample<span class="sc">$</span>Rsquared)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE comparison</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_cv_results, <span class="fu">aes</span>(<span class="at">x =</span> Model, <span class="at">y =</span> RMSE, <span class="at">fill =</span> Model)) <span class="sc">+</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cross-Validation RMSE Comparison"</span>,</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Lower is better; white diamonds show means"</span>,</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"RMSE (grams)"</span>) <span class="sc">+</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="co"># R² comparison  </span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_cv_results, <span class="fu">aes</span>(<span class="at">x =</span> Model, <span class="at">y =</span> Rsquared, <span class="at">fill =</span> Model)) <span class="sc">+</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cross-Validation R² Comparison"</span>,</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Higher is better; white diamonds show means"</span>, </span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"R-squared"</span>) <span class="sc">+</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>comprehensive_comparison <span class="ot">&lt;-</span> p3 <span class="sc">+</span> p4</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comprehensive_comparison)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="comprehensive-model-comparison.png" class="img-fluid figure-img"></p>
<figcaption>Comprehensive comparison of all models showing both RMSE and R² distributions from cross-validation</figcaption>
</figure>
</div>
</section>
</section>
<section id="the-bias-variance-tradeoff" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> The Bias-Variance Tradeoff</h1>
<p>Let’s examine how model complexity affects the bias-variance tradeoff:</p>
<section id="learning-curves" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="learning-curves"><span class="header-section-number">7.1</span> Learning Curves</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate learning curves</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>calculate_learning_curve <span class="ot">&lt;-</span> <span class="cf">function</span>(model_formula, data, <span class="at">train_sizes =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) {</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(train_sizes, <span class="cf">function</span>(size) {</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    n_train <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(data) <span class="sc">*</span> size)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perform multiple bootstrap samples</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    bootstrap_results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="cf">function</span>(i) {</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set.seed</span>(i)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>      train_idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(data), n_train)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>      train_data <span class="ot">&lt;-</span> data[train_idx, ]</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>      test_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>train_idx, ]</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Fit model</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>      model <span class="ot">&lt;-</span> <span class="fu">lm</span>(model_formula, <span class="at">data =</span> train_data)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate errors</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>      train_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, train_data)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>      test_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, test_data)</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">train_size =</span> size,</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">train_rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((train_data<span class="sc">$</span>body_mass_g <span class="sc">-</span> train_pred)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">test_rmse =</span> <span class="cf">if</span>(<span class="fu">nrow</span>(test_data) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data<span class="sc">$</span>body_mass_g <span class="sc">-</span> test_pred)<span class="sc">^</span><span class="dv">2</span>)) <span class="cf">else</span> <span class="cn">NA</span>,</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">bootstrap =</span> i</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    bootstrap_results</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>  results</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate learning curves for key models</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>learning_simple <span class="ot">&lt;-</span> <span class="fu">calculate_learning_curve</span>(</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>  body_mass_g <span class="sc">~</span> flipper_length_mm, penguins_clean)</span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>learning_species <span class="ot">&lt;-</span> <span class="fu">calculate_learning_curve</span>(</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>  body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span> flipper_length_mm <span class="sc">+</span> species, penguins_clean)</span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine and plot</span></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>learning_curves <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>  learning_simple <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"Simple"</span>),</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>  learning_species <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"Species"</span>)</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(train_rmse, test_rmse), <span class="at">names_to =</span> <span class="st">"Set"</span>, <span class="at">values_to =</span> <span class="st">"RMSE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Set =</span> <span class="fu">str_remove</span>(Set, <span class="st">"_rmse"</span>))</span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>learning_summary <span class="ot">&lt;-</span> learning_curves <span class="sc">%&gt;%</span></span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Model, train_size, Set) <span class="sc">%&gt;%</span></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE_mean =</span> <span class="fu">mean</span>(RMSE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE_se =</span> <span class="fu">sd</span>(RMSE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">n</span>()),</span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(learning_summary, <span class="fu">aes</span>(<span class="at">x =</span> train_size <span class="sc">*</span> <span class="fu">nrow</span>(penguins_clean), <span class="at">y =</span> RMSE_mean, </span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="fu">interaction</span>(Model, Set), <span class="at">linetype =</span> Set)) <span class="sc">+</span></span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> RMSE_mean <span class="sc">-</span> RMSE_se, <span class="at">ymax =</span> RMSE_mean <span class="sc">+</span> RMSE_se, </span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">interaction</span>(Model, Set)), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Learning Curves: Bias-Variance Tradeoff"</span>,</span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Training vs validation error as sample size increases"</span>,</span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Training Set Size"</span>, <span class="at">y =</span> <span class="st">"RMSE (grams)"</span>,</span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Model.Set"</span>, <span class="at">fill =</span> <span class="st">"Model.Set"</span>) <span class="sc">+</span></span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="learning-curves.png" class="img-fluid figure-img"></p>
<figcaption>Learning curves showing how training and validation error change with sample size</figcaption>
</figure>
</div>
</section>
</section>
<section id="key-insights-from-advanced-modeling" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Key Insights from Advanced Modeling</h1>
<section id="performance-hierarchy" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="performance-hierarchy"><span class="header-section-number">8.1</span> Performance Hierarchy</h2>
<p>Based on our rigorous cross-validation, here’s what we’ve learned:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract best performing model</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>best_model_idx <span class="ot">&lt;-</span> <span class="fu">which.min</span>(model_performance<span class="sc">$</span>RMSE_mean)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> model_performance<span class="sc">$</span>Model[best_model_idx]</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>best_rmse <span class="ot">&lt;-</span> model_performance<span class="sc">$</span>RMSE_mean[best_model_idx]</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>best_r2 <span class="ot">&lt;-</span> model_performance<span class="sc">$</span>Rsquared_mean[best_model_idx]</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"🏆 Model Performance Insights:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>🏆 Model Performance Insights:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"==============================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==============================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Best performing model: %s</span><span class="sc">\n</span><span class="st">"</span>, best_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best performing model: Random Forest</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Cross-validated RMSE: %.1f ± %.1f grams</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>            best_rmse, model_performance<span class="sc">$</span>RMSE_sd[best_model_idx]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cross-validated RMSE: 296.2 ± 40.5 grams</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Cross-validated R²: %.3f ± %.3f</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>            best_r2, model_performance<span class="sc">$</span>Rsquared_sd[best_model_idx]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cross-validated R²: 0.871 ± 0.032</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">📊 Key Findings:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
📊 Key Findings:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Linear models with species information perform excellently</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>• Linear models with species information perform excellently</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Polynomial features provide minimal improvement over linear relationships</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>• Polynomial features provide minimal improvement over linear relationships</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Random forests offer competitive but not superior performance</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>• Random forests offer competitive but not superior performance</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• Cross-validation confirms our models generalize well to new data</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>• Cross-validation confirms our models generalize well to new data</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"• The bias-variance tradeoff favors simpler models in this dataset</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>• The bias-variance tradeoff favors simpler models in this dataset</code></pre>
</div>
</div>
</section>
<section id="model-selection-recommendations" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="model-selection-recommendations"><span class="header-section-number">8.2</span> Model Selection Recommendations</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">💡 Model Selection Guidance:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
💡 Model Selection Guidance:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"============================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate confidence intervals for performance differences</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>species_vs_poly_diff <span class="ot">&lt;-</span> <span class="fu">mean</span>(cv_species<span class="sc">$</span>resample<span class="sc">$</span>RMSE <span class="sc">-</span> cv_poly<span class="sc">$</span>resample<span class="sc">$</span>RMSE)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>species_vs_rf_diff <span class="ot">&lt;-</span> <span class="fu">mean</span>(cv_species<span class="sc">$</span>resample<span class="sc">$</span>RMSE <span class="sc">-</span> cv_rf<span class="sc">$</span>resample<span class="sc">$</span>RMSE)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Species model vs Polynomial: %.1f grams RMSE difference</span><span class="sc">\n</span><span class="st">"</span>, species_vs_poly_diff))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Species model vs Polynomial: 4.9 grams RMSE difference</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Species model vs Random Forest: %.1f grams RMSE difference</span><span class="sc">\n</span><span class="st">"</span>, species_vs_rf_diff))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Species model vs Random Forest: 19.5 grams RMSE difference</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">🎯 Recommendation: The linear species model offers the best balance of:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
🎯 Recommendation: The linear species model offers the best balance of:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   • Excellent predictive performance</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Excellent predictive performance</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   • Model interpretability</span><span class="sc">\n</span><span class="st">"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Model interpretability</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   • Computational efficiency</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Computational efficiency</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   • Biological meaningfulness</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Biological meaningfulness</code></pre>
</div>
</div>
</section>
</section>
<section id="looking-ahead-to-part-4" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Looking Ahead to Part 4</h1>
<p>We’ve established that our species-aware linear model performs excellently under cross-validation, but important questions remain about model assumptions and diagnostic procedures:</p>
<ul>
<li>Are our regression assumptions satisfied?</li>
<li>How should we interpret residual patterns?</li>
<li>What do diagnostic plots tell us about model adequacy?</li>
<li>How robust are our results to outliers?</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🎯 Preview of Part 4
</div>
</div>
<div class="callout-body-container callout-body">
<p>In our next installment, we’ll dive deep into model diagnostics, residual analysis, and assumption checking. We’ll also explore influence diagnostics and learn how to identify and handle problematic observations that might affect our conclusions.</p>
</div>
</div>
</section>
<section id="reproducibility-information" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Reproducibility Information</h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.0 (2025-04-11)
Platform: aarch64-apple-darwin20
Running under: macOS Sequoia 15.5

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Los_Angeles
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] patchwork_1.3.1      knitr_1.50           caret_7.0-1         
 [4] lattice_0.22-6       randomForest_4.7-1.2 car_3.1-3           
 [7] carData_3.0-5        broom_1.0.8          lubridate_1.9.4     
[10] forcats_1.0.0        stringr_1.5.1        dplyr_1.1.4         
[13] purrr_1.0.4          readr_2.1.5          tidyr_1.3.1         
[16] tibble_3.3.0         ggplot2_3.5.2        tidyverse_2.0.0     
[19] palmerpenguins_0.1.1

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.1     timeDate_4041.110    farver_2.1.2        
 [4] fastmap_1.2.0        pROC_1.18.5          digest_0.6.37       
 [7] rpart_4.1.24         timechange_0.3.0     lifecycle_1.0.4     
[10] survival_3.8-3       magrittr_2.0.3       compiler_4.5.0      
[13] rlang_1.1.6          tools_4.5.0          yaml_2.3.10         
[16] data.table_1.17.4    labeling_0.4.3       htmlwidgets_1.6.4   
[19] plyr_1.8.9           RColorBrewer_1.1-3   abind_1.4-8         
[22] withr_3.0.2          nnet_7.3-20          grid_4.5.0          
[25] stats4_4.5.0         future_1.58.0        globals_0.18.0      
[28] scales_1.4.0         iterators_1.0.14     MASS_7.3-65         
[31] cli_3.6.5            rmarkdown_2.29       generics_0.1.4      
[34] future.apply_1.20.0  reshape2_1.4.4       tzdb_0.5.0          
[37] splines_4.5.0        parallel_4.5.0       vctrs_0.6.5         
[40] hardhat_1.4.1        Matrix_1.7-3         jsonlite_2.0.0      
[43] hms_1.1.3            Formula_1.2-5        listenv_0.9.1       
[46] foreach_1.5.2        gower_1.0.2          recipes_1.3.1       
[49] glue_1.8.0           parallelly_1.45.0    codetools_0.2-20    
[52] stringi_1.8.7        gtable_0.3.6         pillar_1.10.2       
[55] htmltools_0.5.8.1    ipred_0.9-15         lava_1.8.1          
[58] R6_2.6.1             evaluate_1.0.3       backports_1.5.0     
[61] class_7.3-23         Rcpp_1.0.14          nlme_3.1-168        
[64] prodlim_2025.04.28   xfun_0.52            pkgconfig_2.0.3     
[67] ModelMetrics_1.2.2.2</code></pre>
</div>
</div>
<hr>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🐧 Continue Your Journey
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ready to ensure your model meets all assumptions? Head to <a href="../palmer_penguins_part4/">Part 4: Model Diagnostics and Interpretation</a> where we’ll thoroughly validate our model assumptions!</p>
<p><strong>Full Series Navigation:</strong> 1. <a href="../palmer_penguins_part1/">Part 1: EDA and Simple Regression</a> ✅ 2. <a href="../palmer_penguins_part2/">Part 2: Multiple Regression and Species Effects</a> ✅ 3. <strong>Part 3: Advanced Models and Cross-Validation</strong> (This post) ✅ 4. <a href="../palmer_penguins_part4/">Part 4: Model Diagnostics and Interpretation</a> 5. <a href="../palmer_penguins_part5/">Part 5: Random Forest vs Linear Models</a></p>
</div>
</div>
<p><em>Have questions about cross-validation or model selection? Feel free to reach out on <a href="https://twitter.com/yourhandle">Twitter</a> or <a href="https://linkedin.com/in/yourprofile">LinkedIn</a>. You can also find the complete code for this series on <a href="https://github.com/yourusername/palmer-penguins-series">GitHub</a>.</em></p>
<p><strong>About the Author:</strong> [Your name] is a [your role] specializing in statistical ecology and machine learning. This series demonstrates best practices for model validation and selection in biological research.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{(ryy)_glenn_thomas2025,
  author = {(Ryy) Glenn Thomas, Ronald and Name, Your},
  title = {Palmer {Penguins} {Data} {Analysis} {Series} {(Part} 3):
    {Advanced} {Models} and {Cross-Validation}},
  date = {2025-01-03},
  url = {https://focusonr.org/posts/palmer_penguins_part3/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-(ryy)_glenn_thomas2025" class="csl-entry quarto-appendix-citeas" role="listitem">
(Ryy) Glenn Thomas, Ronald, and Your Name. 2025. <span>“Palmer Penguins
Data Analysis Series (Part 3): Advanced Models and
Cross-Validation.”</span> January 3, 2025. <a href="https://focusonr.org/posts/palmer_penguins_part3/">https://focusonr.org/posts/palmer_penguins_part3/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/focusonr\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="rgt47/qblog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2023-2025, Ronald G. Thomas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<!-- PDF view/download button for blog posts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Only add the button on post pages
  if (window.location.pathname.includes('/posts/') && !window.location.pathname.endsWith('/posts/') && !window.location.pathname.endsWith('/posts/index.html')) {
    var currentPath = window.location.pathname;
    var pdfPath = currentPath.replace('.html', '.pdf');

    // Check if PDF exists first
    fetch(pdfPath, { method: 'HEAD' })
      .then(function(response) {
        if (response.ok) {
          // PDF exists, show download button
          showDownloadButton(pdfPath);
        } else {
          // PDF doesn't exist, show link to generate
          showGenerateButton(currentPath);
        }
      })
      .catch(function() {
        // Error checking PDF, show generate button
        showGenerateButton(currentPath);
      });
  }
});

function showDownloadButton(pdfPath) {
  var downloadBtn = document.createElement('div');
  downloadBtn.className = 'pdf-download-button';

  // Get file size if possible
  fetch(pdfPath, { method: 'HEAD' })
    .then(function(response) {
      var size = response.headers.get('Content-Length');
      var sizeText = '';

      if (size) {
        // Convert to MB or KB
        var sizeInMB = size / (1024 * 1024);
        if (sizeInMB >= 1) {
          sizeText = ' (' + sizeInMB.toFixed(1) + ' MB)';
        } else {
          sizeText = ' (' + (size / 1024).toFixed(0) + ' KB)';
        }
      }

      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' + sizeText +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    })
    .catch(function() {
      // Basic fallback if we can't get file size
      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    });

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(downloadBtn);
  }
}

function showGenerateButton(htmlPath) {
  var qmdPath = htmlPath.replace('/posts/', 'posts/').replace('/index.html', '/index.qmd').replace('.html', '.qmd');

  var generateBtn = document.createElement('div');
  generateBtn.className = 'pdf-download-button';
  generateBtn.innerHTML =
    '<div class="alert alert-info d-flex align-items-center p-3" role="alert">' +
    '  <div class="me-3">' +
    '    <i class="bi bi-file-pdf" style="font-size: 1.5rem;"></i>' +
    '  </div>' +
    '  <div class="flex-grow-1">' +
    '    <strong>PDF Version Available</strong><br>' +
    '    <span class="small text-muted">This article can be generated as a PDF for offline reading or printing.</span>' +
    '  </div>' +
    '  <div>' +
    '    <button class="btn btn-outline-primary btn-sm" onclick="copyGenerateCommand(\'' + qmdPath + '\')">' +
    '      <i class="bi bi-clipboard me-1"></i>Copy Command' +
    '    </button>' +
    '  </div>' +
    '</div>' +
    '<div class="collapse mt-2" id="generateInstructions">' +
    '  <div class="card card-body bg-light">' +
    '    <small>' +
    '      <strong>To generate PDF:</strong> Run this command in your terminal:<br>' +
    '      <code class="user-select-all" id="generateCommand">./generate_pdf.sh ' + qmdPath + '</code>' +
    '    </small>' +
    '  </div>' +
    '</div>';

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(generateBtn);
  }
}

function copyGenerateCommand(qmdPath) {
  var command = './generate_pdf.sh ' + qmdPath;
  
  // Try to copy to clipboard
  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(command).then(function() {
      showCopyFeedback('Command copied to clipboard!');
    }, function() {
      showGenerateInstructions();
    });
  } else {
    // Fallback: show instructions
    showGenerateInstructions();
  }
}

function showCopyFeedback(message) {
  // Show brief success message
  var btn = event.target.closest('button');
  var originalHtml = btn.innerHTML;
  btn.innerHTML = '<i class="bi bi-check me-1"></i>Copied!';
  btn.classList.remove('btn-outline-primary');
  btn.classList.add('btn-success');
  
  setTimeout(function() {
    btn.innerHTML = originalHtml;
    btn.classList.remove('btn-success');
    btn.classList.add('btn-outline-primary');
  }, 2000);
}

function showGenerateInstructions() {
  // Toggle instructions visibility
  var instructions = document.getElementById('generateInstructions');
  if (instructions) {
    instructions.classList.toggle('show');
  }
}
</script>

<style>
.pdf-download-button {
  margin-top: 1rem;
  margin-bottom: 1rem;
}
</style>




</body></html>