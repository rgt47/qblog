<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ronald (Ryy) Glenn Thomas">
<meta name="dcterms.date" content="2025-05-13">

<title>RCT validation language ‚Äì Thomas Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;1,400&amp;family=Open+Sans:ital,wght@0,400;0,600;1,400&amp;family=Fira+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/0fba9333d8.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">

<!-- Custom meta tags for social sharing -->
<meta property="og:site_name" content="Thomas Lab">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@rgt47">

<!-- Add responsive features -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Add analytics if needed -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXX');
</script> -->

<!-- Add custom javascript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Remove code tools button completely
  const codeButton = document.querySelector('.code-tools-button');
  if (codeButton) {
    codeButton.remove();
  }
  
  // Add any custom JavaScript functionality here
  
  // Example: Add smooth scrolling
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      
      document.querySelector(this.getAttribute('href')).scrollIntoView({
        behavior: 'smooth'
      });
    });
  });
  
  // Make sidebar category items clickable (but not TOC items)
  const categoryLinks = {
    'Programming & Development': '/posts/?category=Programming+%26+Development',
    'Data Analysis & Visualization': '/posts/?category=Data+Analysis+%26+Visualization',
    'Deployment & Operations': '/posts/?category=Deployment+%26+Operations',
    'Development Environment': '/posts/?category=Development+Environment',
    'Shiny Applications': '/posts/?category=Shiny+Applications',
    'AI & Automation': '/posts/?category=AI+%26+Automation',
    'System Administration': '/posts/?category=System+Administration'
  };
  
  // Only target sidebar items that are not in the TOC
  document.querySelectorAll('.sidebar-item-section .sidebar-item-text').forEach(item => {
    // Skip if this is inside the TOC
    if (item.closest('#TOC')) return;
    
    const text = item.textContent.trim();
    if (categoryLinks[text]) {
      item.addEventListener('click', function() {
        window.location.href = categoryLinks[text];
      });
    }
  });
});
</script>


<meta property="og:title" content="RCT validation language ‚Äì Thomas Lab">
<meta property="og:description" content="">
<meta property="og:image" content="https://focusonr.org/posts/rct_validation_lang/img/lua.png">
<meta property="og:site_name" content="Thomas Lab">
<meta property="og:image:height" content="2000">
<meta property="og:image:width" content="3000">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Thomas Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="../../blog/index.html">
 <span class="dropdown-text">üì∞ Blog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/index.html">
 <span class="dropdown-text">üìö Tutorials</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../references/index.html">
 <span class="dropdown-text">üìã References</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../guides/index.html">
 <span class="dropdown-text">üõ†Ô∏è Guides</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../posts/index.html"> 
<span class="menu-text">All Posts</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-categories" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Categories</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-categories">    
        <li>
    <a class="dropdown-item" href="../../posts/index.html">
 <span class="dropdown-text">Programming &amp; Development</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/index.html">
 <span class="dropdown-text">Data Analysis &amp; Visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/index.html">
 <span class="dropdown-text">Deployment &amp; Operations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/index.html">
 <span class="dropdown-text">Development Environment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/index.html">
 <span class="dropdown-text">Shiny Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/index.html">
 <span class="dropdown-text">AI &amp; Automation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#consider-matlab-to-r-converter" id="toc-consider-matlab-to-r-converter" class="nav-link" data-scroll-target="#consider-matlab-to-r-converter"><span class="header-section-number">1.0.1</span> consider matlab to R converter</a></li>
  </ul></li>
  <li><a href="#tools-for-implementing-complex-data-validation-checks-in-edc-systems" id="toc-tools-for-implementing-complex-data-validation-checks-in-edc-systems" class="nav-link" data-scroll-target="#tools-for-implementing-complex-data-validation-checks-in-edc-systems"><span class="header-section-number">2</span> <strong>Tools for Implementing Complex Data Validation Checks in EDC Systems</strong></a>
  <ul class="collapse">
  <li><a href="#proprietary-edc-systems-with-built-in-validation" id="toc-proprietary-edc-systems-with-built-in-validation" class="nav-link" data-scroll-target="#proprietary-edc-systems-with-built-in-validation"><span class="header-section-number">2.1</span> <strong>1. Proprietary EDC Systems with Built-in Validation</strong></a></li>
  <li><a href="#open-source-edc-systems-with-custom-validation-capabilities" id="toc-open-source-edc-systems-with-custom-validation-capabilities" class="nav-link" data-scroll-target="#open-source-edc-systems-with-custom-validation-capabilities"><span class="header-section-number">2.2</span> <strong>2. Open-Source EDC Systems with Custom Validation Capabilities</strong></a>
  <ul class="collapse">
  <li><a href="#a.-openclinica" id="toc-a.-openclinica" class="nav-link" data-scroll-target="#a.-openclinica"><span class="header-section-number">2.2.1</span> <strong>a. OpenClinica</strong></a></li>
  <li><a href="#b.-redcap" id="toc-b.-redcap" class="nav-link" data-scroll-target="#b.-redcap"><span class="header-section-number">2.2.2</span> <strong>b. REDCap</strong></a></li>
  <li><a href="#c.-clincapture" id="toc-c.-clincapture" class="nav-link" data-scroll-target="#c.-clincapture"><span class="header-section-number">2.2.3</span> <strong>c.&nbsp;ClinCapture</strong></a></li>
  </ul></li>
  <li><a href="#custom-validation-using-general-purpose-tools" id="toc-custom-validation-using-general-purpose-tools" class="nav-link" data-scroll-target="#custom-validation-using-general-purpose-tools"><span class="header-section-number">2.3</span> <strong>3. Custom Validation Using General-Purpose Tools</strong></a>
  <ul class="collapse">
  <li><a href="#a.-r-for-data-validation" id="toc-a.-r-for-data-validation" class="nav-link" data-scroll-target="#a.-r-for-data-validation"><span class="header-section-number">2.3.1</span> <strong>a. R for Data Validation</strong></a></li>
  <li><a href="#b.-python-for-data-validation" id="toc-b.-python-for-data-validation" class="nav-link" data-scroll-target="#b.-python-for-data-validation"><span class="header-section-number">2.3.2</span> <strong>b. Python for Data Validation</strong></a></li>
  <li><a href="#c.-sql-for-data-integrity-checks" id="toc-c.-sql-for-data-integrity-checks" class="nav-link" data-scroll-target="#c.-sql-for-data-integrity-checks"><span class="header-section-number">2.3.3</span> <strong>c.&nbsp;SQL for Data Integrity Checks</strong></a></li>
  </ul></li>
  <li><a href="#integrating-validation-into-edc-workflows" id="toc-integrating-validation-into-edc-workflows" class="nav-link" data-scroll-target="#integrating-validation-into-edc-workflows"><span class="header-section-number">2.4</span> <strong>4. Integrating Validation into EDC Workflows</strong></a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">2.5</span> <strong>Conclusion</strong></a></li>
  </ul></li>
  <li><a href="#shiny-form-validation-with-relational-data-and-machine-learning" id="toc-shiny-form-validation-with-relational-data-and-machine-learning" class="nav-link" data-scroll-target="#shiny-form-validation-with-relational-data-and-machine-learning"><span class="header-section-number">3</span> <strong>Shiny Form Validation with Relational Data and Machine Learning</strong></a>
  <ul class="collapse">
  <li><a href="#can-shiny-create-forms-with-real-time-validation" id="toc-can-shiny-create-forms-with-real-time-validation" class="nav-link" data-scroll-target="#can-shiny-create-forms-with-real-time-validation"><span class="header-section-number">3.1</span> <strong>Can Shiny Create Forms with Real-Time Validation?</strong></a></li>
  <li><a href="#methods-for-real-time-validation-in-shiny" id="toc-methods-for-real-time-validation-in-shiny" class="nav-link" data-scroll-target="#methods-for-real-time-validation-in-shiny"><span class="header-section-number">3.2</span> <strong>Methods for Real-Time Validation in Shiny</strong></a>
  <ul class="collapse">
  <li><a href="#validate-and-need-for-simple-input-validation" id="toc-validate-and-need-for-simple-input-validation" class="nav-link" data-scroll-target="#validate-and-need-for-simple-input-validation"><span class="header-section-number">3.2.1</span> <strong>1. <code>validate()</code> and <code>need()</code> for Simple Input Validation</strong></a></li>
  <li><a href="#shinyvalidate-package-for-advanced-form-validation" id="toc-shinyvalidate-package-for-advanced-form-validation" class="nav-link" data-scroll-target="#shinyvalidate-package-for-advanced-form-validation"><span class="header-section-number">3.2.2</span> <strong>2. <code>shinyvalidate</code> Package for Advanced Form Validation</strong></a></li>
  <li><a href="#javascript-based-validation-for-immediate-feedback" id="toc-javascript-based-validation-for-immediate-feedback" class="nav-link" data-scroll-target="#javascript-based-validation-for-immediate-feedback"><span class="header-section-number">3.2.3</span> <strong>3. JavaScript-Based Validation for Immediate Feedback</strong></a></li>
  </ul></li>
  <li><a href="#can-javascript-access-relational-data-and-machine-learning-tools" id="toc-can-javascript-access-relational-data-and-machine-learning-tools" class="nav-link" data-scroll-target="#can-javascript-access-relational-data-and-machine-learning-tools"><span class="header-section-number">3.3</span> <strong>Can JavaScript Access Relational Data and Machine Learning Tools?</strong></a></li>
  <li><a href="#using-indexeddb-for-local-relational-data-validation" id="toc-using-indexeddb-for-local-relational-data-validation" class="nav-link" data-scroll-target="#using-indexeddb-for-local-relational-data-validation"><span class="header-section-number">3.4</span> <strong>1. Using IndexedDB for Local Relational Data Validation</strong></a></li>
  <li><a href="#using-ajax-to-query-a-remote-sql-database" id="toc-using-ajax-to-query-a-remote-sql-database" class="nav-link" data-scroll-target="#using-ajax-to-query-a-remote-sql-database"><span class="header-section-number">3.5</span> <strong>2. Using AJAX to Query a Remote SQL Database</strong></a></li>
  <li><a href="#calling-a-machine-learning-model-for-validation" id="toc-calling-a-machine-learning-model-for-validation" class="nav-link" data-scroll-target="#calling-a-machine-learning-model-for-validation"><span class="header-section-number">3.6</span> <strong>3. Calling a Machine Learning Model for Validation</strong></a></li>
  <li><a href="#choosing-the-best-approach" id="toc-choosing-the-best-approach" class="nav-link" data-scroll-target="#choosing-the-best-approach"><span class="header-section-number">3.7</span> <strong>Choosing the Best Approach</strong></a></li>
  <li><a href="#conclusion-1" id="toc-conclusion-1" class="nav-link" data-scroll-target="#conclusion-1"><span class="header-section-number">3.8</span> <strong>Conclusion</strong></a></li>
  </ul></li>
  <li><a href="#spreadsheet-driven-validation-system-for-shiny-forms" id="toc-spreadsheet-driven-validation-system-for-shiny-forms" class="nav-link" data-scroll-target="#spreadsheet-driven-validation-system-for-shiny-forms"><span class="header-section-number">4</span> <strong>Spreadsheet-Driven Validation System for Shiny Forms</strong></a>
  <ul class="collapse">
  <li><a href="#your-idea-spreadsheet-driven-validation-system" id="toc-your-idea-spreadsheet-driven-validation-system" class="nav-link" data-scroll-target="#your-idea-spreadsheet-driven-validation-system"><span class="header-section-number">4.1</span> <strong>Your Idea: Spreadsheet-Driven Validation System</strong></a></li>
  <li><a href="#has-this-been-done-before" id="toc-has-this-been-done-before" class="nav-link" data-scroll-target="#has-this-been-done-before"><span class="header-section-number">4.2</span> <strong>Has This Been Done Before?</strong></a></li>
  <li><a href="#why-this-is-a-good-idea" id="toc-why-this-is-a-good-idea" class="nav-link" data-scroll-target="#why-this-is-a-good-idea"><span class="header-section-number">4.3</span> <strong>Why This is a Good Idea</strong></a></li>
  <li><a href="#how-it-would-work" id="toc-how-it-would-work" class="nav-link" data-scroll-target="#how-it-would-work"><span class="header-section-number">4.4</span> <strong>How It Would Work</strong></a>
  <ul class="collapse">
  <li><a href="#define-rules-in-a-spreadsheet" id="toc-define-rules-in-a-spreadsheet" class="nav-link" data-scroll-target="#define-rules-in-a-spreadsheet"><span class="header-section-number">4.4.1</span> <strong>1. Define Rules in a Spreadsheet</strong></a></li>
  <li><a href="#lua-script-processes-the-spreadsheet" id="toc-lua-script-processes-the-spreadsheet" class="nav-link" data-scroll-target="#lua-script-processes-the-spreadsheet"><span class="header-section-number">4.4.2</span> <strong>2. Lua Script Processes the Spreadsheet</strong></a></li>
  <li><a href="#javascript-file-is-included-in-shiny" id="toc-javascript-file-is-included-in-shiny" class="nav-link" data-scroll-target="#javascript-file-is-included-in-shiny"><span class="header-section-number">4.4.3</span> <strong>3. JavaScript File is Included in Shiny</strong></a></li>
  </ul></li>
  <li><a href="#advantages-of-this-approach" id="toc-advantages-of-this-approach" class="nav-link" data-scroll-target="#advantages-of-this-approach"><span class="header-section-number">4.5</span> <strong>Advantages of This Approach</strong></a></li>
  <li><a href="#potential-enhancements" id="toc-potential-enhancements" class="nav-link" data-scroll-target="#potential-enhancements"><span class="header-section-number">4.6</span> <strong>Potential Enhancements</strong></a>
  <ul class="collapse">
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">4.6.1</span> <strong>Next Steps</strong></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#dynamic-rule-reloading-and-database-integration-for-shiny-forms" id="toc-dynamic-rule-reloading-and-database-integration-for-shiny-forms" class="nav-link" data-scroll-target="#dynamic-rule-reloading-and-database-integration-for-shiny-forms"><span class="header-section-number">5</span> <strong>Dynamic Rule Reloading and Database Integration for Shiny Forms</strong></a>
  <ul class="collapse">
  <li><a href="#dynamic-rule-reloading-spreadsheet-based" id="toc-dynamic-rule-reloading-spreadsheet-based" class="nav-link" data-scroll-target="#dynamic-rule-reloading-spreadsheet-based"><span class="header-section-number">5.1</span> <strong>1. Dynamic Rule Reloading (Spreadsheet-Based)</strong></a>
  <ul class="collapse">
  <li><a href="#a.-spreadsheet-format-validation_rules.csv" id="toc-a.-spreadsheet-format-validation_rules.csv" class="nav-link" data-scroll-target="#a.-spreadsheet-format-validation_rules.csv"><span class="header-section-number">5.1.1</span> <strong>A. Spreadsheet Format (<code>validation_rules.csv</code>)</strong></a></li>
  <li><a href="#b.-lua-script-to-convert-csv-to-javascript-process_validation.lua" id="toc-b.-lua-script-to-convert-csv-to-javascript-process_validation.lua" class="nav-link" data-scroll-target="#b.-lua-script-to-convert-csv-to-javascript-process_validation.lua"><span class="header-section-number">5.1.2</span> <strong>B. Lua Script to Convert CSV to JavaScript (<code>process_validation.lua</code>)</strong></a></li>
  <li><a href="#c.-shiny-app-with-automatic-rule-reloading-app.r" id="toc-c.-shiny-app-with-automatic-rule-reloading-app.r" class="nav-link" data-scroll-target="#c.-shiny-app-with-automatic-rule-reloading-app.r"><span class="header-section-number">5.1.3</span> <strong>C. Shiny App with Automatic Rule Reloading (<code>app.R</code>)</strong></a></li>
  </ul></li>
  <li><a href="#database-integration-for-validation-rules" id="toc-database-integration-for-validation-rules" class="nav-link" data-scroll-target="#database-integration-for-validation-rules"><span class="header-section-number">5.2</span> <strong>2. Database Integration for Validation Rules</strong></a>
  <ul class="collapse">
  <li><a href="#a.-database-schema" id="toc-a.-database-schema" class="nav-link" data-scroll-target="#a.-database-schema"><span class="header-section-number">5.2.1</span> <strong>A. Database Schema</strong></a></li>
  <li><a href="#b.-lua-script-to-fetch-rules-from-database-process_validation_db.lua" id="toc-b.-lua-script-to-fetch-rules-from-database-process_validation_db.lua" class="nav-link" data-scroll-target="#b.-lua-script-to-fetch-rules-from-database-process_validation_db.lua"><span class="header-section-number">5.2.2</span> <strong>B. Lua Script to Fetch Rules from Database (<code>process_validation_db.lua</code>)</strong></a></li>
  <li><a href="#c.-modify-shiny-to-fetch-rules-from-database" id="toc-c.-modify-shiny-to-fetch-rules-from-database" class="nav-link" data-scroll-target="#c.-modify-shiny-to-fetch-rules-from-database"><span class="header-section-number">5.2.3</span> <strong>C. Modify Shiny to Fetch Rules from Database</strong></a></li>
  </ul></li>
  <li><a href="#comparison-spreadsheet-vs.-database" id="toc-comparison-spreadsheet-vs.-database" class="nav-link" data-scroll-target="#comparison-spreadsheet-vs.-database"><span class="header-section-number">5.3</span> <strong>Comparison: Spreadsheet vs.&nbsp;Database</strong></a></li>
  <li><a href="#next-steps-1" id="toc-next-steps-1" class="nav-link" data-scroll-target="#next-steps-1"><span class="header-section-number">5.4</span> <strong>Next Steps</strong></a></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites"><span class="header-section-number">5.5</span> Prerequisites</a></li>
  <li><a href="#step-by-step-implementation" id="toc-step-by-step-implementation" class="nav-link" data-scroll-target="#step-by-step-implementation"><span class="header-section-number">5.6</span> Step-by-Step Implementation</a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways"><span class="header-section-number">5.7</span> Key Takeaways</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">5.8</span> Further Reading</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">RCT validation language</h1>
</div>


<div class="quarto-title-meta-author column-body">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://rgtlab.org">Ronald (Ryy) Glenn Thomas</a> <a href="https://orcid.org/0000-0003-1686-4965" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://ucsd.edu">
            UCSD
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta column-body">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 13, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>



<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img/lua.png" class="img-fluid"></p>
</div></div><section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Consider a simple programming language to capture the essence of clinical trial data base validation logic.</p>
<p>Similar in concept to Coffeescript (compiles to Lua) or Moonscript (compiles to Javascript).</p>
<p>Idea is for trial design and initiation team to collaborate (say on gppgle docs) to develop the quality control validation logic and then translate that language into a series of snippets in Lua (using Lpeg)</p>
<p>https://www.inf.puc-rio.br/~roberto/lpeg/</p>
<section id="consider-matlab-to-r-converter" class="level3" data-number="1.0.1">
<h3 data-number="1.0.1" class="anchored" data-anchor-id="consider-matlab-to-r-converter"><span class="header-section-number">1.0.1</span> consider matlab to R converter</h3>
<p><a href="https://cran.r-project.org/web/packages/matconv/index.html">CRAN - Package matconv</a></p>
<p>Consider using openClinica as a starting point.</p>
<p>Ensuring data accuracy and integrity is crucial in clinical trials, as it directly impacts the reliability of study outcomes and regulatory compliance. Data validation encompasses a series of processes aimed at verifying that the collected data is accurate, complete, and consistent.</p>
<p>Key Components of Data Validation: 1. Edit Checks: Automated rules applied during data entry to identify discrepancies, such as out-of-range values or logical inconsistencies. These checks prompt immediate corrections, enhancing data quality. 2. Source Data Verification (SDV): A process where data entered into the case report forms (CRFs) is cross-verified with original source documents to ensure accuracy. While traditional SDV involves comprehensive verification, targeted SDV focuses on critical data points, optimizing resources without compromising data integrity. Ôøº 3. Batch Validation: Periodic reviews of accumulated data to identify trends or patterns indicating potential errors, allowing for timely interventions.</p>
<p>Implementing Effective Data Validation: ‚Ä¢ Standardization: Utilizing standardized data formats and terminologies ensures uniformity across multiple sites and studies, facilitating easier data aggregation and analysis. ‚Ä¢ Validation Plans: Developing comprehensive data validation plans that outline specific checks, procedures, and responsible personnel helps in systematically ensuring data quality. ‚Ä¢ Advanced Technologies: Employing Electronic Data Capture (EDC) systems with built-in validation functionalities streamlines data entry and validation processes, reducing manual errors. Ôøº</p>
<p>Regulatory Compliance:</p>
<p>Adhering to regulatory guidelines, such as those from the FDA and EMA, is essential. These guidelines emphasize the importance of data integrity and provide frameworks for implementing effective data validation processes. Ôøº</p>
<p>Challenges and Considerations:</p>
<p>Common challenges in data validation include managing large volumes of data, ensuring consistency across multiple sites, and maintaining data integrity throughout the trial. Addressing these challenges requires a combination of robust validation procedures, continuous training for personnel, and leveraging technological solutions to automate and monitor data validation activities.</p>
<p>In summary, data validation is a critical aspect of clinical data management, ensuring that the information collected during trials is reliable and accurate. Implementing structured validation processes, supported by technology and adherence to regulatory standards, enhances the credibility of clinical trial outcomes.</p>
<p>Electronic Data Capture (EDC) systems allow for advanced, automated data validation checks to ensure high data quality and integrity in clinical trials. In addition to basic range and format checks, here are some complex validation checks that can be programmed into EDC systems:</p>
<ol type="1">
<li><p>Temporal Consistency Checks ‚Ä¢ Ensures that date/time fields follow logical sequences. ‚Ä¢ Example: Visit date cannot be earlier than screening date or Adverse event resolution date must be after the event start date.</p></li>
<li><p>Cross-field Logical Consistency Checks ‚Ä¢ Validates relationships between multiple data fields. ‚Ä¢ Example: If a participant is marked as pregnant, then gender must be female. ‚Ä¢ Example: If a patient has received a COVID-19 vaccine, they should not be marked as ‚Äúunvaccinated.‚Äù</p></li>
<li><p>Protocol Adherence Checks ‚Ä¢ Ensures data aligns with the study protocol. ‚Ä¢ Example: Weight-based drug dosage should be within protocol-defined limits based on patient body weight. ‚Ä¢ Example: Inclusion/exclusion criteria verification (e.g., Age must be between 18-65 years for eligibility).</p></li>
<li><p>Range Checks with Dynamic Thresholds ‚Ä¢ Instead of using static limits, thresholds are dynamically adjusted based on patient demographics or prior values. ‚Ä¢ Example: A hemoglobin level drop greater than 2 g/dL from baseline triggers a flag, rather than using a fixed normal range.</p></li>
<li><p>Plausibility Checks Using Historical Data ‚Ä¢ Detects outliers based on patient history or known disease patterns. ‚Ä¢ Example: A patient‚Äôs blood pressure should not suddenly drop from 140/90 to 80/40 unless a serious adverse event is recorded.</p></li>
<li><p>Missing Data Pattern Recognition ‚Ä¢ Flags missing data based on expected entry patterns. ‚Ä¢ Example: If ‚ÄúYes‚Äù is marked for ‚ÄúDid the patient receive treatment?‚Äù, then treatment details must be entered.</p></li>
<li><p>MedDRA/WHO Drug Dictionary Validation ‚Ä¢ Checks that reported adverse events and medications match standardized medical dictionaries. ‚Ä¢ Example: If ‚ÄúHeadache‚Äù is entered as an adverse event, it must map to the correct MedDRA term.</p></li>
<li><p>Conditional Queries Based on Risk-Based Monitoring ‚Ä¢ Uses machine learning or statistical rules to prioritize data review. ‚Ä¢ Example: If a site has a higher rate of protocol deviations, trigger additional data validation checks.</p></li>
<li><p>Visit and Event Sequencing Checks ‚Ä¢ Ensures that study visits and procedures occur in the correct order. ‚Ä¢ Example: Randomization must occur before the first dose of study drug is recorded.</p></li>
<li><p>Duplicate Record Detection ‚Ä¢ Identifies duplicate patients or entries using probabilistic matching. ‚Ä¢ Example: If two records have identical name, DOB, and enrollment date, trigger an alert for possible duplicate entry.</p></li>
</ol>
</section>
</section>
<section id="tools-for-implementing-complex-data-validation-checks-in-edc-systems" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> <strong>Tools for Implementing Complex Data Validation Checks in EDC Systems</strong></h1>
<section id="proprietary-edc-systems-with-built-in-validation" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="proprietary-edc-systems-with-built-in-validation"><span class="header-section-number">2.1</span> <strong>1. Proprietary EDC Systems with Built-in Validation</strong></h2>
<ul>
<li><strong>Medidata Rave</strong> (uses Medidata Rave Edit Check Scripts)</li>
<li><strong>Oracle Clinical / InForm</strong> (PL/SQL-based validation)</li>
<li><strong>IBM Clinical Development</strong></li>
<li><strong>Veeva Vault EDC</strong></li>
<li><strong>Castor EDC</strong></li>
<li>Provide graphical interfaces or scripting languages for validation rules.</li>
</ul>
<hr>
</section>
<section id="open-source-edc-systems-with-custom-validation-capabilities" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="open-source-edc-systems-with-custom-validation-capabilities"><span class="header-section-number">2.2</span> <strong>2. Open-Source EDC Systems with Custom Validation Capabilities</strong></h2>
<section id="a.-openclinica" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="a.-openclinica"><span class="header-section-number">2.2.1</span> <strong>a. OpenClinica</strong></h3>
<ul>
<li><p><strong>Validation Features:</strong></p>
<ul>
<li>Real-time edit checks (range, cross-field, logic-based).</li>
<li>Uses <strong>XPath expressions</strong> for validation.</li>
</ul></li>
<li><p><strong>Example Implementation:</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">rule</span>&gt;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">when</span>&gt;</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        /StudyEventData/FormData/ItemGroupData/ItemData[@ItemOID='AGE'] &gt; 100</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">when</span>&gt;</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">then</span>&gt;</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">message</span>&gt;Age cannot be greater than 100 years.&lt;/<span class="kw">message</span>&gt;</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">then</span>&gt;</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">rule</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Website:</strong> <a href="https://www.openclinica.com/">openclinica.com</a></p></li>
</ul>
<hr>
</section>
<section id="b.-redcap" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="b.-redcap"><span class="header-section-number">2.2.2</span> <strong>b. REDCap</strong></h3>
<ul>
<li><p><strong>Validation Features:</strong></p>
<ul>
<li>Real-time <strong>range and logic checks</strong>.</li>
<li>Uses <strong>branching logic</strong> and <strong>calculated fields</strong>.</li>
<li>Custom <strong>data quality rules</strong> via SQL queries.</li>
</ul></li>
<li><p><strong>Example Implementation:</strong></p>
<pre class="text"><code>[age] &gt; 18 AND [age] &lt; 65</code></pre></li>
<li><p><strong>Website:</strong> <a href="https://projectredcap.org/">projectredcap.org</a></p></li>
</ul>
<hr>
</section>
<section id="c.-clincapture" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="c.-clincapture"><span class="header-section-number">2.2.3</span> <strong>c.&nbsp;ClinCapture</strong></h3>
<ul>
<li><strong>Validation Features:</strong>
<ul>
<li>JavaScript-based validation for logic and range checks.</li>
<li>Custom queries to detect missing or inconsistent data.</li>
</ul></li>
<li><strong>Website:</strong> <a href="https://www.clincapture.com/">clincapture.com</a></li>
</ul>
<hr>
</section>
</section>
<section id="custom-validation-using-general-purpose-tools" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="custom-validation-using-general-purpose-tools"><span class="header-section-number">2.3</span> <strong>3. Custom Validation Using General-Purpose Tools</strong></h2>
<section id="a.-r-for-data-validation" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="a.-r-for-data-validation"><span class="header-section-number">2.3.1</span> <strong>a. R for Data Validation</strong></h3>
<ul>
<li><p><strong>Libraries:</strong> <code>validate</code>, <code>pointblank</code></p></li>
<li><p><strong>Example:</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(validate)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> <span class="fu">validator</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  age <span class="sc">&gt;=</span> <span class="dv">18</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  bmi <span class="sc">&gt;=</span> <span class="dv">15</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;=</span> <span class="dv">50</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  start_date <span class="sc">&lt;</span> end_date</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>check_results <span class="ot">&lt;-</span> <span class="fu">confront</span>(data, rules)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(check_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<hr>
</section>
<section id="b.-python-for-data-validation" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="b.-python-for-data-validation"><span class="header-section-number">2.3.2</span> <strong>b. Python for Data Validation</strong></h3>
<ul>
<li><p><strong>Libraries:</strong> <code>pandera</code>, <code>cerberus</code></p></li>
<li><p><strong>Example:</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandera <span class="im">import</span> DataFrameSchema, Column, Check</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> DataFrameSchema({</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age"</span>: Column(<span class="bu">int</span>, Check(<span class="kw">lambda</span> x: <span class="dv">18</span> <span class="op">&lt;=</span> x <span class="op">&lt;=</span> <span class="dv">65</span>, error<span class="op">=</span><span class="st">"Age must be 18-65"</span>)),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"bmi"</span>: Column(<span class="bu">float</span>, Check(<span class="kw">lambda</span> x: <span class="dv">15</span> <span class="op">&lt;=</span> x <span class="op">&lt;=</span> <span class="dv">50</span>, error<span class="op">=</span><span class="st">"BMI must be realistic"</span>)),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"start_date"</span>: Column(<span class="bu">str</span>),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"end_date"</span>: Column(<span class="bu">str</span>, Check(<span class="kw">lambda</span> x, y: x <span class="op">&lt;</span> y, error<span class="op">=</span><span class="st">"Start date must be before end date"</span>))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>validated_data <span class="op">=</span> schema.validate(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<hr>
</section>
<section id="c.-sql-for-data-integrity-checks" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="c.-sql-for-data-integrity-checks"><span class="header-section-number">2.3.3</span> <strong>c.&nbsp;SQL for Data Integrity Checks</strong></h3>
<ul>
<li><p><strong>Example:</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> patient_id, age</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> clinical_data</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> age <span class="op">&lt;</span> <span class="dv">18</span> <span class="kw">OR</span> age <span class="op">&gt;</span> <span class="dv">100</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<hr>
</section>
</section>
<section id="integrating-validation-into-edc-workflows" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="integrating-validation-into-edc-workflows"><span class="header-section-number">2.4</span> <strong>4. Integrating Validation into EDC Workflows</strong></h2>
<ul>
<li><strong>Automated Validation Pipelines:</strong> Apache NiFi, Talend, Pentaho for ETL-based validation.</li>
<li><strong>FHIR/CDISC Compliance:</strong> OpenCDISC Validator for CDISC standards (SDTM/ADaM).</li>
</ul>
<hr>
</section>
<section id="conclusion" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">2.5</span> <strong>Conclusion</strong></h2>
<ul>
<li><strong>For real-time validation:</strong> OpenClinica, REDCap, and ClinCapture provide built-in rule engines.</li>
<li><strong>For custom validation:</strong> R, Python, and SQL offer greater flexibility. <strong>Which approach fits your use case best?</strong></li>
</ul>
</section>
</section>
<section id="shiny-form-validation-with-relational-data-and-machine-learning" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> <strong>Shiny Form Validation with Relational Data and Machine Learning</strong></h1>
<section id="can-shiny-create-forms-with-real-time-validation" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="can-shiny-create-forms-with-real-time-validation"><span class="header-section-number">3.1</span> <strong>Can Shiny Create Forms with Real-Time Validation?</strong></h2>
<p>Yes, <strong>Shiny</strong> can create forms with <strong>real-time validation</strong> by using built-in reactive validation functions and JavaScript-based checks. Shiny provides several approaches for validating user input before submission.</p>
<hr>
</section>
<section id="methods-for-real-time-validation-in-shiny" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="methods-for-real-time-validation-in-shiny"><span class="header-section-number">3.2</span> <strong>Methods for Real-Time Validation in Shiny</strong></h2>
<section id="validate-and-need-for-simple-input-validation" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="validate-and-need-for-simple-input-validation"><span class="header-section-number">3.2.1</span> <strong>1. <code>validate()</code> and <code>need()</code> for Simple Input Validation</strong></h3>
<ul>
<li>These functions allow dynamic validation of form inputs.</li>
<li>Error messages are displayed <strong>instantly</strong> when an invalid input is detected.</li>
</ul>
<section id="example-age-validation-must-be-between-18-65" class="level4" data-number="3.2.1.1">
<h4 data-number="3.2.1.1" class="anchored" data-anchor-id="example-age-validation-must-be-between-18-65"><span class="header-section-number">3.2.1.1</span> <strong>Example: Age Validation (Must be Between 18-65)</strong></h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"Real-Time Validation Example"</span>),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sidebarPanel</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">numericInput</span>(<span class="st">"age"</span>, <span class="st">"Enter Age:"</span>, <span class="at">value =</span> <span class="cn">NULL</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">100</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">verbatimTextOutput</span>(<span class="st">"validation_message"</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">actionButton</span>(<span class="st">"submit"</span>, <span class="st">"Submit"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mainPanel</span>()</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>validation_message <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">validate</span>(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">need</span>(input<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span>, <span class="st">"Age must be at least 18"</span>),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">need</span>(input<span class="sc">$</span>age <span class="sc">&lt;=</span> <span class="dv">65</span>, <span class="st">"Age must be 65 or below"</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Valid input!"</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="shinyvalidate-package-for-advanced-form-validation" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="shinyvalidate-package-for-advanced-form-validation"><span class="header-section-number">3.2.2</span> <strong>2. <code>shinyvalidate</code> Package for Advanced Form Validation</strong></h3>
<p>The <code>shinyvalidate</code> package allows multiple <strong>dependent</strong> form inputs to be validated <strong>before submission</strong>.</p>
<section id="example-multiple-field-validation-email-age" class="level4" data-number="3.2.2.1">
<h4 data-number="3.2.2.1" class="anchored" data-anchor-id="example-multiple-field-validation-email-age"><span class="header-section-number">3.2.2.1</span> <strong>Example: Multiple Field Validation (Email &amp; Age)</strong></h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinyvalidate)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"Shinyvalidate Example"</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">textInput</span>(<span class="st">"email"</span>, <span class="st">"Enter Email:"</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">numericInput</span>(<span class="st">"age"</span>, <span class="st">"Enter Age:"</span>, <span class="at">value =</span> <span class="cn">NULL</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">100</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">actionButton</span>(<span class="st">"submit"</span>, <span class="st">"Submit"</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">verbatimTextOutput</span>(<span class="st">"validation_message"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    iv <span class="ot">&lt;-</span> InputValidator<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    iv<span class="sc">$</span><span class="fu">add_rule</span>(<span class="st">"email"</span>, <span class="fu">sv_email</span>()) <span class="co"># Validates email format</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    iv<span class="sc">$</span><span class="fu">add_rule</span>(<span class="st">"age"</span>, <span class="fu">sv_between</span>(<span class="dv">18</span>, <span class="dv">65</span>)) <span class="co"># Age must be between 18 and 65</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    iv<span class="sc">$</span><span class="fu">enable</span>()</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">observeEvent</span>(input<span class="sc">$</span>submit, {</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (iv<span class="sc">$</span><span class="fu">is_valid</span>()) {</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">showModal</span>(<span class="fu">modalDialog</span>(<span class="st">"Form submitted successfully!"</span>))</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">showModal</span>(<span class="fu">modalDialog</span>(<span class="st">"Please fix errors before submitting."</span>))</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="javascript-based-validation-for-immediate-feedback" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="javascript-based-validation-for-immediate-feedback"><span class="header-section-number">3.2.3</span> <strong>3. JavaScript-Based Validation for Immediate Feedback</strong></h3>
<p>Shiny supports <strong>JavaScript validation</strong> for client-side real-time validation <strong>before</strong> sending data to the server.</p>
<section id="example-real-time-numeric-input-restriction" class="level4" data-number="3.2.3.1">
<h4 data-number="3.2.3.1" class="anchored" data-anchor-id="example-real-time-numeric-input-restriction"><span class="header-section-number">3.2.3.1</span> <strong>Example: Real-Time Numeric Input Restriction</strong></h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    tags<span class="sc">$</span><span class="fu">script</span>(<span class="fu">HTML</span>(<span class="st">"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">        function validateNumericInput() {</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">            var input = document.getElementById('numInput').value;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">            if (isNaN(input) || input &lt; 1 || input &gt; 100) {</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">                document.getElementById('error').innerHTML = 'Enter a valid number (1-100)';</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">                document.getElementById('error').innerHTML = '';</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="st">    "</span>)),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">textInput</span>(<span class="st">"numInput"</span>, <span class="st">"Enter a number:"</span>, <span class="st">""</span>, <span class="at">oninput =</span> <span class="st">"validateNumericInput()"</span>),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">span</span>(<span class="at">id =</span> <span class="st">"error"</span>, <span class="at">style =</span> <span class="st">"color: red;"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {}</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
</section>
<section id="can-javascript-access-relational-data-and-machine-learning-tools" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="can-javascript-access-relational-data-and-machine-learning-tools"><span class="header-section-number">3.3</span> <strong>Can JavaScript Access Relational Data and Machine Learning Tools?</strong></h2>
<p>Yes, <strong>JavaScript</strong> can access <strong>relational datasets</strong> and <strong>machine learning tools</strong> for real-time validation. This can be achieved through:</p>
<ol type="1">
<li><strong>Client-Side Validation via IndexedDB</strong> (local relational database in browser)</li>
<li><strong>AJAX Requests to Query a Remote Database</strong> (MySQL, PostgreSQL, etc.)</li>
<li><strong>Calling a Machine Learning Model via an API</strong> (TensorFlow.js, Python API)</li>
<li><strong>WebAssembly (WASM) for Local ML Computation</strong></li>
</ol>
<hr>
</section>
<section id="using-indexeddb-for-local-relational-data-validation" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="using-indexeddb-for-local-relational-data-validation"><span class="header-section-number">3.4</span> <strong>1. Using IndexedDB for Local Relational Data Validation</strong></h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> db<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Open IndexedDB database</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> request <span class="op">=</span> indexedDB<span class="op">.</span><span class="fu">open</span>(<span class="st">"ClinicalDB"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  request<span class="op">.</span><span class="at">onsuccess</span> <span class="op">=</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      db <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">result</span><span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">validateUserID</span>() {</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> inputID <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"userID"</span>)<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> transaction <span class="op">=</span> db<span class="op">.</span><span class="fu">transaction</span>([<span class="st">"patients"</span>])<span class="op">;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> objectStore <span class="op">=</span> transaction<span class="op">.</span><span class="fu">objectStore</span>(<span class="st">"patients"</span>)<span class="op">;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> request <span class="op">=</span> objectStore<span class="op">.</span><span class="fu">get</span>(inputID)<span class="op">;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onsuccess</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="op">!</span>request<span class="op">.</span><span class="at">result</span>) {</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>              <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"error"</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">"Invalid Patient ID!"</span><span class="op">;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>              <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"error"</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">"userID"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text"</span><span class="ot"> oninput</span><span class="op">=</span><span class="st">"validateUserID()"</span><span class="dt">&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> id</span><span class="op">=</span><span class="st">"error"</span><span class="ot"> style</span><span class="op">=</span><span class="st">"color: red;"</span><span class="dt">&gt;&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="using-ajax-to-query-a-remote-sql-database" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="using-ajax-to-query-a-remote-sql-database"><span class="header-section-number">3.5</span> <strong>2. Using AJAX to Query a Remote SQL Database</strong></h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">checkPatientID</span>() {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> userID <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"userID"</span>)<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fetch</span>(<span class="vs">`/validate_id?userID=</span><span class="sc">${</span>userID<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">then</span>(response <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">json</span>())</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">then</span>(data <span class="kw">=&gt;</span> {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (data<span class="op">.</span><span class="at">valid</span>) {</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                  <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"error"</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>              } <span class="cf">else</span> {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                  <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"error"</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">"Invalid Patient ID!"</span><span class="op">;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">"userID"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text"</span><span class="ot"> oninput</span><span class="op">=</span><span class="st">"checkPatientID()"</span><span class="dt">&gt;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> id</span><span class="op">=</span><span class="st">"error"</span><span class="ot"> style</span><span class="op">=</span><span class="st">"color: red;"</span><span class="dt">&gt;&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="calling-a-machine-learning-model-for-validation" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="calling-a-machine-learning-model-for-validation"><span class="header-section-number">3.6</span> <strong>3. Calling a Machine Learning Model for Validation</strong></h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">validateAdverseEvent</span>() {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> eventText <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"eventText"</span>)<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fetch</span>(<span class="vs">`/predict_adverse_event`</span><span class="op">,</span> {</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>          <span class="dt">method</span><span class="op">:</span> <span class="st">"POST"</span><span class="op">,</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>          <span class="dt">headers</span><span class="op">:</span> { <span class="st">"Content-Type"</span><span class="op">:</span> <span class="st">"application/json"</span> }<span class="op">,</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>          <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({ <span class="st">"text"</span><span class="op">:</span> eventText })</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>(response <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">json</span>())</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>(data <span class="kw">=&gt;</span> {</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>          <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"error"</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>              data<span class="op">.</span><span class="at">valid</span> <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> <span class="st">"Potentially invalid event!"</span><span class="op">;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">"eventText"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text"</span><span class="ot"> oninput</span><span class="op">=</span><span class="st">"validateAdverseEvent()"</span><span class="dt">&gt;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> id</span><span class="op">=</span><span class="st">"error"</span><span class="ot"> style</span><span class="op">=</span><span class="st">"color: red;"</span><span class="dt">&gt;&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="choosing-the-best-approach" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="choosing-the-best-approach"><span class="header-section-number">3.7</span> <strong>Choosing the Best Approach</strong></h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Approach</th>
<th>Best For</th>
<th>Needs Server?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>IndexedDB</strong></td>
<td>Local relational checks</td>
<td>‚ùå No</td>
</tr>
<tr class="even">
<td><strong>AJAX (SQL Backend)</strong></td>
<td>Large relational datasets</td>
<td>‚úÖ Yes</td>
</tr>
<tr class="odd">
<td><strong>ML API (Python/Flask)</strong></td>
<td>Advanced validation via AI</td>
<td>‚úÖ Yes</td>
</tr>
<tr class="even">
<td><strong>TensorFlow.js</strong></td>
<td>Local ML without server</td>
<td>‚ùå No</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="conclusion-1" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="conclusion-1"><span class="header-section-number">3.8</span> <strong>Conclusion</strong></h2>
<ul>
<li><strong>For small datasets</strong>, use <strong>IndexedDB</strong> (local relational validation).</li>
<li><strong>For real-time database validation</strong>, use <strong>AJAX + SQL backend</strong>.</li>
<li><strong>For AI-powered checks</strong>, use <strong>Flask ML API</strong> or <strong>TensorFlow.js</strong>.</li>
</ul>
</section>
</section>
<section id="spreadsheet-driven-validation-system-for-shiny-forms" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> <strong>Spreadsheet-Driven Validation System for Shiny Forms</strong></h1>
<section id="your-idea-spreadsheet-driven-validation-system" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="your-idea-spreadsheet-driven-validation-system"><span class="header-section-number">4.1</span> <strong>Your Idea: Spreadsheet-Driven Validation System</strong></h2>
<p>Your idea of defining <strong>data validation rules in a spreadsheet</strong>, then <strong>processing them with Lua</strong> to generate <strong>JavaScript</strong> for <strong>Shiny validation</strong> is a <strong>great idea</strong>. This approach would: - Allow non-programmers (e.g., clinicians, data managers) to define <strong>custom validation rules</strong> in a familiar format (Excel, Google Sheets, CSV). - Automate the generation of <strong>JavaScript validation logic</strong> from a structured input (spreadsheet). - Integrate validation logic into <strong>Shiny</strong> dynamically, enabling real-time data validation.</p>
<hr>
</section>
<section id="has-this-been-done-before" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="has-this-been-done-before"><span class="header-section-number">4.2</span> <strong>Has This Been Done Before?</strong></h2>
<p>Yes, similar approaches have been explored, but not exactly in the way you describe.</p>
<ol type="1">
<li><strong>Spreadsheet-Driven Validation Rules</strong>
<ul>
<li><strong>Medidata Rave</strong> (commercial EDC system) allows validation checks to be defined in a <strong>spreadsheet-like rule editor</strong>.</li>
<li><strong>OpenClinica</strong> supports rule definitions in a <strong>spreadsheet format</strong> (ODK XLSForm).</li>
<li><strong>RedCAP</strong> allows some rule-based constraints in CSV.</li>
</ul></li>
<li><strong>Code Generation from Spreadsheets</strong>
<ul>
<li><strong>Google Sheets + Apps Script</strong>: People generate <strong>JavaScript validation</strong> from structured spreadsheet data.</li>
<li><strong>Lua for Code Generation</strong>: Lua is used in game engines and <strong>config-driven</strong> workflows, but it has not been widely used to generate <strong>JavaScript validation rules from spreadsheets</strong>.</li>
</ul></li>
</ol>
<p>Thus, <strong>your approach is novel in the clinical data validation context</strong>‚Äîthis could be <strong>a powerful open-source tool</strong>.</p>
<hr>
</section>
<section id="why-this-is-a-good-idea" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="why-this-is-a-good-idea"><span class="header-section-number">4.3</span> <strong>Why This is a Good Idea</strong></h2>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>Benefit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Spreadsheet as Validation Rule Storage</strong></td>
<td>Easy for non-programmers to modify rules</td>
</tr>
<tr class="even">
<td><strong>Lua as Code Generator</strong></td>
<td>Fast, lightweight, and excellent for text processing</td>
</tr>
<tr class="odd">
<td><strong>JavaScript for Validation</strong></td>
<td>Enables <strong>real-time validation</strong> in <strong>Shiny</strong> without server overhead</td>
</tr>
<tr class="even">
<td><strong>Dynamic Validation Updates</strong></td>
<td>Changing the spreadsheet updates validation logic without modifying code</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="how-it-would-work" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="how-it-would-work"><span class="header-section-number">4.4</span> <strong>How It Would Work</strong></h2>
<section id="define-rules-in-a-spreadsheet" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="define-rules-in-a-spreadsheet"><span class="header-section-number">4.4.1</span> <strong>1. Define Rules in a Spreadsheet</strong></h3>
<p>Each field in the Shiny app gets a validation rule in <strong>one cell per field</strong>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 69%">
</colgroup>
<thead>
<tr class="header">
<th>Field</th>
<th>Validation Rule</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>age</td>
<td><code>age &gt;= 18 &amp;&amp; age &lt;= 65</code></td>
</tr>
<tr class="even">
<td>email</td>
<td><code>/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i.test(email)</code></td>
</tr>
<tr class="odd">
<td>height</td>
<td><code>height &gt; 50 &amp;&amp; height &lt; 250</code></td>
</tr>
<tr class="even">
<td>bmi</td>
<td><code>weight / (height / 100) ** 2 &gt; 15 &amp;&amp; weight / (height / 100) ** 2 &lt; 50</code></td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="lua-script-processes-the-spreadsheet" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="lua-script-processes-the-spreadsheet"><span class="header-section-number">4.4.2</span> <strong>2. Lua Script Processes the Spreadsheet</strong></h3>
<p>A <strong>Lua script</strong> reads the spreadsheet (CSV, Excel) and <strong>generates JavaScript validation functions</strong>.</p>
<section id="example-lua-script-process_validation.lua" class="level4" data-number="4.4.2.1">
<h4 data-number="4.4.2.1" class="anchored" data-anchor-id="example-lua-script-process_validation.lua"><span class="header-section-number">4.4.2.1</span> <strong>Example Lua Script (<code>process_validation.lua</code>)</strong></h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">csv</span> <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">"csv"</span><span class="op">)</span>  <span class="co">-- Use a CSV library like `luacsv`</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">file</span> <span class="op">=</span> <span class="fu">io.open</span><span class="op">(</span><span class="st">"validation_rules.csv"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">parsed_data</span> <span class="op">=</span> <span class="va">csv</span><span class="op">.</span>parse<span class="op">(</span><span class="va">file</span><span class="op">:</span><span class="fu">read</span><span class="op">(</span><span class="st">"*all"</span><span class="op">))</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">js_code</span> <span class="op">=</span> <span class="st">"const validationRules = {</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span><span class="op">,</span> <span class="va">row</span> <span class="kw">in</span> <span class="fu">ipairs</span><span class="op">(</span><span class="va">parsed_data</span><span class="op">)</span> <span class="cf">do</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> <span class="va">field</span><span class="op">,</span> <span class="va">rule</span> <span class="op">=</span> <span class="va">row</span><span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="va">row</span><span class="op">[</span><span class="dv">2</span><span class="op">]</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">js_code</span> <span class="op">=</span> <span class="va">js_code</span> <span class="op">..</span> <span class="fu">string.format</span><span class="op">(</span><span class="st">'    "%s": function(value) { return %s; },</span><span class="sc">\n</span><span class="st">'</span><span class="op">,</span> <span class="va">field</span><span class="op">,</span> <span class="va">rule</span><span class="op">)</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="va">js_code</span> <span class="op">=</span> <span class="va">js_code</span> <span class="op">..</span> <span class="st">"};</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">:</span><span class="fu">close</span><span class="op">()</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">js_file</span> <span class="op">=</span> <span class="fu">io.open</span><span class="op">(</span><span class="st">"validation.js"</span><span class="op">,</span> <span class="st">"w"</span><span class="op">)</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="va">js_file</span><span class="op">:</span><span class="fu">write</span><span class="op">(</span><span class="va">js_code</span><span class="op">)</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="va">js_file</span><span class="op">:</span><span class="fu">close</span><span class="op">()</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="st">"Validation JavaScript generated successfully!"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="javascript-file-is-included-in-shiny" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="javascript-file-is-included-in-shiny"><span class="header-section-number">4.4.3</span> <strong>3. JavaScript File is Included in Shiny</strong></h3>
<p>The <strong>generated JavaScript file (<code>validation.js</code>)</strong> is included in the Shiny app.</p>
<section id="example-of-integrating-validation.js-in-shiny" class="level4" data-number="4.4.3.1">
<h4 data-number="4.4.3.1" class="anchored" data-anchor-id="example-of-integrating-validation.js-in-shiny"><span class="header-section-number">4.4.3.1</span> <strong>Example of Integrating <code>validation.js</code> in Shiny</strong></h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    tags<span class="sc">$</span><span class="fu">head</span>(tags<span class="sc">$</span><span class="fu">script</span>(<span class="at">src=</span><span class="st">"validation.js"</span>)),  <span class="co"># Include generated JS</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">numericInput</span>(<span class="st">"age"</span>, <span class="st">"Enter Age:"</span>, <span class="at">value =</span> <span class="cn">NULL</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">textInput</span>(<span class="st">"email"</span>, <span class="st">"Enter Email:"</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">actionButton</span>(<span class="st">"submit"</span>, <span class="st">"Submit"</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">verbatimTextOutput</span>(<span class="st">"validation_message"</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">observeEvent</span>(input<span class="sc">$</span>submit, {</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Call JavaScript function to validate fields</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        shinyjs<span class="sc">::</span><span class="fu">runjs</span>(<span class="st">"if (!validationRules.age(input$age)) alert('Invalid Age!');"</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        shinyjs<span class="sc">::</span><span class="fu">runjs</span>(<span class="st">"if (!validationRules.email(input$email)) alert('Invalid Email!');"</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
</section>
<section id="advantages-of-this-approach" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="advantages-of-this-approach"><span class="header-section-number">4.5</span> <strong>Advantages of This Approach</strong></h2>
<p>‚úÖ <strong>Non-programmers can define validation rules</strong> in spreadsheets<br>
‚úÖ <strong>Lua is fast &amp; lightweight for generating JavaScript</strong><br>
‚úÖ <strong>JavaScript validation happens instantly in the browser</strong><br>
‚úÖ <strong>Shiny remains reactive while offloading validation to the client</strong></p>
<hr>
</section>
<section id="potential-enhancements" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="potential-enhancements"><span class="header-section-number">4.6</span> <strong>Potential Enhancements</strong></h2>
<p>üöÄ <strong>Support relational data</strong>: Extend Lua to query databases and include dynamic constraints<br>
üöÄ <strong>Integrate ML</strong>: Add <strong>TensorFlow.js</strong> or an API to use machine learning for validation<br>
üöÄ <strong>Validation UI</strong>: Build a Shiny app to visualize and edit validation rules dynamically</p>
<hr>
<section id="next-steps" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="next-steps"><span class="header-section-number">4.6.1</span> <strong>Next Steps</strong></h3>
<p>Would you like a <strong>working prototype</strong> where we generate JavaScript from a spreadsheet and use it in a Shiny app? üöÄ</p>
</section>
</section>
</section>
<section id="dynamic-rule-reloading-and-database-integration-for-shiny-forms" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> <strong>Dynamic Rule Reloading and Database Integration for Shiny Forms</strong></h1>
<section id="dynamic-rule-reloading-spreadsheet-based" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="dynamic-rule-reloading-spreadsheet-based"><span class="header-section-number">5.1</span> <strong>1. Dynamic Rule Reloading (Spreadsheet-Based)</strong></h2>
<section id="a.-spreadsheet-format-validation_rules.csv" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="a.-spreadsheet-format-validation_rules.csv"><span class="header-section-number">5.1.1</span> <strong>A. Spreadsheet Format (<code>validation_rules.csv</code>)</strong></h3>
<pre class="csv"><code>field,rule
age,age &gt;= 18 &amp;&amp; age &lt;= 65
email,/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email)
height,height &gt; 50 &amp;&amp; height &lt; 250
bmi,weight / (height / 100) ** 2 &gt; 15 &amp;&amp; weight / (height / 100) ** 2 &lt; 50</code></pre>
<hr>
</section>
<section id="b.-lua-script-to-convert-csv-to-javascript-process_validation.lua" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="b.-lua-script-to-convert-csv-to-javascript-process_validation.lua"><span class="header-section-number">5.1.2</span> <strong>B. Lua Script to Convert CSV to JavaScript (<code>process_validation.lua</code>)</strong></h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">csv</span> <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">"luacsv"</span><span class="op">)</span>  <span class="co">-- Requires CSV parser library</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">file</span> <span class="op">=</span> <span class="fu">io.open</span><span class="op">(</span><span class="st">"validation_rules.csv"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">)</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">parsed_data</span> <span class="op">=</span> <span class="va">csv</span><span class="op">.</span>parse<span class="op">(</span><span class="va">file</span><span class="op">:</span><span class="fu">read</span><span class="op">(</span><span class="st">"*all"</span><span class="op">))</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">js_code</span> <span class="op">=</span> <span class="st">"const validationRules = {</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="er">"</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="er">for i, row in ipairs(parsed_data) do</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="er">    local field, rule = row[1], row[2]</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="er">    js_code = js_code .. string.format('    "%s": function(value) { return %s; },</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="er">', field, rule)</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="er">end</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="er">js_code = js_code .. "};</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="er">"</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="er">file:close()</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="er">local js_file = io.open("validation.js", "w")</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="er">js_file:write(js_code)</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="er">js_file:close()</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="er">print("Validation JavaScript generated successfully!")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="c.-shiny-app-with-automatic-rule-reloading-app.r" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="c.-shiny-app-with-automatic-rule-reloading-app.r"><span class="header-section-number">5.1.3</span> <strong>C. Shiny App with Automatic Rule Reloading (<code>app.R</code>)</strong></h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinyjs)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fs)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">useShinyjs</span>(),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    tags<span class="sc">$</span><span class="fu">head</span>(tags<span class="sc">$</span><span class="fu">script</span>(<span class="at">src =</span> <span class="st">"validation.js"</span>)),  <span class="co"># Include JS dynamically</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">"Dynamic Validation Rules in Shiny"</span>),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sidebarPanel</span>(</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">numericInput</span>(<span class="st">"age"</span>, <span class="st">"Enter Age:"</span>, <span class="at">value =</span> <span class="cn">NULL</span>),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">textInput</span>(<span class="st">"email"</span>, <span class="st">"Enter Email:"</span>),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">numericInput</span>(<span class="st">"height"</span>, <span class="st">"Enter Height (cm):"</span>, <span class="at">value =</span> <span class="cn">NULL</span>),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">numericInput</span>(<span class="st">"weight"</span>, <span class="st">"Enter Weight (kg):"</span>, <span class="at">value =</span> <span class="cn">NULL</span>),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">actionButton</span>(<span class="st">"submit"</span>, <span class="st">"Submit"</span>),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">verbatimTextOutput</span>(<span class="st">"validation_message"</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mainPanel</span>()</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Watch for changes in the validation rules file</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">observe</span>({</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">invalidateLater</span>(<span class="dv">5000</span>, session)  <span class="co"># Check every 5 seconds</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">runjs</span>(<span class="st">"delete window.validationRules; $.getScript('validation.js');"</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">observeEvent</span>(input<span class="sc">$</span>submit, {</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">runjs</span>(<span class="st">"</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="st">            let ageValid = validationRules['age'](parseFloat($('#age').val()));</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="st">            let emailValid = validationRules['email']($('#email').val());</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="st">            let heightValid = validationRules['height'](parseFloat($('#height').val()));</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="st">            let bmi = parseFloat($('#weight').val()) / ((parseFloat($('#height').val()) / 100) ** 2);</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="st">            let bmiValid = validationRules['bmi'](bmi);</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="st">            let messages = [];</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="st">            if (!ageValid) messages.push('Invalid Age!');</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="st">            if (!emailValid) messages.push('Invalid Email!');</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="st">            if (!heightValid) messages.push('Invalid Height!');</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="st">            if (!bmiValid) messages.push('Invalid BMI!');</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="st">            if (messages.length &gt; 0) {</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="st">                alert(messages.join('</span><span class="sc">\n</span><span class="st">'));</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="st">                alert('All inputs are valid!');</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="st">        "</span>);</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>‚úî <strong>Every 5 seconds</strong>, Shiny reloads <code>validation.js</code> if <code>validation_rules.csv</code> was modified.<br>
‚úî The new validation rules apply <strong>immediately</strong> in the browser.<br>
‚úî No need to restart the Shiny app.</p>
<hr>
</section>
</section>
<section id="database-integration-for-validation-rules" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="database-integration-for-validation-rules"><span class="header-section-number">5.2</span> <strong>2. Database Integration for Validation Rules</strong></h2>
<p>Instead of a CSV file, the validation rules can be <strong>stored in a database</strong> (e.g., MySQL, PostgreSQL, SQLite).</p>
<section id="a.-database-schema" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="a.-database-schema"><span class="header-section-number">5.2.1</span> <strong>A. Database Schema</strong></h3>
<p>Table: <strong>validation_rules</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> validation_rules (</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    field TEXT <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rule</span> TEXT</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Example data:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> validation_rules (field, <span class="kw">rule</span>) <span class="kw">VALUES</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>(<span class="st">'age'</span>, <span class="st">'age &gt;= 18 &amp;&amp; age &lt;= 65'</span>),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>(<span class="st">'email'</span>, <span class="st">'/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email)'</span>),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>(<span class="st">'height'</span>, <span class="st">'height &gt; 50 &amp;&amp; height &lt; 250'</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>(<span class="st">'bmi'</span>, <span class="st">'weight / (height / 100) ** 2 &gt; 15 &amp;&amp; weight / (height / 100) ** 2 &lt; 50'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="b.-lua-script-to-fetch-rules-from-database-process_validation_db.lua" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="b.-lua-script-to-fetch-rules-from-database-process_validation_db.lua"><span class="header-section-number">5.2.2</span> <strong>B. Lua Script to Fetch Rules from Database (<code>process_validation_db.lua</code>)</strong></h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">sqlite3</span> <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">"lsqlite3"</span><span class="op">)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">db</span> <span class="op">=</span> <span class="va">sqlite3</span><span class="op">.</span>open<span class="op">(</span><span class="st">"validation.db"</span><span class="op">)</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">js_code</span> <span class="op">=</span> <span class="st">"const validationRules = {</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="er">"</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="er">for row in db:nrows("SELECT * FROM validation_rules") do</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="er">    js_code = js_code .. string.format('    "%s": function(value) { return %s; },</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="er">', row.field, row.rule)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="er">end</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="er">js_code = js_code .. "};</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="er">"</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="er">local js_file = io.open("validation.js", "w")</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="er">js_file:write(js_code)</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="er">js_file:close()</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="er">db:close()</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="er">print("Validation JavaScript generated from database successfully!")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This script queries the database and <strong>generates <code>validation.js</code> dynamically</strong>.</p>
<hr>
</section>
<section id="c.-modify-shiny-to-fetch-rules-from-database" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="c.-modify-shiny-to-fetch-rules-from-database"><span class="header-section-number">5.2.3</span> <strong>C. Modify Shiny to Fetch Rules from Database</strong></h3>
<p>Modify the <strong>Shiny <code>server</code> function</strong> to reload validation rules <strong>every 5 seconds</strong>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">observe</span>({</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">invalidateLater</span>(<span class="dv">5000</span>, session)  <span class="co"># Reload every 5 seconds</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">system</span>(<span class="st">"lua process_validation_db.lua"</span>)  <span class="co"># Run Lua script</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">runjs</span>(<span class="st">"delete window.validationRules; $.getScript('validation.js');"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>‚úî <strong>Shiny queries the database every 5 seconds</strong> and updates validation rules dynamically.<br>
‚úî Users can <strong>edit validation rules in the database</strong>, and they apply instantly.<br>
‚úî <strong>No restart required</strong>.</p>
<hr>
</section>
</section>
<section id="comparison-spreadsheet-vs.-database" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="comparison-spreadsheet-vs.-database"><span class="header-section-number">5.3</span> <strong>Comparison: Spreadsheet vs.&nbsp;Database</strong></h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Feature</th>
<th>CSV-Based Dynamic Rules</th>
<th>Database-Based Dynamic Rules</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Storage</strong></td>
<td>Local file</td>
<td>Centralized database</td>
</tr>
<tr class="even">
<td><strong>Scalability</strong></td>
<td>Best for small teams</td>
<td>Ideal for large-scale use</td>
</tr>
<tr class="odd">
<td><strong>User Interface</strong></td>
<td>Spreadsheet</td>
<td>Web-based admin panel</td>
</tr>
<tr class="even">
<td><strong>Performance</strong></td>
<td>Fast</td>
<td>Requires DB query</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="next-steps-1" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="next-steps-1"><span class="header-section-number">5.4</span> <strong>Next Steps</strong></h2>
<p>üî• <strong>Would you like an admin panel in Shiny to edit validation rules directly?</strong><br>
üî• <strong>Would you like to store validation rules in a NoSQL database (MongoDB)?</strong><br>
üöÄ Let me know what enhancements you‚Äôd like! üöÄ</p>
</section>
<section id="prerequisites" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="prerequisites"><span class="header-section-number">5.5</span> Prerequisites</h2>
<p>In development</p>
</section>
<section id="step-by-step-implementation" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="step-by-step-implementation"><span class="header-section-number">5.6</span> Step-by-Step Implementation</h2>
<p>In development</p>
</section>
<section id="key-takeaways" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="key-takeaways"><span class="header-section-number">5.7</span> Key Takeaways</h2>
<p>In development</p>
</section>
<section id="further-reading" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">5.8</span> Further Reading</h2>
<p>In development</p>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{(ryy)_glenn_thomas2025,
  author = {(Ryy) Glenn Thomas, Ronald},
  title = {RCT Validation Language},
  date = {2025-05-13},
  url = {https://focusonr.org/posts/rct_validation_lang/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-(ryy)_glenn_thomas2025" class="csl-entry quarto-appendix-citeas" role="listitem">
(Ryy) Glenn Thomas, Ronald. 2025. <span>‚ÄúRCT Validation
Language.‚Äù</span> May 13, 2025. <a href="https://focusonr.org/posts/rct_validation_lang/">https://focusonr.org/posts/rct_validation_lang/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/focusonr\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="rgt47/qblog" data-repo-id="R_kgDOH6TO7A" data-category="Announcements" data-category-id="DIC_kwDOH5G3U84CRUp9" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="light">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2023-2025, Ronald G. Thomas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<!-- PDF view/download button for blog posts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Only add the button on post pages
  if (window.location.pathname.includes('/posts/') && !window.location.pathname.endsWith('/posts/') && !window.location.pathname.endsWith('/posts/index.html')) {
    var currentPath = window.location.pathname;
    var pdfPath = currentPath.replace('.html', '.pdf');

    // Check if PDF exists first
    fetch(pdfPath, { method: 'HEAD' })
      .then(function(response) {
        if (response.ok) {
          // PDF exists, show download button
          showDownloadButton(pdfPath);
        } else {
          // PDF doesn't exist, show link to generate
          showGenerateButton(currentPath);
        }
      })
      .catch(function() {
        // Error checking PDF, show generate button
        showGenerateButton(currentPath);
      });
  }
});

function showDownloadButton(pdfPath) {
  var downloadBtn = document.createElement('div');
  downloadBtn.className = 'pdf-download-button';

  // Get file size if possible
  fetch(pdfPath, { method: 'HEAD' })
    .then(function(response) {
      var size = response.headers.get('Content-Length');
      var sizeText = '';

      if (size) {
        // Convert to MB or KB
        var sizeInMB = size / (1024 * 1024);
        if (sizeInMB >= 1) {
          sizeText = ' (' + sizeInMB.toFixed(1) + ' MB)';
        } else {
          sizeText = ' (' + (size / 1024).toFixed(0) + ' KB)';
        }
      }

      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' + sizeText +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    })
    .catch(function() {
      // Basic fallback if we can't get file size
      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    });

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(downloadBtn);
  }
}

function showGenerateButton(htmlPath) {
  var qmdPath = htmlPath.replace('/posts/', 'posts/').replace('index.html', 'index.qmd');

  var generateBtn = document.createElement('div');
  generateBtn.className = 'pdf-download-button';
  generateBtn.innerHTML =
    '<div class="alert alert-secondary d-flex flex-column gap-2 p-3" role="alert">' +
    '  <div><i class="bi bi-file-pdf me-2"></i><strong>PDF version available</strong></div>' +
    '  <div class="small">Generate a PDF version of this article by running this command in the terminal:</div>' +
    '  <pre class="bg-light p-2 rounded mb-0 mt-1"><code>./generate_pdf.sh ' + qmdPath + '</code></pre>' +
    '</div>';

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(generateBtn);
  }
}
</script>

<style>
.pdf-download-button {
  margin-top: 1rem;
  margin-bottom: 1rem;
}
</style>




</body></html>