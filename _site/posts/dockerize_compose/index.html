<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ronald (Ryy) Glenn Thomas">
<meta name="dcterms.date" content="2023-06-30">
<meta name="description" content="This is the first in a series of posts offering suggested strategies for leveraging open source technologies to effectively host data science analysis apps and reports online.">

<title>Focus on R: a new qblog - A straightforward strategy to get your Shiny app online, securely and continuously updated.</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<link href="https://fonts.googleapis.com/css?family=Fira+Sans|Merriweather" rel="stylesheet">
<script src="https://kit.fontawesome.com/0fba9333d8.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Focus on R: a new qblog - A straightforward strategy to get your Shiny app online, securely and continuously updated.">
<meta property="og:description" content="This is the first in a series of posts offering suggested strategies for leveraging open source technologies to effectively host data science analysis apps and reports online.">
<meta property="og:image" content="https://focusonr.org/posts/dockerize_compose/img/rshiny.png">
<meta property="og:site-name" content="Focus on R: a new qblog">
<meta property="og:image:height" content="482">
<meta property="og:image:width" content="1200">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Focus on R: a new qblog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47"><i class="bi bi-twitter" role="img" aria-label="twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47"><i class="bi bi-github" role="img" aria-label="github">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://rgtlab.org"><i class="bi bi-person-circle" role="img" aria-label="website">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">1</span>  Introduction</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods"><span class="toc-section-number">2</span>  Methods</a>
  <ul class="collapse">
  <li><a href="#hosting" id="toc-hosting" class="nav-link" data-scroll-target="#hosting"><span class="toc-section-number">2.1</span>  Hosting</a></li>
  <li><a href="#select-a-hosting-service" id="toc-select-a-hosting-service" class="nav-link" data-scroll-target="#select-a-hosting-service"><span class="toc-section-number">2.2</span>  Select a hosting service</a></li>
  <li><a href="#website" id="toc-website" class="nav-link" data-scroll-target="#website"><span class="toc-section-number">2.3</span>  Website</a></li>
  </ul></li>
  <li><a href="#docker" id="toc-docker" class="nav-link" data-scroll-target="#docker"><span class="toc-section-number">3</span>  Docker</a></li>
  <li><a href="#caddy" id="toc-caddy" class="nav-link" data-scroll-target="#caddy"><span class="toc-section-number">4</span>  Caddy</a></li>
  <li><a href="#landing-page" id="toc-landing-page" class="nav-link" data-scroll-target="#landing-page"><span class="toc-section-number">5</span>  Landing Page</a></li>
  <li><a href="#github" id="toc-github" class="nav-link" data-scroll-target="#github"><span class="toc-section-number">6</span>  Github</a></li>
  <li><a href="#appendices" id="toc-appendices" class="nav-link" data-scroll-target="#appendices"><span class="toc-section-number">7</span>  Appendices</a>
  <ul class="collapse">
  <li><a href="#appendix-1" id="toc-appendix-1" class="nav-link" data-scroll-target="#appendix-1"><span class="toc-section-number">7.1</span>  Appendix-1</a></li>
  <li><a href="#app.r" id="toc-app.r" class="nav-link" data-scroll-target="#app.r"><span class="toc-section-number">7.2</span>  App.R</a></li>
  <li><a href="#tip-1.-docker-on-m1-macbook." id="toc-tip-1.-docker-on-m1-macbook." class="nav-link" data-scroll-target="#tip-1.-docker-on-m1-macbook."><span class="toc-section-number">7.3</span>  Tip 1. Docker on M1 macbook.</a></li>
  <li><a href="#tip-2-add-user-to-docker-group-on-server." id="toc-tip-2-add-user-to-docker-group-on-server." class="nav-link" data-scroll-target="#tip-2-add-user-to-docker-group-on-server."><span class="toc-section-number">7.4</span>  Tip 2 add user to docker group on server.</a></li>
  <li><a href="#tip-3-ssh-config-file." id="toc-tip-3-ssh-config-file." class="nav-link" data-scroll-target="#tip-3-ssh-config-file."><span class="toc-section-number">7.5</span>  Tip 3 ssh config file.</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="toc-section-number">8</span>  References</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A straightforward strategy to get your Shiny app online, securely and continuously updated.</h1>
<p class="subtitle lead">Github, Docker-compose, EC2 version</p>
  <div class="quarto-categories">
    <div class="quarto-category">Docker</div>
    <div class="quarto-category">Shiny</div>
    <div class="quarto-category">docker-compose</div>
  </div>
  </div>

<div>
  <div class="description">
    This is the first in a series of posts offering suggested strategies for leveraging open source technologies to effectively host data science analysis apps and reports online.
  </div>
</div>

<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <a href="https://rgtlab.org">Ronald (Ryy) Glenn Thomas</a> <a href="https://orcid.org/0000-0003-1686-4965" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://ucsd.edu">
            UCSD
            </a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 30, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>


<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img/crane.jpg" class="img-fluid" alt="under construction"> <font size="1"> Photo by <a href="https://unsplash.com/@nathangwaters?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Nathan Waters</a> on <a href="https://unsplash.com/s/photos/construction?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a> </font></p>
</div></div><section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>This is the first in a series of posts offering suggested strategies for leveraging open source technologies to provide straight-forward solutions to one of the central challenges in the practice of data science, i.e.&nbsp;how to effectively communicate analysis results to clients and collaborators. The list of open-source technologies (software stack) we suggest for employment is: linux, R, Shiny, Docker, Git, and Caddy. In this post we’ll make use of two cloud services: Github and Amazon Web Service (AWS). Further posts will describe alternate constructions, e.g.&nbsp;using the low cost cloud service: Hetzner.</p>
<p>Also described in other posts are strategies that avoid Github and docker-compose. This approach provides a simpler initial construction, but a more labor intensive updating process.</p>
<p>This initial post provides a minimal, proof-of-concept example of how to apply these technologies for hosting an interactive Shiny application.</p>
<p>In the following we start with a very simple, but hopefully still useful, stand-alone Shiny app developed on our local workstation. Then after some straightforward interfacing with the AWS environment, we push the Shiny app into the cloud, and end up with a secure (encrypted and authenticated) app running on a website with a custom domain name.</p>
</section>
<section id="methods" class="level1 page-columns page-full" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Methods</h1>
<p>Start by creating a repository (repo) for the project. The best way to do this is to initiate the repo on Github and then <code>clone</code> it to your local workstation. Start by logging in to Github and creating a new empty repo, call it power1_app. On your local workstation navigate to your Shiny development directory, say <code>~/prj</code> and clone the power1_app repo from Github:</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Details for creating a Github repo follow:
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p>login to github (screenshot)</p></li>
<li><p>click on <code>new</code>. Then in <code>repository name</code> field enter <code>power1</code>. (Make the</p></li>
<li><p>make the repo private, we only want to share with our client at this point).</p></li>
<li><p>create the repo. Click <code>Create repository</code> green button at the bottom of the page.</p></li>
<li><p>on your laptop cd to development directory, say ~/prj and clone the github repo:</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/rgt47/power1_app.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img/git1.png" class="img-fluid"></p>
</div></div><p>After cloning the repo to ~/prj/power1_app cd into the directory and create two new sub-directories, <code>power1_shiny</code> and <code>site</code>. These directories will house our shiny app and our web site landing page file, respectively.</p>
<p>Lets jump ahead to the point where you’ve just finished developing a new Shiny app, named <code>power1_shiny</code> . (The methods described here apply generically to any Shiny app, but we’ll use one of our own for illustration). See the <code>R/Shiny</code> code for our <code>power1_shiny</code> app (<code>app.R</code>) <a href="#appendix-1">here</a> in appendix 1.</p>
<details>
<summary>show the <code>power1_shiny/app.R</code> code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">titlePanel</span>(<span class="st">"Power Calculator for Two Group Parallel Designs"</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sliderInput</span>(<span class="st">"N"</span>, <span class="st">"Total Sample Size:"</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">300</span>, <span class="at">value =</span> <span class="dv">100</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plotOutput</span>(<span class="st">"plot"</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">verbatimTextOutput</span>(<span class="st">"eff"</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.5</span>,.<span class="dv">05</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  pow <span class="ot">=</span> <span class="fu">reactive</span>(<span class="fu">sapply</span>(delta, <span class="cf">function</span>(x) <span class="fu">power.t.test</span>(input<span class="sc">$</span>N, <span class="at">d=</span>x)<span class="sc">$</span>power ))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  eff <span class="ot">=</span>  <span class="fu">renderText</span>(<span class="fu">power.t.test</span>(input<span class="sc">$</span>N, <span class="at">power=</span>.<span class="dv">8</span>)<span class="sc">$</span>d)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(delta, <span class="fu">pow</span>(), <span class="at">cex=</span><span class="fl">1.5</span>, <span class="at">ylab=</span><span class="st">"power"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> .<span class="dv">8</span>,  <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span><span class="fl">2.5</span>, <span class="at">lty =</span> <span class="dv">4</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">eff</span>(), <span class="at">col =</span> <span class="st">"blue"</span>,<span class="at">lwd =</span><span class="fl">2.5</span>, <span class="at">lty =</span> <span class="dv">4</span>)})  </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>eff <span class="ot">&lt;-</span> <span class="fu">renderText</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">"Std. effect detectable with power 80% = "</span>, <span class="fu">eff</span>()) )</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>We can test the app locally in our development directory, say <code>power1_app</code>, by runnning it with the following command.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"library(shiny); runApp('power1_shiny/app.R', launch=T)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command will run the R program, load the Shiny package, and launch the app in your default browser.</p>
<p>Figure 1 below shows the Shiny app running locally in a browser, it consists of a widget to select the sample size and provide a dynamic visualization (2D plot) of the power as a function of the standardized effect size:</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/shinyapppower1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Shiny app</em></figcaption><p></p>
</figure>
</div>
</div></div><p>Once we determine our app is working as designed, the next step is to set up a secure hosting environment on a virtual server. Once the app is hosted the we simply need to send a link and security credentials to our collaborators for them to have secure access to the Shiny app. There are many ways to accomplish the hosting. Here we’ll describe a straightforward and efficient approach using mainstream cloud services and open source tools. That is, we’ll describe how to ‘spin’ up a server on Amazon Web Service EC2 and in just a few steps, through the application of Docker, R, Shiny, and Caddy we’ll have a fully functioning secure web app to share with colleagues.</p>
<section id="hosting" class="level2 page-columns page-full" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="hosting"><span class="header-section-number">2.1</span> Hosting</h2>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/blogdockerizeflow.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Data flow </em></figcaption><p></p>
</figure>
</div>
</div></div><p>Figure 2 illustrates the tools we’ll use and the flow of program and configuration files. In order to host <code>power1</code> online we’ll need to complete the following tasks:</p>
<ol type="1">
<li>create a virtual server (connected via ssh) with a firewall</li>
<li>obtain a static IP address (to identify the server online)</li>
<li>obtain a domain name (name for IP address)</li>
<li>install and configure a webserver (tool to interact with https protocol requests and respond)</li>
<li>obtain and install an SSL certificate (to allow encrypted communication)</li>
<li>setup an authentication method (password protection)</li>
<li>configure a reverse proxy method (translate https, port 443, requests to Shiny, port 3838)</li>
</ol>
<p>At first glance these 7 requirements can appear daunting, but on closer inspection all can be met with relative ease and minimal cost ( using a cloud-hosting service, e.g.&nbsp;Amazon’s EC2 or Digital Ocean, and a “leased” domain name from, e.g.&nbsp;GoDaddy, or Amazon’s Route 53) or no cost( if you have your own server with IP address, and domain name)</p>
</section>
<section id="select-a-hosting-service" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="select-a-hosting-service"><span class="header-section-number">2.2</span> Select a hosting service</h2>
<p>There are a number of cloud based server options: Microsoft Azure, Oracle, Google Cloud, Amazon AWS EC2, Digital Ocean to name a few. Each has their own approach to setting up a custom virtual server. Several have free or low-cost service tiers available.</p>
<p>An overview of the process with EC2 follows. Detailed instructions for AWS EC2 are covered in an earlier post <a href="https://focusonr.org/posts/setupaws/">here</a>.</p>
<ol start="0" type="1">
<li>Create an account or sign in.</li>
<li>Set up an interactive environment with AWS server.
<ol type="a">
<li>define ssh key-pair.</li>
<li>configure firewall.</li>
<li>request static IP.</li>
<li>obtain domain name.</li>
<li>select an instance and launch server.</li>
</ol></li>
</ol>
<p>Once the server is available connect via ssh, and login,</p>
<p>The only necessary software to install is docker and git. Install both with the following commands:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> git</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> snap install docker.io</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once the host is set up and the requisite software installed we’ll have a customized virtual server wtih a static IP address, and a unique domain name and firewall in place. In other words, items 1, 2, and 3 from our <code>hosting</code> list above will be taken care of.</p>
</section>
<section id="website" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="website"><span class="header-section-number">2.3</span> Website</h2>
<p>To configure the web server and containerize our app we need to add three files to the repo, to go along with our Shiny app.</p>
<p>We’ll use a slightly indirect route to create and place the necessary files on the server but this approach will allow to do all our countinuing development on our local workstation and have the web app be automatically continually undated. We’ll create the configuration files we need on our workstation and push them github and from there they can be accessed from our server.</p>
<p>These three configuation files are:</p>
</section>
</section>
<section id="docker" class="level1 page-columns page-full" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Docker</h1>
<ol type="1">
<li>a Docker configuration file (default name <code>Dockerfile</code>)</li>
</ol>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img/docker1.jpg" class="img-fluid"> <font size="1"> Photo by <a href="https://unsplash.com/@carrier_lost?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Ian Taylor</a> on <a href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a> </font></p>
</div></div><p>We’ll use docker to access R/Shiny, and docker-compose to access Caddy, our webserver. The first file is the dockerfile. Here is our minimal dockerfile with comments:</p>
<details>
<summary>show the <code>Dockerfile</code> code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>FROM rocker<span class="sc">/</span>shiny<span class="sc">:</span><span class="dv">4</span>.<span class="fl">2.0</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># there are a bunch of files in /srv/shiny-server. delete them</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>RUN rm <span class="sc">-</span>rf <span class="sc">/</span>srv<span class="sc">/</span>shiny<span class="sc">-</span>server</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>COPY <span class="sc">/</span>power1_shiny<span class="sc">/</span><span class="er">*</span> <span class="er">/</span>srv<span class="sc">/</span>shiny<span class="sc">-</span>server<span class="sc">/</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>USER shiny</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>CMD [<span class="st">"/usr/bin/shiny-server"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>This file in just a few lines instructs Docker to build a new container based on a Rocker/Shiny image (which is a ubuntu image with R and Shiny installed) and layered with the addition of our Shiny code launch Shiny server listening on (default) port 3838.</p>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="">Note: We placed the <code>power1_shiny/app.R</code> code in the default location <code>/srv/shiny-server</code> so we only need to start the Shiny server and it will find the shiny program</span></div></div>
<p>This configuration file instructs Docker to build a container based on a Rocker/Shiny image (which itself is a ubuntu image with R and Shiny installed) then copy into the container the <code>power1_shiny.R</code> code and finally launch Shiny on (default) port 3838. We placed the app.R code in the default location <code>/srv/shiny-server</code> we only need to start the server and it will find the shiny program.</p>
<ol start="2" type="1">
<li>a Caddy web server configuration file (default name <code>Caddyfile</code>)</li>
</ol>
<p>We’ll use <code>Caddy</code> as our web server. Caddy is an open-source tool that has the very useful feature of automating the acquisition and installing of an SSL certificate. An SSL cert is required by most browsers to use the encrypted communication protocol https.</p>
<p>We use the caddy configuration file to specify three critical things.</p>
<ol type="1">
<li>the site domain name.</li>
<li>the ‘reverse proxy’ map that redirects requests to port 443 (ssl port) to port 3838 (Shiny port).</li>
<li>add login credentials for all users (e.g.&nbsp;bob/vanilla47):</li>
</ol>
</section>
<section id="caddy" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Caddy</h1>
<p>Our barebones <code>Caddyfile</code> looks like this:</p>
<details>
<summary>Show the <code>Caddyfile</code> code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use caddy auth tool to generate a password via the `bcrypt` algorithm. </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; caddy hash-password --plaintext hiccup </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>rgtlab.org {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>basicauth <span class="sc">/</span>power1<span class="sc">/</span><span class="er">*</span> {</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    Bob <span class="sc">$</span>2a<span class="sc">$</span><span class="dv">14</span><span class="sc">$</span>Zkx19XLiW6VYouLHR5NmfOFU0z2GTNmpkT<span class="sc">/</span>5qqR7hx4IjWJPDhjvG</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    root <span class="sc">*</span> <span class="er">/</span>srv</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    handle_path <span class="sc">/</span>power1<span class="sc">/</span><span class="er">*</span> {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        reverse_proxy power1<span class="sc">:</span><span class="dv">3838</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    file_server</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>We can accomplish what we need for items 4, 5, and 7 through the Caddyfile.</p>
<p>Note:</p>
<ul>
<li>rgtlab.org is our domain name</li>
<li><code>handle_path</code> maps all https requests to port 3838 where Shiny is listening.</li>
</ul>
<p>Providing our servers domain name, <code>rgtlab.org</code> is sufficient to initiate an exchange with the <code>letsencrypt</code> service to generates an SSL certificate.</p>
<p>And a third file is a config file for Docker Compose. Docker Compose is a Docker module that provides a framework for running multi-container applications. This docker compose YAML file instructs Docker to containerize our Shiny app, pull a caddy webserver image from Docker Hub and create a local network for the two containers to communicate in.</p>
<ol start="3" type="1">
<li>a Docker-compose configuration file (default name <code>docker-compose.yml</code>).</li>
</ol>
<p>The docker-compose.yml file:</p>
<details>
<summary><code>docker-compose.yml</code>. Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>version<span class="sc">:</span> <span class="st">"3.7"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>services<span class="sc">:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  power1<span class="sc">:</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    image<span class="sc">:</span> registry.gitlab.com<span class="sc">/</span>rgt47<span class="sc">/</span>power1_app<span class="sc">/</span>power1_image<span class="sc">:</span>v1<span class="fl">.0</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    restart<span class="sc">:</span> unless<span class="sc">-</span>stopped</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    ports<span class="sc">:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> <span class="st">"9000:3838"</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  caddy<span class="sc">:</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    image<span class="sc">:</span> caddy<span class="sc">:</span><span class="dv">2</span>.<span class="fl">6.4</span><span class="sc">-</span>alpine</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    ports<span class="sc">:</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> <span class="st">"80:80"</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> <span class="st">"443:443"</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    volumes<span class="sc">:</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> <span class="er">$</span>PWD<span class="sc">/</span>Caddyfile<span class="sc">:</span><span class="er">/</span>etc<span class="sc">/</span>caddy<span class="sc">/</span>Caddyfile</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> <span class="er">$</span>PWD<span class="sc">/</span>site<span class="sc">:</span><span class="er">/</span>srv</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> caddy_data<span class="sc">:</span><span class="er">/</span>data</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>volumes<span class="sc">:</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    caddy_data<span class="sc">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="landing-page" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Landing Page</h1>
<p>Lastly, we need an html file, <code>index.html</code> in a subdirectory named <code>site</code> that provides the landing page for our server.</p>
<details>
<summary><code>index.html</code>. Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;!</span>DOCTYPE html<span class="sc">&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span>html<span class="sc">&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>body<span class="sc">&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>h1<span class="sc">&gt;</span>Power1 app<span class="sc">&lt;</span><span class="er">/</span>h1<span class="sc">&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>ul<span class="sc">&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      <span class="er">&lt;</span>li<span class="sc">&gt;</span><span class="er">&lt;</span>a href<span class="ot">=</span><span class="st">"./power1/"</span><span class="sc">&gt;</span>Power1 app<span class="sc">&lt;</span><span class="er">/</span>a<span class="sc">&gt;</span><span class="er">&lt;/</span>li<span class="sc">&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;/</span>ul<span class="sc">&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;/</span>body<span class="sc">&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;/</span>html<span class="sc">&gt;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>At this point our <code>power1_app</code> repo looks like this:</p>
<pre class="text"><code>.
├── Caddyfile
├── Dockerfile
├── docker-compose.yml
└── site
    └── index.html</code></pre>
</section>
<section id="github" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Github</h1>
<p>Push the new content to Github.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next login to the virtual server and clone the repo from Github.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> rgtlab.org</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/rgt47/power1_app.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Lastly, cd into <code>power1_app</code> directory and run</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and you’re good to go! The power1_shiny app is available at</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">https://rgtlab.org/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="appendices" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Appendices</h1>
<section id="appendix-1" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="appendix-1"><span class="header-section-number">7.1</span> Appendix-1</h2>
</section>
<section id="app.r" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="app.r"><span class="header-section-number">7.2</span> App.R</h2>
<p>Consider an app that is a balance of simple and functional – one that calculates the power for a 2-sample t-test as a function of the standardized effect size. re is our shiny app <code>power1_shiny.R</code>:</p>
<p>Consider the power1.R file:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ui</span> <span class="op">&lt;</span>- fluidPage<span class="er">(</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">titlePanel</span><span class="er">(</span><span class="st">"Power Calculator for Two Group Parallel Designs"</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">sliderInput</span><span class="er">(</span><span class="st">"N"</span><span class="ex">,</span> <span class="st">"Total Sample Size:"</span>, min = 0, max = 300, value = 100<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="ex">plotOutput</span><span class="er">(</span><span class="st">"plot"</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">verbatimTextOutput</span><span class="er">(</span><span class="st">"eff"</span><span class="kw">))</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="ex">server</span> <span class="op">&lt;</span>- function<span class="er">(</span><span class="ex">input,</span> output, session<span class="kw">)</span> <span class="kw">{</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">delta</span> = seq<span class="er">(</span><span class="ex">0,</span> 1.5,.05<span class="kw">)</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="ex">pow</span> = reactive<span class="er">(</span><span class="ex">sapply</span><span class="er">(</span><span class="ex">delta,</span> function<span class="er">(</span><span class="ex">x</span><span class="kw">)</span> <span class="ex">power.t.test</span><span class="er">(</span><span class="ex">input</span><span class="va">$N</span><span class="ex">,</span> d=x<span class="kw">)</span><span class="va">$power</span> <span class="kw">))</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">eff</span> =  renderText<span class="er">(</span><span class="ex">power.t.test</span><span class="er">(</span><span class="ex">input</span><span class="va">$N</span><span class="ex">,</span> power=.8<span class="kw">)</span><span class="va">$d</span><span class="kw">)</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="ex">output</span><span class="va">$plot</span> <span class="op">&lt;</span>- renderPlot<span class="er">(</span><span class="kw">{</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">plot</span><span class="er">(</span><span class="ex">delta,</span> pow<span class="er">(</span><span class="kw">)</span><span class="ex">,</span> cex=1.5, ylab=<span class="st">"power"</span><span class="kw">)</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="ex">abline</span><span class="er">(</span><span class="ex">h</span> = .8,  col = <span class="st">"red"</span>, lwd =2.5, lty = 4<span class="kw">)</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="ex">abline</span><span class="er">(</span><span class="ex">v</span> = eff<span class="er">(</span><span class="kw">)</span><span class="ex">,</span> col = <span class="st">"blue"</span>,lwd =2.5, lty = 4<span class="kw">)})</span>  </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="ex">output</span><span class="va">$eff</span> <span class="op">&lt;</span>- renderText<span class="er">(</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">paste0</span><span class="er">(</span><span class="st">"Std. effect detectable with power 80% = "</span><span class="ex">,</span> eff<span class="er">(</span><span class="kw">))</span> <span class="kw">)</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="ex">shinyApp</span><span class="er">(</span><span class="ex">ui,</span> server<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The app is designed to be maximally minimal. Using only base R functions, with a minimum of reactive widgets and layout commands to keep it simple while still performing a useful function.</p>
</section>
<section id="tip-1.-docker-on-m1-macbook." class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="tip-1.-docker-on-m1-macbook."><span class="header-section-number">7.3</span> Tip 1. Docker on M1 macbook.</h2>
<p>To get docker functioning properly with <code>rocker</code> images on M1 Mac desktop use <code>--platform</code> option.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> power1_shiny <span class="at">--platform</span> linux/x86_64 .</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">-p</span> 80:3838 <span class="at">--platform</span> linux/x86_64 power1_shiny</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="tip-2-add-user-to-docker-group-on-server." class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="tip-2-add-user-to-docker-group-on-server."><span class="header-section-number">7.4</span> Tip 2 add user to docker group on server.</h2>
<p>Add ubuntu to the docker group to allow docker to run without sudo.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> usermod <span class="at">-aG</span> docker <span class="va">${USER}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="tip-3-ssh-config-file." class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="tip-3-ssh-config-file."><span class="header-section-number">7.5</span> Tip 3 ssh config file.</h2>
<p>For convenience, construct a <code>config</code> file in <code>~/.ssh</code> as:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Host</span> rgtlab.org</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">HostName</span> 13.57.139.31 <span class="co"># static IP</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">User</span> ubuntu <span class="co"># default user on ubuntu server</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Port</span> 22  <span class="co"># the default port ssh uses</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ex">IdentityFile</span> ~/Downloads/power1.rsa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>then you can ssh into the new server with</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sh</span><span class="op">&gt;</span> ssh rgtlab.org </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="references" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> References</h1>
<ul>
<li><a href="https://focusonr.org/posts/server_setup_aws_console/">Focus on R: a new qblog - Set up a virtual server on AWS (in anticipation of hosting Shiny apps)</a></li>
<li><a href="https://focusonr.org/posts/server_setup_aws_cli/">Focus on R: a new qblog - Set up a virtual server on AWS with AWS CLI</a></li>
<li><a href="https://hosting.analythium.io/shiny-apps-with-docker-compose-part-1-development/">Shiny Apps with Docker Compose, Part 1: Development</a></li>
<li><a href="https://hosting.analythium.io/shiny-apps-with-docker-compose-part-2-production/">Shiny Apps with Docker Compose, Part 2: Production</a></li>
</ul>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{(ryy)glennthomas2023,
  author = {Ronald (Ryy) Glenn Thomas},
  title = {A Straightforward Strategy to Get Your {Shiny} App Online,
    Securely and Continuously Updated.},
  date = {2023-06-30},
  url = {https://focusonr.org/posts/dockerize_compose},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-(ryy)glennthomas2023" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Ronald (Ryy) Glenn Thomas. 2023. <span>“A Straightforward Strategy to
Get Your Shiny App Online, Securely and Continuously Updated. .”</span>
June 30, 2023. <a href="https://focusonr.org/posts/dockerize_compose">https://focusonr.org/posts/dockerize_compose</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="rgt47/qblog" data-repo-id="R_kgDOH6TO7A" data-category="Announcements" data-category-id="DIC_kwDOH5G3U84CRUp9" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
</div> <!-- /content -->



</body></html>