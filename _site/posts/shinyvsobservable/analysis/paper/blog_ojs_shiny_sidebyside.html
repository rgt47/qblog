<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Data Science Team">
<meta name="dcterms.date" content="2025-12-08">

<title>Combining Observable JS and Shiny in One Quarto Document – Thomas Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-e0d487ef0183e85fdba1faa3590ecedc.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    "?",
    "/"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="../../../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;1,400&amp;family=Open+Sans:ital,wght@0,400;0,600;1,400&amp;family=Fira+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/0fba9333d8.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">

<!-- Custom meta tags for social sharing -->
<meta property="og:site_name" content="Thomas Lab">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@rgt47">

<!-- Add responsive features -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Add analytics if needed -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXX');
</script> -->

<!-- Add custom javascript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Remove code tools button completely
  const codeButton = document.querySelector('.code-tools-button');
  if (codeButton) {
    codeButton.remove();
  }
  
  // Add any custom JavaScript functionality here
  
  // Example: Add smooth scrolling
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      
      document.querySelector(this.getAttribute('href')).scrollIntoView({
        behavior: 'smooth'
      });
    });
  });
  
  // Make sidebar category items clickable (but not TOC items)
  const categoryLinks = {
    'Programming & Development': '/posts/?category=Programming+%26+Development',
    'Data Analysis & Visualization': '/posts/?category=Data+Analysis+%26+Visualization',
    'Deployment & Operations': '/posts/?category=Deployment+%26+Operations',
    'Development Environment': '/posts/?category=Development+Environment',
    'Shiny Applications': '/posts/?category=Shiny+Applications',
    'AI & Automation': '/posts/?category=AI+%26+Automation',
    'System Administration': '/posts/?category=System+Administration'
  };
  
  // Only target sidebar items that are not in the TOC
  document.querySelectorAll('.sidebar-item-section .sidebar-item-text').forEach(item => {
    // Skip if this is inside the TOC
    if (item.closest('#TOC')) return;
    
    const text = item.textContent.trim();
    if (categoryLinks[text]) {
      item.addEventListener('click', function() {
        window.location.href = categoryLinks[text];
      });
    }
  });
});
</script>


<meta property="og:title" content="Combining Observable JS and Shiny in One Quarto Document – Thomas Lab">
<meta property="og:description" content="A Hard-Won Guide for Statisticians">
<meta property="og:site_name" content="Thomas Lab">
</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Thomas Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../white-papers/index.html"> 
<span class="menu-text">White Papers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../misc/index.html"> 
<span class="menu-text">Misc</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#the-goal" id="toc-the-goal" class="nav-link" data-scroll-target="#the-goal"><span class="header-section-number">2</span> The Goal</a></li>
  <li><a href="#the-naive-approach-what-we-tried-first" id="toc-the-naive-approach-what-we-tried-first" class="nav-link" data-scroll-target="#the-naive-approach-what-we-tried-first"><span class="header-section-number">3</span> The Naive Approach (What We Tried First)</a>
  <ul class="collapse">
  <li><a href="#attempt-1-just-put-both-in-one-file" id="toc-attempt-1-just-put-both-in-one-file" class="nav-link" data-scroll-target="#attempt-1-just-put-both-in-one-file"><span class="header-section-number">3.1</span> Attempt 1: Just Put Both in One File</a></li>
  <li><a href="#why-this-fails" id="toc-why-this-fails" class="nav-link" data-scroll-target="#why-this-fails"><span class="header-section-number">3.2</span> Why This Fails</a></li>
  </ul></li>
  <li><a href="#attempt-2-use-ojs_define-to-share-data" id="toc-attempt-2-use-ojs_define-to-share-data" class="nav-link" data-scroll-target="#attempt-2-use-ojs_define-to-share-data"><span class="header-section-number">4</span> Attempt 2: Use <code>ojs_define()</code> to Share Data</a>
  <ul class="collapse">
  <li><a href="#why-this-fails-1" id="toc-why-this-fails-1" class="nav-link" data-scroll-target="#why-this-fails-1"><span class="header-section-number">4.1</span> Why This Fails</a></li>
  <li><a href="#what-about-context-setup" id="toc-what-about-context-setup" class="nav-link" data-scroll-target="#what-about-context-setup"><span class="header-section-number">4.2</span> What About <code>context: setup</code>?</a></li>
  </ul></li>
  <li><a href="#attempt-3-use-d3.csv-instead" id="toc-attempt-3-use-d3.csv-instead" class="nav-link" data-scroll-target="#attempt-3-use-d3.csv-instead"><span class="header-section-number">5</span> Attempt 3: Use <code>d3.csv()</code> Instead</a>
  <ul class="collapse">
  <li><a href="#why-this-fails-2" id="toc-why-this-fails-2" class="nav-link" data-scroll-target="#why-this-fails-2"><span class="header-section-number">5.1</span> Why This Fails</a></li>
  </ul></li>
  <li><a href="#the-solution-that-actually-works" id="toc-the-solution-that-actually-works" class="nav-link" data-scroll-target="#the-solution-that-actually-works"><span class="header-section-number">6</span> The Solution That Actually Works</a>
  <ul class="collapse">
  <li><a href="#fetch-data-from-a-public-url" id="toc-fetch-data-from-a-public-url" class="nav-link" data-scroll-target="#fetch-data-from-a-public-url"><span class="header-section-number">6.1</span> Fetch Data from a Public URL</a></li>
  </ul></li>
  <li><a href="#complete-working-example" id="toc-complete-working-example" class="nav-link" data-scroll-target="#complete-working-example"><span class="header-section-number">7</span> Complete Working Example</a></li>
  <li><a href="#dos-and-donts" id="toc-dos-and-donts" class="nav-link" data-scroll-target="#dos-and-donts"><span class="header-section-number">8</span> Dos and Don’ts</a>
  <ul class="collapse">
  <li><a href="#do" id="toc-do" class="nav-link" data-scroll-target="#do"><span class="header-section-number">8.1</span> ✅ DO</a></li>
  <li><a href="#dont" id="toc-dont" class="nav-link" data-scroll-target="#dont"><span class="header-section-number">8.2</span> ❌ DON’T</a></li>
  </ul></li>
  <li><a href="#gotchas-and-edge-cases" id="toc-gotchas-and-edge-cases" class="nav-link" data-scroll-target="#gotchas-and-edge-cases"><span class="header-section-number">9</span> Gotchas and Edge Cases</a>
  <ul class="collapse">
  <li><a href="#gotcha-1-browser-caching" id="toc-gotcha-1-browser-caching" class="nav-link" data-scroll-target="#gotcha-1-browser-caching"><span class="header-section-number">9.1</span> Gotcha 1: Browser Caching</a></li>
  <li><a href="#gotcha-2-server-context-confusion" id="toc-gotcha-2-server-context-confusion" class="nav-link" data-scroll-target="#gotcha-2-server-context-confusion"><span class="header-section-number">9.2</span> Gotcha 2: Server Context Confusion</a></li>
  <li><a href="#gotcha-3-error-messages-are-misleading" id="toc-gotcha-3-error-messages-are-misleading" class="nav-link" data-scroll-target="#gotcha-3-error-messages-are-misleading"><span class="header-section-number">9.3</span> Gotcha 3: Error Messages Are Misleading</a></li>
  <li><a href="#gotcha-4-the-preview-port-changes" id="toc-gotcha-4-the-preview-port-changes" class="nav-link" data-scroll-target="#gotcha-4-the-preview-port-changes"><span class="header-section-number">9.4</span> Gotcha 4: The Preview Port Changes</a></li>
  <li><a href="#gotcha-5-ojs-inputs-dont-automatically-connect-to-shiny" id="toc-gotcha-5-ojs-inputs-dont-automatically-connect-to-shiny" class="nav-link" data-scroll-target="#gotcha-5-ojs-inputs-dont-automatically-connect-to-shiny"><span class="header-section-number">9.5</span> Gotcha 5: OJS Inputs Don’t Automatically Connect to Shiny</a></li>
  </ul></li>
  <li><a href="#alternative-approaches" id="toc-alternative-approaches" class="nav-link" data-scroll-target="#alternative-approaches"><span class="header-section-number">10</span> Alternative Approaches</a>
  <ul class="collapse">
  <li><a href="#option-1-two-separate-documents" id="toc-option-1-two-separate-documents" class="nav-link" data-scroll-target="#option-1-two-separate-documents"><span class="header-section-number">10.1</span> Option 1: Two Separate Documents</a></li>
  <li><a href="#option-2-static-ojs-only" id="toc-option-2-static-ojs-only" class="nav-link" data-scroll-target="#option-2-static-ojs-only"><span class="header-section-number">10.2</span> Option 2: Static OJS Only</a></li>
  <li><a href="#option-3-pre-embed-the-data-as-json" id="toc-option-3-pre-embed-the-data-as-json" class="nav-link" data-scroll-target="#option-3-pre-embed-the-data-as-json"><span class="header-section-number">10.3</span> Option 3: Pre-embed the Data as JSON</a></li>
  </ul></li>
  <li><a href="#when-to-use-each-technology" id="toc-when-to-use-each-technology" class="nav-link" data-scroll-target="#when-to-use-each-technology"><span class="header-section-number">11</span> When to Use Each Technology</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">12</span> Conclusion</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">13</span> Resources</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Combining Observable JS and Shiny in One Quarto Document</h1>
<p class="subtitle lead">A Hard-Won Guide for Statisticians</p>
</div>



<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Data Science Team </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 8, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>If you’re a statistician who’s heard about Observable JS and wants to compare it side-by-side with Shiny in a single document, you might think: “Quarto supports both—how hard can it be?”</p>
<p><strong>Very hard, as it turns out.</strong></p>
<p>This post documents our journey trying to create a simple side-by-side comparison of Observable JS and Shiny showing the same interactive visualization. What should have taken 30 minutes took several hours of debugging. We’re sharing our experience so you don’t have to suffer the same fate.</p>
</section>
<section id="the-goal" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="the-goal"><span class="header-section-number">2</span> The Goal</h2>
<p>We wanted to create a single Quarto document that shows:</p>
<ul>
<li><strong>Left column</strong>: An Observable JS histogram with a slider filter</li>
<li><strong>Right column</strong>: The identical visualization in Shiny</li>
</ul>
<p>Both would filter the Palmer Penguins dataset by bill length and display a histogram of body mass. Simple, right?</p>
</section>
<section id="the-naive-approach-what-we-tried-first" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="the-naive-approach-what-we-tried-first"><span class="header-section-number">3</span> The Naive Approach (What We Tried First)</h2>
<section id="attempt-1-just-put-both-in-one-file" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="attempt-1-just-put-both-in-one-file"><span class="header-section-number">3.1</span> Attempt 1: Just Put Both in One File</h3>
<p>Our first attempt looked like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Side by Side"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span><span class="kw">:</span><span class="at"> html</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">server</span><span class="kw">:</span><span class="at"> shiny</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>With Observable JS code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"palmer-penguins.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>And Shiny code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| context: server</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"palmer-penguins.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Result</strong>: The Shiny side worked. The Observable side showed:</p>
<pre><code>OJS Error: Unable to load file: palmer-penguins.csv</code></pre>
</section>
<section id="why-this-fails" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="why-this-fails"><span class="header-section-number">3.2</span> Why This Fails</h3>
<p>When you add <code>server: shiny</code> to your YAML header, the document runs as a Shiny application. This fundamentally changes how files are served:</p>
<ol type="1">
<li><strong>Shiny serves the HTML dynamically</strong> from an R process</li>
<li><strong>FileAttachment paths don’t resolve</strong> because the Shiny server doesn’t know about Observable’s file attachment system</li>
<li><strong>The CSV file isn’t accessible</strong> at the URL that Observable expects</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Key Insight #1
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>FileAttachment()</code> does NOT work in Shiny documents. This is the single biggest “gotcha” when combining OJS and Shiny.</p>
</div>
</div>
</section>
</section>
<section id="attempt-2-use-ojs_define-to-share-data" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="attempt-2-use-ojs_define-to-share-data"><span class="header-section-number">4</span> Attempt 2: Use <code>ojs_define()</code> to Share Data</h2>
<p>The Quarto documentation mentions <code>ojs_define()</code> as a way to pass data from R to Observable. Perfect! We’ll load the data in R and share it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| context: server</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"palmer-penguins.csv"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ojs_define</span>(<span class="at">data_from_r =</span> data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data_ojs <span class="op">=</span> <span class="fu">transpose</span>(data_from_r)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Result</strong>:</p>
<pre><code>Error in .subset2(x, "impl")$defineOutput:
  Unexpected data.frame object for output$data_from_r
ℹ Did you forget to use a render function?</code></pre>
<section id="why-this-fails-1" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="why-this-fails-1"><span class="header-section-number">4.1</span> Why This Fails</h3>
<p>In a Shiny document, <code>ojs_define()</code> behaves differently than in a regular Quarto document:</p>
<ol type="1">
<li><strong>In regular Quarto</strong>: <code>ojs_define()</code> runs at render time and embeds data in the HTML</li>
<li><strong>In Shiny Quarto</strong>: <code>ojs_define()</code> tries to create a Shiny output, which expects a reactive expression</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Key Insight #2
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>ojs_define()</code> in a <code>server: shiny</code> document requires passing a <strong>reactive expression</strong>, not a static data frame. And even then, it may not work as expected.</p>
</div>
</div>
</section>
<section id="what-about-context-setup" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="what-about-context-setup"><span class="header-section-number">4.2</span> What About <code>context: setup</code>?</h3>
<p>We tried putting <code>ojs_define()</code> in different contexts:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| context: setup</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ojs_define</span>(<span class="at">data =</span> penguins)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Result</strong>: Same error. In a Shiny document, even “setup” code runs within the Shiny server context.</p>
</section>
</section>
<section id="attempt-3-use-d3.csv-instead" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="attempt-3-use-d3.csv-instead"><span class="header-section-number">5</span> Attempt 3: Use <code>d3.csv()</code> Instead</h2>
<p>Since <code>FileAttachment</code> doesn’t work, maybe we can use D3’s CSV loader:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data_ojs <span class="op">=</span> d3<span class="op">.</span><span class="fu">csv</span>(<span class="st">"palmer-penguins.csv"</span><span class="op">,</span> d3<span class="op">.</span><span class="at">autoType</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Result</strong>:</p>
<pre><code>OJS Error: 404 Not Found</code></pre>
<section id="why-this-fails-2" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="why-this-fails-2"><span class="header-section-number">5.1</span> Why This Fails</h3>
<p>The Shiny server doesn’t serve static files from the working directory by default. When Observable tries to fetch <code>palmer-penguins.csv</code>, the Shiny server returns a 404.</p>
<p>We tried adding <code>resources</code> to the YAML:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> palmer-penguins.csv</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Result</strong>: Still 404. The <code>resources</code> option works for static HTML output, but the Shiny server has its own file-serving logic.</p>
</section>
</section>
<section id="the-solution-that-actually-works" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="the-solution-that-actually-works"><span class="header-section-number">6</span> The Solution That Actually Works</h2>
<p>After much trial and error, here’s what finally worked:</p>
<section id="fetch-data-from-a-public-url" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="fetch-data-from-a-public-url"><span class="header-section-number">6.1</span> Fetch Data from a Public URL</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>penguins_raw <span class="op">=</span> {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://raw.githubusercontent.com/allisonhorst/palmerpenguins/main/inst/extdata/penguins.csv"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">text</span>()<span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="fu">csvParse</span>(text<span class="op">,</span> d3<span class="op">.</span><span class="at">autoType</span>)<span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>data_ojs <span class="op">=</span> penguins_raw<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">bill_length_mm</span> <span class="op">!=</span> <span class="kw">null</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This works because:</p>
<ol type="1">
<li><code>fetch()</code> makes an HTTP request to an external URL</li>
<li>GitHub’s raw content URLs are publicly accessible</li>
<li>The request bypasses the Shiny server entirely</li>
<li>D3’s <code>csvParse()</code> converts the text to typed data</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>The Working Solution
</div>
</div>
<div class="callout-body-container callout-body">
<p>In a Shiny+OJS document, load OJS data from a <strong>public URL</strong> using <code>fetch()</code>, not from local files.</p>
</div>
</div>
</section>
</section>
<section id="complete-working-example" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="complete-working-example"><span class="header-section-number">7</span> Complete Working Example</h2>
<p>Here’s the minimal working code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Observable vs Shiny: Side-by-Side"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="an">server:</span><span class="co"> shiny</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>::: {.grid}</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>::: {.g-col-6}</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">## Observable JS</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>viewof bill_min <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">32</span><span class="op">,</span> <span class="dv">50</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">35</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Min bill length:"</span>})</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Load from public URL - this is the key!</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> {</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> resp <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">"https://raw.githubusercontent.com/allisonhorst/palmerpenguins/main/inst/extdata/penguins.csv"</span>)<span class="op">;</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="fu">csvParse</span>(<span class="cf">await</span> resp<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> d3<span class="op">.</span><span class="at">autoType</span>)<span class="op">;</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> penguins<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">bill_length_mm</span> <span class="op">&gt;</span> bill_min <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">bill_length_mm</span> <span class="op">!=</span> <span class="kw">null</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [Plot<span class="op">.</span><span class="fu">rectY</span>(filtered<span class="op">,</span> Plot<span class="op">.</span><span class="fu">binX</span>({<span class="dt">y</span><span class="op">:</span> <span class="st">"count"</span>}<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="st">"body_mass_g"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"species"</span>}))]</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>::: {.g-col-6}</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Shiny</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>::: {.cell}</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{.r .cell-code}</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="fu">sliderInput</span>(<span class="st">"bill_min"</span>, <span class="st">"Min bill length:"</span>, <span class="at">min =</span> <span class="dv">32</span>, <span class="at">max =</span> <span class="dv">50</span>, <span class="at">value =</span> <span class="dv">35</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="fu">plotOutput</span>(<span class="st">"plot"</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>::: {.cell context='server'}</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{.r .cell-code}</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"palmer-penguins.csv"</span>)</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(bill_length_mm <span class="sc">&gt;</span> input<span class="sc">$</span>bill_min, <span class="sc">!</span><span class="fu">is.na</span>(body_mass_g)) <span class="sc">|&gt;</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">fill =</span> species)) <span class="sc">+</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>)</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>:::</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="dos-and-donts" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="dos-and-donts"><span class="header-section-number">8</span> Dos and Don’ts</h2>
<section id="do" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="do"><span class="header-section-number">8.1</span> ✅ DO</h3>
<ol type="1">
<li><strong>Use <code>fetch()</code> with public URLs</strong> for loading data in OJS within Shiny documents</li>
<li><strong>Keep OJS and Shiny data loading separate</strong> - don’t try to share data between them</li>
<li><strong>Test incrementally</strong> - get Shiny working first, then add OJS</li>
<li><strong>Use <code>await</code> properly</strong> when fetching data in OJS code blocks</li>
<li><strong>Hard refresh your browser</strong> (Cmd+Shift+R) when debugging - caching causes confusion</li>
<li><strong>Restart the preview server</strong> when making major changes - Quarto’s hot reload doesn’t always catch everything</li>
</ol>
</section>
<section id="dont" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="dont"><span class="header-section-number">8.2</span> ❌ DON’T</h3>
<ol type="1">
<li><strong>Don’t use <code>FileAttachment()</code></strong> in Shiny documents - it won’t work</li>
<li><strong>Don’t use <code>ojs_define()</code> with static data</strong> in Shiny documents - it expects reactives</li>
<li><strong>Don’t assume <code>d3.csv("local-file.csv")</code> will work</strong> - Shiny doesn’t serve local files</li>
<li><strong>Don’t rely on <code>resources:</code> in YAML</strong> to make files accessible to OJS in Shiny mode</li>
<li><strong>Don’t mix <code>context: setup</code> with <code>ojs_define()</code></strong> - it still runs in Shiny context</li>
<li><strong>Don’t trust the displayed code in the browser</strong> - it may be cached from a previous version</li>
</ol>
</section>
</section>
<section id="gotchas-and-edge-cases" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="gotchas-and-edge-cases"><span class="header-section-number">9</span> Gotchas and Edge Cases</h2>
<section id="gotcha-1-browser-caching" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="gotcha-1-browser-caching"><span class="header-section-number">9.1</span> Gotcha 1: Browser Caching</h3>
<p>When debugging, the browser often shows old code even after you’ve updated the file. The displayed code (with <code>echo: true</code>) might show <code>FileAttachment(...)</code> even though your file now uses <code>fetch()</code>.</p>
<p><strong>Solution</strong>: Kill the preview server, delete generated files, restart, and hard-refresh:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> yourfile_files yourfile.html</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">quarto</span> preview yourfile.qmd</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Then Cmd+Shift+R in browser</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="gotcha-2-server-context-confusion" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="gotcha-2-server-context-confusion"><span class="header-section-number">9.2</span> Gotcha 2: Server Context Confusion</h3>
<p>In a Shiny document, <strong>all R code runs in the server context</strong> by default. Even chunks without <code>#| context: server</code> are affected by the Shiny runtime.</p>
</section>
<section id="gotcha-3-error-messages-are-misleading" class="level3" data-number="9.3">
<h3 data-number="9.3" class="anchored" data-anchor-id="gotcha-3-error-messages-are-misleading"><span class="header-section-number">9.3</span> Gotcha 3: Error Messages Are Misleading</h3>
<p>The error “Did you forget to use a render function?” when using <code>ojs_define()</code> suggests you need <code>renderSomething()</code>, but that’s not the real issue. The real issue is that <code>ojs_define()</code> doesn’t work well with static data in Shiny documents.</p>
</section>
<section id="gotcha-4-the-preview-port-changes" class="level3" data-number="9.4">
<h3 data-number="9.4" class="anchored" data-anchor-id="gotcha-4-the-preview-port-changes"><span class="header-section-number">9.4</span> Gotcha 4: The Preview Port Changes</h3>
<p>Every time you restart <code>quarto preview</code>, you might get a different port (5155, 6532, 7665, etc.). Make sure you’re looking at the right URL.</p>
</section>
<section id="gotcha-5-ojs-inputs-dont-automatically-connect-to-shiny" class="level3" data-number="9.5">
<h3 data-number="9.5" class="anchored" data-anchor-id="gotcha-5-ojs-inputs-dont-automatically-connect-to-shiny"><span class="header-section-number">9.5</span> Gotcha 5: OJS Inputs Don’t Automatically Connect to Shiny</h3>
<p>Unlike what some documentation suggests, <code>viewof</code> variables in OJS don’t automatically become Shiny inputs unless you configure <code>ojs-import</code> in the YAML. For a simple side-by-side comparison, keep the two systems completely separate.</p>
</section>
</section>
<section id="alternative-approaches" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="alternative-approaches"><span class="header-section-number">10</span> Alternative Approaches</h2>
<p>If this complexity is too much, consider these alternatives:</p>
<section id="option-1-two-separate-documents" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="option-1-two-separate-documents"><span class="header-section-number">10.1</span> Option 1: Two Separate Documents</h3>
<p>Create <code>penguins_observable.qmd</code> and <code>penguins_shiny.qmd</code> separately, then link between them or embed them in iframes.</p>
</section>
<section id="option-2-static-ojs-only" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="option-2-static-ojs-only"><span class="header-section-number">10.2</span> Option 2: Static OJS Only</h3>
<p>If you don’t need Shiny’s server-side features, remove <code>server: shiny</code> and use pure OJS with <code>FileAttachment()</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Observable Only"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span><span class="kw">:</span><span class="at"> html</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># No server: shiny!</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="option-3-pre-embed-the-data-as-json" class="level3" data-number="10.3">
<h3 data-number="10.3" class="anchored" data-anchor-id="option-3-pre-embed-the-data-as-json"><span class="header-section-number">10.3</span> Option 3: Pre-embed the Data as JSON</h3>
<p>Convert your CSV to JSON and embed it directly in the OJS code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"species"</span><span class="op">:</span> <span class="st">"Adelie"</span><span class="op">,</span> <span class="st">"bill_length_mm"</span><span class="op">:</span> <span class="fl">39.1</span><span class="op">,</span> <span class="op">...</span>}<span class="op">,</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This makes the file larger but avoids all loading issues.</p>
</section>
</section>
<section id="when-to-use-each-technology" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="when-to-use-each-technology"><span class="header-section-number">11</span> When to Use Each Technology</h2>
<p>Based on our experience:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Use Case</th>
<th>Recommendation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Self-contained report</td>
<td>Observable JS only</td>
</tr>
<tr class="even">
<td>Complex statistics</td>
<td>Shiny only</td>
</tr>
<tr class="odd">
<td>Teaching comparison</td>
<td>Separate documents</td>
</tr>
<tr class="even">
<td>Production dashboard</td>
<td>Pick one, not both</td>
</tr>
</tbody>
</table>
</section>
<section id="conclusion" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">12</span> Conclusion</h2>
<p>Combining Observable JS and Shiny in a single Quarto document is possible, but it’s not straightforward. The key challenges are:</p>
<ol type="1">
<li><strong>File loading works completely differently</strong> in Shiny vs.&nbsp;static Quarto</li>
<li><strong><code>ojs_define()</code> has different behavior</strong> depending on context</li>
<li><strong>Documentation doesn’t cover this edge case</strong> well</li>
<li><strong>Debugging is frustrating</strong> due to caching and misleading errors</li>
</ol>
<p>The working solution—fetching data from a public URL—is a workaround rather than an elegant integration. If you’re building production applications, we recommend choosing one technology rather than combining both.</p>
<p>However, for educational purposes (showing students or colleagues how both technologies work), the side-by-side approach can be valuable once you get past the setup hurdles.</p>
</section>
<section id="resources" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="resources"><span class="header-section-number">13</span> Resources</h2>
<ul>
<li><a href="https://quarto.org/docs/interactive/ojs/">Quarto OJS Documentation</a></li>
<li><a href="https://quarto.org/docs/interactive/shiny/">Quarto Shiny Documentation</a></li>
<li><a href="https://quarto.org/docs/interactive/ojs/shiny.html">Quarto Shiny Reactives (ojs_define)</a></li>
<li><a href="https://observablehq.com/plot/">Observable Plot</a></li>
<li><a href="https://allisonhorst.github.io/palmerpenguins/">Palmer Penguins Dataset</a></li>
</ul>
<hr>
<p><em>This post was written after several hours of debugging. We hope it saves you time.</em></p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{(ryy)_glenn_thomas2025,
  author = {(Ryy) Glenn Thomas, Ronald and Science Team, Data},
  title = {Combining {Observable} {JS} and {Shiny} in {One} {Quarto}
    {Document}},
  date = {2025-12-08},
  url = {https://focusonr.org/posts/shinyvsobservable/analysis/paper/blog_ojs_shiny_sidebyside.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-(ryy)_glenn_thomas2025" class="csl-entry quarto-appendix-citeas" role="listitem">
(Ryy) Glenn Thomas, Ronald, and Data Science Team. 2025.
<span>“Combining Observable JS and Shiny in One Quarto Document.”</span>
December 8, 2025. <a href="https://focusonr.org/posts/shinyvsobservable/analysis/paper/blog_ojs_shiny_sidebyside.html">https://focusonr.org/posts/shinyvsobservable/analysis/paper/blog_ojs_shiny_sidebyside.html</a>.
</div></div></section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../posts/shinyvsobservable/analysis/paper";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../../../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/focusonr\.org");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="rgt47/qblog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2023-2025, Ronald G. Thomas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<!-- Fix for Quarto category encoding issue -->
<script>
// Fix category encoding for Quarto listing functionality
(function() {
  function fixAllCategoryEncoding() {
    // Only run on pages that have Quarto listings
    if (!document.querySelector('.quarto-listing')) {
      return;
    }
    
    // Fix sidebar category data-category attributes
    const categoryEls = document.querySelectorAll('.quarto-listing-category .category[data-category]');
    
    categoryEls.forEach((categoryEl) => {
      const category = categoryEl.getAttribute('data-category');
      
      if (category && category !== '') {
        // Check if it contains only base64 characters and proper length
        const isBase64 = /^[A-Za-z0-9+/]*={0,2}$/.test(category) && category.length % 4 === 0;
        
        if (isBase64) {
          try {
            const decoded = decodeURIComponent(atob(category));
            // Verify it decoded to something reasonable (no control characters)
            if (!decoded.match(/^[A-Za-z0-9\s\-,]+$/)) {
              // Invalid encoding, re-encode from original text
              const encodedCategory = btoa(encodeURIComponent(categoryEl.textContent.trim()));
              categoryEl.setAttribute('data-category', encodedCategory);
            }
          } catch (e) {
            // Base64 decode failed, re-encode from original text
            const encodedCategory = btoa(encodeURIComponent(categoryEl.textContent.trim()));
            categoryEl.setAttribute('data-category', encodedCategory);
          }
        } else {
          // Not base64, encode it
          const encodedCategory = btoa(encodeURIComponent(category));
          categoryEl.setAttribute('data-category', encodedCategory);
        }
      }
    });
    
    // Fix listing item data-categories attributes  
    const listingItems = document.querySelectorAll('[data-categories]');
    
    listingItems.forEach((item) => {
      const categories = item.getAttribute('data-categories');
      
      if (categories && categories !== '') {
        // Check if it's already base64 encoded
        try {
          decodeURIComponent(atob(categories));
          // Already encoded and valid
        } catch (e) {
          // Not encoded, fix it
          const encodedCategories = btoa(encodeURIComponent(categories));
          item.setAttribute('data-categories', encodedCategories);
        }
      }
    });
    
    // Fix post-specific category tag click handlers
    const postCategoryTags = document.querySelectorAll('.listing-category[onclick]');
    
    postCategoryTags.forEach((tag) => {
      const categoryText = tag.textContent.trim();
      
      // Replace the onclick handler to use encoded category
      tag.onclick = () => {
        const encodedCategory = btoa(encodeURIComponent(categoryText));
        window.quartoListingCategory(encodedCategory);
        return false;
      };
    });
  }
  
  // Run immediately
  fixAllCategoryEncoding();
  
  // Also run when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', fixAllCategoryEncoding);
  }
})();
</script>

<!-- PDF view/download button for blog posts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Only add the button on post pages
  if (window.location.pathname.includes('/posts/') && !window.location.pathname.endsWith('/posts/') && !window.location.pathname.endsWith('/posts/index.html')) {
    var currentPath = window.location.pathname;
    // Handle both /posts/name/ and /posts/name/index.html formats
    var pdfPath;
    if (currentPath.endsWith('/')) {
      pdfPath = currentPath + 'index.pdf';
    } else {
      pdfPath = currentPath.replace('.html', '.pdf');
    }

    // Check if PDF exists first
    fetch(pdfPath, { method: 'HEAD' })
      .then(function(response) {
        if (response.ok) {
          // PDF exists, show download button
          showDownloadButton(pdfPath);
        }
        // If PDF doesn't exist, don't show any button
      })
      .catch(function(error) {
        // Error checking PDF, don't show any button
      });
  }
});

function showDownloadButton(pdfPath) {
  var downloadBtn = document.createElement('div');
  downloadBtn.className = 'pdf-download-button';

  // Get file size if possible
  fetch(pdfPath, { method: 'HEAD' })
    .then(function(response) {
      var size = response.headers.get('Content-Length');
      var sizeText = '';

      if (size) {
        // Convert to MB or KB
        var sizeInMB = size / (1024 * 1024);
        if (sizeInMB >= 1) {
          sizeText = ' (' + sizeInMB.toFixed(1) + ' MB)';
        } else {
          sizeText = ' (' + (size / 1024).toFixed(0) + ' KB)';
        }
      }

      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' + sizeText +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    })
    .catch(function() {
      // Basic fallback if we can't get file size
      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    });

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(downloadBtn);
  }
}


</script>

<style>
.pdf-download-button {
  margin-top: 1rem;
  margin-bottom: 1rem;
}
</style>




</body></html>