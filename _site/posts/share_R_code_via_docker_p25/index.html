<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="R.G. Thomas">
<meta name="dcterms.date" content="2025-06-30">

<title>Research Compendia for Full Reproducibility in R: A zzrrtools, renv, and Docker Strategy – Thomas Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;1,400&amp;family=Open+Sans:ital,wght@0,400;0,600;1,400&amp;family=Fira+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/0fba9333d8.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">

<!-- Custom meta tags for social sharing -->
<meta property="og:site_name" content="Thomas Lab">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@rgt47">

<!-- Add responsive features -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Add analytics if needed -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXX');
</script> -->

<!-- Add custom javascript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add any custom JavaScript functionality here
  
  // Example: Add smooth scrolling
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      
      document.querySelector(this.getAttribute('href')).scrollIntoView({
        behavior: 'smooth'
      });
    });
  });
});
</script>


<meta property="og:title" content="Research Compendia for Full Reproducibility in R: A zzrrtools, renv, and Docker Strategy – Thomas Lab">
<meta property="og:description" content="This white paper presents an approach to achieving reproducibility in R workflows by combining three tools: zzrrtools for creating structured research compendia, renv for R package management, and Docker for containerizing the computing environment. The zzrrtools framework provides a standardized research compendium structure, renv manages package dependencies, and Docker ensures consistent execution environments. Together, these tools create self-contained research compendia that run identically across different systems. The paper includes a practical case study demonstrating multi-developer collaborative workflows with clear governance roles, where a project maintainer manages the technical infrastructure while multiple contributors extend the research analysis.">
<meta property="og:site_name" content="Thomas Lab">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Thomas Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Research Compendia for Full Reproducibility in R: A zzrrtools, renv, and Docker Strategy</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Categories</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Programming &amp; Development</span></span>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Data Analysis &amp; Visualization</span></span>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Deployment &amp; Operations</span></span>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Development Environment</span></span>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Shiny Applications</span></span>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">AI &amp; Automation</span></span>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">System Administration</span></span>
  </li>
      </ul>
  </li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive Summary</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#the-challenge-of-reproducibility-in-r" id="toc-the-challenge-of-reproducibility-in-r" class="nav-link" data-scroll-target="#the-challenge-of-reproducibility-in-r"><span class="header-section-number">1.1</span> The Challenge of Reproducibility in R</a></li>
  <li><a href="#a-three-level-solution" id="toc-a-three-level-solution" class="nav-link" data-scroll-target="#a-three-level-solution"><span class="header-section-number">1.2</span> A Three-Level Solution</a></li>
  </ul></li>
  <li><a href="#zzrrtools-project-level-reproducibility" id="toc-zzrrtools-project-level-reproducibility" class="nav-link" data-scroll-target="#zzrrtools-project-level-reproducibility"><span class="header-section-number">2</span> zzrrtools: Project-Level Reproducibility</a>
  <ul class="collapse">
  <li><a href="#what-is-zzrrtools" id="toc-what-is-zzrrtools" class="nav-link" data-scroll-target="#what-is-zzrrtools"><span class="header-section-number">2.1</span> What is zzrrtools?</a></li>
  <li><a href="#key-features-of-zzrrtools" id="toc-key-features-of-zzrrtools" class="nav-link" data-scroll-target="#key-features-of-zzrrtools"><span class="header-section-number">2.2</span> Key Features of zzrrtools</a></li>
  <li><a href="#zzrrtools-workflow-self-replicating-collaboration" id="toc-zzrrtools-workflow-self-replicating-collaboration" class="nav-link" data-scroll-target="#zzrrtools-workflow-self-replicating-collaboration"><span class="header-section-number">2.3</span> zzrrtools Workflow: Self-Replicating Collaboration</a>
  <ul class="collapse">
  <li><a href="#integrated-renv-consistency-checking" id="toc-integrated-renv-consistency-checking" class="nav-link" data-scroll-target="#integrated-renv-consistency-checking"><span class="header-section-number">2.3.1</span> Integrated renv Consistency Checking</a></li>
  </ul></li>
  <li><a href="#research-compendium-structure" id="toc-research-compendium-structure" class="nav-link" data-scroll-target="#research-compendium-structure"><span class="header-section-number">2.4</span> Research Compendium Structure</a></li>
  <li><a href="#iterative-development-workflow" id="toc-iterative-development-workflow" class="nav-link" data-scroll-target="#iterative-development-workflow"><span class="header-section-number">2.5</span> Iterative Development Workflow</a>
  <ul class="collapse">
  <li><a href="#phase-1-exploration-development-scripts" id="toc-phase-1-exploration-development-scripts" class="nav-link" data-scroll-target="#phase-1-exploration-development-scripts"><span class="header-section-number">2.5.1</span> Phase 1: Exploration &amp; Development (<code>scripts/</code>)</a></li>
  <li><a href="#phase-2-function-extraction-r" id="toc-phase-2-function-extraction-r" class="nav-link" data-scroll-target="#phase-2-function-extraction-r"><span class="header-section-number">2.5.2</span> Phase 2: Function Extraction (<code>R/</code>)</a></li>
  <li><a href="#phase-3-publication-integration-analysispaper" id="toc-phase-3-publication-integration-analysispaper" class="nav-link" data-scroll-target="#phase-3-publication-integration-analysispaper"><span class="header-section-number">2.5.3</span> Phase 3: Publication Integration (<code>analysis/paper/</code>)</a></li>
  <li><a href="#recommended-collaborative-workflow" id="toc-recommended-collaborative-workflow" class="nav-link" data-scroll-target="#recommended-collaborative-workflow"><span class="header-section-number">2.5.4</span> Recommended Collaborative Workflow:</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#renv-package-level-reproducibility" id="toc-renv-package-level-reproducibility" class="nav-link" data-scroll-target="#renv-package-level-reproducibility"><span class="header-section-number">3</span> renv: Package-Level Reproducibility</a>
  <ul class="collapse">
  <li><a href="#what-is-renv" id="toc-what-is-renv" class="nav-link" data-scroll-target="#what-is-renv"><span class="header-section-number">3.1</span> What is renv?</a></li>
  <li><a href="#key-features-of-renv" id="toc-key-features-of-renv" class="nav-link" data-scroll-target="#key-features-of-renv"><span class="header-section-number">3.2</span> Key Features of renv</a></li>
  <li><a href="#basic-renv-workflow" id="toc-basic-renv-workflow" class="nav-link" data-scroll-target="#basic-renv-workflow"><span class="header-section-number">3.3</span> Basic renv Workflow</a></li>
  </ul></li>
  <li><a href="#docker-system-level-reproducibility" id="toc-docker-system-level-reproducibility" class="nav-link" data-scroll-target="#docker-system-level-reproducibility"><span class="header-section-number">4</span> Docker: System-Level Reproducibility</a>
  <ul class="collapse">
  <li><a href="#what-is-docker" id="toc-what-is-docker" class="nav-link" data-scroll-target="#what-is-docker"><span class="header-section-number">4.1</span> What is Docker?</a></li>
  <li><a href="#dockers-role-in-reproducibility" id="toc-dockers-role-in-reproducibility" class="nav-link" data-scroll-target="#dockers-role-in-reproducibility"><span class="header-section-number">4.2</span> Docker’s Role in Reproducibility</a></li>
  <li><a href="#docker-components-for-r-workflows" id="toc-docker-components-for-r-workflows" class="nav-link" data-scroll-target="#docker-components-for-r-workflows"><span class="header-section-number">4.3</span> Docker Components for R Workflows</a></li>
  </ul></li>
  <li><a href="#combining-zzrrtools-renv-and-docker-a-comprehensive-approach" id="toc-combining-zzrrtools-renv-and-docker-a-comprehensive-approach" class="nav-link" data-scroll-target="#combining-zzrrtools-renv-and-docker-a-comprehensive-approach"><span class="header-section-number">5</span> Combining zzrrtools, renv, and Docker: A Comprehensive Approach</a>
  <ul class="collapse">
  <li><a href="#why-use-all-three" id="toc-why-use-all-three" class="nav-link" data-scroll-target="#why-use-all-three"><span class="header-section-number">5.1</span> Why Use All Three?</a></li>
  <li><a href="#integration-strategy-with-governance-model" id="toc-integration-strategy-with-governance-model" class="nav-link" data-scroll-target="#integration-strategy-with-governance-model"><span class="header-section-number">5.2</span> Integration Strategy with Governance Model</a></li>
  </ul></li>
  <li><a href="#practical-example-collaborative-research-compendium-development-with-testing" id="toc-practical-example-collaborative-research-compendium-development-with-testing" class="nav-link" data-scroll-target="#practical-example-collaborative-research-compendium-development-with-testing"><span class="header-section-number">6</span> Practical Example: Collaborative Research Compendium Development with Testing</a>
  <ul class="collapse">
  <li><a href="#project-scenario" id="toc-project-scenario" class="nav-link" data-scroll-target="#project-scenario"><span class="header-section-number">6.1</span> Project Scenario</a></li>
  <li><a href="#implementation-example" id="toc-implementation-example" class="nav-link" data-scroll-target="#implementation-example"><span class="header-section-number">6.2</span> Implementation Example</a>
  <ul class="collapse">
  <li><a href="#project-maintainer-setup-joe" id="toc-project-maintainer-setup-joe" class="nav-link" data-scroll-target="#project-maintainer-setup-joe"><span class="header-section-number">6.2.1</span> Project Maintainer Setup (Joe)</a></li>
  <li><a href="#team-member-onboarding-sam" id="toc-team-member-onboarding-sam" class="nav-link" data-scroll-target="#team-member-onboarding-sam"><span class="header-section-number">6.2.2</span> Team Member Onboarding (Sam)</a></li>
  </ul></li>
  <li><a href="#complete-handoff-workflow-summary" id="toc-complete-handoff-workflow-summary" class="nav-link" data-scroll-target="#complete-handoff-workflow-summary"><span class="header-section-number">6.3</span> Complete Handoff Workflow Summary</a></li>
  <li><a href="#collaboration-results" id="toc-collaboration-results" class="nav-link" data-scroll-target="#collaboration-results"><span class="header-section-number">6.4</span> Collaboration Results</a></li>
  </ul></li>
  <li><a href="#best-practices-and-considerations" id="toc-best-practices-and-considerations" class="nav-link" data-scroll-target="#best-practices-and-considerations"><span class="header-section-number">7</span> Best Practices and Considerations</a>
  <ul class="collapse">
  <li><a href="#when-to-use-this-approach" id="toc-when-to-use-this-approach" class="nav-link" data-scroll-target="#when-to-use-this-approach"><span class="header-section-number">7.1</span> When to Use This Approach</a></li>
  <li><a href="#tips-for-efficient-implementation" id="toc-tips-for-efficient-implementation" class="nav-link" data-scroll-target="#tips-for-efficient-implementation"><span class="header-section-number">7.2</span> Tips for Efficient Implementation</a></li>
  <li><a href="#testing-strategies-for-r-analyses" id="toc-testing-strategies-for-r-analyses" class="nav-link" data-scroll-target="#testing-strategies-for-r-analyses"><span class="header-section-number">7.3</span> Testing Strategies for R Analyses</a></li>
  <li><a href="#potential-challenges" id="toc-potential-challenges" class="nav-link" data-scroll-target="#potential-challenges"><span class="header-section-number">7.4</span> Potential Challenges</a></li>
  <li><a href="#troubleshooting-common-issues" id="toc-troubleshooting-common-issues" class="nav-link" data-scroll-target="#troubleshooting-common-issues"><span class="header-section-number">7.5</span> Troubleshooting Common Issues</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">8</span> Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">9</span> References</a></li>
  <li><a href="#appendix-a-github-personal-access-token-setup" id="toc-appendix-a-github-personal-access-token-setup" class="nav-link" data-scroll-target="#appendix-a-github-personal-access-token-setup">Appendix A: GitHub Personal Access Token Setup</a>
  <ul class="collapse">
  <li><a href="#step-by-step-token-creation" id="toc-step-by-step-token-creation" class="nav-link" data-scroll-target="#step-by-step-token-creation"><span class="header-section-number">9.1</span> Step-by-Step Token Creation</a></li>
  <li><a href="#token-security-best-practices" id="toc-token-security-best-practices" class="nav-link" data-scroll-target="#token-security-best-practices"><span class="header-section-number">9.2</span> Token Security Best Practices</a></li>
  <li><a href="#alternative-using-github-cli" id="toc-alternative-using-github-cli" class="nav-link" data-scroll-target="#alternative-using-github-cli"><span class="header-section-number">9.3</span> Alternative: Using GitHub CLI</a></li>
  <li><a href="#troubleshooting-common-issues-1" id="toc-troubleshooting-common-issues-1" class="nav-link" data-scroll-target="#troubleshooting-common-issues-1"><span class="header-section-number">9.4</span> Troubleshooting Common Issues</a></li>
  </ul></li>
  <li><a href="#appendix-b-comprehensive-test-suite" id="toc-appendix-b-comprehensive-test-suite" class="nav-link" data-scroll-target="#appendix-b-comprehensive-test-suite">Appendix B: Comprehensive Test Suite</a>
  <ul class="collapse">
  <li><a href="#test-file-teststestthattest-comprehensive-analysis.r" id="toc-test-file-teststestthattest-comprehensive-analysis.r" class="nav-link" data-scroll-target="#test-file-teststestthattest-comprehensive-analysis.r"><span class="header-section-number">9.5</span> Test File: <code>tests/testthat/test-comprehensive-analysis.R</code></a></li>
  <li><a href="#running-the-tests" id="toc-running-the-tests" class="nav-link" data-scroll-target="#running-the-tests"><span class="header-section-number">9.6</span> Running the Tests</a></li>
  <li><a href="#test-categories-explained" id="toc-test-categories-explained" class="nav-link" data-scroll-target="#test-categories-explained"><span class="header-section-number">9.7</span> Test Categories Explained</a></li>
  </ul></li>
  <li><a href="#appendix-c-directory-structure" id="toc-appendix-c-directory-structure" class="nav-link" data-scroll-target="#appendix-c-directory-structure">Appendix C: Directory Structure</a>
  <ul class="collapse">
  <li><a href="#key-features-explained" id="toc-key-features-explained" class="nav-link" data-scroll-target="#key-features-explained"><span class="header-section-number">9.8</span> Key Features Explained:</a></li>
  </ul></li>
  <li><a href="#appendix-d-docker-workflow-options" id="toc-appendix-d-docker-workflow-options" class="nav-link" data-scroll-target="#appendix-d-docker-workflow-options">Appendix D: Docker Workflow Options</a>
  <ul class="collapse">
  <li><a href="#multi-service-docker-architecture" id="toc-multi-service-docker-architecture" class="nav-link" data-scroll-target="#multi-service-docker-architecture"><span class="header-section-number">9.9</span> Multi-Service Docker Architecture</a></li>
  <li><a href="#option-2-docker-compose-services" id="toc-option-2-docker-compose-services" class="nav-link" data-scroll-target="#option-2-docker-compose-services"><span class="header-section-number">9.10</span> Option 2: Docker Compose Services</a></li>
  <li><a href="#option-3-direct-docker-commands" id="toc-option-3-direct-docker-commands" class="nav-link" data-scroll-target="#option-3-direct-docker-commands"><span class="header-section-number">9.11</span> Option 3: Direct Docker Commands</a></li>
  <li><a href="#volume-mounting-strategies" id="toc-volume-mounting-strategies" class="nav-link" data-scroll-target="#volume-mounting-strategies"><span class="header-section-number">9.12</span> Volume Mounting Strategies</a></li>
  <li><a href="#choosing-the-right-approach" id="toc-choosing-the-right-approach" class="nav-link" data-scroll-target="#choosing-the-right-approach"><span class="header-section-number">9.13</span> Choosing the Right Approach</a></li>
  </ul></li>
  <li><a href="#appendix-e-github-actions-cicd-setup" id="toc-appendix-e-github-actions-cicd-setup" class="nav-link" data-scroll-target="#appendix-e-github-actions-cicd-setup">Appendix E: GitHub Actions CI/CD Setup</a>
  <ul class="collapse">
  <li><a href="#understanding-github-actions-for-research" id="toc-understanding-github-actions-for-research" class="nav-link" data-scroll-target="#understanding-github-actions-for-research"><span class="header-section-number">9.14</span> Understanding GitHub Actions for Research</a></li>
  <li><a href="#step-by-step-setup" id="toc-step-by-step-setup" class="nav-link" data-scroll-target="#step-by-step-setup"><span class="header-section-number">9.15</span> Step-by-Step Setup</a>
  <ul class="collapse">
  <li><a href="#step-1-create-workflow-directory" id="toc-step-1-create-workflow-directory" class="nav-link" data-scroll-target="#step-1-create-workflow-directory"><span class="header-section-number">9.15.1</span> Step 1: Create Workflow Directory</a></li>
  <li><a href="#step-2-docker-based-ci-workflow-with-renv-validation" id="toc-step-2-docker-based-ci-workflow-with-renv-validation" class="nav-link" data-scroll-target="#step-2-docker-based-ci-workflow-with-renv-validation"><span class="header-section-number">9.15.2</span> Step 2: Docker-based CI Workflow with renv Validation</a></li>
  <li><a href="#step-3-r-package-check-workflow" id="toc-step-3-r-package-check-workflow" class="nav-link" data-scroll-target="#step-3-r-package-check-workflow"><span class="header-section-number">9.15.3</span> Step 3: R Package Check Workflow</a></li>
  <li><a href="#step-4-automated-paper-rendering" id="toc-step-4-automated-paper-rendering" class="nav-link" data-scroll-target="#step-4-automated-paper-rendering"><span class="header-section-number">9.15.4</span> Step 4: Automated Paper Rendering</a></li>
  <li><a href="#step-5-container-registry-integration" id="toc-step-5-container-registry-integration" class="nav-link" data-scroll-target="#step-5-container-registry-integration"><span class="header-section-number">9.15.5</span> Step 5: Container Registry Integration</a></li>
  </ul></li>
  <li><a href="#workflow-explanations" id="toc-workflow-explanations" class="nav-link" data-scroll-target="#workflow-explanations"><span class="header-section-number">9.16</span> Workflow Explanations</a>
  <ul class="collapse">
  <li><a href="#docker-ci-workflow-features" id="toc-docker-ci-workflow-features" class="nav-link" data-scroll-target="#docker-ci-workflow-features"><span class="header-section-number">9.16.1</span> Docker CI Workflow Features:</a></li>
  <li><a href="#r-package-check-features" id="toc-r-package-check-features" class="nav-link" data-scroll-target="#r-package-check-features"><span class="header-section-number">9.16.2</span> R Package Check Features:</a></li>
  <li><a href="#paper-rendering-features" id="toc-paper-rendering-features" class="nav-link" data-scroll-target="#paper-rendering-features"><span class="header-section-number">9.16.3</span> Paper Rendering Features:</a></li>
  <li><a href="#container-publishing-features" id="toc-container-publishing-features" class="nav-link" data-scroll-target="#container-publishing-features"><span class="header-section-number">9.16.4</span> Container Publishing Features:</a></li>
  </ul></li>
  <li><a href="#authentication-and-permissions" id="toc-authentication-and-permissions" class="nav-link" data-scroll-target="#authentication-and-permissions"><span class="header-section-number">9.17</span> Authentication and Permissions</a>
  <ul class="collapse">
  <li><a href="#built-in-github_token" id="toc-built-in-github_token" class="nav-link" data-scroll-target="#built-in-github_token"><span class="header-section-number">9.17.1</span> Built-in GITHUB_TOKEN:</a></li>
  <li><a href="#setting-repository-permissions" id="toc-setting-repository-permissions" class="nav-link" data-scroll-target="#setting-repository-permissions"><span class="header-section-number">9.17.2</span> Setting Repository Permissions:</a></li>
  <li><a href="#using-personal-access-tokens-advanced" id="toc-using-personal-access-tokens-advanced" class="nav-link" data-scroll-target="#using-personal-access-tokens-advanced"><span class="header-section-number">9.17.3</span> Using Personal Access Tokens (Advanced):</a></li>
  </ul></li>
  <li><a href="#integration-with-collaborative-workflow" id="toc-integration-with-collaborative-workflow" class="nav-link" data-scroll-target="#integration-with-collaborative-workflow"><span class="header-section-number">9.18</span> Integration with Collaborative Workflow</a>
  <ul class="collapse">
  <li><a href="#pull-request-integration" id="toc-pull-request-integration" class="nav-link" data-scroll-target="#pull-request-integration"><span class="header-section-number">9.18.1</span> Pull Request Integration:</a></li>
  <li><a href="#branch-protection-rules" id="toc-branch-protection-rules" class="nav-link" data-scroll-target="#branch-protection-rules"><span class="header-section-number">9.18.2</span> Branch Protection Rules:</a></li>
  </ul></li>
  <li><a href="#monitoring-and-troubleshooting" id="toc-monitoring-and-troubleshooting" class="nav-link" data-scroll-target="#monitoring-and-troubleshooting"><span class="header-section-number">9.19</span> Monitoring and Troubleshooting</a>
  <ul class="collapse">
  <li><a href="#viewing-workflow-results" id="toc-viewing-workflow-results" class="nav-link" data-scroll-target="#viewing-workflow-results"><span class="header-section-number">9.19.1</span> Viewing Workflow Results:</a></li>
  <li><a href="#common-issues-and-solutions" id="toc-common-issues-and-solutions" class="nav-link" data-scroll-target="#common-issues-and-solutions"><span class="header-section-number">9.19.2</span> Common Issues and Solutions:</a></li>
  <li><a href="#performance-optimization" id="toc-performance-optimization" class="nav-link" data-scroll-target="#performance-optimization"><span class="header-section-number">9.19.3</span> Performance Optimization:</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#appendix-f-docker-configuration-examples" id="toc-appendix-f-docker-configuration-examples" class="nav-link" data-scroll-target="#appendix-f-docker-configuration-examples">Appendix F: Docker Configuration Examples</a>
  <ul class="collapse">
  <li><a href="#production-dockerfile" id="toc-production-dockerfile" class="nav-link" data-scroll-target="#production-dockerfile"><span class="header-section-number">9.20</span> Production Dockerfile</a></li>
  <li><a href="#features-of-the-production-dockerfile" id="toc-features-of-the-production-dockerfile" class="nav-link" data-scroll-target="#features-of-the-production-dockerfile"><span class="header-section-number">9.21</span> Features of the Production Dockerfile</a></li>
  <li><a href="#r-version-extraction" id="toc-r-version-extraction" class="nav-link" data-scroll-target="#r-version-extraction"><span class="header-section-number">9.22</span> R Version Extraction</a></li>
  </ul></li>
  <li><a href="#appendix-g-renv-management-and-validation" id="toc-appendix-g-renv-management-and-validation" class="nav-link" data-scroll-target="#appendix-g-renv-management-and-validation">Appendix G: renv Management and Validation</a>
  <ul class="collapse">
  <li><a href="#renv-consistency-checker-features" id="toc-renv-consistency-checker-features" class="nav-link" data-scroll-target="#renv-consistency-checker-features"><span class="header-section-number">9.23</span> renv Consistency Checker Features</a></li>
  <li><a href="#team-collaboration-commands" id="toc-team-collaboration-commands" class="nav-link" data-scroll-target="#team-collaboration-commands"><span class="header-section-number">9.24</span> Team Collaboration Commands</a></li>
  <li><a href="#multi-developer-workflow" id="toc-multi-developer-workflow" class="nav-link" data-scroll-target="#multi-developer-workflow"><span class="header-section-number">9.25</span> Multi-Developer Workflow</a></li>
  <li><a href="#integration-with-development-workflows" id="toc-integration-with-development-workflows" class="nav-link" data-scroll-target="#integration-with-development-workflows"><span class="header-section-number">9.26</span> Integration with Development Workflows</a>
  <ul class="collapse">
  <li><a href="#pre-commit-hooks" id="toc-pre-commit-hooks" class="nav-link" data-scroll-target="#pre-commit-hooks"><span class="header-section-number">9.26.1</span> Pre-commit Hooks</a></li>
  <li><a href="#makefile-integration" id="toc-makefile-integration" class="nav-link" data-scroll-target="#makefile-integration"><span class="header-section-number">9.26.2</span> Makefile Integration</a></li>
  <li><a href="#cicd-integration" id="toc-cicd-integration" class="nav-link" data-scroll-target="#cicd-integration"><span class="header-section-number">9.26.3</span> CI/CD Integration</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Research Compendia for Full Reproducibility in R: A zzrrtools, renv, and Docker Strategy</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>R.G. Thomas </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 30, 2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    <p>This white paper presents an approach to achieving reproducibility in R workflows by combining three tools: zzrrtools for creating structured research compendia, renv for R package management, and Docker for containerizing the computing environment. The zzrrtools framework provides a standardized research compendium structure, renv manages package dependencies, and Docker ensures consistent execution environments. Together, these tools create self-contained research compendia that run identically across different systems. The paper includes a practical case study demonstrating multi-developer collaborative workflows with clear governance roles, where a project maintainer manages the technical infrastructure while multiple contributors extend the research analysis.</p>
  </div>
</div>


</header>


<section id="executive-summary" class="level1 unnumbered">
<h1 class="unnumbered">Executive Summary</h1>
<p>Reproducibility is key to conducting data analysis, yet in practice, achieving it consistently with R workflows can be quite challenging. R projects frequently break when transferred between computers due to mismatched R versions, package dependencies, or inconsistent project organization. This white paper describes an approach to solving this problem by combining three tools: <strong>zzrrtools</strong> for creating structured research compendia, <strong>renv</strong> for R package management, and <strong>Docker</strong> for containerizing the computing environment. Together, these tools ensure that an R workflow runs identically across different computers by providing standardized project structure, identical R packages and versions, consistent R versions, and the same operating system libraries as the original setup.</p>
</section>
<section id="motivation" class="level1 unnumbered">
<h1 class="unnumbered">Motivation</h1>
<p>Imagine you’ve written code that you want to share with a colleague. At first glance, this may seem like a straightforward task—simply share the files electronically. However, ensuring that your colleague can run the code without errors, and obtain the same results is often much more challenging than anticipated.</p>
<p>When sharing R code, several potential problems can arise that can lead to code that won’t run or won’t match your results:</p>
<ul>
<li>Different versions of R installed on each machine</li>
<li>Mismatched R package versions</li>
<li>Missing or mismatched system dependencies (like pandoc or LaTeX)</li>
<li>Missing supplemental files referenced by the program (bibliography files, LaTeX preambles, datasets, images)</li>
<li>Different R startup configurations (.Rprofile or .Renviron)</li>
<li>Different Operating Systems (macOS, Windows, Linux, etc.)</li>
</ul>
<p>A real-world scenario often unfolds like this:</p>
<ol type="1">
<li>You email your analysis files to a colleague</li>
<li>They attempt to run your analysis with the commands you provided</li>
<li>But R isn’t installed on their system</li>
<li>After installing R, they get an error: “could not find function ‘render’” since they don’t have the <code>rmarkdown</code> package installed</li>
<li>They install the rmarkdown package and run the R command again</li>
<li>Now pandoc is missing</li>
<li>After installing pandoc, a required package, say <code>ggplot</code>, is missing</li>
<li>After installing <code>ggplot</code>, several external files are missing (e.g.&nbsp; bibliography, images)</li>
<li>And so on…</li>
</ol>
<p>This cycle of troubleshooting can be time-consuming and frustrating. Even when the code eventually runs, there’s no guarantee that they will get the same results that you did.</p>
<p>To ensure true reproducibility, your colleague should have a computing environment as similar to yours as possible. Given the dynamic nature of open source software, not to mention hardware and operating system differences, this can be difficult to achieve through manual installation and configuration.</p>
<p>The approach outlined in this white paper offers a systematic solution. Rather than sending standalone text files, with modest additional effort, you can provide a complete, containerized, hardware and OS independent environment that includes everything needed to run your analysis. With this approach, your colleague can run a simple command like:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="dt">\</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/analysis/figures:/home/analyst/output"</span> <span class="dt">\</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(The details of this docker command are explained below.)</p>
<p>This creates an identical R environment on their desktop, ready for them to run or modify your code with confidence that it will work as intended.</p>
<p>The Docker command shown above represents the end goal of this white paper’s approach, but achieving this level of reproducibility requires understanding and implementing three complementary technologies. The following sections provide a framework for building such reproducible environments from the ground up.</p>
</section>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<section id="the-challenge-of-reproducibility-in-r" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="the-challenge-of-reproducibility-in-r"><span class="header-section-number">1.1</span> The Challenge of Reproducibility in R</h2>
<p>R has become a standard tool for data science and statistical analysis across numerous scientific disciplines. However, as R projects grow in complexity, they often develop complex webs of dependencies that can make sharing and reproducing analyses difficult. Some common challenges include:</p>
<ul>
<li>Different R versions across machines</li>
<li>Incompatible package versions</li>
<li>Missing system-level dependencies</li>
<li>Operating system differences (macOS vs.&nbsp;Windows vs.&nbsp;Linux)</li>
<li>Conflicts with other installed packages</li>
<li>R startup files (.Rprofile, .Renviron, .RData) that can affect code behavior</li>
</ul>
<p>These challenges often manifest as the frustrating “it works on my machine” problem, where analysis code runs perfectly for the original author but fails when others attempt to use it. This undermines the scientific and collaborative potential of R-based analyses.</p>
</section>
<section id="a-three-level-solution" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="a-three-level-solution"><span class="header-section-number">1.2</span> A Three-Level Solution</h2>
<p>To address these challenges, we need to tackle reproducibility at three distinct levels:</p>
<ol type="1">
<li><p><strong>Project-level reproducibility</strong>: Ensuring consistent project structure and organization using research compendium standards</p></li>
<li><p><strong>Package-level reproducibility</strong>: Ensuring exact package versions and dependencies are maintained</p></li>
<li><p><strong>System-level reproducibility</strong>: Guaranteeing consistent R versions, operating system, and system libraries</p></li>
</ol>
<p>The strategy presented in this white paper leverages <strong>zzrrtools</strong> for project-level structure, <strong>renv</strong> for package-level consistency, and <strong>Docker</strong> for system-level consistency. When combined, they provide a framework for end-to-end reproducible R workflows with proper research compendium organization.</p>
<p>With this three-level framework established, we can now examine how each tool addresses its specific layer of reproducibility. We begin with zzrrtools, which tackles the foundational challenge of project-level organization and provides the structural framework upon which package and system-level reproducibility can be built.</p>
</section>
</section>
<section id="zzrrtools-project-level-reproducibility" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> zzrrtools: Project-Level Reproducibility</h1>
<section id="what-is-zzrrtools" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="what-is-zzrrtools"><span class="header-section-number">2.1</span> What is zzrrtools?</h2>
<p><strong>zzrrtools</strong> is a Docker-first framework that creates reproducible research compendia with containerized development workflows. The framework extends the research compendium concept introduced by Ben Marwick’s rrtools, adding container-based development and automated dependency validation. Team members install zzrrtools once on their system, then can create or join any zzrrtools-based project using the same framework. A research compendium organizes digital research materials to enable others to inspect, reproduce, and extend the research.</p>
</section>
<section id="key-features-of-zzrrtools" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="key-features-of-zzrrtools"><span class="header-section-number">2.2</span> Key Features of zzrrtools</h2>
<p><strong>zzrrtools</strong> creates containerized research compendia with these key features:</p>
<ul>
<li><p><strong>Docker-first development</strong>: All workflows operate within containers, eliminating “works on my machine” issues</p></li>
<li><p><strong>Centralized framework</strong>: One-time zzrrtools installation enables consistent project creation and team collaboration</p></li>
<li><p><strong>Multi-service architecture</strong>: Provides specialized Docker environments for interactive R sessions, shell development, and paper rendering</p></li>
<li><p><strong>Flexible base images</strong>: Choice of minimal (rocker/r-ver) or pre-packaged (rgt47/r-pluspackages) Docker templates with common R packages</p></li>
<li><p><strong>Advanced dependency validation</strong>: Automated renv consistency checking with CRAN verification and pre-commit validation</p></li>
<li><p><strong>Shell-based workflows</strong>: Optimized for command-line development with rich automation via Make targets</p></li>
<li><p><strong>Team collaboration focus</strong>: Designed for multi-developer teams working on shared research projects</p></li>
</ul>
</section>
<section id="zzrrtools-workflow-self-replicating-collaboration" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="zzrrtools-workflow-self-replicating-collaboration"><span class="header-section-number">2.3</span> zzrrtools Workflow: Self-Replicating Collaboration</h2>
<p>The zzrrtools workflow is designed for team collaboration:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Project creator initializes the research compendium</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/prj/zzrrtools/zzrrtools.sh</span> <span class="pp">[</span><span class="ss">OPTIONS</span><span class="pp">]</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Available options:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   --dotfiles DIR       Copy personal dotfiles (with leading dots)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   --dotfiles-nodot DIR Copy dotfiles (without leading dots) </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   --base-image NAME    Use custom Docker base image (default: rocker/r-ver)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                        Popular options: rgt47/r-pluspackages (includes tidyverse)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   --no-docker          Skip Docker image build</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   --next-steps         Show workflow guidance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This creates a Docker-first research compendium with:</p>
<ul>
<li><strong>Framework-based setup</strong> using centrally installed zzrrtools for consistent project creation</li>
<li><strong>Multi-service Docker architecture</strong> for interactive R, shell, and rendering</li>
<li><strong>Advanced renv validation</strong> with CRAN verification and pre-commit checking</li>
<li><strong>Dual-track automation</strong> supporting both native R and Docker workflows</li>
<li><strong>Navigation shortcuts</strong> via symbolic links (a→data, p→paper, s→scripts)</li>
<li><strong>Developer environment integration</strong> with personal dotfiles support</li>
<li><strong>Team synchronization</strong> via automated dependency validation</li>
</ul>
<p>Team members can collaborate after one-time zzrrtools installation:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One-time zzrrtools installation</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone zzrrtools-repo ~/prj/zzrrtools</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/prj/zzrrtools <span class="kw">&amp;&amp;</span> <span class="ex">./install.sh</span>  <span class="co"># Creates zzrrtools command in PATH</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Per-project workflow</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone project-repo <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> project-repo</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">zzrrtools</span>  <span class="co"># Set up project environment (command available anywhere)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r   <span class="co"># Start interactive R session</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="integrated-renv-consistency-checking" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="integrated-renv-consistency-checking"><span class="header-section-number">2.3.1</span> Integrated renv Consistency Checking</h3>
<p>The workflow includes advanced renv management through the <code>check_renv_for_commit.R</code> script, which provides automated dependency validation and team conflict prevention. This script:</p>
<ul>
<li><strong>Scans multiple directories</strong> (R/, scripts/, analysis/) for package dependencies</li>
<li><strong>Validates against CRAN</strong> to ensure packages exist and are properly named<br>
</li>
<li><strong>Synchronizes dependencies</strong> across code files, DESCRIPTION, and renv.lock</li>
<li><strong>Provides automated fixes</strong> to maintain team environment consistency</li>
<li><strong>Integrates with CI/CD</strong> for fail-fast validation workflows</li>
</ul>
<p>Usage examples:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive dependency checking (development)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto-fix dependency issues</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># CI/CD validation with fail-fast</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span> <span class="at">--fail-on-issues</span> <span class="at">--quiet</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Via Make targets (recommended)</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv          <span class="co"># Check dependencies</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-fix      <span class="co"># Fix dependency issues</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check-renv-fix  <span class="co"># Fix in container</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This approach ensures collaborators can reliably reproduce package environments and CI/CD pipelines have all necessary dependency information.</p>
</section>
</section>
<section id="research-compendium-structure" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="research-compendium-structure"><span class="header-section-number">2.4</span> Research Compendium Structure</h2>
<p>The zzrrtools setup creates a directory structure that follows research compendium best practices. The structure includes organized data folders, analysis directories, testing frameworks, and workflows.</p>
<p><strong>Key organizational principles:</strong></p>
<ul>
<li><strong>Data management</strong>: Separate folders for raw, derived, and external data with proper documentation</li>
<li><strong>Analysis workflow</strong>: Dedicated spaces for papers, figures, tables, and working scripts<br>
</li>
<li><strong>Package structure</strong>: R package organization with documentation and testing</li>
<li><strong>Integration support</strong>: Works with Docker, GitHub Actions, and build systems</li>
</ul>
<p>This organizational framework provides the foundation for reproducible research while supporting team collaboration and automated workflows.</p>
</section>
<section id="iterative-development-workflow" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="iterative-development-workflow"><span class="header-section-number">2.5</span> Iterative Development Workflow</h2>
<p>For collaborative analysis development, the research compendium structure supports a phased approach that balances rapid iteration with publication-quality outputs:</p>
<section id="phase-1-exploration-development-scripts" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="phase-1-exploration-development-scripts"><span class="header-section-number">2.5.1</span> Phase 1: Exploration &amp; Development (<code>scripts/</code>)</h3>
<p>During active analysis development, team members should work primarily in the <code>scripts/</code> directory:</p>
<pre><code>scripts/
├── 01_data_exploration.R
├── 02_penguin_correlations.R  
├── 03_species_analysis.R
├── 04_body_mass_analysis.R    # Additional analysis
└── 05_visualization_experiments.R</code></pre>
<p><strong>Benefits of script-based development:</strong> - <strong>Fast iteration</strong>: No need to knit/render documents during development - <strong>Interactive debugging</strong>: Can run code line-by-line in R console - <strong>Version control friendly</strong>: Pure R files produce clean diffs in Git - <strong>Easy collaboration</strong>: Contributors can add numbered script files - <strong>Flexible experimentation</strong>: Quick to test ideas and approaches</p>
</section>
<section id="phase-2-function-extraction-r" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="phase-2-function-extraction-r"><span class="header-section-number">2.5.2</span> Phase 2: Function Extraction (<code>R/</code>)</h3>
<p>As analysis patterns emerge, extract reusable functions to the <code>R/</code> directory:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R/penguin_utils.R</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>calculate_species_correlation <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_var, y_var, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">species_filter =</span> <span class="cn">NULL</span>) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reusable function extracted from scripts</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(species_filter)) {</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data[data<span class="sc">$</span>species <span class="sc">==</span> species_filter, ]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(data[[x_var]], data[[y_var]], <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>create_species_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_var, y_var) {</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standardized plotting function</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes_string</span>(<span class="at">x =</span> x_var, <span class="at">y =</span> y_var, </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> <span class="st">"species"</span>)) <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="phase-3-publication-integration-analysispaper" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="phase-3-publication-integration-analysispaper"><span class="header-section-number">2.5.3</span> Phase 3: Publication Integration (<code>analysis/paper/</code>)</h3>
<p>Once analysis approaches stabilize, integrate polished results into the manuscript:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In analysis/paper/paper.Rmd</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: Source complete scripts</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../scripts/02_penguin_correlations.R"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../scripts/04_body_mass_analysis.R"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: Use extracted functions</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"penguin_utils.R"</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>correlation_result <span class="ot">&lt;-</span> <span class="fu">calculate_species_correlation</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  penguins, <span class="st">"flipper_length_mm"</span>, <span class="st">"bill_length_mm"</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="recommended-collaborative-workflow" class="level3" data-number="2.5.4">
<h3 data-number="2.5.4" class="anchored" data-anchor-id="recommended-collaborative-workflow"><span class="header-section-number">2.5.4</span> Recommended Collaborative Workflow:</h3>
<ol type="1">
<li><strong>Project initialization</strong>: Project maintainer runs <code>zzrrtools.sh</code> to create project structure</li>
<li><strong>Immediate containerization</strong>: Build Docker container and switch to container-based development from day one</li>
<li><strong>Initial development</strong>: Create exploratory scripts in <code>scripts/</code> directory <strong>inside the container</strong></li>
<li><strong>Collaborative iteration</strong>: Team members clone repo, build identical container, add additional script files through pull requests <strong>from within the container</strong></li>
<li><strong>Code review in scripts</strong>: Both developers refine analysis logic in script files while working in identical Docker environments</li>
<li><strong>Function extraction</strong>: Move stable, reusable code to <code>R/</code> directory</li>
<li><strong>Paper integration</strong>: Source scripts or use functions in <code>analysis/paper/paper.Rmd</code></li>
<li><strong>Continuous validation</strong>: All development and testing occurs within the containerized environment</li>
</ol>
<p><strong>Why this container-first approach works:</strong></p>
<ul>
<li><strong>Reproducibility</strong>: Eliminates “works on my machine” problems from day one</li>
<li><strong>Identical environments</strong>: All collaborators work in exactly the same computational environment</li>
<li><strong>No environment drift</strong>: Cannot occur when everyone develops within containers</li>
<li><strong>Speed</strong>: Script development is faster than R Markdown knitting</li>
<li><strong>Modularity</strong>: Each script can focus on a specific analysis aspect</li>
<li><strong>Testability</strong>: Functions in <code>R/</code> can be easily unit tested in the same environment they’ll run in production</li>
<li><strong>Simple collaboration</strong>: Environment setup becomes a one-time <code>docker build</code> command for all contributors</li>
<li><strong>Development-production parity</strong>: The development environment IS the production environment</li>
</ul>
<p>This container-first, phased approach gives collaborators the speed of script-based development during exploration while maintaining the reproducibility and narrative flow of literate programming for final outputs. Most importantly, it ensures that all development occurs within the exact computational environment that will be used for final analysis and publication.</p>
<p>While zzrrtools establishes the organizational foundation for reproducible research, it relies on consistent R package environments to function effectively across different systems. The directory structure and R package framework created by zzrrtools becomes most useful when combined with precise dependency management. This is where renv becomes essential, providing the package-level consistency that complements zzrrtools’ structural approach.</p>
</section>
</section>
</section>
<section id="renv-package-level-reproducibility" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> renv: Package-Level Reproducibility</h1>
<section id="what-is-renv" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="what-is-renv"><span class="header-section-number">3.1</span> What is renv?</h2>
<p><strong>renv</strong> (Reproducible Environment) is an R package designed to create isolated, project-specific library environments. Instead of relying on a shared system-wide R library that might change over time, renv gives each project its own separate collection of packages with specific versions.</p>
</section>
<section id="key-features-of-renv" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="key-features-of-renv"><span class="header-section-number">3.2</span> Key Features of renv</h2>
<ul>
<li><p><strong>Isolated project library</strong>: renv creates a project-specific library (typically in <code>renv/library</code>) containing only the packages used by that project. This isolation ensures that updates or changes to packages in one project won’t affect others.</p></li>
<li><p><strong>Lockfile for dependencies</strong>: When you finish installing or updating packages, <code>renv::snapshot()</code> produces a <code>renv.lock</code> file - a JSON document listing each package and its exact version and source. This lockfile is designed to be committed to version control and shared.</p></li>
<li><p><strong>Environment restoration</strong>: On a new machine (or when reproducing past results), <code>renv::restore()</code> installs the exact versions of packages specified in the lockfile. This creates an R package environment identical to the one that created the lockfile, provided the same R version is available. The R version is important since critical components of the R system, such as random number generation, and default factor handling policy vary between versions.</p></li>
</ul>
</section>
<section id="basic-renv-workflow" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="basic-renv-workflow"><span class="header-section-number">3.3</span> Basic renv Workflow</h2>
<p>The typical workflow with renv involves:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One-time installation of renv</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"renv"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize renv for the project</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">init</span>()  <span class="co"># Creates renv infrastructure</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Install project-specific packages</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the package state to renv.lock</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">snapshot</span>()</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Later or on another system...</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">restore</span>()  <span class="co"># Restore packages from renv.lock</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>While renv successfully addresses package-level reproducibility by ensuring identical R package versions across environments, even perfect package consistency cannot prevent analyses from failing or producing different results due to variations in R versions, operating systems, or system-level dependencies. A complete reproducibility solution requires addressing these system-level differences, which is where Docker containerization becomes essential.</p>
</section>
</section>
<section id="docker-system-level-reproducibility" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Docker: System-Level Reproducibility</h1>
<section id="what-is-docker" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="what-is-docker"><span class="header-section-number">4.1</span> What is Docker?</h2>
<p>Docker is a platform that allows you to package software into standardized units called containers. A Docker container is like a lightweight virtual machine that includes everything needed to run an application: the code, runtime, system tools, libraries, and settings.</p>
</section>
<section id="dockers-role-in-reproducibility" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="dockers-role-in-reproducibility"><span class="header-section-number">4.2</span> Docker’s Role in Reproducibility</h2>
<p>While renv handles R packages, Docker ensures consistency for:</p>
<ul>
<li><strong>Operating system</strong>: The specific Linux distribution or OS version</li>
<li><strong>R interpreter</strong>: The exact R version</li>
<li><strong>System libraries</strong>: Required C/C++ libraries and other dependencies</li>
<li><strong>Computational environment</strong>: Memory limits, CPU configuration, etc.</li>
<li><strong>External tools</strong>: pandoc, LaTeX, and other utilities needed for R Markdown</li>
</ul>
<p>By running an R Markdown project in Docker, you eliminate differences in OS or R installation as potential sources of irreproducibility. Any machine running Docker will execute the container in an identical environment.</p>
</section>
<section id="docker-components-for-r-workflows" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="docker-components-for-r-workflows"><span class="header-section-number">4.3</span> Docker Components for R Workflows</h2>
<p>For R-based projects, a typical Docker approach involves:</p>
<ol type="1">
<li><strong>Base image</strong>: Starting from a pre-configured R image (e.g., from the Rocker project)</li>
<li><strong>Dependencies</strong>: Adding system and R package dependencies</li>
<li><strong>Configuration</strong>: Setting working directories and environment variables</li>
<li><strong>Content</strong>: Adding project files</li>
<li><strong>Execution</strong>: Defining how the project should run</li>
</ol>
<p>The zzrrtools setup uses a streamlined Dockerfile based on rocker/r-ver with TinyTeX for LaTeX support. The R version is matched to the renv.lock file:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use R version from renv.lock for perfect consistency</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> R_VERSION=4.3.0</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> rocker/r-ver:${R_VERSION}</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Prevent interactive prompts</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> DEBIAN_FRONTEND=noninteractive</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Install minimal system dependencies</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="at">--no-install-recommends</span> <span class="dt">\</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    pandoc <span class="dt">\</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    vim <span class="dt">\</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    git <span class="dt">\</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    curl <span class="dt">\</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    fonts-dejavu <span class="dt">\</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> clean <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> <span class="at">-rf</span> /var/lib/apt/lists/<span class="pp">*</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create non-root user</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> USERNAME=analyst</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">useradd</span> <span class="at">--create-home</span> <span class="at">--shell</span> /bin/bash <span class="va">${USERNAME}</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Set user R library path</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> R_LIBS_USER=/home/${USERNAME}/R/library</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create user R library directory and assign permissions</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> /home/<span class="va">${USERNAME}</span>/R/library <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">chown</span> <span class="at">-R</span> <span class="va">${USERNAME}</span>:<span class="va">${USERNAME}</span> /home/<span class="va">${USERNAME}</span>/R</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /home/${USERNAME}</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy renv files with correct ownership</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> renv.lock ./</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> renv/activate.R ./renv/</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Switch to non-root user</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="kw">USER</span> ${USERNAME}</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Install base R packages to user library</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">'.libPaths(Sys.getenv("R_LIBS_USER")); \</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="st">    install.packages(c("tinytex", "rmarkdown", "renv"), \</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="st">    repos = "https://cloud.r-project.org")'</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Install TinyTeX in user directory</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">'tinytex::install_tinytex()'</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Add TinyTeX binaries to PATH</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> PATH=/home/${USERNAME}/.TinyTeX/bin/x86_64-linux:$PATH</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Restore R packages via renv</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">'.libPaths(Sys.getenv("R_LIBS_USER")); \</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="st">    renv::restore()'</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Default to interactive shell</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"/bin/bash"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This configuration provides a minimal R installation with LaTeX support for PDF rendering and secure non-root user execution.</p>
<p><strong>Docker Compose Integration:</strong></p>
<p>The setup also includes a docker-compose.yml that provides multiple development environments:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple services for different workflows</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">r-session</span><span class="kw">:</span><span class="co">   # Interactive R session  </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bash</span><span class="kw">:</span><span class="co">        # Bash shell access</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">research</span><span class="kw">:</span><span class="co">    # Automated paper rendering</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">test</span><span class="kw">:</span><span class="co">        # Package testing</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">check</span><span class="kw">:</span><span class="co">       # Package checking</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This allows developers to choose their preferred development environment while maintaining identical package dependencies and system configuration.</p>
</section>
</section>
<section id="combining-zzrrtools-renv-and-docker-a-comprehensive-approach" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Combining zzrrtools, renv, and Docker: A Comprehensive Approach</h1>
<section id="why-use-all-three" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="why-use-all-three"><span class="header-section-number">5.1</span> Why Use All Three?</h2>
<p>Using any single tool improves reproducibility, but combining all three provides the most complete solution:</p>
<ul>
<li><strong>zzrrtools</strong> provides standardized project structure and research compendium organization</li>
<li><strong>renv</strong> guarantees the R packages and their versions</li>
<li><strong>Docker</strong> guarantees the OS and R version</li>
<li><strong>Together</strong> they achieve end-to-end reproducibility from project organization through package dependencies to operating system consistency</li>
</ul>
<p>This approach creates a fully portable, well-organized research compendium that can be shared and will produce identical results across different computers while following established research best practices.</p>
</section>
<section id="integration-strategy-with-governance-model" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="integration-strategy-with-governance-model"><span class="header-section-number">5.2</span> Integration Strategy with Governance Model</h2>
<p>The workflow integrates zzrrtools, renv, and Docker with a clear governance structure suitable for multi-developer research teams:</p>
<p><strong>Project Maintainer Role:</strong> - Creates and maintains the research compendium structure - Manages renv environment and package dependencies using consistency checking - Updates and maintains Docker images - Reviews and approves contributor changes - Runs renv validation before accepting pull requests</p>
<p><strong>Contributor Role (Other Developers)</strong>: - Access the private research compendium as invited collaborators - Add analysis content, papers, and documentation using feature branches - Propose new package dependencies through contributions - Submit changes via pull requests from feature branches</p>
<p><strong>Workflow Steps</strong>:</p>
<ol type="1">
<li><p><strong>Initialize Research Compendium (Maintainer)</strong>:</p>
<ul>
<li>Create standardized project structure using zzrrtools framework</li>
<li>Set up analysis directories with data organization</li>
<li>Initialize renv environment with <code>renv::init()</code></li>
<li>Create Dockerfile with container configuration</li>
</ul></li>
<li><p><strong>Establish Development Environment (Maintainer)</strong>:</p>
<ul>
<li><p>Install required packages and develop initial analysis</p></li>
<li><p>Create tests for analytical functions</p></li>
<li><p>Use the renv consistency checker to validate and create initial lockfile:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate dependencies and create snapshot</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Build and test Docker image locally</p></li>
</ul></li>
<li><p><strong>Maintain Infrastructure (Maintainer)</strong>:</p>
<ul>
<li><p>Review contributor pull requests for package additions</p></li>
<li><p>Use renv consistency checker to validate and update dependencies:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate contributor's package requirements</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fail-on-issues</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># If validation passes, update environment</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Update <code>renv.lock</code> by selectively incorporating new dependencies</p></li>
<li><p>Rebuild Docker images when system dependencies change</p></li>
<li><p>Push updated images to container registry (Docker Hub, GitHub Container Registry)</p></li>
</ul></li>
<li><p><strong>Collaborative Development (All Developers)</strong>:</p>
<p><strong>Research Compendium Files in GitHub Repository:</strong></p>
<ul>
<li><strong>Project Structure</strong>: <code>DESCRIPTION</code>, <code>LICENSE</code>, <code>README.qmd</code> (zzrrtools-generated)</li>
<li><strong>Analysis Content</strong>: Files in <code>analysis/paper/</code> directory (R Markdown manuscripts)</li>
<li><strong>Dependencies</strong>: <code>renv.lock</code> (managed by maintainer), <code>renv/activate.R</code></li>
<li><strong>Infrastructure</strong>: <code>Dockerfile</code> (maintained by project maintainer)</li>
<li><strong>Code</strong>: <code>R/</code> directory (utility functions), <code>tests/</code> directory</li>
<li><strong>Documentation</strong>: Generated README files and project documentation</li>
<li><strong>Configuration</strong>: <code>.gitignore</code>, <code>.github/</code> (CI/CD workflows)</li>
</ul>
<p><strong>Sharing the Docker image using Docker Hub:</strong></p>
<p>Docker Hub provides public image hosting that enables reproducible research by sharing computational environments while protecting private research code in GitHub.</p>
<p><strong>Docker Hub (Recommended for Reproducible Research)</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the image with GitHub Container Registry URL</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> ghcr.io/username/penguins_analysis:v1.0 .</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Login to GitHub Container Registry (using GitHub Personal Access Token)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$GITHUB_TOKEN</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="at">-u</span> username <span class="dt">\</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">--password-stdin</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Push to GitHub Container Registry (automatically private)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push ghcr.io/username/penguins_analysis:v1.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Setting up GitHub Personal Access Token:</strong></p>
<p>Create a Personal Access Token with the required permissions for container registry operations. The token must include <code>write:packages</code> and <code>read:packages</code> scopes, plus <code>repo</code> access for private repositories.</p>
<p><strong>For detailed step-by-step instructions, see Appendix A: GitHub Personal Access Token Setup.</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export token as environment variable (replace with your actual token)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">GITHUB_TOKEN</span><span class="op">=</span>ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Login and push</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$GITHUB_TOKEN</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="at">-u</span> username <span class="dt">\</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">--password-stdin</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> ghcr.io/username/penguins_analysis:v1.0 .</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push ghcr.io/username/penguins_analysis:v1.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Note</strong>: If you get a “permission_denied” error when pushing, ensure your token includes the correct scopes (see Appendix A for details).</p>
<p><strong>GitHub Container Registry Benefits:</strong></p>
<ul>
<li><strong>Free tier</strong>: 0.5GB storage included, no billing currently active</li>
<li><strong>Automatic access control</strong>: Inherits repository permissions</li>
<li><strong>Integrated with GitHub Actions</strong>: Direct authentication in CI/CD</li>
<li><strong>Simple team sharing</strong>: Repository collaborators automatically have access</li>
<li><strong>Package management</strong>: Integrated with GitHub Packages ecosystem</li>
</ul>
<p><strong>Docker Workflow:</strong></p>
<p>The zzrrtools setup provides multiple approaches for working with containers, from simple Make commands to direct Docker execution. Make commands offer simplicity:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build and run with Make (recommended)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build    <span class="co"># Build the container</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r        <span class="co"># Interactive R session</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-render   <span class="co"># Render research paper</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>For Docker workflow options including Docker Compose and direct commands, see Appendix D: Docker Workflow Options.</strong></p></li>
<li><p><strong>Execute consistently</strong>:</p>
<ul>
<li>Run analyses in the Docker container for guaranteed reproducibility</li>
<li>Use volume mounts to access local files while maintaining environment consistency</li>
<li>Run tests within the container to verify functionality</li>
</ul></li>
</ol>
<p>This strategy ensures that your R Markdown documents and analyses will run identically for anyone who has access to your Docker container, regardless of their local setup.</p>
</section>
</section>
<section id="practical-example-collaborative-research-compendium-development-with-testing" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Practical Example: Collaborative Research Compendium Development with Testing</h1>
<p>The following case study demonstrates how two developers can collaborate on a research compendium using zzrrtools, renv, and Docker to ensure reproducibility, with integrated testing procedures to maintain code quality.</p>
<section id="project-scenario" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="project-scenario"><span class="header-section-number">6.1</span> Project Scenario</h2>
<p>A team of data scientists collaborates on Palmer Penguins analysis using zzrrtools’ Docker-first workflow that eliminates environment setup friction:</p>
<ul>
<li><strong>Joe</strong> (<code>joe</code>): Project maintainer who initializes the repository</li>
<li><strong>Sam</strong> (<code>sam</code>): Contributor who extends the analysis<br>
</li>
<li><strong>Additional team members</strong>: Can join without any local R installation</li>
</ul>
<p>The collaboration model emphasizes <strong>zero-setup team onboarding</strong> through self-replicating project distribution and containerized development environments.</p>
<blockquote class="blockquote">
<p><strong>Collaboration Philosophy</strong>: - <strong>Self-contained projects</strong>: Each repository includes its own setup script - <strong>Container-first development</strong>: All work happens in identical Docker environments - <strong>Automated dependency validation</strong>: Pre-commit checks prevent conflicts - <strong>Shell-based workflows</strong>: Command-line tools for maximum flexibility</p>
</blockquote>
<p><strong>Key Workflow Principles:</strong> - Joe initializes with zzrrtools and commits the setup script to the repository - Team members run the included script - no separate installation required - All development occurs in containers for perfect environment consistency - Dependency changes are validated before commits to prevent team conflicts - Each developer works in identical environments regardless of host system</p>
</section>
<section id="implementation-example" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="implementation-example"><span class="header-section-number">6.2</span> Implementation Example</h2>
<section id="project-maintainer-setup-joe" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="project-maintainer-setup-joe"><span class="header-section-number">6.2.1</span> Project Maintainer Setup (Joe)</h3>
<p>Joe initializes a private GitHub repository and creates the containerized research environment:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create repository and initialize zzrrtools</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/joe/penguins_analysis.git</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> penguins_analysis</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">~/prj/zzrrtools/zzrrtools.sh</span> <span class="at">--dotfiles</span> ~/.config/shell <span class="dt">\</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">--base-image</span> rgt47/r-pluspackages</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This creates: - Research compendium directory structure - Docker container configuration - renv dependency management - Automated validation scripts - GitHub Actions workflows</p>
<p><strong>For a detailed view of the complete directory structure created by zzrrtools, see Appendix C: Directory Structure.</strong></p>
<p>Joe completes the setup and begins development:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate dependencies and build container</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Start container-based development</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>For detailed information on renv dependency validation, troubleshooting, and team collaboration workflows, see Appendix G: renv Management and Validation.</strong></p>
<p>The validation script ensures package environment consistency by verifying dependencies across code files, DESCRIPTION, and renv.lock, preventing common collaboration issues where team members have mismatched environments.</p>
<p><strong>Step 4: Create Initial Analysis Paper</strong></p>
<p>Joe creates an initial analysis examining flipper length vs.&nbsp;bill length relationships in the Palmer Penguins dataset, implementing basic visualization and statistical exploration within the research compendium structure.</p>
<p><strong>Step 5: Create Tests for Analysis Functions</strong></p>
<p>Joe implements testing to ensure reproducible research through data validation, error detection, and environment verification. Testing provides collaboration confidence and supports publication standards by validating data integrity, statistical relationships, and pipeline functionality.</p>
<p>Joe sets up the testing framework and creates basic data validation tests to verify dataset availability, dimensions, and required columns. These tests ensure the analysis environment is correctly configured and catch data-related issues early in the development process.</p>
<p><strong>For a complete test suite with data validation, statistical tests, and integration tests, see Appendix B: Test Suite.</strong></p>
<p><strong>Step 6: Create a .gitignore file</strong></p>
<p>Joe configures version control to track source code and dependencies while excluding generated outputs and temporary files. The principle: track the “recipe” (code + dependencies), not the “meal” (outputs).</p>
<p>Joe creates a <code>.gitignore</code> file excluding renv libraries, generated outputs, temporary files, and system artifacts. This keeps the repository lightweight while ensuring collaborators can recreate the complete environment from tracked dependencies.</p>
<p><strong>Step 7: Create a Dockerfile</strong></p>
<p>zzrrtools generates a Dockerfile with multiple template options. The standard template uses rocker/r-ver, while the pluspackages template includes common R packages like tidyverse. Both provide:</p>
<ul>
<li><strong>R version consistency</strong>: Matches exact R version specified in renv.lock</li>
<li><strong>Development environment</strong>: Includes zsh, vim, tmux, Node.js for plugin support</li>
<li><strong>Security</strong>: Non-root user execution with proper file permissions</li>
<li><strong>TinyTeX integration</strong>: LaTeX support for PDF rendering (pluspackages template)</li>
<li><strong>Pre-installed packages</strong>: Common packages like tidyverse, DT, testthat (pluspackages template)</li>
</ul>
<p>The generated Dockerfile includes development tools and optimizations:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> R_VERSION=latest</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> rocker/r-ver:${R_VERSION}</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Install comprehensive development environment</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="dt">\</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    git ssh curl wget vim tmux zsh build-essential <span class="dt">\</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    libcurl4-openssl-dev libssl-dev libxml2-dev <span class="dt">\</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    libfontconfig1-dev libharfbuzz-dev libfribidi-dev <span class="dt">\</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    libfreetype6-dev libpng-dev libtiff5-dev libjpeg-dev <span class="dt">\</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    man-db pandoc <span class="dt">\</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> <span class="at">-rf</span> /var/lib/apt/lists/<span class="pp">*</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Node.js for vim plugins</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">curl</span> <span class="at">-fsSL</span> https://deb.nodesource.com/setup_lts.x <span class="kw">|</span> <span class="fu">bash</span> <span class="at">-</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> install <span class="at">-y</span> nodejs</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create non-root user with zsh shell</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> USERNAME=analyst</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">useradd</span> <span class="at">--create-home</span> <span class="at">--shell</span> /bin/zsh <span class="va">${USERNAME}</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up R environment with renv</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /home/${USERNAME}/project</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> renv.lock ./</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="kw">USER</span> ${USERNAME}</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"install.packages('renv'); renv::restore()"</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy project files and install</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> . .</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::install('.')"</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"/bin/zsh"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Alternative: Pre-packaged Template</strong></p>
<p>For projects using common packages, the pluspackages template includes TinyTeX and popular R packages:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install TinyTeX for PDF rendering</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"install.packages('tinytex')"</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">R</span> <span class="at">-e</span> <span class="st">"tinytex::install_tinytex()"</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">/root/.TinyTeX/bin/*/tlmgr</span> path add</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Install common R packages (cached layer)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"install.packages(c('renv', 'remotes', 'devtools', </span><span class="dt">\</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="st">    'testthat', 'naniar', 'DT', 'conflicted', 'ggthemes', </span><span class="dt">\</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="st">    'datapasta', 'janitor', 'kableExtra', 'tidytuesdayR', </span><span class="dt">\</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="st">    'tidyverse'), repos = c(CRAN = 'https://cloud.r-project.org'))"</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Give user write permissions to R library</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">chown</span> <span class="at">-R</span> <span class="va">${USERNAME}</span>:<span class="va">${USERNAME}</span> /usr/local/lib/R/site-library</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>For production Dockerfiles with development environment configuration (zsh, vim plugins, dotfiles integration), see Appendix F: Docker Configuration Examples.</strong></p>
<p><strong>R Version Synchronization:</strong></p>
<p>The Dockerfile uses a build argument to ensure the R version exactly matches what’s specified in <code>renv.lock</code>. This eliminates potential issues from R version mismatches between the package environment and the underlying R interpreter. The build command extracts the R version from the renv lockfile:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract R version from renv.lock</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="va">R_VERSION</span><span class="op">=</span><span class="va">$(</span><span class="ex">jq</span> <span class="at">-r</span> <span class="st">'.R.Version'</span> renv.lock<span class="va">)</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Build Docker image with extracted R version</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">--build-arg</span> R_VERSION=<span class="va">${R_VERSION}</span> <span class="dt">\</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-t</span> ghcr.io/joe/penguins_analysis:v1.0 .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If the <code>renv.lock</code> file specifies R 4.3.1, the Docker image will use <code>rocker/r-ver:4.3.1</code>. If renv is updated to R 4.4.0, the Docker build will use <code>rocker/r-ver:4.4.0</code>. This maintains consistency between the package environment and system environment.</p>
<p><strong>Step 8: Container-Based Development</strong></p>
<p>Joe performs all development work inside the Docker container, ensuring consistent environments and immediate visibility of changes to the host system through volume mounting. The container provides a complete development environment with package management, editing tools, and validation utilities.</p>
<p><strong>Step 9: Update and Share Environment</strong></p>
<p>When package dependencies change, GitHub Actions automatically rebuilds the Docker image with updated renv.lock specifications and pushes the updated environment to Docker Hub for team access. This ensures collaborators have access to the identical development environment.</p>
<p><strong>Step 10: Prepare for Team Handoff</strong></p>
<p>Before handing off to team members, Joe must complete several critical steps:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Validate all dependencies are properly captured</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-fix</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Run complete test suite to ensure everything works</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-test</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Render paper to verify end-to-end workflow</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-render</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Build and tag the Docker image</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> tag penguins_analysis ghcr.io/joe/penguins_analysis:v1.0</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Push Docker image to Docker Hub for team access</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$GITHUB_TOKEN</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="at">-u</span> joe <span class="at">--password-stdin</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push ghcr.io/joe/penguins_analysis:v1.0</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Commit all setup files and push to repository</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Initial research compendium setup with Docker environment"</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push origin main</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step 11: Enable Team Access</strong></p>
<p>Joe configures repository permissions for team collaboration:</p>
<ol type="1">
<li><strong>Repository Settings</strong> → <strong>Collaborators</strong> → Add team members</li>
<li><strong>Grant “Write” access</strong> to enable forking and pull requests</li>
<li><strong>Share repository URL</strong> and Docker Hub image name with team</li>
<li><strong>Document onboarding process</strong> in README or team communication</li>
</ol>
<p>At this point, Joe has established a reproducible research framework ready for collaborative development. The containerized environment is available via the registry, and team members can join with zero local setup requirements.</p>
</section>
<section id="team-member-onboarding-sam" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="team-member-onboarding-sam"><span class="header-section-number">6.2.2</span> Team Member Onboarding (Sam)</h3>
<p><strong>What Sam Receives from Joe:</strong> - Repository URL: <code>https://github.com/joe/penguins_analysis</code> - Container registry access (GitHub Personal Access Token) - Brief project overview and development guidelines</p>
<p><strong>Sam’s Onboarding Process:</strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Clone the zzrrtools framework</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/username/zzrrtools.git ~/prj/zzrrtools</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/prj/zzrrtools</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./install.sh</span>  <span class="co"># Creates zzrrtools command in PATH</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Fork and clone the project repository</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/sam/penguins_analysis.git  <span class="co"># Sam's fork</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> penguins_analysis</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Run zzrrtools setup with personal preferences</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="ex">zzrrtools</span> <span class="at">--dotfiles</span> ~/.config/shell  <span class="co"># Customize with personal dotfiles</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Or use other options:</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># zzrrtools --base-image rgt47/r-pluspackages  # Use pre-packaged template</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># zzrrtools --no-docker                       # Skip Docker build</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># zzrrtools --next-steps                      # Show workflow guidance</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Pull the pre-built Docker environment</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull ghcr.io/joe/penguins_analysis:v1.0</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Start development in identical environment</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Key Advantage</strong>: After one-time zzrrtools installation, Sam has access to the framework for all future projects. The development environment setup becomes a simple script execution.</p>
<p>Sam develops new analysis components within the same containerized environment, ensuring identical results across team members.</p>
<p><strong>Step 5: Paper Integration and Testing</strong></p>
<p>Sam integrates the new analysis into the research paper, combining Joe’s original visualizations with the new body mass analysis. Sam also creates tests to validate the new functionality and ensure package dependencies are properly documented.</p>
<p><strong>Step 6: Validation and Quality Assurance</strong></p>
<p>Sam creates tests for the new body mass analysis, validates data integrity and statistical relationships, then runs the complete test suite and verifies paper rendering to ensure no regressions before submission.</p>
<p><strong>Step 7: Contribution Submission</strong></p>
<p>When Sam completes the analysis iteration, the submission process follows these steps:</p>
<ol type="1">
<li><p><strong>Validate dependencies</strong>: Run <code>make docker-check-renv-fix</code> to ensure package consistency</p></li>
<li><p><strong>Run complete test suite</strong>: Execute <code>make docker-test</code> to verify all tests pass</p></li>
<li><p><strong>Verify paper rendering</strong>: Run <code>make docker-render</code> to confirm analysis integrates properly</p></li>
<li><p><strong>Commit changes</strong>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Add body mass analysis and associated tests"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push origin feature/body-mass-analysis</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Create pull request</strong>: Submit pull request from Sam’s fork to Joe’s original repository</p></li>
<li><p><strong>Notify Joe</strong>: Alert project maintainer about new packages or Docker changes needed</p></li>
</ol>
<p><strong>Note</strong>: Only Joe (project maintainer) can accept pull requests. The official Docker image is automatically rebuilt and pushed to Docker Hub by GitHub Actions when package dependencies change.</p>
<p><strong>CI Feedback Loop</strong>: If the CI workflow fails (e.g., renv validation issues), Sam receives automatic GitHub notifications and can view detailed failure logs to fix the issues before Joe reviews the PR.</p>
<p>Sam commits the completed analysis, tests, and documentation to their feature branch and creates a cross-repository pull request to the original repository. This ensures proper code review and governance while maintaining clear attribution of contributions.</p>
<p>At this point, Sam has successfully contributed new analysis through the collaborative workflow. Joe reviews the pull request, tests the changes in the containerized environment, and merges the contribution while maintaining project governance and quality standards.</p>
</section>
</section>
<section id="complete-handoff-workflow-summary" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="complete-handoff-workflow-summary"><span class="header-section-number">6.3</span> Complete Handoff Workflow Summary</h2>
<p><strong>Initiating Developer (Joe) Responsibilities:</strong> 1. Run <code>zzrrtools.sh</code> to create research compendium 2. Develop initial analysis and create tests 3. Validate dependencies with <code>make check-renv-fix</code><br>
4. Build initial Docker image and configure automated rebuilds via GitHub Actions 5. Push team Docker image to Docker Hub (public registry for reproducibility) 6. Commit all files and push to repository 7. Grant team member repository access<br>
8. Share repository URL and Docker Hub image name</p>
<p><strong>Joining Developer (Sam) Process:</strong> 1. Receive repository URL and Docker Hub image name from Joe 2. Clone zzrrtools framework: <code>git clone zzrrtools ~/prj/zzrrtools</code> 3. Install zzrrtools: <code>cd ~/prj/zzrrtools &amp;&amp; ./install.sh</code> (creates <code>zzrrtools</code> command in PATH) 4. Fork and clone project repository 5. Pull pre-built team Docker image: <code>docker pull [TEAM]/project:latest</code> (from Docker Hub) 6. Start development immediately: <code>make docker-r</code> (no local setup needed) 7. Submit contributions via pull requests to private repository</p>
<p><strong>Key Success Factor</strong>: The containerized environment and centralized zzrrtools framework eliminate project-specific configuration requirements for team members after one-time framework installation.</p>
</section>
<section id="collaboration-results" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="collaboration-results"><span class="header-section-number">6.4</span> Collaboration Results</h2>
<p>This workflow achieves: - Identical development environments across team members - Dependency validation preventing conflicts - Standardized project structure - Automated testing and CI/CD integration</p>
<p><strong>For GitHub Actions setup instructions, workflow examples, and CI/CD configuration, see Appendix E: GitHub Actions CI/CD Setup.</strong></p>
<p>The collaborative workflow demonstrated above illustrates the power of combining zzrrtools, renv, and Docker for reproducible research. However, successful implementation of this approach requires understanding both when it’s most beneficial and how to apply it effectively. The following best practices and considerations provide guidance for teams considering this strategy.</p>
</section>
</section>
<section id="best-practices-and-considerations" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Best Practices and Considerations</h1>
<section id="when-to-use-this-approach" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="when-to-use-this-approach"><span class="header-section-number">7.1</span> When to Use This Approach</h2>
<p>The zzrrtools + renv + Docker approach with testing is particularly valuable for:</p>
<ul>
<li><strong>Long-term research projects</strong> where reproducibility over time is crucial</li>
<li><strong>Collaborative analyses</strong> with multiple contributors on different systems</li>
<li><strong>Production analytical pipelines</strong> that need to run consistently</li>
<li><strong>Academic publications</strong> where methods must be reproducible</li>
<li><strong>Teaching and education</strong> to ensure consistent student experiences</li>
<li><strong>Complex analyses</strong> that require testing to validate results</li>
</ul>
</section>
<section id="tips-for-efficient-implementation" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="tips-for-efficient-implementation"><span class="header-section-number">7.2</span> Tips for Efficient Implementation</h2>
<ol type="1">
<li><strong>Keep Docker images minimal</strong>: Include only what’s necessary for reproducibility.</li>
<li><strong>Use specific version tags</strong>: For both R packages and Docker base images, specify exact versions.</li>
<li><strong>Document system requirements</strong>: Include notes on RAM and storage requirements.</li>
<li><strong>Leverage bind mounts</strong>: Mount local directories to containers for easier development.</li>
<li><strong>Write meaningful tests</strong>: Focus on validating both data integrity and analytical results.</li>
<li><strong>Test regularly</strong>: Use CI/CD pipelines to run tests on every change.</li>
<li><strong>Consider computational requirements</strong>: Particularly for resource-intensive analyses.</li>
</ol>
</section>
<section id="testing-strategies-for-r-analyses" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="testing-strategies-for-r-analyses"><span class="header-section-number">7.3</span> Testing Strategies for R Analyses</h2>
<p>Testing data analysis code differs from traditional software testing but provides crucial value for reproducible research:</p>
<ol type="1">
<li><strong>Data Validation Tests</strong>: Ensure data has the expected structure, types, and values.</li>
<li><strong>Function Tests</strong>: Verify that custom functions work as expected with known inputs and outputs.</li>
<li><strong>Edge Case Tests</strong>: Check how code handles missing values, outliers, or unexpected inputs.</li>
<li><strong>Integration Tests</strong>: Confirm that different parts of the analysis work correctly together.</li>
<li><strong>Regression Tests</strong>: Make sure new changes don’t break existing functionality.</li>
<li><strong>Output Validation</strong>: Verify that final results match expected patterns or benchmarks.</li>
</ol>
<p>While uncommon in traditional data analysis, these tests catch silent errors, validate assumptions, and provide confidence that analyses remain correct as code and data evolve.</p>
</section>
<section id="potential-challenges" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="potential-challenges"><span class="header-section-number">7.4</span> Potential Challenges</h2>
<p>Some challenges to be aware of:</p>
<ul>
<li><strong>Docker image size</strong>: Images with many packages can become large</li>
<li><strong>Learning curve</strong>: Docker, renv, and testing frameworks require some initial learning</li>
<li><strong>System-specific features</strong>: Some analyses may rely on hardware features</li>
<li><strong>Performance considerations</strong>: Containers may have different performance characteristics</li>
<li><strong>Test maintenance</strong>: Tests need to be updated as the analysis evolves</li>
</ul>
</section>
<section id="troubleshooting-common-issues" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="troubleshooting-common-issues"><span class="header-section-number">7.5</span> Troubleshooting Common Issues</h2>
<p><strong>Docker Build Failures:</strong> - Try: <code>export DOCKER_BUILDKIT=0</code> (disable BuildKit) - Check Docker has sufficient memory/disk space - Ensure Docker is running and up to date</p>
<p><strong>Platform Warnings on ARM64/Apple Silicon:</strong> - Use updated Makefile with <code>--platform linux/amd64</code> flags - Or set: <code>export DOCKER_DEFAULT_PLATFORM=linux/amd64</code></p>
<p><strong>Permission Errors in Container:</strong> - Rebuild image after copying dotfiles - Check file ownership in project directory</p>
<p><strong>Package Name Errors:</strong> - Ensure directory name contains only letters/numbers/periods - Avoid underscores and special characters</p>
<p><strong>Missing Dotfiles in Container:</strong> - Use <code>--dotfiles</code> or <code>--dotfiles-nodot</code> flag during setup - Rebuild Docker image after adding dotfiles</p>
<p>Despite these challenges, the benefits of reproducible research outweigh the implementation costs, particularly for collaborative and long-term projects. The approach described in this white paper provides a foundation for achieving reproducibility that meets the standards expected in data science and academic research.</p>
</section>
</section>
<section id="conclusion" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Conclusion</h1>
<p>Achieving full reproducibility in R requires addressing project organization, package dependencies, and system-level consistency, while ensuring code quality through testing. By combining zzrrtools for research compendium structure, renv for R package management, Docker for environment containerization, and testing for code validation, data scientists and researchers can create truly portable, reproducible, and reliable workflows.</p>
<p>The approach presented in this white paper ensures that the common frustration of “it works on my machine” becomes a thing of the past. Instead, research compendia become easy to share and fully reproducible. A collaborator or reviewer can launch the Docker container and get identical results, without worrying about package versions, system setup, or project organization.</p>
<p>The case study demonstrates how two developers can effectively collaborate on an analysis while maintaining reproducibility and code quality throughout the project lifecycle. By integrating testing into the workflow, the team can be confident that their analysis is not only reproducible but also correct.</p>
<p>This strategy represents a method for long-term reproducibility in R, meeting the standards required for data science and research documentation. The combination of standardized research compendium structure, dependency management, and containerized environments creates a foundation for reproducible research. By adopting this approach, the R community can make progress toward the goal of reproducible and reliable research and analysis.</p>
</section>
<section id="references" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> References</h1>
<ol type="1">
<li>Marwick, B., Boettiger, C., &amp; Mullen, L. (2018). Packaging data analytical work reproducibly using R (and friends). <em>The American Statistician</em>, 72(1), 80-88.</li>
<li>Marwick, B. (2017). rrtools: Creates a Reproducible Research Compendium. R package version 0.1.6. https://github.com/benmarwick/rrtools (Extended in zzrrtools framework)</li>
<li>Ushey, K., Wickham, H., &amp; RStudio. (2023). renv: Project Environments. R package. https://rstudio.github.io/renv/</li>
<li>The Rocker Project. (2023). Docker containers for the R environment. https://www.rocker-project.org/</li>
<li>Wickham, H. (2023). testthat: Unit Testing for R. https://testthat.r-lib.org/</li>
</ol>
</section>
<section id="appendix-a-github-personal-access-token-setup" class="level1 unnumbered">
<h1 class="unnumbered">Appendix A: GitHub Personal Access Token Setup</h1>
<p>This appendix provides step-by-step instructions for creating a GitHub Personal Access Token with the required permissions for container registry operations.</p>
<p><strong>Why Container Access is Required:</strong> Both collaborators need container-related permissions because Docker images are stored in GitHub Container Registry as private packages that require authentication to access.</p>
<section id="step-by-step-token-creation" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="step-by-step-token-creation"><span class="header-section-number">9.1</span> Step-by-Step Token Creation</h2>
<p><strong>1. Navigate to GitHub Settings:</strong> - Go to <a href="https://github.com">GitHub.com</a> and sign in - Click your profile picture (top right) → Settings - In the left sidebar: Developer settings → Personal access tokens</p>
<p><strong>Note</strong>: GitHub now offers two token types: - <strong>Fine-grained personal access tokens</strong> (recommended for new projects) - <strong>Personal access tokens (classic)</strong> (for broader compatibility)</p>
<p><strong>2. Create New Token:</strong> - Click “Generate new token” and select the appropriate type - Add a descriptive note (e.g., “Docker Container Registry Access”) - Set expiration (recommended: 90 days for security)</p>
<p><strong>3. Select Required Scopes</strong> (check these boxes): - ✅ <strong>repo</strong> (Full control of private repositories) - <em>Required for private repos</em> - ✅ <strong>write:packages</strong> (Upload Docker images to GitHub Container Registry) - <em>Required for project maintainer</em> - ✅ <strong>read:packages</strong> (Download Docker images from GitHub Container Registry) - <em>Required for all team members</em> - ✅ <strong>delete:packages</strong> (Delete packages from GitHub Package Registry) - <em>Optional but recommended</em></p>
<p><strong>Note</strong>: Team members only need <code>read:packages</code> and <code>repo</code>, but the project maintainer needs all container permissions to push Docker images.</p>
<p><strong>Token Type Recommendation</strong>: Use fine-grained personal access tokens for new projects as they provide better security and more precise permissions.</p>
<p><strong>4. Generate and Copy Token:</strong> - Click “Generate token” at the bottom - <strong>Important</strong>: Copy the token immediately - you won’t see it again - Store it securely (see security practices below)</p>
</section>
<section id="token-security-best-practices" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="token-security-best-practices"><span class="header-section-number">9.2</span> Token Security Best Practices</h2>
<ul>
<li><strong>Never commit tokens to repositories</strong> - Use <code>.gitignore</code> to exclude files containing tokens</li>
<li><strong>Use environment variables</strong> - Store tokens in shell environment variables</li>
<li><strong>Set reasonable expiration dates</strong> - Use 30-90 day expiration for security</li>
<li><strong>Revoke unused tokens</strong> - Clean up tokens when no longer needed</li>
<li><strong>Consider GitHub CLI</strong> - Use <code>gh auth login</code> for easier management</li>
<li><strong>Monitor token usage</strong> - Check GitHub Settings → Developer settings → Personal access tokens for activity</li>
</ul>
</section>
<section id="alternative-using-github-cli" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="alternative-using-github-cli"><span class="header-section-number">9.3</span> Alternative: Using GitHub CLI</h2>
<p>For simpler token management, consider using GitHub CLI instead of manual tokens:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and authenticate (handles tokens)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gh</span> auth login <span class="at">--scopes</span> write:packages,read:packages,repo</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Login to container registry (works with gh auth)</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$(</span><span class="ex">gh</span> auth token<span class="va">)</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="dt">\</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-u</span> <span class="va">$(</span><span class="ex">gh</span> api user <span class="at">--jq</span> .login<span class="va">)</span> <span class="at">--password-stdin</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="troubleshooting-common-issues-1" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="troubleshooting-common-issues-1"><span class="header-section-number">9.4</span> Troubleshooting Common Issues</h2>
<p><strong>“permission_denied: The token provided does not match expected scopes”</strong> - Verify your token includes <code>write:packages</code> and <code>read:packages</code> scopes - For private repositories, ensure <code>repo</code> scope is also selected - Create a new token with correct permissions if needed</p>
<p><strong>Token not recognized:</strong> - Ensure token is properly exported: <code>export GITHUB_TOKEN=your_token_here</code> - Verify token hasn’t expired - Check that you’re using the full token (starts with <code>ghp_</code>) 6. Horst, A.M., Hill, A.P., &amp; Gorman, K.B. (2020). palmerpenguins: Palmer Archipelago (Antarctica) penguin data. R package version 0.1.0. https://allisonhorst.github.io/palmerpenguins/ 7. Marwick, B. (2016). Computational reproducibility in archaeological research: Basic principles and a case study of their implementation. <em>Journal of Archaeological Method and Theory</em>, 24(2), 424-473.</p>
</section>
</section>
<section id="appendix-b-comprehensive-test-suite" class="level1 unnumbered">
<h1 class="unnumbered">Appendix B: Comprehensive Test Suite</h1>
<p>This appendix provides a set of tests that can be used to validate the Palmer Penguins analysis. These tests demonstrate best practices for data analysis testing and can be adapted for other projects.</p>
<section id="test-file-teststestthattest-comprehensive-analysis.r" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="test-file-teststestthattest-comprehensive-analysis.r"><span class="header-section-number">9.5</span> Test File: <code>tests/testthat/test-comprehensive-analysis.R</code></h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 1: Data Availability and Basic Structure</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify your primary dataset loads correctly and has </span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expected dimensions</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Package loading issues, file path problems, corrupted data files</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Palmer Penguins dataset is available and has correct structure"</span>, </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">exists</span>(<span class="st">"penguins"</span>, <span class="at">where =</span> <span class="st">"package:palmerpenguins"</span>))</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_s3_class</span>(palmerpenguins<span class="sc">::</span>penguins, <span class="st">"data.frame"</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(palmerpenguins<span class="sc">::</span>penguins), <span class="dv">8</span>)  <span class="co"># Adapt: Set expected </span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                                                    <span class="co"># column count</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">nrow</span>(palmerpenguins<span class="sc">::</span>penguins), <span class="dv">300</span>)   <span class="co"># Adapt: Set minimum </span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                                                    <span class="co"># row threshold</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(palmerpenguins<span class="sc">::</span>penguins), <span class="dv">344</span>)  <span class="co"># Adapt: Set exact </span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>                                                      <span class="co"># expected count </span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>                                                      <span class="co"># if known</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 2: Required Columns Exist with Correct Types</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Ensure your analysis depends on columns that </span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co"># actually </span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># exist with correct types</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Column name changes, type coercion issues, CSV import problems</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Dataset contains required columns with expected data types"</span>, {</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check column existence - Adapt: List columns your analysis requires</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  required_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"species"</span>, <span class="st">"island"</span>, <span class="st">"bill_length_mm"</span>, </span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"bill_depth_mm"</span>, <span class="st">"flipper_length_mm"</span>, </span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"body_mass_g"</span>, <span class="st">"sex"</span>, <span class="st">"year"</span>)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(required_cols <span class="sc">%in%</span> <span class="fu">names</span>(df)))</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check data types - Adapt: Verify types match your analysis </span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expectations</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>species, <span class="st">"integer"</span>)  <span class="co"># Factor stored as integer</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>bill_length_mm, <span class="st">"double"</span>)  <span class="co"># Continuous measurements</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>flipper_length_mm, <span class="st">"integer"</span>)  <span class="co"># Discrete measurements</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>body_mass_g, <span class="st">"integer"</span>)  <span class="co"># Integer measurements</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 3: Categorical Variables Have Expected Levels</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify factor levels for categorical variables used</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="co"># in </span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Missing categories, typos in factor levels, data encoding issues</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Species factor has expected levels"</span>, {</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>  species_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(palmerpenguins<span class="sc">::</span>penguins<span class="sc">$</span>species)</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>  expected_species <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Adelie"</span>, <span class="st">"Chinstrap"</span>, <span class="st">"Gentoo"</span>)  <span class="co"># Adapt: Your </span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>                                                          <span class="co"># expected </span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>                                                          <span class="co"># categories</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sort</span>(species_levels), <span class="fu">sort</span>(expected_species))</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">length</span>(species_levels), <span class="dv">3</span>)  <span class="co"># Adapt: Expected number of </span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>                                           <span class="co"># categories</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For other datasets: Test treatment groups, regions, product types, etc.</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 4: Data Value Ranges are Domain-Reasonable</span></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify numeric values fall within realistic ranges</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a><span class="co"># for </span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a><span class="co"># your domain</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Data entry errors, unit conversion mistakes, outliers from </span></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a><span class="co"># measurement errors</span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Measurement values fall within reasonable biological ranges"</span>, {</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bill length - Adapt: Set realistic bounds for your numeric variables</span></span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>  bill_lengths <span class="ot">&lt;-</span> df<span class="sc">$</span>bill_length_mm[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>bill_length_mm)]</span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(bill_lengths <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> bill_lengths <span class="sc">&lt;=</span> <span class="dv">70</span>))  <span class="co"># Penguin-</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>                                                              <span class="co"># specific </span></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>                                                              <span class="co"># range</span></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Flipper length - Examples for other domains:</span></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>  flipper_lengths <span class="ot">&lt;-</span> df<span class="sc">$</span>flipper_length_mm[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>flipper_length_mm)]</span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(flipper_lengths <span class="sc">&gt;=</span> <span class="dv">150</span> <span class="sc">&amp;</span> flipper_lengths <span class="sc">&lt;=</span> <span class="dv">250</span>))</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Finance: stock prices &gt; 0, percentages 0-100</span></span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Health: age 0-120, BMI 10-80, blood pressure 50-300</span></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Engineering: temperatures -273+°C, pressures &gt; 0</span></span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Body mass</span></span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>  body_masses <span class="ot">&lt;-</span> df<span class="sc">$</span>body_mass_g[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>body_mass_g)]</span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(body_masses <span class="sc">&gt;=</span> <span class="dv">2000</span> <span class="sc">&amp;</span> body_masses <span class="sc">&lt;=</span> <span class="dv">7000</span>))</span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 5: Missing Data Patterns are as Expected</span></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify missingness patterns match your data </span></span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a><span class="co"># collection </span></span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a><span class="co"># expectations</span></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Unexpected data loss, systematic missingness, data pipeline </span></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a><span class="co"># failures</span></span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Missing data follows expected patterns"</span>, {</span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total missing values should be manageable</span></span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a>  total_na <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(df))</span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(total_na, <span class="fu">nrow</span>(df))  <span class="co"># Adapt: Set acceptable threshold for </span></span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># missing </span></span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># data</span></span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Some variables may have expected missingness</span></span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>sex)), <span class="dv">0</span>)  <span class="co"># Sex determination sometimes difficult</span></span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt examples: Optional survey questions, historical data gaps, sensor </span></span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># failures</span></span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Critical variables should be complete</span></span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>species)), <span class="dv">0</span>)  <span class="co"># Primary identifier must be </span></span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a>                                           <span class="co"># complete</span></span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: ID columns, primary keys, required fields should have no NAs</span></span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 6: Expected Statistical Relationships Hold</span></span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Test known relationships between variables in your </span></span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a><span class="co"># domain</span></span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Data corruption, encoding errors, units mix-ups that break known </span></span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a><span class="co"># patterns</span></span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Expected correlations between measurements exist"</span>, {</span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test strong expected relationships</span></span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a>  correlation <span class="ot">&lt;-</span> <span class="fu">cor</span>(df<span class="sc">$</span>flipper_length_mm, df<span class="sc">$</span>body_mass_g, </span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a>                     <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(correlation, <span class="fl">0.8</span>)  <span class="co"># Strong positive correlation expected</span></span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt examples: height vs weight, price vs quality, experience vs salary</span></span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test weaker but expected relationships</span></span>
<span id="cb25-128"><a href="#cb25-128" aria-hidden="true" tabindex="-1"></a>  bill_cor <span class="ot">&lt;-</span> <span class="fu">cor</span>(df<span class="sc">$</span>bill_length_mm, df<span class="sc">$</span>bill_depth_mm, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb25-129"><a href="#cb25-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">abs</span>(bill_cor), <span class="fl">0.1</span>)  <span class="co"># Some relationship should exist</span></span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Education vs income, advertising vs sales, temperature vs </span></span>
<span id="cb25-131"><a href="#cb25-131" aria-hidden="true" tabindex="-1"></a>  <span class="co"># energy use</span></span>
<span id="cb25-132"><a href="#cb25-132" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-133"><a href="#cb25-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 7: Visualization Functions Work Correctly</span></span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Ensure your key plots and visualizations can be </span></span>
<span id="cb25-136"><a href="#cb25-136" aria-hidden="true" tabindex="-1"></a><span class="co"># generated</span></span>
<span id="cb25-137"><a href="#cb25-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Missing aesthetic mappings, incompatible data types, package </span></span>
<span id="cb25-138"><a href="#cb25-138" aria-hidden="true" tabindex="-1"></a><span class="co"># conflicts</span></span>
<span id="cb25-139"><a href="#cb25-139" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Basic plots can be generated without errors"</span>, {</span>
<span id="cb25-140"><a href="#cb25-140" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-141"><a href="#cb25-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test basic plot creation without errors</span></span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_no_error</span>({</span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a>    p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb25-145"><a href="#cb25-145" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-146"><a href="#cb25-146" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>()</span>
<span id="cb25-147"><a href="#cb25-147" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb25-148"><a href="#cb25-148" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Test your key plot types - histograms, boxplots, time series,</span></span>
<span id="cb25-149"><a href="#cb25-149" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb25-150"><a href="#cb25-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-151"><a href="#cb25-151" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that plot object is properly created</span></span>
<span id="cb25-152"><a href="#cb25-152" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb25-153"><a href="#cb25-153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span>
<span id="cb25-154"><a href="#cb25-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_s3_class</span>(p1, <span class="st">"ggplot"</span>)  <span class="co"># Adapt: Check for your plotting </span></span>
<span id="cb25-155"><a href="#cb25-155" aria-hidden="true" tabindex="-1"></a>                                   <span class="co"># framework objects</span></span>
<span id="cb25-156"><a href="#cb25-156" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-157"><a href="#cb25-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-158"><a href="#cb25-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 8: Data Filtering and Subsetting Work Correctly</span></span>
<span id="cb25-159"><a href="#cb25-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify data manipulation operations produce expected</span></span>
<span id="cb25-160"><a href="#cb25-160" aria-hidden="true" tabindex="-1"></a><span class="co"># results</span></span>
<span id="cb25-161"><a href="#cb25-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Logic errors in filtering, unexpected factor behaviors, </span></span>
<span id="cb25-162"><a href="#cb25-162" aria-hidden="true" tabindex="-1"></a><span class="co"># indexing mistakes</span></span>
<span id="cb25-163"><a href="#cb25-163" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Data can be properly filtered and subsetted"</span>, {</span>
<span id="cb25-164"><a href="#cb25-164" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-165"><a href="#cb25-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-166"><a href="#cb25-166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test categorical filtering</span></span>
<span id="cb25-167"><a href="#cb25-167" aria-hidden="true" tabindex="-1"></a>  adelie_penguins <span class="ot">&lt;-</span> df[df<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"Adelie"</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>species), ]</span>
<span id="cb25-168"><a href="#cb25-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">nrow</span>(adelie_penguins), <span class="dv">100</span>)  <span class="co"># Adapt: Expected subset size</span></span>
<span id="cb25-169"><a href="#cb25-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(adelie_penguins<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"Adelie"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb25-170"><a href="#cb25-170" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Filter by treatment groups, regions, time periods, etc.</span></span>
<span id="cb25-171"><a href="#cb25-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-172"><a href="#cb25-172" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test missing data handling</span></span>
<span id="cb25-173"><a href="#cb25-173" aria-hidden="true" tabindex="-1"></a>  complete_cases <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df), ]</span>
<span id="cb25-174"><a href="#cb25-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(<span class="fu">nrow</span>(complete_cases), <span class="fu">nrow</span>(df))  <span class="co"># Some rows should be removed</span></span>
<span id="cb25-175"><a href="#cb25-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(complete_cases)), <span class="dv">0</span>)  <span class="co"># No NAs remaining</span></span>
<span id="cb25-176"><a href="#cb25-176" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Test your specific data cleaning operations</span></span>
<span id="cb25-177"><a href="#cb25-177" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-178"><a href="#cb25-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-179"><a href="#cb25-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 9: Summary Statistics are Reasonable</span></span>
<span id="cb25-180"><a href="#cb25-180" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify computed statistics match domain knowledge </span></span>
<span id="cb25-181"><a href="#cb25-181" aria-hidden="true" tabindex="-1"></a><span class="co"># expectations</span></span>
<span id="cb25-182"><a href="#cb25-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Calculation errors, unit mistakes, algorithm bugs, extreme </span></span>
<span id="cb25-183"><a href="#cb25-183" aria-hidden="true" tabindex="-1"></a><span class="co"># outliers</span></span>
<span id="cb25-184"><a href="#cb25-184" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Summary statistics fall within expected ranges"</span>, {</span>
<span id="cb25-185"><a href="#cb25-185" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-186"><a href="#cb25-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-187"><a href="#cb25-187" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test means fall within expected ranges</span></span>
<span id="cb25-188"><a href="#cb25-188" aria-hidden="true" tabindex="-1"></a>  mean_flipper <span class="ot">&lt;-</span> <span class="fu">mean</span>(df<span class="sc">$</span>flipper_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-189"><a href="#cb25-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(mean_flipper, <span class="dv">190</span>)  <span class="co"># Adapt: Set realistic bounds for your </span></span>
<span id="cb25-190"><a href="#cb25-190" aria-hidden="true" tabindex="-1"></a>                                <span class="co"># variables</span></span>
<span id="cb25-191"><a href="#cb25-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(mean_flipper, <span class="dv">210</span>)</span>
<span id="cb25-192"><a href="#cb25-192" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Examples: Average customer age 20-80, mean salary $30k-200k, etc.</span></span>
<span id="cb25-193"><a href="#cb25-193" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-194"><a href="#cb25-194" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test other central tendencies</span></span>
<span id="cb25-195"><a href="#cb25-195" aria-hidden="true" tabindex="-1"></a>  mean_mass <span class="ot">&lt;-</span> <span class="fu">mean</span>(df<span class="sc">$</span>body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-196"><a href="#cb25-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(mean_mass, <span class="dv">4000</span>)</span>
<span id="cb25-197"><a href="#cb25-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(mean_mass, <span class="dv">5000</span>)</span>
<span id="cb25-198"><a href="#cb25-198" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-199"><a href="#cb25-199" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test variability measures are reasonable</span></span>
<span id="cb25-200"><a href="#cb25-200" aria-hidden="true" tabindex="-1"></a>  sd_flipper <span class="ot">&lt;-</span> <span class="fu">sd</span>(df<span class="sc">$</span>flipper_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-201"><a href="#cb25-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(sd_flipper, <span class="dv">5</span>)   <span class="co"># Not zero variance</span></span>
<span id="cb25-202"><a href="#cb25-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(sd_flipper, <span class="dv">30</span>)  <span class="co"># Not excessive variance</span></span>
<span id="cb25-203"><a href="#cb25-203" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: CV should be &lt;50%, SD should be meaningful relative to mean</span></span>
<span id="cb25-204"><a href="#cb25-204" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-205"><a href="#cb25-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-206"><a href="#cb25-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 10: Complete Analysis Pipeline Integration Test</span></span>
<span id="cb25-207"><a href="#cb25-207" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Test your entire analysis workflow runs without </span></span>
<span id="cb25-208"><a href="#cb25-208" aria-hidden="true" tabindex="-1"></a><span class="co"># errors</span></span>
<span id="cb25-209"><a href="#cb25-209" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Pipeline breaks, dependency issues, function interaction problems</span></span>
<span id="cb25-210"><a href="#cb25-210" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Complete analysis pipeline executes successfully"</span>, {</span>
<span id="cb25-211"><a href="#cb25-211" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-212"><a href="#cb25-212" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-213"><a href="#cb25-213" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that full workflow executes without errors</span></span>
<span id="cb25-214"><a href="#cb25-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_no_error</span>({</span>
<span id="cb25-215"><a href="#cb25-215" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data preparation step</span></span>
<span id="cb25-216"><a href="#cb25-216" aria-hidden="true" tabindex="-1"></a>    clean_df <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df[<span class="fu">c</span>(<span class="st">"flipper_length_mm"</span>, </span>
<span id="cb25-217"><a href="#cb25-217" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"bill_length_mm"</span>)]), ]</span>
<span id="cb25-218"><a href="#cb25-218" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-219"><a href="#cb25-219" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Statistical analysis step - Adapt: Your key analyses</span></span>
<span id="cb25-220"><a href="#cb25-220" aria-hidden="true" tabindex="-1"></a>    correlation_result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(clean_df<span class="sc">$</span>flipper_length_mm, </span>
<span id="cb25-221"><a href="#cb25-221" aria-hidden="true" tabindex="-1"></a>                                   clean_df<span class="sc">$</span>bill_length_mm)</span>
<span id="cb25-222"><a href="#cb25-222" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-223"><a href="#cb25-223" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization step - Adapt: Your key plots</span></span>
<span id="cb25-224"><a href="#cb25-224" aria-hidden="true" tabindex="-1"></a>    plot_result <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(clean_df, </span>
<span id="cb25-225"><a href="#cb25-225" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb25-226"><a href="#cb25-226" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-227"><a href="#cb25-227" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb25-228"><a href="#cb25-228" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-229"><a href="#cb25-229" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Flipper Length vs. Bill Length"</span>,</span>
<span id="cb25-230"><a href="#cb25-230" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span id="cb25-231"><a href="#cb25-231" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"Bill Length (mm)"</span>)</span>
<span id="cb25-232"><a href="#cb25-232" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb25-233"><a href="#cb25-233" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Add model fitting, prediction, reporting steps as needed</span></span>
<span id="cb25-234"><a href="#cb25-234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-235"><a href="#cb25-235" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify analysis produces meaningful results</span></span>
<span id="cb25-236"><a href="#cb25-236" aria-hidden="true" tabindex="-1"></a>  clean_df <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df[<span class="fu">c</span>(<span class="st">"flipper_length_mm"</span>, </span>
<span id="cb25-237"><a href="#cb25-237" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"bill_length_mm"</span>)]), ]</span>
<span id="cb25-238"><a href="#cb25-238" aria-hidden="true" tabindex="-1"></a>  correlation_result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(clean_df<span class="sc">$</span>flipper_length_mm, </span>
<span id="cb25-239"><a href="#cb25-239" aria-hidden="true" tabindex="-1"></a>                                 clean_df<span class="sc">$</span>bill_length_mm)</span>
<span id="cb25-240"><a href="#cb25-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(correlation_result<span class="sc">$</span>p.value, <span class="fl">0.05</span>)  <span class="co"># Significant result expected</span></span>
<span id="cb25-241"><a href="#cb25-241" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Check model R², prediction accuracy, convergence, etc.</span></span>
<span id="cb25-242"><a href="#cb25-242" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="running-the-tests" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="running-the-tests"><span class="header-section-number">9.6</span> Running the Tests</h2>
<p>To run all tests in your project:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run all tests</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_dir</span>(<span class="st">"tests/testthat"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run specific test file</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_file</span>(<span class="st">"tests/testthat/test-comprehensive-analysis.R"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Run tests with detailed output</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_dir</span>(<span class="st">"tests/testthat"</span>, <span class="at">reporter =</span> <span class="st">"detailed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="test-categories-explained" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="test-categories-explained"><span class="header-section-number">9.7</span> Test Categories Explained</h2>
<p><strong>Data Validation Tests (1-5)</strong>: Verify data structure, types, ranges, and missing patterns <strong>Statistical Tests (6)</strong>: Confirm expected relationships in the data <strong>Functional Tests (7-8)</strong>: Ensure analysis functions work correctly <strong>Sanity Tests (9)</strong>: Check that summary statistics are reasonable <strong>Integration Tests (10)</strong>: Verify the complete analysis pipeline works end-to-end</p>
<p>These tests provide coverage for a data analysis project and can catch issues ranging from data corruption to environment setup problems.</p>
</section>
</section>
<section id="appendix-c-directory-structure" class="level1 unnumbered">
<h1 class="unnumbered">Appendix C: Directory Structure</h1>
<p>The zzrrtools setup creates the following directory structure:</p>
<pre><code>project/
├── DESCRIPTION              # Package metadata and dependencies
├── LICENSE                  # Project license  
├── README.md               # Project documentation
├── project.Rproj           # R project file
├── renv.lock               # Package dependency lockfile
├── setup_renv.R            # Automated renv setup script
├── Dockerfile              # Container specification
├── docker-compose.yml      # Multi-service Docker setup
├── Makefile                # Build automation (native R + Docker)
├── .Rprofile               # R startup configuration
├── .dockerignore           # Docker build exclusions
├── ZZRRTOOLS_USER_GUIDE.md # Comprehensive user documentation
├── .zshrc_docker           # zsh configuration for Docker container
├── .github/workflows/      # Multiple GitHub Actions workflows
│   ├── docker-ci.yml       # Docker-based CI/CD
│   ├── r-package.yml       # R package checking
│   └── render-paper.yml    # Automated paper rendering
├── check_renv_for_commit.R # renv consistency validation script
├── R/                      # R functions and utilities
│   └── utils.R             # Pre-built utility functions
├── man/                    # Generated function documentation
├── data/                   # Comprehensive data organization
│   ├── raw_data/           # Original, unmodified data
│   ├── derived_data/       # Processed/cleaned data
│   ├── metadata/           # Data documentation
│   ├── validation/         # Data validation scripts
│   └── external_data/      # Third-party datasets
├── analysis/               # Research analysis
│   ├── paper/              # Manuscript with PDF output
│   ├── figures/            # Generated plots and charts
│   ├── tables/             # Generated tables
│   └── templates/          # Document templates and CSL styles
├── scripts/                # Working R scripts and code snippets
├── tests/testthat/         # Unit tests and validation
├── vignettes/              # Package vignettes and tutorials
├── inst/doc/               # Package documentation
├── docs/                   # Additional documentation
├── archive/                # Archived files and old versions
└── [a,n,f,t,s,m,e,o,c]    # Symbolic links for easy navigation</code></pre>
<section id="key-features-explained" class="level2" data-number="9.8">
<h2 data-number="9.8" class="anchored" data-anchor-id="key-features-explained"><span class="header-section-number">9.8</span> Key Features Explained:</h2>
<p><strong>Data Organization:</strong> - <strong>raw_data/</strong>: Original, unmodified datasets as received - <strong>derived_data/</strong>: Processed, cleaned, or transformed data - <strong>metadata/</strong>: Documentation about data sources, collection methods, variables - <strong>validation/</strong>: Scripts that verify data integrity and quality - <strong>external_data/</strong>: Third-party datasets or reference data</p>
<p><strong>Multiple Output Formats:</strong> - <strong>figures/</strong>: Generated plots, charts, and visualizations - <strong>tables/</strong>: Generated summary tables and statistical results - <strong>paper/</strong>: Main manuscript and analysis documents - <strong>templates/</strong>: Document templates and citation style files</p>
<p><strong>R Package Structure:</strong> - <strong>R/</strong>: Custom functions and utilities - <strong>man/</strong>: Generated documentation for R functions - <strong>tests/testthat/</strong>: Unit tests and validation scripts - <strong>vignettes/</strong>: Long-form documentation and tutorials - <strong>DESCRIPTION</strong>: Package metadata and dependency specifications</p>
<p><strong>Docker Orchestration:</strong> - <strong>Dockerfile</strong>: Main container specification - <strong>docker-compose.yml</strong>: Multi-service development environments - <strong>Makefile</strong>: Build automation supporting both native R and Docker workflows</p>
<p><strong>Workflows:</strong> - <strong>.github/workflows/</strong>: GitHub Actions for testing, checking, and rendering - <strong>setup_renv.R</strong>: Package environment setup - <strong>RRTOOLS_USER_GUIDE.md</strong>: Usage documentation</p>
<p><strong>Navigation Shortcuts:</strong> - <strong>Symbolic links</strong>: Single-letter shortcuts for easy navigation - <code>a</code> → analysis/, <code>n</code> → analysis/, <code>f</code> → figures/ - <code>t</code> → tests/, <code>s</code> → scripts/, <code>m</code> → man/ - <code>e</code> → external_data/, <code>o</code> → output/, <code>c</code> → cache/</p>
<p>This structure supports research projects while maintaining clear organization and following established research compendium principles.</p>
</section>
</section>
<section id="appendix-d-docker-workflow-options" class="level1 unnumbered">
<h1 class="unnumbered">Appendix D: Docker Workflow Options</h1>
<p>The zzrrtools setup provides a multi-service Docker architecture optimized for collaborative shell-based development workflows.</p>
<section id="multi-service-docker-architecture" class="level2" data-number="9.9">
<h2 data-number="9.9" class="anchored" data-anchor-id="multi-service-docker-architecture"><span class="header-section-number">9.9</span> Multi-Service Docker Architecture</h2>
<p>zzrrtools creates specialized Docker environments for different development tasks:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the containerized research environment</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive R console (primary development environment)</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Development shell with personal dotfiles</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-zsh</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive bash session</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-bash</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># RStudio Server (web-based IDE)</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-rstudio    <span class="co"># Access at http://localhost:8787</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Render research paper</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-render</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Run tests</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-test</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Package checking</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co"># renv dependency validation</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check-renv-fix</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="co"># See all available commands</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> help</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Collaborative Benefits:</strong> - <strong>Zero-setup onboarding</strong>: Team members run identical commands - <strong>Consistent environments</strong>: Same container across all developer machines - <strong>ARM64/Apple Silicon support</strong>: Platform-specific flags ensure compatibility - <strong>Shell-optimized workflows</strong>: Command-line development with rich tooling - <strong>Personal customization</strong>: Dotfiles integration for familiar environments - <strong>Web-based development</strong>: Optional RStudio Server for GUI-based workflows</p>
</section>
<section id="option-2-docker-compose-services" class="level2" data-number="9.10">
<h2 data-number="9.10" class="anchored" data-anchor-id="option-2-docker-compose-services"><span class="header-section-number">9.10</span> Option 2: Docker Compose Services</h2>
<p>Docker Compose orchestrates multiple container configurations:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive R session</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> r-session</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Bash shell access</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> bash</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Automated paper rendering</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> research</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Package testing</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> test</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Package checking</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> check</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Docker Compose Configuration Example:</strong></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">r-session</span><span class="kw">:</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .:/home/analyst/project</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./cache:/home/analyst/cache</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">working_dir</span><span class="kw">:</span><span class="at"> /home/analyst/project</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bash</span><span class="kw">:</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .:/home/analyst/project</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">working_dir</span><span class="kw">:</span><span class="at"> /home/analyst/project</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">entrypoint</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"/bin/bash"</span><span class="kw">]</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">research</span><span class="kw">:</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .:/home/analyst/project</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./analysis/figures:/home/analyst/output</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">working_dir</span><span class="kw">:</span><span class="at"> /home/analyst/project</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"R"</span><span class="kw">,</span><span class="at"> </span><span class="st">"-e"</span><span class="kw">,</span><span class="at"> </span><span class="st">"rmarkdown::render('analysis/paper/paper.Rmd')"</span><span class="kw">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Benefits:</strong> - <strong>Service setup</strong>: Multiple predefined container configurations - <strong>Volume management</strong>: Consistent volume mounting across services - <strong>Environment isolation</strong>: Different services for different purposes - <strong>Parallel execution</strong>: Can run multiple services simultaneously</p>
</section>
<section id="option-3-direct-docker-commands" class="level2" data-number="9.11">
<h2 data-number="9.11" class="anchored" data-anchor-id="option-3-direct-docker-commands"><span class="header-section-number">9.11</span> Option 3: Direct Docker Commands</h2>
<p>For maximum control, use Docker commands directly:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic interactive session</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-it</span> <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive session with mounted cache</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-it</span> <span class="dt">\</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/cache:/home/analyst/cache"</span> <span class="dt">\</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Render research paper</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/analysis/figures:/home/analyst/output"</span> <span class="dt">\</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0 <span class="dt">\</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  R <span class="at">-e</span> <span class="st">"rmarkdown::render('analysis/paper/paper.Rmd')"</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Run specific tests</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0 <span class="dt">\</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  R <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test-data-integrity.R')"</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive bash session</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-it</span> <span class="dt">\</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0 <span class="dt">\</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  /bin/bash</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Common Docker Flags Explained:</strong> - <code>--rm</code>: Remove container when it exits - <code>-it</code>: Interactive terminal session - <code>-v</code>: Mount volume (host:container) - <code>-w</code>: Set working directory inside container - <code>--entrypoint</code>: Override default command</p>
<p><strong>Benefits:</strong> - <strong>Full flexibility</strong>: Complete control over container configuration - <strong>Educational</strong>: Shows exactly what’s happening under the hood - <strong>Troubleshooting</strong>: Easier to debug when you see all options - <strong>Portability</strong>: Commands work on any Docker installation</p>
</section>
<section id="volume-mounting-strategies" class="level2" data-number="9.12">
<h2 data-number="9.12" class="anchored" data-anchor-id="volume-mounting-strategies"><span class="header-section-number">9.12</span> Volume Mounting Strategies</h2>
<p><strong>Project Files:</strong></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mount entire project directory</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Output Separation:</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate outputs from source</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/analysis/figures:/home/analyst/output"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Cache Persistence:</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Persistent package cache across sessions</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/cache:/home/analyst/cache"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Read-only Source:</strong></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Protect source files from modification</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project:ro"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="choosing-the-right-approach" class="level2" data-number="9.13">
<h2 data-number="9.13" class="anchored" data-anchor-id="choosing-the-right-approach"><span class="header-section-number">9.13</span> Choosing the Right Approach</h2>
<p><strong>Use Make Commands When:</strong> - You want simplicity and consistency - You’re new to Docker - You’re focusing on analysis rather than infrastructure</p>
<p><strong>Use Docker Compose When:</strong> - You need multiple service configurations - You’re working with a team using standardized environments - You want to define complex volume and networking setups</p>
<p><strong>Use Direct Commands When:</strong> - You need maximum flexibility - You’re troubleshooting container issues - You’re creating custom workflows not covered by Make targets</p>
<p>All three approaches can be used together in the same project, depending on the specific task and user preferences.</p>
</section>
</section>
<section id="appendix-e-github-actions-cicd-setup" class="level1 unnumbered">
<h1 class="unnumbered">Appendix E: GitHub Actions CI/CD Setup</h1>
<p>GitHub Actions provides testing and deployment for research compendia. This appendix covers CI/CD setup for reproducible research workflows.</p>
<section id="understanding-github-actions-for-research" class="level2" data-number="9.14">
<h2 data-number="9.14" class="anchored" data-anchor-id="understanding-github-actions-for-research"><span class="header-section-number">9.14</span> Understanding GitHub Actions for Research</h2>
<p><strong>What is CI/CD for Research?</strong></p>
<p>Continuous Integration/Continuous Deployment (CI/CD) tests your research code whenever changes are made. For research compendia, this means:</p>
<ul>
<li><strong>Testing</strong>: Every push triggers your test suite</li>
<li><strong>Environment consistency</strong>: Tests run in identical Docker environments</li>
<li><strong>Early error detection</strong>: Problems caught during development</li>
<li><strong>Collaboration confidence</strong>: Team members see if changes break functionality</li>
<li><strong>Reproducibility validation</strong>: Ensures analysis works across different systems</li>
</ul>
</section>
<section id="step-by-step-setup" class="level2" data-number="9.15">
<h2 data-number="9.15" class="anchored" data-anchor-id="step-by-step-setup"><span class="header-section-number">9.15</span> Step-by-Step Setup</h2>
<section id="step-1-create-workflow-directory" class="level3" data-number="9.15.1">
<h3 data-number="9.15.1" class="anchored" data-anchor-id="step-1-create-workflow-directory"><span class="header-section-number">9.15.1</span> Step 1: Create Workflow Directory</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the GitHub Actions directory</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> .github/workflows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-2-docker-based-ci-workflow-with-renv-validation" class="level3" data-number="9.15.2">
<h3 data-number="9.15.2" class="anchored" data-anchor-id="step-2-docker-based-ci-workflow-with-renv-validation"><span class="header-section-number">9.15.2</span> Step 2: Docker-based CI Workflow with renv Validation</h3>
<p>Create <code>.github/workflows/docker-ci.yml</code>:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Docker CI with renv Validation</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">build-and-test</span><span class="kw">:</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout repository</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up R for renv validation</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r@v2</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">r-version</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install renv for validation</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>        install.packages("renv")</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">shell</span><span class="kw">:</span><span class="at"> Rscript {0}</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Validate renv consistency before Docker build</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>        # Validate renv environment before building Docker image</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>        Rscript check_renv_for_commit.R --fail-on-issues --quiet</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Extract R version from renv.lock</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">id</span><span class="kw">:</span><span class="at"> r-version</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>        R_VERSION=$(Rscript -e "cat(renv::lockfile_read()\$R\$Version)")</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>        echo "r-version=${R_VERSION}" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build Docker image</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v5</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">push</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> ${{ github.repository }}:latest</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a><span class="fu">        build-args</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>          R_VERSION=${{ steps.r-version.outputs.r-version }}</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">cache-from</span><span class="kw">:</span><span class="at"> type=gha</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">cache-to</span><span class="kw">:</span><span class="at"> type=gha,mode=max</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run tests in container</span></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>        docker run --rm -v $PWD:/home/analyst/project \</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>          ${{ github.repository }}:latest \</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>          R -e "testthat::test_dir('tests/testthat')"</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Render research paper</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>        docker run --rm -v $PWD:/home/analyst/project \</span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>          -v $PWD/analysis/figures:/home/analyst/output \</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>          ${{ github.repository }}:latest \</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>          R -e "rmarkdown::render('analysis/paper/paper.Rmd')"</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Upload rendered paper</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/upload-artifact@v4</span></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">if</span><span class="kw">:</span><span class="at"> success()</span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> research-paper</span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">path</span><span class="kw">:</span><span class="at"> analysis/paper/paper.pdf</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-3-r-package-check-workflow" class="level3" data-number="9.15.3">
<h3 data-number="9.15.3" class="anchored" data-anchor-id="step-3-r-package-check-workflow"><span class="header-section-number">9.15.3</span> Step 3: R Package Check Workflow</h3>
<p>Create <code>.github/workflows/r-package.yml</code>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> R Package Check</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">R-CMD-check</span><span class="kw">:</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ${{ matrix.config.os }}</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ${{ matrix.config.os }} (${{ matrix.config.r }})</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">fail-fast</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="fu">os</span><span class="kw">:</span><span class="at"> ubuntu-latest</span><span class="kw">,</span><span class="at">   </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span><span class="kw">}</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="fu">os</span><span class="kw">:</span><span class="at"> macOS-latest</span><span class="kw">,</span><span class="at">    </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span><span class="kw">}</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="fu">os</span><span class="kw">:</span><span class="at"> windows-latest</span><span class="kw">,</span><span class="at">  </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span><span class="kw">}</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">GITHUB_PAT</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">R_KEEP_PKG_SOURCE</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-pandoc@v2</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r@v2</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">r-version</span><span class="kw">:</span><span class="at"> ${{ matrix.config.r }}</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">http-user-agent</span><span class="kw">:</span><span class="at"> ${{ matrix.config.http-user-agent }}</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">use-public-rspm</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-renv@v2</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install system dependencies</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> runner.os == 'Linux'</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>          sudo apt-get update</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>          sudo apt-get install -y \</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>            libcurl4-openssl-dev \</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>            libssl-dev \</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>            libxml2-dev</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Validate renv consistency</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>          # Use the renv validation script included in the repository</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>          Rscript check_renv_for_commit.R --fail-on-issues --quiet</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/check-r-package@v2</span></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">upload-snapshots</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4-automated-paper-rendering" class="level3" data-number="9.15.4">
<h3 data-number="9.15.4" class="anchored" data-anchor-id="step-4-automated-paper-rendering"><span class="header-section-number">9.15.4</span> Step 4: Automated Paper Rendering</h3>
<p>Create <code>.github/workflows/render-paper.yml</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Render Research Paper</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span><span class="co">  # Manual trigger</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'analysis/paper/**'</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'analysis/data/**'</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'R/**'</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'data/**'</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">render</span><span class="kw">:</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout repository</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build Docker image</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v5</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">push</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> paper-render:latest</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-from</span><span class="kw">:</span><span class="at"> type=gha</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-to</span><span class="kw">:</span><span class="at"> type=gha,mode=max</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Render paper in container</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>          docker run --rm \</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>            -v $PWD:/home/analyst/project \</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>            -v $PWD/analysis/figures:/home/analyst/output \</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>            paper-render:latest \</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>            R -e "rmarkdown::render('analysis/paper/paper.Rmd')"</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Upload rendered paper</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/upload-artifact@v4</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> research-paper-${{ github.sha }}</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="fu">          path</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>            analysis/paper/paper.pdf</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>            analysis/figures/*.png</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>            analysis/figures/*.jpg</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">retention-days</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-5-container-registry-integration" class="level3" data-number="9.15.5">
<h3 data-number="9.15.5" class="anchored" data-anchor-id="step-5-container-registry-integration"><span class="header-section-number">9.15.5</span> Step 5: Container Registry Integration</h3>
<p>Create <code>.github/workflows/container-publish.yml</code>:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and Push Container</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main </span><span class="kw">]</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> </span><span class="st">'v*'</span><span class="at"> </span><span class="kw">]</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main </span><span class="kw">]</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">REGISTRY</span><span class="kw">:</span><span class="at"> ghcr.io</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">IMAGE_NAME</span><span class="kw">:</span><span class="at"> ${{ github.repository }}</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">build-and-push</span><span class="kw">:</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> read</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">packages</span><span class="kw">:</span><span class="at"> write</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout repository</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Log in to Container Registry</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name != 'pull_request'</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/login-action@v3</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">registry</span><span class="kw">:</span><span class="at"> ${{ env.REGISTRY }}</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">username</span><span class="kw">:</span><span class="at"> ${{ github.actor }}</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Extract metadata</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> meta</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/metadata-action@v5</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">images</span><span class="kw">:</span><span class="at"> ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a><span class="fu">          tags</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>            type=ref,event=branch</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>            type=ref,event=pr</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>            type=semver,pattern={{version}}</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>            type=semver,pattern={{major}}.{{minor}}</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and push Docker image</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v5</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">platforms</span><span class="kw">:</span><span class="at"> linux/amd64,linux/arm64</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">push</span><span class="kw">:</span><span class="at"> ${{ github.event_name != 'pull_request' }}</span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.tags }}</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">labels</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.labels }}</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-from</span><span class="kw">:</span><span class="at"> type=gha</span></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-to</span><span class="kw">:</span><span class="at"> type=gha,mode=max</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="workflow-explanations" class="level2" data-number="9.16">
<h2 data-number="9.16" class="anchored" data-anchor-id="workflow-explanations"><span class="header-section-number">9.16</span> Workflow Explanations</h2>
<section id="docker-ci-workflow-features" class="level3" data-number="9.16.1">
<h3 data-number="9.16.1" class="anchored" data-anchor-id="docker-ci-workflow-features"><span class="header-section-number">9.16.1</span> Docker CI Workflow Features:</h3>
<ul>
<li><strong>Pre-build renv Validation</strong>: Validates package dependency consistency before Docker build (prevents build failures)</li>
<li><strong>Dynamic R Version</strong>: Extracts R version from renv.lock and passes it to Docker build</li>
<li><strong>Build Testing</strong>: Ensures Docker image builds with latest changes using correct R version</li>
<li><strong>Testing</strong>: Runs R package tests and renders paper in container</li>
<li><strong>Artifact Generation</strong>: Saves rendered papers as downloadable artifacts</li>
<li><strong>Caching</strong>: Uses GitHub Actions cache for faster builds</li>
<li><strong>Early Failure</strong>: Stops pipeline if dependency issues are detected</li>
</ul>
</section>
<section id="r-package-check-features" class="level3" data-number="9.16.2">
<h3 data-number="9.16.2" class="anchored" data-anchor-id="r-package-check-features"><span class="header-section-number">9.16.2</span> R Package Check Features:</h3>
<ul>
<li><strong>Multi-platform Testing</strong>: Tests on Ubuntu, macOS, and Windows</li>
<li><strong>R CMD Check</strong>: Package validation</li>
<li><strong>renv Integration</strong>: Restores package environment</li>
<li><strong>renv Consistency Validation</strong>: Verifies dependency synchronization across platforms</li>
<li><strong>System Dependencies</strong>: Installs required system libraries</li>
</ul>
</section>
<section id="paper-rendering-features" class="level3" data-number="9.16.3">
<h3 data-number="9.16.3" class="anchored" data-anchor-id="paper-rendering-features"><span class="header-section-number">9.16.3</span> Paper Rendering Features:</h3>
<ul>
<li><strong>Selective Triggering</strong>: Only runs when relevant files change</li>
<li><strong>Manual Execution</strong>: Can be triggered manually via GitHub interface</li>
<li><strong>Artifact Storage</strong>: Saves PDFs and figures with retention policy</li>
<li><strong>Path-based Triggers</strong>: Responds to changes in analysis files</li>
</ul>
</section>
<section id="container-publishing-features" class="level3" data-number="9.16.4">
<h3 data-number="9.16.4" class="anchored" data-anchor-id="container-publishing-features"><span class="header-section-number">9.16.4</span> Container Publishing Features:</h3>
<ul>
<li><strong>Building</strong>: Builds on pushes and tags</li>
<li><strong>Multi-platform</strong>: Supports AMD64 and ARM64 platforms</li>
<li><strong>Semantic Versioning</strong>: Tagging based on git tags</li>
<li><strong>Security</strong>: Uses built-in GitHub token for authentication</li>
</ul>
</section>
</section>
<section id="authentication-and-permissions" class="level2" data-number="9.17">
<h2 data-number="9.17" class="anchored" data-anchor-id="authentication-and-permissions"><span class="header-section-number">9.17</span> Authentication and Permissions</h2>
<section id="built-in-github_token" class="level3" data-number="9.17.1">
<h3 data-number="9.17.1" class="anchored" data-anchor-id="built-in-github_token"><span class="header-section-number">9.17.1</span> Built-in GITHUB_TOKEN:</h3>
<p>The built-in <code>GITHUB_TOKEN</code> automatically provides: - Read access to repository contents - Write access to GitHub Packages (when permissions are set) - No manual setup required</p>
</section>
<section id="setting-repository-permissions" class="level3" data-number="9.17.2">
<h3 data-number="9.17.2" class="anchored" data-anchor-id="setting-repository-permissions"><span class="header-section-number">9.17.2</span> Setting Repository Permissions:</h3>
<ol type="1">
<li><strong>Repository Settings</strong> → <strong>Actions</strong> → <strong>General</strong></li>
<li><strong>Workflow permissions</strong>: Choose “Read and write permissions”</li>
<li><strong>Allow GitHub Actions to create and approve pull requests</strong>: Enable if needed</li>
</ol>
</section>
<section id="using-personal-access-tokens-advanced" class="level3" data-number="9.17.3">
<h3 data-number="9.17.3" class="anchored" data-anchor-id="using-personal-access-tokens-advanced"><span class="header-section-number">9.17.3</span> Using Personal Access Tokens (Advanced):</h3>
<p>For broader permissions, create repository secrets:</p>
<ol type="1">
<li><strong>Repository Settings</strong> → <strong>Secrets and variables</strong> → <strong>Actions</strong></li>
<li><strong>New repository secret</strong>: Add <code>GHCR_TOKEN</code> with Personal Access Token</li>
<li><strong>Reference in workflow</strong>: <code>password: ${{ secrets.GHCR_TOKEN }}</code></li>
</ol>
</section>
</section>
<section id="integration-with-collaborative-workflow" class="level2" data-number="9.18">
<h2 data-number="9.18" class="anchored" data-anchor-id="integration-with-collaborative-workflow"><span class="header-section-number">9.18</span> Integration with Collaborative Workflow</h2>
<section id="pull-request-integration" class="level3" data-number="9.18.1">
<h3 data-number="9.18.1" class="anchored" data-anchor-id="pull-request-integration"><span class="header-section-number">9.18.1</span> Pull Request Integration:</h3>
<p>When a team member submits a pull request: 1. GitHub automatically triggers CI workflows 2. Tests run in clean environment identical to production 3. Results displayed directly in pull request interface 4. Merge can be blocked if tests fail</p>
</section>
<section id="branch-protection-rules" class="level3" data-number="9.18.2">
<h3 data-number="9.18.2" class="anchored" data-anchor-id="branch-protection-rules"><span class="header-section-number">9.18.2</span> Branch Protection Rules:</h3>
<p>Enable in <strong>Repository Settings</strong> → <strong>Branches</strong>: - <strong>Require status checks</strong>: Force CI to pass before merging - <strong>Require branches to be up to date</strong>: Ensure latest code is tested - <strong>Include administrators</strong>: Apply rules to all users</p>
</section>
</section>
<section id="monitoring-and-troubleshooting" class="level2" data-number="9.19">
<h2 data-number="9.19" class="anchored" data-anchor-id="monitoring-and-troubleshooting"><span class="header-section-number">9.19</span> Monitoring and Troubleshooting</h2>
<section id="viewing-workflow-results" class="level3" data-number="9.19.1">
<h3 data-number="9.19.1" class="anchored" data-anchor-id="viewing-workflow-results"><span class="header-section-number">9.19.1</span> Viewing Workflow Results:</h3>
<ol type="1">
<li><strong>Repository</strong> → <strong>Actions</strong> tab</li>
<li>Click specific workflow run to see details</li>
<li>Expand steps to see detailed logs</li>
<li>Download artifacts (rendered papers, test results)</li>
</ol>
</section>
<section id="common-issues-and-solutions" class="level3" data-number="9.19.2">
<h3 data-number="9.19.2" class="anchored" data-anchor-id="common-issues-and-solutions"><span class="header-section-number">9.19.2</span> Common Issues and Solutions:</h3>
<p><strong>Docker Build Failures:</strong> - Check Dockerfile syntax - Verify all COPY paths exist - Ensure base image is accessible</p>
<p><strong>renv Restore Failures:</strong> - Verify renv.lock is committed - Check for platform-specific packages - Consider using RSPM for faster installs</p>
<p><strong>Permission Errors:</strong> - Verify GITHUB_TOKEN permissions - Check repository secrets configuration - Ensure workflows have necessary permissions</p>
</section>
<section id="performance-optimization" class="level3" data-number="9.19.3">
<h3 data-number="9.19.3" class="anchored" data-anchor-id="performance-optimization"><span class="header-section-number">9.19.3</span> Performance Optimization:</h3>
<p><strong>Caching Strategies:</strong> - Docker layer caching with <code>cache-from/cache-to</code> - renv package caching with <code>r-lib/actions/setup-renv</code> - Artifact caching for large datasets</p>
<p><strong>Parallel Execution:</strong> - Run tests and documentation in parallel jobs - Use matrix strategies for multi-platform testing - Conditional execution based on changed files</p>
<p>This CI/CD setup ensures that research compendia remain reproducible, tested, and deployment-ready throughout the development lifecycle.</p>
</section>
</section>
</section>
<section id="appendix-f-docker-configuration-examples" class="level1 unnumbered">
<h1 class="unnumbered">Appendix F: Docker Configuration Examples</h1>
<p>This appendix provides Dockerfile examples ranging from minimal configurations to full development environments.</p>
<section id="production-dockerfile" class="level2" data-number="9.20">
<h2 data-number="9.20" class="anchored" data-anchor-id="production-dockerfile"><span class="header-section-number">9.20</span> Production Dockerfile</h2>
<p>The following Dockerfile provides a development environment with zsh, vim plugins, dotfiles integration, and development tools:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use R version from renv.lock for perfect consistency</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> R_VERSION=4.3.0</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> rocker/r-ver:${R_VERSION}</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install system dependencies including zsh and development tools</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="dt">\</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    libxml2-dev <span class="dt">\</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    libcurl4-openssl-dev <span class="dt">\</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    libssl-dev <span class="dt">\</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    libgit2-dev <span class="dt">\</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    libfontconfig1-dev <span class="dt">\</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    libcairo2-dev <span class="dt">\</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    libxt-dev <span class="dt">\</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    pandoc <span class="dt">\</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    zsh <span class="dt">\</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    curl <span class="dt">\</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    git <span class="dt">\</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    fonts-dejavu <span class="dt">\</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> <span class="at">-rf</span> /var/lib/apt/lists/<span class="pp">*</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create non-root user with zsh as default shell</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> USERNAME=analyst</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">useradd</span> <span class="at">--create-home</span> <span class="at">--shell</span> /bin/zsh <span class="va">${USERNAME}</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /home/${USERNAME}/project</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy project files first (for better Docker layer caching)</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> DESCRIPTION .</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> renv.lock* ./</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> .Rprofile* ./</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> renv/activate.R* renv/activate.R</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure renv library path</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> RENV_PATHS_LIBRARY renv/library</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Switch to non-root user for R package installation</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="kw">USER</span> ${USERNAME}</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Install renv and essential R packages</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"install.packages(c('renv', 'remotes', 'devtools', 'knitr', </span><span class="dt">\</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="st">    'rmarkdown'), repos = c(CRAN = 'https://cloud.r-project.org'))"</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Restore R packages from lockfile (if exists)</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"if (file.exists('renv.lock')) renv::restore() else </span><span class="dt">\</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="st">    cat('No renv.lock found, skipping restore</span><span class="dt">\\</span><span class="st">n')"</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy dotfiles for development environment</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Ensure .vimrc and .zshrc_docker exist in build context or create </span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="co"># defaults</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> .vimrc /home/${USERNAME}/.vimrc</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> .zshrc_docker /home/${USERNAME}/.zshrc</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Install zsh plugins for shell experience</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> /home/<span class="va">${USERNAME}</span>/.zsh <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">git</span> clone https://github.com/zsh-users/zsh-autosuggestions <span class="dt">\</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>        /home/<span class="va">${USERNAME}</span>/.zsh/zsh-autosuggestions <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">chown</span> <span class="at">-R</span> <span class="va">${USERNAME}</span>:<span class="va">${USERNAME}</span> /home/<span class="va">${USERNAME}</span>/.zsh</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Install vim-plug and configure vim environment</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> /home/<span class="va">${USERNAME}</span>/.vim/autoload <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>    <span class="ex">curl</span> <span class="at">-fLo</span> /home/<span class="va">${USERNAME}</span>/.vim/autoload/plug.vim <span class="dt">\</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">chown</span> <span class="at">-R</span> <span class="va">${USERNAME}</span>:<span class="va">${USERNAME}</span> /home/<span class="va">${USERNAME}</span>/.vim</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Install vim plugins (suppress interactive mode)</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">vim</span> +PlugInstall +qall <span class="kw">||</span> <span class="fu">true</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy rest of project</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> . .</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Install the research compendium as a package</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::install('.', dependencies = TRUE)"</span></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Set default shell to zsh for development experience</span></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /home/${USERNAME}/project</span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"/bin/zsh"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="features-of-the-production-dockerfile" class="level2" data-number="9.21">
<h2 data-number="9.21" class="anchored" data-anchor-id="features-of-the-production-dockerfile"><span class="header-section-number">9.21</span> Features of the Production Dockerfile</h2>
<p>This production-ready Dockerfile provides:</p>
<ul>
<li><strong>R version consistency</strong>: Matches exact R version specified in renv.lock for perfect environment alignment</li>
<li><strong>Minimal base</strong>: rocker/r-ver provides clean R installation without unnecessary packages</li>
<li><strong>Shell environment</strong>: zsh with autosuggestions and professional prompt for improved productivity</li>
<li><strong>Editor environment</strong>: vim with plugins configured automatically during build</li>
<li><strong>Dotfiles integration</strong>: Personal development preferences (.vimrc, .zshrc) copied from host system</li>
<li><strong>Development tools</strong>: git, curl, pandoc, and essential development libraries pre-installed</li>
<li><strong>Security</strong>: Non-root user execution with proper file permissions</li>
<li><strong>renv integration</strong>: Automatic package restoration with proper library path configuration</li>
<li><strong>Container-optimized workflow</strong>: Optimized layer caching and build process for efficient rebuilds</li>
</ul>
</section>
<section id="r-version-extraction" class="level2" data-number="9.22">
<h2 data-number="9.22" class="anchored" data-anchor-id="r-version-extraction"><span class="header-section-number">9.22</span> R Version Extraction</h2>
<p>The Dockerfile uses a build argument to ensure the R version exactly matches what’s specified in <code>renv.lock</code>. The build command extracts the R version directly from the renv lockfile:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract R version from renv.lock</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="va">R_VERSION</span><span class="op">=</span><span class="va">$(</span><span class="ex">jq</span> <span class="at">-r</span> <span class="st">'.R.Version'</span> renv.lock<span class="va">)</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Build Docker image with extracted R version</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">--build-arg</span> R_VERSION=<span class="va">${R_VERSION}</span> <span class="dt">\</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-t</span> ghcr.io/username/penguins_analysis:v1.0 .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If the <code>renv.lock</code> file specifies R 4.3.1, the Docker image will use <code>rocker/r-ver:4.3.1</code>. If renv is updated to R 4.4.0, the Docker build will use <code>rocker/r-ver:4.4.0</code>. This maintains consistency between the package environment and system environment.</p>
</section>
</section>
<section id="appendix-g-renv-management-and-validation" class="level1 unnumbered">
<h1 class="unnumbered">Appendix G: renv Management and Validation</h1>
<p>This appendix provides details for the renv consistency checking script and dependency management workflows.</p>
<section id="renv-consistency-checker-features" class="level2" data-number="9.23">
<h2 data-number="9.23" class="anchored" data-anchor-id="renv-consistency-checker-features"><span class="header-section-number">9.23</span> renv Consistency Checker Features</h2>
<p>The <code>check_renv_for_commit.R</code> script provides advanced team collaboration features through dependency validation:</p>
<ul>
<li><strong>Team conflict prevention</strong>: Pre-commit validation stops dependency inconsistencies before they reach the repository</li>
<li><strong>Automated dependency discovery</strong>: Scans R/, scripts/, and analysis/ directories for <code>library()</code>, <code>require()</code>, and <code>pkg::</code> calls</li>
<li><strong>Multi-source synchronization</strong>: Ensures packages are consistent across code files, DESCRIPTION, and renv.lock</li>
<li><strong>CRAN validation</strong>: Verifies packages exist and are properly named before team integration</li>
<li><strong>Automatic fixing</strong>: Updates DESCRIPTION and regenerates renv.lock to maintain team synchronization</li>
<li><strong>CI/CD fail-fast</strong>: Provides proper exit codes for automated workflows</li>
<li><strong>Interactive collaboration mode</strong>: Guides developers through dependency resolution during development</li>
</ul>
</section>
<section id="team-collaboration-commands" class="level2" data-number="9.24">
<h2 data-number="9.24" class="anchored" data-anchor-id="team-collaboration-commands"><span class="header-section-number">9.24</span> Team Collaboration Commands</h2>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Team development workflow (via Make)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv          <span class="co"># Interactive dependency checking</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-fix      <span class="co"># Auto-fix dependency issues</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-ci       <span class="co"># CI/CD validation with fail-fast</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Docker-based validation (no local R required)</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check-renv-fix  <span class="co"># Fix dependencies in container</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Direct script usage</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span> <span class="at">--fail-on-issues</span>  <span class="co"># CI mode</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--quiet</span>                 <span class="co"># Minimal output</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--help</span>                  <span class="co"># Usage info</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="multi-developer-workflow" class="level2" data-number="9.25">
<h2 data-number="9.25" class="anchored" data-anchor-id="multi-developer-workflow"><span class="header-section-number">9.25</span> Multi-Developer Workflow</h2>
<ol type="1">
<li><strong>Install packages in container</strong>: Use <code>install.packages()</code> or <code>renv::install()</code> within Docker environment</li>
<li><strong>Validate team dependencies</strong>: Run <code>make check-renv</code> to check for conflicts before committing</li>
<li><strong>Review team impacts</strong>: Script identifies packages that would affect other team members</li>
<li><strong>Synchronize team environment</strong>: Use <code>make check-renv-fix</code> to update shared dependency files</li>
<li><strong>Commit with team confidence</strong>: Other developers can reproduce your exact environment</li>
</ol>
</section>
<section id="integration-with-development-workflows" class="level2" data-number="9.26">
<h2 data-number="9.26" class="anchored" data-anchor-id="integration-with-development-workflows"><span class="header-section-number">9.26</span> Integration with Development Workflows</h2>
<section id="pre-commit-hooks" class="level3" data-number="9.26.1">
<h3 data-number="9.26.1" class="anchored" data-anchor-id="pre-commit-hooks"><span class="header-section-number">9.26.1</span> Pre-commit Hooks</h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to .git/hooks/pre-commit</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fail-on-issues</span> <span class="at">--quiet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="makefile-integration" class="level3" data-number="9.26.2">
<h3 data-number="9.26.2" class="anchored" data-anchor-id="makefile-integration"><span class="header-section-number">9.26.2</span> Makefile Integration</h3>
<div class="sourceCode" id="cb45"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="dv">check-renv:</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>Rscript check_renv_for_commit.R</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="dv">check-renv-fix:</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>Rscript check_renv_for_commit.R --fix</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="dv">check-renv-ci:</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>Rscript check_renv_for_commit.R --quiet --fail-on-issues</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cicd-integration" class="level3" data-number="9.26.3">
<h3 data-number="9.26.3" class="anchored" data-anchor-id="cicd-integration"><span class="header-section-number">9.26.3</span> CI/CD Integration</h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Validate renv consistency</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">run</span><span class="kw">:</span><span class="at"> Rscript check_renv_for_commit.R --fail-on-issues --quiet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This approach ensures that collaborators can reliably reproduce your package environment and that CI/CD pipelines have all necessary dependency information.</p>


<!-- -->

</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{(ryy)_glenn_thomas2025,
  author = {(Ryy) Glenn Thomas, Ronald and Thomas, R.G.},
  title = {Research {Compendia} for {Full} {Reproducibility} in {R:} {A}
    Zzrrtools, Renv, and {Docker} {Strategy}},
  date = {2025-06-30},
  url = {https://focusonr.org/posts/share_R_code_via_docker_p25/},
  langid = {en},
  abstract = {This white paper presents an approach to achieving
    reproducibility in R workflows by combining three tools: zzrrtools
    for creating structured research compendia, renv for R package
    management, and Docker for containerizing the computing environment.
    The zzrrtools framework provides a standardized research compendium
    structure, renv manages package dependencies, and Docker ensures
    consistent execution environments. Together, these tools create
    self-contained research compendia that run identically across
    different systems. The paper includes a practical case study
    demonstrating multi-developer collaborative workflows with clear
    governance roles, where a project maintainer manages the technical
    infrastructure while multiple contributors extend the research
    analysis.}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-(ryy)_glenn_thomas2025" class="csl-entry quarto-appendix-citeas" role="listitem">
(Ryy) Glenn Thomas, Ronald, and R.G. Thomas. 2025. <span>“Research
Compendia for Full Reproducibility in R: A Zzrrtools, Renv, and Docker
Strategy.”</span> June 30, 2025. <a href="https://focusonr.org/posts/share_R_code_via_docker_p25/">https://focusonr.org/posts/share_R_code_via_docker_p25/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/focusonr\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="rgt47/qblog" data-repo-id="R_kgDOH6TO7A" data-category="Announcements" data-category-id="DIC_kwDOH5G3U84CRUp9" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="light"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb47" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Research Compendia for Full Reproducibility in R: A zzrrtools, renv,</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">  and Docker Strategy"</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># PDF format removed to prevent automatic PDF generation</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use ./generate_pdf.sh script instead</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "R.G. Thomas"</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> |</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co">  This white paper presents an approach to achieving </span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co">  reproducibility in R workflows by combining three tools: zzrrtools </span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co">  for creating structured research compendia, renv for R package management, </span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co">  and Docker for containerizing the computing environment. The zzrrtools </span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co">  framework provides a standardized research compendium structure, renv </span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="co">  manages package dependencies, and Docker ensures consistent execution </span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co">  environments. Together, these tools create self-contained research compendia </span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co">  that run identically across different systems. The paper includes a </span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="co">  practical case study demonstrating multi-developer collaborative workflows </span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="co">  with clear governance roles, where a project maintainer manages the </span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co">  technical infrastructure while multiple contributors extend the research </span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co">  analysis.</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># Executive Summary {.unnumbered}</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>Reproducibility is key to conducting data analysis, yet in</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>practice, achieving it consistently with R workflows can be quite </span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>challenging. R</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>projects frequently break when transferred between computers due to </span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>mismatched R</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>versions, package dependencies, or inconsistent project organization. This </span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>white paper describes an</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>approach to solving this problem by combining three tools: </span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>**zzrrtools** for </span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>creating structured research compendia, **renv** for R package management, </span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>and **Docker** for containerizing the computing environment.</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>Together, these tools ensure that an R workflow runs identically across</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>different computers by providing standardized project structure, identical R </span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>packages and versions, consistent R versions, and the same operating system </span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>libraries</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>as the original setup.</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a><span class="fu"># Motivation {.unnumbered}</span></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>Imagine you've written code that you want to share with a colleague. At </span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>first</span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>glance, this may seem like a straightforward task—simply share the files</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>electronically. However, ensuring that your</span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>colleague can run the code without errors, and obtain the same results is </span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>often</span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>much more challenging than anticipated.</span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>When sharing R code, several potential problems can arise that can lead to </span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>code that won't run or won't match your results:</span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different versions of R installed on each machine</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Mismatched R package versions</span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Missing or mismatched system dependencies (like pandoc or LaTeX)</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Missing supplemental files referenced by the program (bibliography files, </span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a>  LaTeX preambles, datasets, images)</span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different R startup configurations (.Rprofile or .Renviron)</span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different Operating Systems (macOS, Windows, Linux, etc.) </span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>A real-world scenario often unfolds like this:</span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>You email your analysis files to a colleague</span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>They attempt to run your analysis with the commands you provided</span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>But R isn't installed on their system</span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>After installing R, they get an error: "could not find function 'render'" </span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>   since they don't have the <span class="in">`rmarkdown`</span> package installed</span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>They install the rmarkdown package and run the R command again</span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Now pandoc is missing</span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>After installing pandoc, a required package, say <span class="in">`ggplot`</span>, is missing</span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>After installing <span class="in">`ggplot`</span>, several external files are missing (e.g. </span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a>   bibliography, images)</span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>And so on...</span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a>This cycle of troubleshooting can be time-consuming and frustrating. Even </span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>when</span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>the code eventually runs, there's no guarantee that they will get the same</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a>results that you did.</span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a>To ensure true reproducibility, your colleague should have a computing</span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a>environment as similar to yours as possible. Given the dynamic nature of </span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a>open</span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a>source software, not to mention hardware and operating system differences, </span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a>this</span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a>can be difficult to achieve through manual installation and configuration.</span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a>The approach outlined in this white paper offers a systematic solution. </span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a>Rather</span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a>than sending standalone text files, with modest additional effort, you can</span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a>provide a complete, containerized, hardware and OS independent environment </span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a>that</span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a>includes everything needed to run your analysis. With this approach, your</span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a>colleague can run a simple command like:</span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a><span class="in">```sh</span></span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="dt">\</span></span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/analysis/figures:/home/analyst/output"</span> <span class="dt">\</span></span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a>(The details of this docker command are explained below.)</span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a>This creates an identical R environment on their desktop, ready for them to </span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a>run</span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a>or modify your code with confidence that it will work as intended.</span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a>The Docker command shown above represents the end goal of this white paper's approach, but achieving this level of reproducibility requires understanding and implementing three complementary technologies. The following sections provide a framework for building such reproducible environments from the ground up.</span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Challenge of Reproducibility in R</span></span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a>R has become a standard tool for data science and statistical analysis across</span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a>numerous scientific disciplines. However, as R projects grow in complexity, they often</span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a>develop complex webs of dependencies that can make sharing and reproducing</span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a>analyses difficult. Some common challenges include:</span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different R versions across machines</span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Incompatible package versions</span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Missing system-level dependencies </span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Operating system differences (macOS vs. Windows vs. Linux)</span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Conflicts with other installed packages</span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>R startup files (.Rprofile, .Renviron, .RData) that can affect code behavior</span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a>These challenges often manifest as the frustrating "it works on my machine"</span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a>problem, where analysis code runs perfectly for the original author but fails</span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a>when others attempt to use it. This undermines the scientific and collaborative</span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true" tabindex="-1"></a>potential of R-based analyses.</span>
<span id="cb47-136"><a href="#cb47-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true" tabindex="-1"></a><span class="fu">## A Three-Level Solution</span></span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true" tabindex="-1"></a>To address these challenges, we need to tackle reproducibility</span>
<span id="cb47-140"><a href="#cb47-140" aria-hidden="true" tabindex="-1"></a>at three distinct levels:</span>
<span id="cb47-141"><a href="#cb47-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-142"><a href="#cb47-142" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Project-level reproducibility**: Ensuring consistent project structure and organization using research compendium standards</span>
<span id="cb47-143"><a href="#cb47-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-144"><a href="#cb47-144" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Package-level reproducibility**: Ensuring exact package versions and dependencies are maintained</span>
<span id="cb47-145"><a href="#cb47-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-146"><a href="#cb47-146" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**System-level reproducibility**: Guaranteeing consistent R versions, operating system, and system libraries</span>
<span id="cb47-147"><a href="#cb47-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-148"><a href="#cb47-148" aria-hidden="true" tabindex="-1"></a>The strategy presented in this white paper leverages **zzrrtools** for project-level</span>
<span id="cb47-149"><a href="#cb47-149" aria-hidden="true" tabindex="-1"></a>structure, **renv** for package-level consistency, and **Docker** for system-level </span>
<span id="cb47-150"><a href="#cb47-150" aria-hidden="true" tabindex="-1"></a>consistency. When combined, they provide a framework for end-to-end </span>
<span id="cb47-151"><a href="#cb47-151" aria-hidden="true" tabindex="-1"></a>reproducible R workflows with proper research compendium organization.</span>
<span id="cb47-152"><a href="#cb47-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-153"><a href="#cb47-153" aria-hidden="true" tabindex="-1"></a>With this three-level framework established, we can now examine how each tool addresses its specific layer of reproducibility. We begin with zzrrtools, which tackles the foundational challenge of project-level organization and provides the structural framework upon which package and system-level reproducibility can be built.</span>
<span id="cb47-154"><a href="#cb47-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-155"><a href="#cb47-155" aria-hidden="true" tabindex="-1"></a><span class="fu"># zzrrtools: Project-Level Reproducibility</span></span>
<span id="cb47-156"><a href="#cb47-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-157"><a href="#cb47-157" aria-hidden="true" tabindex="-1"></a><span class="fu">## What is zzrrtools?</span></span>
<span id="cb47-158"><a href="#cb47-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-159"><a href="#cb47-159" aria-hidden="true" tabindex="-1"></a>**zzrrtools** is a Docker-first framework that creates reproducible research </span>
<span id="cb47-160"><a href="#cb47-160" aria-hidden="true" tabindex="-1"></a>compendia with containerized development workflows. The framework extends the </span>
<span id="cb47-161"><a href="#cb47-161" aria-hidden="true" tabindex="-1"></a>research compendium concept introduced by Ben Marwick's rrtools, adding </span>
<span id="cb47-162"><a href="#cb47-162" aria-hidden="true" tabindex="-1"></a>container-based development and automated dependency validation. Team members install zzrrtools once on their system, then can create or </span>
<span id="cb47-163"><a href="#cb47-163" aria-hidden="true" tabindex="-1"></a>join any zzrrtools-based project using the same framework. A research </span>
<span id="cb47-164"><a href="#cb47-164" aria-hidden="true" tabindex="-1"></a>compendium organizes digital research materials to enable others to inspect, </span>
<span id="cb47-165"><a href="#cb47-165" aria-hidden="true" tabindex="-1"></a>reproduce, and extend the research.</span>
<span id="cb47-166"><a href="#cb47-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-167"><a href="#cb47-167" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Features of zzrrtools</span></span>
<span id="cb47-168"><a href="#cb47-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-169"><a href="#cb47-169" aria-hidden="true" tabindex="-1"></a>**zzrrtools** creates containerized research compendia with these key features:</span>
<span id="cb47-170"><a href="#cb47-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-171"><a href="#cb47-171" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Docker-first development**: All workflows operate within containers, eliminating </span>
<span id="cb47-172"><a href="#cb47-172" aria-hidden="true" tabindex="-1"></a>  "works on my machine" issues</span>
<span id="cb47-173"><a href="#cb47-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-174"><a href="#cb47-174" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Centralized framework**: One-time zzrrtools installation enables </span>
<span id="cb47-175"><a href="#cb47-175" aria-hidden="true" tabindex="-1"></a>  consistent project creation and team collaboration</span>
<span id="cb47-176"><a href="#cb47-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-177"><a href="#cb47-177" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Multi-service architecture**: Provides specialized Docker environments for </span>
<span id="cb47-178"><a href="#cb47-178" aria-hidden="true" tabindex="-1"></a>  interactive R sessions, shell development, and paper rendering</span>
<span id="cb47-179"><a href="#cb47-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-180"><a href="#cb47-180" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Flexible base images**: Choice of minimal (rocker/r-ver) or pre-packaged </span>
<span id="cb47-181"><a href="#cb47-181" aria-hidden="true" tabindex="-1"></a>  (rgt47/r-pluspackages) Docker templates with common R packages</span>
<span id="cb47-182"><a href="#cb47-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-183"><a href="#cb47-183" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Advanced dependency validation**: Automated renv consistency checking with </span>
<span id="cb47-184"><a href="#cb47-184" aria-hidden="true" tabindex="-1"></a>  CRAN verification and pre-commit validation</span>
<span id="cb47-185"><a href="#cb47-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-186"><a href="#cb47-186" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Shell-based workflows**: Optimized for command-line development with rich </span>
<span id="cb47-187"><a href="#cb47-187" aria-hidden="true" tabindex="-1"></a>  automation via Make targets</span>
<span id="cb47-188"><a href="#cb47-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-189"><a href="#cb47-189" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Team collaboration focus**: Designed for multi-developer teams working on </span>
<span id="cb47-190"><a href="#cb47-190" aria-hidden="true" tabindex="-1"></a>  shared research projects</span>
<span id="cb47-191"><a href="#cb47-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-192"><a href="#cb47-192" aria-hidden="true" tabindex="-1"></a><span class="fu">## zzrrtools Workflow: Self-Replicating Collaboration</span></span>
<span id="cb47-193"><a href="#cb47-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-194"><a href="#cb47-194" aria-hidden="true" tabindex="-1"></a>The zzrrtools workflow is designed for team collaboration:</span>
<span id="cb47-195"><a href="#cb47-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-196"><a href="#cb47-196" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-197"><a href="#cb47-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Project creator initializes the research compendium</span></span>
<span id="cb47-198"><a href="#cb47-198" aria-hidden="true" tabindex="-1"></a><span class="ex">~/prj/zzrrtools/zzrrtools.sh</span> <span class="pp">[</span><span class="ss">OPTIONS</span><span class="pp">]</span></span>
<span id="cb47-199"><a href="#cb47-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-200"><a href="#cb47-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Available options:</span></span>
<span id="cb47-201"><a href="#cb47-201" aria-hidden="true" tabindex="-1"></a><span class="co">#   --dotfiles DIR       Copy personal dotfiles (with leading dots)</span></span>
<span id="cb47-202"><a href="#cb47-202" aria-hidden="true" tabindex="-1"></a><span class="co">#   --dotfiles-nodot DIR Copy dotfiles (without leading dots) </span></span>
<span id="cb47-203"><a href="#cb47-203" aria-hidden="true" tabindex="-1"></a><span class="co">#   --base-image NAME    Use custom Docker base image (default: rocker/r-ver)</span></span>
<span id="cb47-204"><a href="#cb47-204" aria-hidden="true" tabindex="-1"></a><span class="co">#                        Popular options: rgt47/r-pluspackages (includes tidyverse)</span></span>
<span id="cb47-205"><a href="#cb47-205" aria-hidden="true" tabindex="-1"></a><span class="co">#   --no-docker          Skip Docker image build</span></span>
<span id="cb47-206"><a href="#cb47-206" aria-hidden="true" tabindex="-1"></a><span class="co">#   --next-steps         Show workflow guidance</span></span>
<span id="cb47-207"><a href="#cb47-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-208"><a href="#cb47-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-209"><a href="#cb47-209" aria-hidden="true" tabindex="-1"></a>This creates a Docker-first research compendium with:</span>
<span id="cb47-210"><a href="#cb47-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-211"><a href="#cb47-211" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Framework-based setup** using centrally installed zzrrtools for consistent project creation</span>
<span id="cb47-212"><a href="#cb47-212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Multi-service Docker architecture** for interactive R, shell, and rendering</span>
<span id="cb47-213"><a href="#cb47-213" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Advanced renv validation** with CRAN verification and pre-commit checking</span>
<span id="cb47-214"><a href="#cb47-214" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Dual-track automation** supporting both native R and Docker workflows</span>
<span id="cb47-215"><a href="#cb47-215" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Navigation shortcuts** via symbolic links (a→data, p→paper, s→scripts)</span>
<span id="cb47-216"><a href="#cb47-216" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Developer environment integration** with personal dotfiles support</span>
<span id="cb47-217"><a href="#cb47-217" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Team synchronization** via automated dependency validation</span>
<span id="cb47-218"><a href="#cb47-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-219"><a href="#cb47-219" aria-hidden="true" tabindex="-1"></a>Team members can collaborate after one-time zzrrtools installation:</span>
<span id="cb47-220"><a href="#cb47-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-221"><a href="#cb47-221" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-222"><a href="#cb47-222" aria-hidden="true" tabindex="-1"></a><span class="co"># One-time zzrrtools installation</span></span>
<span id="cb47-223"><a href="#cb47-223" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone zzrrtools-repo ~/prj/zzrrtools</span>
<span id="cb47-224"><a href="#cb47-224" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/prj/zzrrtools <span class="kw">&amp;&amp;</span> <span class="ex">./install.sh</span>  <span class="co"># Creates zzrrtools command in PATH</span></span>
<span id="cb47-225"><a href="#cb47-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-226"><a href="#cb47-226" aria-hidden="true" tabindex="-1"></a><span class="co"># Per-project workflow</span></span>
<span id="cb47-227"><a href="#cb47-227" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone project-repo <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> project-repo</span>
<span id="cb47-228"><a href="#cb47-228" aria-hidden="true" tabindex="-1"></a><span class="ex">zzrrtools</span>  <span class="co"># Set up project environment (command available anywhere)</span></span>
<span id="cb47-229"><a href="#cb47-229" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r   <span class="co"># Start interactive R session</span></span>
<span id="cb47-230"><a href="#cb47-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-231"><a href="#cb47-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-232"><a href="#cb47-232" aria-hidden="true" tabindex="-1"></a><span class="fu">### Integrated renv Consistency Checking</span></span>
<span id="cb47-233"><a href="#cb47-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-234"><a href="#cb47-234" aria-hidden="true" tabindex="-1"></a>The workflow includes advanced renv management through the <span class="in">`check_renv_for_commit.R`</span> script, which provides automated dependency validation and team conflict prevention. This script:</span>
<span id="cb47-235"><a href="#cb47-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-236"><a href="#cb47-236" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Scans multiple directories** (R/, scripts/, analysis/) for package dependencies</span>
<span id="cb47-237"><a href="#cb47-237" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Validates against CRAN** to ensure packages exist and are properly named  </span>
<span id="cb47-238"><a href="#cb47-238" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Synchronizes dependencies** across code files, DESCRIPTION, and renv.lock</span>
<span id="cb47-239"><a href="#cb47-239" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Provides automated fixes** to maintain team environment consistency</span>
<span id="cb47-240"><a href="#cb47-240" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Integrates with CI/CD** for fail-fast validation workflows</span>
<span id="cb47-241"><a href="#cb47-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-242"><a href="#cb47-242" aria-hidden="true" tabindex="-1"></a>Usage examples:</span>
<span id="cb47-243"><a href="#cb47-243" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-244"><a href="#cb47-244" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive dependency checking (development)</span></span>
<span id="cb47-245"><a href="#cb47-245" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R</span>
<span id="cb47-246"><a href="#cb47-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-247"><a href="#cb47-247" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto-fix dependency issues</span></span>
<span id="cb47-248"><a href="#cb47-248" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span></span>
<span id="cb47-249"><a href="#cb47-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-250"><a href="#cb47-250" aria-hidden="true" tabindex="-1"></a><span class="co"># CI/CD validation with fail-fast</span></span>
<span id="cb47-251"><a href="#cb47-251" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span> <span class="at">--fail-on-issues</span> <span class="at">--quiet</span></span>
<span id="cb47-252"><a href="#cb47-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-253"><a href="#cb47-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Via Make targets (recommended)</span></span>
<span id="cb47-254"><a href="#cb47-254" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv          <span class="co"># Check dependencies</span></span>
<span id="cb47-255"><a href="#cb47-255" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-fix      <span class="co"># Fix dependency issues</span></span>
<span id="cb47-256"><a href="#cb47-256" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check-renv-fix  <span class="co"># Fix in container</span></span>
<span id="cb47-257"><a href="#cb47-257" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-258"><a href="#cb47-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-259"><a href="#cb47-259" aria-hidden="true" tabindex="-1"></a>This approach ensures collaborators can reliably reproduce package environments and CI/CD pipelines have all necessary dependency information.</span>
<span id="cb47-260"><a href="#cb47-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-261"><a href="#cb47-261" aria-hidden="true" tabindex="-1"></a><span class="fu">## Research Compendium Structure</span></span>
<span id="cb47-262"><a href="#cb47-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-263"><a href="#cb47-263" aria-hidden="true" tabindex="-1"></a>The zzrrtools setup creates a directory structure that follows research compendium best practices. The structure includes organized data folders, analysis directories, testing frameworks, and workflows.</span>
<span id="cb47-264"><a href="#cb47-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-265"><a href="#cb47-265" aria-hidden="true" tabindex="-1"></a>**Key organizational principles:**</span>
<span id="cb47-266"><a href="#cb47-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-267"><a href="#cb47-267" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Data management**: Separate folders for raw, derived, and external data with proper documentation</span>
<span id="cb47-268"><a href="#cb47-268" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Analysis workflow**: Dedicated spaces for papers, figures, tables, and working scripts  </span>
<span id="cb47-269"><a href="#cb47-269" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Package structure**: R package organization with documentation and testing</span>
<span id="cb47-270"><a href="#cb47-270" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Integration support**: Works with Docker, GitHub Actions, and build systems</span>
<span id="cb47-271"><a href="#cb47-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-272"><a href="#cb47-272" aria-hidden="true" tabindex="-1"></a>This organizational framework provides the foundation for reproducible research while supporting team collaboration and automated workflows.</span>
<span id="cb47-273"><a href="#cb47-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-274"><a href="#cb47-274" aria-hidden="true" tabindex="-1"></a><span class="fu">## Iterative Development Workflow</span></span>
<span id="cb47-275"><a href="#cb47-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-276"><a href="#cb47-276" aria-hidden="true" tabindex="-1"></a>For collaborative analysis development, the research compendium structure supports a phased approach that balances rapid iteration with publication-quality outputs:</span>
<span id="cb47-277"><a href="#cb47-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-278"><a href="#cb47-278" aria-hidden="true" tabindex="-1"></a><span class="fu">### Phase 1: Exploration &amp; Development (`scripts/`)</span></span>
<span id="cb47-279"><a href="#cb47-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-280"><a href="#cb47-280" aria-hidden="true" tabindex="-1"></a>During active analysis development, team members should work primarily in the <span class="in">`scripts/`</span> directory:</span>
<span id="cb47-281"><a href="#cb47-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-282"><a href="#cb47-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-283"><a href="#cb47-283" aria-hidden="true" tabindex="-1"></a><span class="in">scripts/</span></span>
<span id="cb47-284"><a href="#cb47-284" aria-hidden="true" tabindex="-1"></a><span class="in">├── 01_data_exploration.R</span></span>
<span id="cb47-285"><a href="#cb47-285" aria-hidden="true" tabindex="-1"></a><span class="in">├── 02_penguin_correlations.R  </span></span>
<span id="cb47-286"><a href="#cb47-286" aria-hidden="true" tabindex="-1"></a><span class="in">├── 03_species_analysis.R</span></span>
<span id="cb47-287"><a href="#cb47-287" aria-hidden="true" tabindex="-1"></a><span class="in">├── 04_body_mass_analysis.R    # Additional analysis</span></span>
<span id="cb47-288"><a href="#cb47-288" aria-hidden="true" tabindex="-1"></a><span class="in">└── 05_visualization_experiments.R</span></span>
<span id="cb47-289"><a href="#cb47-289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-290"><a href="#cb47-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-291"><a href="#cb47-291" aria-hidden="true" tabindex="-1"></a>**Benefits of script-based development:**</span>
<span id="cb47-292"><a href="#cb47-292" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Fast iteration**: No need to knit/render documents during development</span>
<span id="cb47-293"><a href="#cb47-293" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Interactive debugging**: Can run code line-by-line in R console</span>
<span id="cb47-294"><a href="#cb47-294" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Version control friendly**: Pure R files produce clean diffs in Git</span>
<span id="cb47-295"><a href="#cb47-295" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Easy collaboration**: Contributors can add numbered script files</span>
<span id="cb47-296"><a href="#cb47-296" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Flexible experimentation**: Quick to test ideas and approaches</span>
<span id="cb47-297"><a href="#cb47-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-298"><a href="#cb47-298" aria-hidden="true" tabindex="-1"></a><span class="fu">### Phase 2: Function Extraction (`R/`)</span></span>
<span id="cb47-299"><a href="#cb47-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-300"><a href="#cb47-300" aria-hidden="true" tabindex="-1"></a>As analysis patterns emerge, extract reusable functions to the <span class="in">`R/`</span> directory:</span>
<span id="cb47-301"><a href="#cb47-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-302"><a href="#cb47-302" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb47-303"><a href="#cb47-303" aria-hidden="true" tabindex="-1"></a><span class="co"># R/penguin_utils.R</span></span>
<span id="cb47-304"><a href="#cb47-304" aria-hidden="true" tabindex="-1"></a>calculate_species_correlation <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_var, y_var, </span>
<span id="cb47-305"><a href="#cb47-305" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">species_filter =</span> <span class="cn">NULL</span>) {</span>
<span id="cb47-306"><a href="#cb47-306" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reusable function extracted from scripts</span></span>
<span id="cb47-307"><a href="#cb47-307" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(species_filter)) {</span>
<span id="cb47-308"><a href="#cb47-308" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data[data<span class="sc">$</span>species <span class="sc">==</span> species_filter, ]</span>
<span id="cb47-309"><a href="#cb47-309" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-310"><a href="#cb47-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(data[[x_var]], data[[y_var]], <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb47-311"><a href="#cb47-311" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-312"><a href="#cb47-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-313"><a href="#cb47-313" aria-hidden="true" tabindex="-1"></a>create_species_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_var, y_var) {</span>
<span id="cb47-314"><a href="#cb47-314" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standardized plotting function</span></span>
<span id="cb47-315"><a href="#cb47-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes_string</span>(<span class="at">x =</span> x_var, <span class="at">y =</span> y_var, </span>
<span id="cb47-316"><a href="#cb47-316" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> <span class="st">"species"</span>)) <span class="sc">+</span></span>
<span id="cb47-317"><a href="#cb47-317" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb47-318"><a href="#cb47-318" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb47-319"><a href="#cb47-319" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-320"><a href="#cb47-320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-321"><a href="#cb47-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-322"><a href="#cb47-322" aria-hidden="true" tabindex="-1"></a><span class="fu">### Phase 3: Publication Integration (`analysis/paper/`)</span></span>
<span id="cb47-323"><a href="#cb47-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-324"><a href="#cb47-324" aria-hidden="true" tabindex="-1"></a>Once analysis approaches stabilize, integrate polished results into the manuscript:</span>
<span id="cb47-325"><a href="#cb47-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-326"><a href="#cb47-326" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb47-327"><a href="#cb47-327" aria-hidden="true" tabindex="-1"></a><span class="co"># In analysis/paper/paper.Rmd</span></span>
<span id="cb47-328"><a href="#cb47-328" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: Source complete scripts</span></span>
<span id="cb47-329"><a href="#cb47-329" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../scripts/02_penguin_correlations.R"</span>)</span>
<span id="cb47-330"><a href="#cb47-330" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../scripts/04_body_mass_analysis.R"</span>)</span>
<span id="cb47-331"><a href="#cb47-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-332"><a href="#cb47-332" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: Use extracted functions</span></span>
<span id="cb47-333"><a href="#cb47-333" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb47-334"><a href="#cb47-334" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"penguin_utils.R"</span>))</span>
<span id="cb47-335"><a href="#cb47-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-336"><a href="#cb47-336" aria-hidden="true" tabindex="-1"></a>correlation_result <span class="ot">&lt;-</span> <span class="fu">calculate_species_correlation</span>(</span>
<span id="cb47-337"><a href="#cb47-337" aria-hidden="true" tabindex="-1"></a>  penguins, <span class="st">"flipper_length_mm"</span>, <span class="st">"bill_length_mm"</span></span>
<span id="cb47-338"><a href="#cb47-338" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-339"><a href="#cb47-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-340"><a href="#cb47-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-341"><a href="#cb47-341" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recommended Collaborative Workflow:</span></span>
<span id="cb47-342"><a href="#cb47-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-343"><a href="#cb47-343" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Project initialization**: Project maintainer runs <span class="in">`zzrrtools.sh`</span> to create project structure</span>
<span id="cb47-344"><a href="#cb47-344" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Immediate containerization**: Build Docker container and switch to container-based development from day one</span>
<span id="cb47-345"><a href="#cb47-345" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Initial development**: Create exploratory scripts in `scripts/` directory **inside the container**</span>
<span id="cb47-346"><a href="#cb47-346" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Collaborative iteration**: Team members clone repo, build identical container, add additional script files through pull requests **from within the container**</span>
<span id="cb47-347"><a href="#cb47-347" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Code review in scripts**: Both developers refine analysis logic in script files while working in identical Docker environments</span>
<span id="cb47-348"><a href="#cb47-348" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Function extraction**: Move stable, reusable code to <span class="in">`R/`</span> directory</span>
<span id="cb47-349"><a href="#cb47-349" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>**Paper integration**: Source scripts or use functions in <span class="in">`analysis/paper/paper.Rmd`</span></span>
<span id="cb47-350"><a href="#cb47-350" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>**Continuous validation**: All development and testing occurs within the containerized environment</span>
<span id="cb47-351"><a href="#cb47-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-352"><a href="#cb47-352" aria-hidden="true" tabindex="-1"></a>**Why this container-first approach works:**</span>
<span id="cb47-353"><a href="#cb47-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-354"><a href="#cb47-354" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Reproducibility**: Eliminates "works on my machine" problems from day one</span>
<span id="cb47-355"><a href="#cb47-355" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Identical environments**: All collaborators work in exactly the same computational environment</span>
<span id="cb47-356"><a href="#cb47-356" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**No environment drift**: Cannot occur when everyone develops within containers</span>
<span id="cb47-357"><a href="#cb47-357" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Speed**: Script development is faster than R Markdown knitting</span>
<span id="cb47-358"><a href="#cb47-358" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Modularity**: Each script can focus on a specific analysis aspect</span>
<span id="cb47-359"><a href="#cb47-359" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Testability**: Functions in <span class="in">`R/`</span> can be easily unit tested in the same environment they'll run in production</span>
<span id="cb47-360"><a href="#cb47-360" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Simple collaboration**: Environment setup becomes a one-time <span class="in">`docker build`</span> command for all contributors</span>
<span id="cb47-361"><a href="#cb47-361" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Development-production parity**: The development environment IS the production environment</span>
<span id="cb47-362"><a href="#cb47-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-363"><a href="#cb47-363" aria-hidden="true" tabindex="-1"></a>This container-first, phased approach gives collaborators the speed of script-based development during exploration while maintaining the reproducibility and narrative flow of literate programming for final outputs. Most importantly, it ensures that all development occurs within the exact computational environment that will be used for final analysis and publication.</span>
<span id="cb47-364"><a href="#cb47-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-365"><a href="#cb47-365" aria-hidden="true" tabindex="-1"></a>While zzrrtools establishes the organizational foundation for reproducible research, it relies on consistent R package environments to function effectively across different systems. The directory structure and R package framework created by zzrrtools becomes most useful when combined with precise dependency management. This is where renv becomes essential, providing the package-level consistency that complements zzrrtools' structural approach.</span>
<span id="cb47-366"><a href="#cb47-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-367"><a href="#cb47-367" aria-hidden="true" tabindex="-1"></a><span class="fu"># renv: Package-Level Reproducibility</span></span>
<span id="cb47-368"><a href="#cb47-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-369"><a href="#cb47-369" aria-hidden="true" tabindex="-1"></a><span class="fu">## What is renv?</span></span>
<span id="cb47-370"><a href="#cb47-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-371"><a href="#cb47-371" aria-hidden="true" tabindex="-1"></a>**renv** (Reproducible Environment) is an R package designed to create isolated,</span>
<span id="cb47-372"><a href="#cb47-372" aria-hidden="true" tabindex="-1"></a>project-specific library environments. Instead of relying on a shared</span>
<span id="cb47-373"><a href="#cb47-373" aria-hidden="true" tabindex="-1"></a>system-wide R library that might change over time, renv gives each project its</span>
<span id="cb47-374"><a href="#cb47-374" aria-hidden="true" tabindex="-1"></a>own separate collection of packages with specific versions.</span>
<span id="cb47-375"><a href="#cb47-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-376"><a href="#cb47-376" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Features of renv</span></span>
<span id="cb47-377"><a href="#cb47-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-378"><a href="#cb47-378" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Isolated project library**: renv creates a project-specific library (typically in <span class="in">`renv/library`</span>) containing only the packages used by that project. This isolation ensures that updates or changes to packages in one project won't affect others.</span>
<span id="cb47-379"><a href="#cb47-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-380"><a href="#cb47-380" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Lockfile for dependencies**: When you finish installing or updating packages, <span class="in">`renv::snapshot()`</span> produces a <span class="in">`renv.lock`</span> file - a JSON document listing each package and its exact version and source. This lockfile is designed to be committed to version control and shared.</span>
<span id="cb47-381"><a href="#cb47-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-382"><a href="#cb47-382" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Environment restoration**: On a new machine (or when reproducing past results), <span class="in">`renv::restore()`</span> installs the exact versions of packages specified in the lockfile. This creates an R package environment identical to the one that created the lockfile, provided the same R version is available. The R version is important since critical components of the R system, such as random number generation, and default factor handling policy vary between versions. </span>
<span id="cb47-383"><a href="#cb47-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-384"><a href="#cb47-384" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic renv Workflow</span></span>
<span id="cb47-385"><a href="#cb47-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-386"><a href="#cb47-386" aria-hidden="true" tabindex="-1"></a>The typical workflow with renv involves:</span>
<span id="cb47-387"><a href="#cb47-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-388"><a href="#cb47-388" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb47-389"><a href="#cb47-389" aria-hidden="true" tabindex="-1"></a><span class="co"># One-time installation of renv</span></span>
<span id="cb47-390"><a href="#cb47-390" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"renv"</span>)</span>
<span id="cb47-391"><a href="#cb47-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-392"><a href="#cb47-392" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize renv for the project</span></span>
<span id="cb47-393"><a href="#cb47-393" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">init</span>()  <span class="co"># Creates renv infrastructure</span></span>
<span id="cb47-394"><a href="#cb47-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-395"><a href="#cb47-395" aria-hidden="true" tabindex="-1"></a><span class="co"># Install project-specific packages</span></span>
<span id="cb47-396"><a href="#cb47-396" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb47-397"><a href="#cb47-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-398"><a href="#cb47-398" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the package state to renv.lock</span></span>
<span id="cb47-399"><a href="#cb47-399" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">snapshot</span>()</span>
<span id="cb47-400"><a href="#cb47-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-401"><a href="#cb47-401" aria-hidden="true" tabindex="-1"></a><span class="co"># Later or on another system...</span></span>
<span id="cb47-402"><a href="#cb47-402" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">restore</span>()  <span class="co"># Restore packages from renv.lock</span></span>
<span id="cb47-403"><a href="#cb47-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-404"><a href="#cb47-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-405"><a href="#cb47-405" aria-hidden="true" tabindex="-1"></a>While renv successfully addresses package-level reproducibility by ensuring identical R package versions across environments, even perfect package consistency cannot prevent analyses from failing or producing different results due to variations in R versions, operating systems, or system-level dependencies. A complete reproducibility solution requires addressing these system-level differences, which is where Docker containerization becomes essential.</span>
<span id="cb47-406"><a href="#cb47-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-407"><a href="#cb47-407" aria-hidden="true" tabindex="-1"></a><span class="fu"># Docker: System-Level Reproducibility</span></span>
<span id="cb47-408"><a href="#cb47-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-409"><a href="#cb47-409" aria-hidden="true" tabindex="-1"></a><span class="fu">## What is Docker?</span></span>
<span id="cb47-410"><a href="#cb47-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-411"><a href="#cb47-411" aria-hidden="true" tabindex="-1"></a>Docker is a platform that allows you to package software into standardized units</span>
<span id="cb47-412"><a href="#cb47-412" aria-hidden="true" tabindex="-1"></a>called containers. A Docker container is like a lightweight virtual machine that</span>
<span id="cb47-413"><a href="#cb47-413" aria-hidden="true" tabindex="-1"></a>includes everything needed to run an application: the code, runtime, system</span>
<span id="cb47-414"><a href="#cb47-414" aria-hidden="true" tabindex="-1"></a>tools, libraries, and settings.</span>
<span id="cb47-415"><a href="#cb47-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-416"><a href="#cb47-416" aria-hidden="true" tabindex="-1"></a><span class="fu">## Docker's Role in Reproducibility</span></span>
<span id="cb47-417"><a href="#cb47-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-418"><a href="#cb47-418" aria-hidden="true" tabindex="-1"></a>While renv handles R packages, Docker ensures consistency for:</span>
<span id="cb47-419"><a href="#cb47-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-420"><a href="#cb47-420" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Operating system**: The specific Linux distribution or OS version</span>
<span id="cb47-421"><a href="#cb47-421" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**R interpreter**: The exact R version</span>
<span id="cb47-422"><a href="#cb47-422" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**System libraries**: Required C/C++ libraries and other dependencies</span>
<span id="cb47-423"><a href="#cb47-423" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Computational environment**: Memory limits, CPU configuration, etc.</span>
<span id="cb47-424"><a href="#cb47-424" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**External tools**: pandoc, LaTeX, and other utilities needed for R Markdown</span>
<span id="cb47-425"><a href="#cb47-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-426"><a href="#cb47-426" aria-hidden="true" tabindex="-1"></a>By running an R Markdown project in Docker, you eliminate differences in OS or R</span>
<span id="cb47-427"><a href="#cb47-427" aria-hidden="true" tabindex="-1"></a>installation as potential sources of irreproducibility. Any machine running</span>
<span id="cb47-428"><a href="#cb47-428" aria-hidden="true" tabindex="-1"></a>Docker will execute the container in an identical environment.</span>
<span id="cb47-429"><a href="#cb47-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-430"><a href="#cb47-430" aria-hidden="true" tabindex="-1"></a><span class="fu">## Docker Components for R Workflows</span></span>
<span id="cb47-431"><a href="#cb47-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-432"><a href="#cb47-432" aria-hidden="true" tabindex="-1"></a>For R-based projects, a typical Docker approach involves:</span>
<span id="cb47-433"><a href="#cb47-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-434"><a href="#cb47-434" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Base image**: Starting from a pre-configured R image (e.g., from the Rocker project)</span>
<span id="cb47-435"><a href="#cb47-435" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Dependencies**: Adding system and R package dependencies</span>
<span id="cb47-436"><a href="#cb47-436" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Configuration**: Setting working directories and environment variables</span>
<span id="cb47-437"><a href="#cb47-437" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Content**: Adding project files</span>
<span id="cb47-438"><a href="#cb47-438" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Execution**: Defining how the project should run</span>
<span id="cb47-439"><a href="#cb47-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-440"><a href="#cb47-440" aria-hidden="true" tabindex="-1"></a>The zzrrtools setup uses a streamlined Dockerfile based on rocker/r-ver with</span>
<span id="cb47-441"><a href="#cb47-441" aria-hidden="true" tabindex="-1"></a>TinyTeX for LaTeX support. The R version is matched to the renv.lock</span>
<span id="cb47-442"><a href="#cb47-442" aria-hidden="true" tabindex="-1"></a>file:</span>
<span id="cb47-443"><a href="#cb47-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-444"><a href="#cb47-444" aria-hidden="true" tabindex="-1"></a><span class="in">```dockerfile</span></span>
<span id="cb47-445"><a href="#cb47-445" aria-hidden="true" tabindex="-1"></a><span class="in"># Use R version from renv.lock for perfect consistency</span></span>
<span id="cb47-446"><a href="#cb47-446" aria-hidden="true" tabindex="-1"></a><span class="in">ARG R_VERSION=4.3.0</span></span>
<span id="cb47-447"><a href="#cb47-447" aria-hidden="true" tabindex="-1"></a><span class="in">FROM rocker/r-ver:${R_VERSION}</span></span>
<span id="cb47-448"><a href="#cb47-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-449"><a href="#cb47-449" aria-hidden="true" tabindex="-1"></a><span class="in"># Prevent interactive prompts</span></span>
<span id="cb47-450"><a href="#cb47-450" aria-hidden="true" tabindex="-1"></a><span class="in">ENV DEBIAN_FRONTEND=noninteractive</span></span>
<span id="cb47-451"><a href="#cb47-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-452"><a href="#cb47-452" aria-hidden="true" tabindex="-1"></a><span class="in"># Install minimal system dependencies</span></span>
<span id="cb47-453"><a href="#cb47-453" aria-hidden="true" tabindex="-1"></a><span class="in">RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \</span></span>
<span id="cb47-454"><a href="#cb47-454" aria-hidden="true" tabindex="-1"></a><span class="in">    pandoc \</span></span>
<span id="cb47-455"><a href="#cb47-455" aria-hidden="true" tabindex="-1"></a><span class="in">    vim \</span></span>
<span id="cb47-456"><a href="#cb47-456" aria-hidden="true" tabindex="-1"></a><span class="in">    git \</span></span>
<span id="cb47-457"><a href="#cb47-457" aria-hidden="true" tabindex="-1"></a><span class="in">    curl \</span></span>
<span id="cb47-458"><a href="#cb47-458" aria-hidden="true" tabindex="-1"></a><span class="in">    fonts-dejavu \</span></span>
<span id="cb47-459"><a href="#cb47-459" aria-hidden="true" tabindex="-1"></a><span class="in">    &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span>
<span id="cb47-460"><a href="#cb47-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-461"><a href="#cb47-461" aria-hidden="true" tabindex="-1"></a><span class="in"># Create non-root user</span></span>
<span id="cb47-462"><a href="#cb47-462" aria-hidden="true" tabindex="-1"></a><span class="in">ARG USERNAME=analyst</span></span>
<span id="cb47-463"><a href="#cb47-463" aria-hidden="true" tabindex="-1"></a><span class="in">RUN useradd --create-home --shell /bin/bash ${USERNAME}</span></span>
<span id="cb47-464"><a href="#cb47-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-465"><a href="#cb47-465" aria-hidden="true" tabindex="-1"></a><span class="in"># Set user R library path</span></span>
<span id="cb47-466"><a href="#cb47-466" aria-hidden="true" tabindex="-1"></a><span class="in">ENV R_LIBS_USER=/home/${USERNAME}/R/library</span></span>
<span id="cb47-467"><a href="#cb47-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-468"><a href="#cb47-468" aria-hidden="true" tabindex="-1"></a><span class="in"># Create user R library directory and assign permissions</span></span>
<span id="cb47-469"><a href="#cb47-469" aria-hidden="true" tabindex="-1"></a><span class="in">RUN mkdir -p /home/${USERNAME}/R/library &amp;&amp; \</span></span>
<span id="cb47-470"><a href="#cb47-470" aria-hidden="true" tabindex="-1"></a><span class="in">    chown -R ${USERNAME}:${USERNAME} /home/${USERNAME}/R</span></span>
<span id="cb47-471"><a href="#cb47-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-472"><a href="#cb47-472" aria-hidden="true" tabindex="-1"></a><span class="in"># Set working directory</span></span>
<span id="cb47-473"><a href="#cb47-473" aria-hidden="true" tabindex="-1"></a><span class="in">WORKDIR /home/${USERNAME}</span></span>
<span id="cb47-474"><a href="#cb47-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-475"><a href="#cb47-475" aria-hidden="true" tabindex="-1"></a><span class="in"># Copy renv files with correct ownership</span></span>
<span id="cb47-476"><a href="#cb47-476" aria-hidden="true" tabindex="-1"></a><span class="in">COPY --chown=${USERNAME}:${USERNAME} renv.lock ./</span></span>
<span id="cb47-477"><a href="#cb47-477" aria-hidden="true" tabindex="-1"></a><span class="in">COPY --chown=${USERNAME}:${USERNAME} renv/activate.R ./renv/</span></span>
<span id="cb47-478"><a href="#cb47-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-479"><a href="#cb47-479" aria-hidden="true" tabindex="-1"></a><span class="in"># Switch to non-root user</span></span>
<span id="cb47-480"><a href="#cb47-480" aria-hidden="true" tabindex="-1"></a><span class="in">USER ${USERNAME}</span></span>
<span id="cb47-481"><a href="#cb47-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-482"><a href="#cb47-482" aria-hidden="true" tabindex="-1"></a><span class="in"># Install base R packages to user library</span></span>
<span id="cb47-483"><a href="#cb47-483" aria-hidden="true" tabindex="-1"></a><span class="in">RUN Rscript -e '.libPaths(Sys.getenv("R_LIBS_USER")); \</span></span>
<span id="cb47-484"><a href="#cb47-484" aria-hidden="true" tabindex="-1"></a><span class="in">    install.packages(c("tinytex", "rmarkdown", "renv"), \</span></span>
<span id="cb47-485"><a href="#cb47-485" aria-hidden="true" tabindex="-1"></a><span class="in">    repos = "https://cloud.r-project.org")'</span></span>
<span id="cb47-486"><a href="#cb47-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-487"><a href="#cb47-487" aria-hidden="true" tabindex="-1"></a><span class="in"># Install TinyTeX in user directory</span></span>
<span id="cb47-488"><a href="#cb47-488" aria-hidden="true" tabindex="-1"></a><span class="in">RUN Rscript -e 'tinytex::install_tinytex()'</span></span>
<span id="cb47-489"><a href="#cb47-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-490"><a href="#cb47-490" aria-hidden="true" tabindex="-1"></a><span class="in"># Add TinyTeX binaries to PATH</span></span>
<span id="cb47-491"><a href="#cb47-491" aria-hidden="true" tabindex="-1"></a><span class="in">ENV PATH=/home/${USERNAME}/.TinyTeX/bin/x86_64-linux:$PATH</span></span>
<span id="cb47-492"><a href="#cb47-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-493"><a href="#cb47-493" aria-hidden="true" tabindex="-1"></a><span class="in"># Restore R packages via renv</span></span>
<span id="cb47-494"><a href="#cb47-494" aria-hidden="true" tabindex="-1"></a><span class="in">RUN Rscript -e '.libPaths(Sys.getenv("R_LIBS_USER")); \</span></span>
<span id="cb47-495"><a href="#cb47-495" aria-hidden="true" tabindex="-1"></a><span class="in">    renv::restore()'</span></span>
<span id="cb47-496"><a href="#cb47-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-497"><a href="#cb47-497" aria-hidden="true" tabindex="-1"></a><span class="in"># Default to interactive shell</span></span>
<span id="cb47-498"><a href="#cb47-498" aria-hidden="true" tabindex="-1"></a><span class="in">CMD ["/bin/bash"]</span></span>
<span id="cb47-499"><a href="#cb47-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-500"><a href="#cb47-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-501"><a href="#cb47-501" aria-hidden="true" tabindex="-1"></a>This configuration provides a minimal R installation with LaTeX support for PDF rendering and secure non-root user execution.</span>
<span id="cb47-502"><a href="#cb47-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-503"><a href="#cb47-503" aria-hidden="true" tabindex="-1"></a>**Docker Compose Integration:**</span>
<span id="cb47-504"><a href="#cb47-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-505"><a href="#cb47-505" aria-hidden="true" tabindex="-1"></a>The setup also includes a docker-compose.yml that provides multiple development environments:</span>
<span id="cb47-506"><a href="#cb47-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-507"><a href="#cb47-507" aria-hidden="true" tabindex="-1"></a><span class="in">```yaml</span></span>
<span id="cb47-508"><a href="#cb47-508" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple services for different workflows</span></span>
<span id="cb47-509"><a href="#cb47-509" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb47-510"><a href="#cb47-510" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">r-session</span><span class="kw">:</span><span class="co">   # Interactive R session  </span></span>
<span id="cb47-511"><a href="#cb47-511" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bash</span><span class="kw">:</span><span class="co">        # Bash shell access</span></span>
<span id="cb47-512"><a href="#cb47-512" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">research</span><span class="kw">:</span><span class="co">    # Automated paper rendering</span></span>
<span id="cb47-513"><a href="#cb47-513" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">test</span><span class="kw">:</span><span class="co">        # Package testing</span></span>
<span id="cb47-514"><a href="#cb47-514" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">check</span><span class="kw">:</span><span class="co">       # Package checking</span></span>
<span id="cb47-515"><a href="#cb47-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-516"><a href="#cb47-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-517"><a href="#cb47-517" aria-hidden="true" tabindex="-1"></a>This allows developers to choose their preferred development environment while maintaining identical package dependencies and system configuration.</span>
<span id="cb47-518"><a href="#cb47-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-519"><a href="#cb47-519" aria-hidden="true" tabindex="-1"></a><span class="fu"># Combining zzrrtools, renv, and Docker: A Comprehensive Approach</span></span>
<span id="cb47-520"><a href="#cb47-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-521"><a href="#cb47-521" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why Use All Three?</span></span>
<span id="cb47-522"><a href="#cb47-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-523"><a href="#cb47-523" aria-hidden="true" tabindex="-1"></a>Using any single tool improves reproducibility, but combining all three provides the most complete solution:</span>
<span id="cb47-524"><a href="#cb47-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-525"><a href="#cb47-525" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**zzrrtools** provides standardized project structure and research compendium organization</span>
<span id="cb47-526"><a href="#cb47-526" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**renv** guarantees the R packages and their versions</span>
<span id="cb47-527"><a href="#cb47-527" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Docker** guarantees the OS and R version</span>
<span id="cb47-528"><a href="#cb47-528" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Together** they achieve end-to-end reproducibility from project organization through package dependencies to operating system consistency</span>
<span id="cb47-529"><a href="#cb47-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-530"><a href="#cb47-530" aria-hidden="true" tabindex="-1"></a>This approach creates a fully portable, well-organized research compendium that can be shared and will produce identical results across different computers while following established research best practices.</span>
<span id="cb47-531"><a href="#cb47-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-532"><a href="#cb47-532" aria-hidden="true" tabindex="-1"></a><span class="fu">## Integration Strategy with Governance Model</span></span>
<span id="cb47-533"><a href="#cb47-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-534"><a href="#cb47-534" aria-hidden="true" tabindex="-1"></a>The workflow integrates zzrrtools, renv, and Docker with a clear governance structure suitable for multi-developer research teams:</span>
<span id="cb47-535"><a href="#cb47-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-536"><a href="#cb47-536" aria-hidden="true" tabindex="-1"></a>**Project Maintainer Role:**</span>
<span id="cb47-537"><a href="#cb47-537" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Creates and maintains the research compendium structure</span>
<span id="cb47-538"><a href="#cb47-538" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Manages renv environment and package dependencies using consistency checking</span>
<span id="cb47-539"><a href="#cb47-539" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Updates and maintains Docker images</span>
<span id="cb47-540"><a href="#cb47-540" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reviews and approves contributor changes</span>
<span id="cb47-541"><a href="#cb47-541" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Runs renv validation before accepting pull requests</span>
<span id="cb47-542"><a href="#cb47-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-543"><a href="#cb47-543" aria-hidden="true" tabindex="-1"></a>**Contributor Role (Other Developers)**:</span>
<span id="cb47-544"><a href="#cb47-544" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Access the private research compendium as invited collaborators</span>
<span id="cb47-545"><a href="#cb47-545" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add analysis content, papers, and documentation using feature branches</span>
<span id="cb47-546"><a href="#cb47-546" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Propose new package dependencies through contributions</span>
<span id="cb47-547"><a href="#cb47-547" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Submit changes via pull requests from feature branches</span>
<span id="cb47-548"><a href="#cb47-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-549"><a href="#cb47-549" aria-hidden="true" tabindex="-1"></a>**Workflow Steps**:</span>
<span id="cb47-550"><a href="#cb47-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-551"><a href="#cb47-551" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Initialize Research Compendium (Maintainer)**: </span>
<span id="cb47-552"><a href="#cb47-552" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Create standardized project structure using zzrrtools framework</span>
<span id="cb47-553"><a href="#cb47-553" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Set up analysis directories with data organization</span>
<span id="cb47-554"><a href="#cb47-554" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Initialize renv environment with <span class="in">`renv::init()`</span></span>
<span id="cb47-555"><a href="#cb47-555" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Create Dockerfile with container configuration</span>
<span id="cb47-556"><a href="#cb47-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-557"><a href="#cb47-557" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Establish Development Environment (Maintainer)**: </span>
<span id="cb47-558"><a href="#cb47-558" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Install required packages and develop initial analysis</span>
<span id="cb47-559"><a href="#cb47-559" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Create tests for analytical functions</span>
<span id="cb47-560"><a href="#cb47-560" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Use the renv consistency checker to validate and create initial lockfile:</span>
<span id="cb47-561"><a href="#cb47-561" aria-hidden="true" tabindex="-1"></a>     <span class="in">```bash</span></span>
<span id="cb47-562"><a href="#cb47-562" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Validate dependencies and create snapshot</span></span>
<span id="cb47-563"><a href="#cb47-563" aria-hidden="true" tabindex="-1"></a>     <span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span></span>
<span id="cb47-564"><a href="#cb47-564" aria-hidden="true" tabindex="-1"></a>     <span class="in">```</span></span>
<span id="cb47-565"><a href="#cb47-565" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Build and test Docker image locally</span>
<span id="cb47-566"><a href="#cb47-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-567"><a href="#cb47-567" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Maintain Infrastructure (Maintainer)**: </span>
<span id="cb47-568"><a href="#cb47-568" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Review contributor pull requests for package additions</span>
<span id="cb47-569"><a href="#cb47-569" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Use renv consistency checker to validate and update dependencies:</span>
<span id="cb47-570"><a href="#cb47-570" aria-hidden="true" tabindex="-1"></a>     <span class="in">```bash</span></span>
<span id="cb47-571"><a href="#cb47-571" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Validate contributor's package requirements</span></span>
<span id="cb47-572"><a href="#cb47-572" aria-hidden="true" tabindex="-1"></a>     <span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fail-on-issues</span></span>
<span id="cb47-573"><a href="#cb47-573" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb47-574"><a href="#cb47-574" aria-hidden="true" tabindex="-1"></a>     <span class="co"># If validation passes, update environment</span></span>
<span id="cb47-575"><a href="#cb47-575" aria-hidden="true" tabindex="-1"></a>     <span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span></span>
<span id="cb47-576"><a href="#cb47-576" aria-hidden="true" tabindex="-1"></a>     <span class="in">```</span></span>
<span id="cb47-577"><a href="#cb47-577" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Update <span class="in">`renv.lock`</span> by selectively incorporating new dependencies</span>
<span id="cb47-578"><a href="#cb47-578" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Rebuild Docker images when system dependencies change</span>
<span id="cb47-579"><a href="#cb47-579" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Push updated images to container registry (Docker Hub, GitHub Container Registry)</span>
<span id="cb47-580"><a href="#cb47-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-581"><a href="#cb47-581" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Collaborative Development (All Developers)**: </span>
<span id="cb47-582"><a href="#cb47-582" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-583"><a href="#cb47-583" aria-hidden="true" tabindex="-1"></a>   **Research Compendium Files in GitHub Repository:**</span>
<span id="cb47-584"><a href="#cb47-584" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Project Structure**: <span class="in">`DESCRIPTION`</span>, <span class="in">`LICENSE`</span>, <span class="in">`README.qmd`</span> (zzrrtools-generated)</span>
<span id="cb47-585"><a href="#cb47-585" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Analysis Content**: Files in <span class="in">`analysis/paper/`</span> directory (R Markdown manuscripts)</span>
<span id="cb47-586"><a href="#cb47-586" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Dependencies**: <span class="in">`renv.lock`</span> (managed by maintainer), <span class="in">`renv/activate.R`</span></span>
<span id="cb47-587"><a href="#cb47-587" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Infrastructure**: <span class="in">`Dockerfile`</span> (maintained by project maintainer)</span>
<span id="cb47-588"><a href="#cb47-588" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Code**: <span class="in">`R/`</span> directory (utility functions), <span class="in">`tests/`</span> directory</span>
<span id="cb47-589"><a href="#cb47-589" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Documentation**: Generated README files and project documentation</span>
<span id="cb47-590"><a href="#cb47-590" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Configuration**: <span class="in">`.gitignore`</span>, <span class="in">`.github/`</span> (CI/CD workflows)</span>
<span id="cb47-591"><a href="#cb47-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-592"><a href="#cb47-592" aria-hidden="true" tabindex="-1"></a>   **Sharing the Docker image using Docker Hub:**</span>
<span id="cb47-593"><a href="#cb47-593" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-594"><a href="#cb47-594" aria-hidden="true" tabindex="-1"></a>   Docker Hub provides public image hosting that enables reproducible research by sharing computational environments while protecting private research code in GitHub.</span>
<span id="cb47-595"><a href="#cb47-595" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-596"><a href="#cb47-596" aria-hidden="true" tabindex="-1"></a>   **Docker Hub (Recommended for Reproducible Research)**</span>
<span id="cb47-597"><a href="#cb47-597" aria-hidden="true" tabindex="-1"></a>   <span class="in">```bash</span></span>
<span id="cb47-598"><a href="#cb47-598" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Build the image with GitHub Container Registry URL</span></span>
<span id="cb47-599"><a href="#cb47-599" aria-hidden="true" tabindex="-1"></a>   <span class="ex">docker</span> build <span class="at">-t</span> ghcr.io/username/penguins_analysis:v1.0 .</span>
<span id="cb47-600"><a href="#cb47-600" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-601"><a href="#cb47-601" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Login to GitHub Container Registry (using GitHub Personal Access Token)</span></span>
<span id="cb47-602"><a href="#cb47-602" aria-hidden="true" tabindex="-1"></a>   <span class="bu">echo</span> <span class="va">$GITHUB_TOKEN</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="at">-u</span> username <span class="dt">\</span></span>
<span id="cb47-603"><a href="#cb47-603" aria-hidden="true" tabindex="-1"></a>     <span class="at">--password-stdin</span></span>
<span id="cb47-604"><a href="#cb47-604" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-605"><a href="#cb47-605" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Push to GitHub Container Registry (automatically private)</span></span>
<span id="cb47-606"><a href="#cb47-606" aria-hidden="true" tabindex="-1"></a>   <span class="ex">docker</span> push ghcr.io/username/penguins_analysis:v1.0</span>
<span id="cb47-607"><a href="#cb47-607" aria-hidden="true" tabindex="-1"></a>   <span class="in">```</span></span>
<span id="cb47-608"><a href="#cb47-608" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-609"><a href="#cb47-609" aria-hidden="true" tabindex="-1"></a>   **Setting up GitHub Personal Access Token:**</span>
<span id="cb47-610"><a href="#cb47-610" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-611"><a href="#cb47-611" aria-hidden="true" tabindex="-1"></a>   Create a Personal Access Token with the required permissions for container registry operations. The token must include <span class="in">`write:packages`</span> and <span class="in">`read:packages`</span> scopes, plus <span class="in">`repo`</span> access for private repositories.</span>
<span id="cb47-612"><a href="#cb47-612" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-613"><a href="#cb47-613" aria-hidden="true" tabindex="-1"></a>   **For detailed step-by-step instructions, see Appendix A: GitHub Personal Access Token Setup.**</span>
<span id="cb47-614"><a href="#cb47-614" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-615"><a href="#cb47-615" aria-hidden="true" tabindex="-1"></a>   <span class="in">```bash</span></span>
<span id="cb47-616"><a href="#cb47-616" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Export token as environment variable (replace with your actual token)</span></span>
<span id="cb47-617"><a href="#cb47-617" aria-hidden="true" tabindex="-1"></a>   <span class="bu">export</span> <span class="va">GITHUB_TOKEN</span><span class="op">=</span>ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
<span id="cb47-618"><a href="#cb47-618" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-619"><a href="#cb47-619" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Login and push</span></span>
<span id="cb47-620"><a href="#cb47-620" aria-hidden="true" tabindex="-1"></a>   <span class="bu">echo</span> <span class="va">$GITHUB_TOKEN</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="at">-u</span> username <span class="dt">\</span></span>
<span id="cb47-621"><a href="#cb47-621" aria-hidden="true" tabindex="-1"></a>     <span class="at">--password-stdin</span></span>
<span id="cb47-622"><a href="#cb47-622" aria-hidden="true" tabindex="-1"></a>   <span class="ex">docker</span> build <span class="at">-t</span> ghcr.io/username/penguins_analysis:v1.0 .</span>
<span id="cb47-623"><a href="#cb47-623" aria-hidden="true" tabindex="-1"></a>   <span class="ex">docker</span> push ghcr.io/username/penguins_analysis:v1.0</span>
<span id="cb47-624"><a href="#cb47-624" aria-hidden="true" tabindex="-1"></a>   <span class="in">```</span></span>
<span id="cb47-625"><a href="#cb47-625" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-626"><a href="#cb47-626" aria-hidden="true" tabindex="-1"></a>   **Note**: If you get a "permission_denied" error when pushing, ensure your token includes the correct scopes (see Appendix A for details).</span>
<span id="cb47-627"><a href="#cb47-627" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-628"><a href="#cb47-628" aria-hidden="true" tabindex="-1"></a>   **GitHub Container Registry Benefits:**</span>
<span id="cb47-629"><a href="#cb47-629" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-630"><a href="#cb47-630" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Free tier**: 0.5GB storage included, no billing currently active</span>
<span id="cb47-631"><a href="#cb47-631" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Automatic access control**: Inherits repository permissions</span>
<span id="cb47-632"><a href="#cb47-632" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Integrated with GitHub Actions**: Direct authentication in CI/CD</span>
<span id="cb47-633"><a href="#cb47-633" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Simple team sharing**: Repository collaborators automatically have access</span>
<span id="cb47-634"><a href="#cb47-634" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Package management**: Integrated with GitHub Packages ecosystem</span>
<span id="cb47-635"><a href="#cb47-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-636"><a href="#cb47-636" aria-hidden="true" tabindex="-1"></a>   **Docker Workflow:**</span>
<span id="cb47-637"><a href="#cb47-637" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-638"><a href="#cb47-638" aria-hidden="true" tabindex="-1"></a>   The zzrrtools setup provides multiple approaches for working with containers, from simple Make commands to direct Docker execution. Make commands offer simplicity:</span>
<span id="cb47-639"><a href="#cb47-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-640"><a href="#cb47-640" aria-hidden="true" tabindex="-1"></a>   <span class="in">```bash</span></span>
<span id="cb47-641"><a href="#cb47-641" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Build and run with Make (recommended)</span></span>
<span id="cb47-642"><a href="#cb47-642" aria-hidden="true" tabindex="-1"></a>   <span class="fu">make</span> docker-build    <span class="co"># Build the container</span></span>
<span id="cb47-643"><a href="#cb47-643" aria-hidden="true" tabindex="-1"></a>   <span class="fu">make</span> docker-r        <span class="co"># Interactive R session</span></span>
<span id="cb47-644"><a href="#cb47-644" aria-hidden="true" tabindex="-1"></a>   <span class="fu">make</span> docker-render   <span class="co"># Render research paper</span></span>
<span id="cb47-645"><a href="#cb47-645" aria-hidden="true" tabindex="-1"></a>   <span class="in">```</span></span>
<span id="cb47-646"><a href="#cb47-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-647"><a href="#cb47-647" aria-hidden="true" tabindex="-1"></a>   **For Docker workflow options including Docker Compose and direct commands, see Appendix D: Docker Workflow Options.**</span>
<span id="cb47-648"><a href="#cb47-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-649"><a href="#cb47-649" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Execute consistently**: </span>
<span id="cb47-650"><a href="#cb47-650" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Run analyses in the Docker container for guaranteed reproducibility</span>
<span id="cb47-651"><a href="#cb47-651" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Use volume mounts to access local files while maintaining environment consistency</span>
<span id="cb47-652"><a href="#cb47-652" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Run tests within the container to verify functionality</span>
<span id="cb47-653"><a href="#cb47-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-654"><a href="#cb47-654" aria-hidden="true" tabindex="-1"></a>This strategy ensures that your R Markdown documents and analyses will run identically for anyone who has access to your Docker container, regardless of their local setup.</span>
<span id="cb47-655"><a href="#cb47-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-656"><a href="#cb47-656" aria-hidden="true" tabindex="-1"></a><span class="fu"># Practical Example: Collaborative Research Compendium Development with Testing</span></span>
<span id="cb47-657"><a href="#cb47-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-658"><a href="#cb47-658" aria-hidden="true" tabindex="-1"></a>The following case study demonstrates how two developers can collaborate on a</span>
<span id="cb47-659"><a href="#cb47-659" aria-hidden="true" tabindex="-1"></a>research compendium using zzrrtools, renv, and Docker to ensure reproducibility, with</span>
<span id="cb47-660"><a href="#cb47-660" aria-hidden="true" tabindex="-1"></a>integrated testing procedures to maintain code quality.</span>
<span id="cb47-661"><a href="#cb47-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-662"><a href="#cb47-662" aria-hidden="true" tabindex="-1"></a><span class="fu">## Project Scenario</span></span>
<span id="cb47-663"><a href="#cb47-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-664"><a href="#cb47-664" aria-hidden="true" tabindex="-1"></a>A team of data scientists collaborates on Palmer Penguins analysis using </span>
<span id="cb47-665"><a href="#cb47-665" aria-hidden="true" tabindex="-1"></a>zzrrtools' Docker-first workflow that eliminates environment setup friction:</span>
<span id="cb47-666"><a href="#cb47-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-667"><a href="#cb47-667" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Joe** (<span class="in">`joe`</span>): Project maintainer who initializes the repository</span>
<span id="cb47-668"><a href="#cb47-668" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sam** (<span class="in">`sam`</span>): Contributor who extends the analysis  </span>
<span id="cb47-669"><a href="#cb47-669" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Additional team members**: Can join without any local R installation</span>
<span id="cb47-670"><a href="#cb47-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-671"><a href="#cb47-671" aria-hidden="true" tabindex="-1"></a>The collaboration model emphasizes **zero-setup team onboarding** through </span>
<span id="cb47-672"><a href="#cb47-672" aria-hidden="true" tabindex="-1"></a>self-replicating project distribution and containerized development environments.</span>
<span id="cb47-673"><a href="#cb47-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-674"><a href="#cb47-674" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **Collaboration Philosophy**: </span></span>
<span id="cb47-675"><a href="#cb47-675" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; - **Self-contained projects**: Each repository includes its own setup script</span></span>
<span id="cb47-676"><a href="#cb47-676" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; - **Container-first development**: All work happens in identical Docker environments</span></span>
<span id="cb47-677"><a href="#cb47-677" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; - **Automated dependency validation**: Pre-commit checks prevent conflicts</span></span>
<span id="cb47-678"><a href="#cb47-678" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; - **Shell-based workflows**: Command-line tools for maximum flexibility</span></span>
<span id="cb47-679"><a href="#cb47-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-680"><a href="#cb47-680" aria-hidden="true" tabindex="-1"></a>**Key Workflow Principles:**</span>
<span id="cb47-681"><a href="#cb47-681" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Joe initializes with zzrrtools and commits the setup script to the repository</span>
<span id="cb47-682"><a href="#cb47-682" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Team members run the included script - no separate installation required</span>
<span id="cb47-683"><a href="#cb47-683" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All development occurs in containers for perfect environment consistency</span>
<span id="cb47-684"><a href="#cb47-684" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dependency changes are validated before commits to prevent team conflicts</span>
<span id="cb47-685"><a href="#cb47-685" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Each developer works in identical environments regardless of host system</span>
<span id="cb47-686"><a href="#cb47-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-687"><a href="#cb47-687" aria-hidden="true" tabindex="-1"></a><span class="fu">## Implementation Example</span></span>
<span id="cb47-688"><a href="#cb47-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-689"><a href="#cb47-689" aria-hidden="true" tabindex="-1"></a><span class="fu">### Project Maintainer Setup (Joe)</span></span>
<span id="cb47-690"><a href="#cb47-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-691"><a href="#cb47-691" aria-hidden="true" tabindex="-1"></a>Joe initializes a private GitHub repository and creates the containerized research environment:</span>
<span id="cb47-692"><a href="#cb47-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-693"><a href="#cb47-693" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-694"><a href="#cb47-694" aria-hidden="true" tabindex="-1"></a><span class="co"># Create repository and initialize zzrrtools</span></span>
<span id="cb47-695"><a href="#cb47-695" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/joe/penguins_analysis.git</span>
<span id="cb47-696"><a href="#cb47-696" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> penguins_analysis</span>
<span id="cb47-697"><a href="#cb47-697" aria-hidden="true" tabindex="-1"></a><span class="ex">~/prj/zzrrtools/zzrrtools.sh</span> <span class="at">--dotfiles</span> ~/.config/shell <span class="dt">\</span></span>
<span id="cb47-698"><a href="#cb47-698" aria-hidden="true" tabindex="-1"></a>                             <span class="at">--base-image</span> rgt47/r-pluspackages</span>
<span id="cb47-699"><a href="#cb47-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-700"><a href="#cb47-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-701"><a href="#cb47-701" aria-hidden="true" tabindex="-1"></a>This creates:</span>
<span id="cb47-702"><a href="#cb47-702" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Research compendium directory structure</span>
<span id="cb47-703"><a href="#cb47-703" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Docker container configuration</span>
<span id="cb47-704"><a href="#cb47-704" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>renv dependency management</span>
<span id="cb47-705"><a href="#cb47-705" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Automated validation scripts</span>
<span id="cb47-706"><a href="#cb47-706" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>GitHub Actions workflows</span>
<span id="cb47-707"><a href="#cb47-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-708"><a href="#cb47-708" aria-hidden="true" tabindex="-1"></a>**For a detailed view of the complete directory structure created by zzrrtools, see Appendix C: Directory Structure.**</span>
<span id="cb47-709"><a href="#cb47-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-710"><a href="#cb47-710" aria-hidden="true" tabindex="-1"></a>Joe completes the setup and begins development:</span>
<span id="cb47-711"><a href="#cb47-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-712"><a href="#cb47-712" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-713"><a href="#cb47-713" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate dependencies and build container</span></span>
<span id="cb47-714"><a href="#cb47-714" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv</span>
<span id="cb47-715"><a href="#cb47-715" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build</span>
<span id="cb47-716"><a href="#cb47-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-717"><a href="#cb47-717" aria-hidden="true" tabindex="-1"></a><span class="co"># Start container-based development</span></span>
<span id="cb47-718"><a href="#cb47-718" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r</span>
<span id="cb47-719"><a href="#cb47-719" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-720"><a href="#cb47-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-721"><a href="#cb47-721" aria-hidden="true" tabindex="-1"></a>**For detailed information on renv dependency validation, troubleshooting, and team collaboration workflows, see Appendix G: renv Management and Validation.**</span>
<span id="cb47-722"><a href="#cb47-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-723"><a href="#cb47-723" aria-hidden="true" tabindex="-1"></a>The validation script ensures package environment consistency by verifying dependencies across code files, DESCRIPTION, and renv.lock, preventing common collaboration issues where team members have mismatched environments.</span>
<span id="cb47-724"><a href="#cb47-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-725"><a href="#cb47-725" aria-hidden="true" tabindex="-1"></a>**Step 4: Create Initial Analysis Paper**</span>
<span id="cb47-726"><a href="#cb47-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-727"><a href="#cb47-727" aria-hidden="true" tabindex="-1"></a>Joe creates an initial analysis examining flipper length vs. bill length relationships in the Palmer Penguins dataset, implementing basic visualization and statistical exploration within the research compendium structure.</span>
<span id="cb47-728"><a href="#cb47-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-729"><a href="#cb47-729" aria-hidden="true" tabindex="-1"></a>**Step 5: Create Tests for Analysis Functions**</span>
<span id="cb47-730"><a href="#cb47-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-731"><a href="#cb47-731" aria-hidden="true" tabindex="-1"></a>Joe implements testing to ensure reproducible research through data validation, error detection, and environment verification. Testing provides collaboration confidence and supports publication standards by validating data integrity, statistical relationships, and pipeline functionality.</span>
<span id="cb47-732"><a href="#cb47-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-733"><a href="#cb47-733" aria-hidden="true" tabindex="-1"></a>Joe sets up the testing framework and creates basic data validation tests to verify dataset availability, dimensions, and required columns. These tests ensure the analysis environment is correctly configured and catch data-related issues early in the development process.</span>
<span id="cb47-734"><a href="#cb47-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-735"><a href="#cb47-735" aria-hidden="true" tabindex="-1"></a>**For a complete test suite with data validation, statistical tests, and integration tests, see Appendix B: Test Suite.**</span>
<span id="cb47-736"><a href="#cb47-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-737"><a href="#cb47-737" aria-hidden="true" tabindex="-1"></a>**Step 6: Create a .gitignore file**</span>
<span id="cb47-738"><a href="#cb47-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-739"><a href="#cb47-739" aria-hidden="true" tabindex="-1"></a>Joe configures version control to track source code and dependencies while excluding generated outputs and temporary files. The principle: track the "recipe" (code + dependencies), not the "meal" (outputs).</span>
<span id="cb47-740"><a href="#cb47-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-741"><a href="#cb47-741" aria-hidden="true" tabindex="-1"></a>Joe creates a <span class="in">`.gitignore`</span> file excluding renv libraries, generated outputs, temporary files, and system artifacts. This keeps the repository lightweight while ensuring collaborators can recreate the complete environment from tracked dependencies.</span>
<span id="cb47-742"><a href="#cb47-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-743"><a href="#cb47-743" aria-hidden="true" tabindex="-1"></a>**Step 7: Create a Dockerfile**</span>
<span id="cb47-744"><a href="#cb47-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-745"><a href="#cb47-745" aria-hidden="true" tabindex="-1"></a>zzrrtools generates a Dockerfile with multiple template options. The standard template uses rocker/r-ver, while the pluspackages template includes common R packages like tidyverse. Both provide:</span>
<span id="cb47-746"><a href="#cb47-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-747"><a href="#cb47-747" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**R version consistency**: Matches exact R version specified in renv.lock</span>
<span id="cb47-748"><a href="#cb47-748" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Development environment**: Includes zsh, vim, tmux, Node.js for plugin support</span>
<span id="cb47-749"><a href="#cb47-749" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Security**: Non-root user execution with proper file permissions</span>
<span id="cb47-750"><a href="#cb47-750" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**TinyTeX integration**: LaTeX support for PDF rendering (pluspackages template)</span>
<span id="cb47-751"><a href="#cb47-751" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Pre-installed packages**: Common packages like tidyverse, DT, testthat (pluspackages template)</span>
<span id="cb47-752"><a href="#cb47-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-753"><a href="#cb47-753" aria-hidden="true" tabindex="-1"></a>The generated Dockerfile includes development tools and optimizations:</span>
<span id="cb47-754"><a href="#cb47-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-755"><a href="#cb47-755" aria-hidden="true" tabindex="-1"></a><span class="in">```dockerfile</span></span>
<span id="cb47-756"><a href="#cb47-756" aria-hidden="true" tabindex="-1"></a><span class="in">ARG R_VERSION=latest</span></span>
<span id="cb47-757"><a href="#cb47-757" aria-hidden="true" tabindex="-1"></a><span class="in">FROM rocker/r-ver:${R_VERSION}</span></span>
<span id="cb47-758"><a href="#cb47-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-759"><a href="#cb47-759" aria-hidden="true" tabindex="-1"></a><span class="in"># Install comprehensive development environment</span></span>
<span id="cb47-760"><a href="#cb47-760" aria-hidden="true" tabindex="-1"></a><span class="in">RUN apt-get update &amp;&amp; apt-get install -y \</span></span>
<span id="cb47-761"><a href="#cb47-761" aria-hidden="true" tabindex="-1"></a><span class="in">    git ssh curl wget vim tmux zsh build-essential \</span></span>
<span id="cb47-762"><a href="#cb47-762" aria-hidden="true" tabindex="-1"></a><span class="in">    libcurl4-openssl-dev libssl-dev libxml2-dev \</span></span>
<span id="cb47-763"><a href="#cb47-763" aria-hidden="true" tabindex="-1"></a><span class="in">    libfontconfig1-dev libharfbuzz-dev libfribidi-dev \</span></span>
<span id="cb47-764"><a href="#cb47-764" aria-hidden="true" tabindex="-1"></a><span class="in">    libfreetype6-dev libpng-dev libtiff5-dev libjpeg-dev \</span></span>
<span id="cb47-765"><a href="#cb47-765" aria-hidden="true" tabindex="-1"></a><span class="in">    man-db pandoc \</span></span>
<span id="cb47-766"><a href="#cb47-766" aria-hidden="true" tabindex="-1"></a><span class="in">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span>
<span id="cb47-767"><a href="#cb47-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-768"><a href="#cb47-768" aria-hidden="true" tabindex="-1"></a><span class="in"># Install Node.js for vim plugins</span></span>
<span id="cb47-769"><a href="#cb47-769" aria-hidden="true" tabindex="-1"></a><span class="in">RUN curl -fsSL https://deb.nodesource.com/setup_lts.x | bash - &amp;&amp; \</span></span>
<span id="cb47-770"><a href="#cb47-770" aria-hidden="true" tabindex="-1"></a><span class="in">    apt-get install -y nodejs</span></span>
<span id="cb47-771"><a href="#cb47-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-772"><a href="#cb47-772" aria-hidden="true" tabindex="-1"></a><span class="in"># Create non-root user with zsh shell</span></span>
<span id="cb47-773"><a href="#cb47-773" aria-hidden="true" tabindex="-1"></a><span class="in">ARG USERNAME=analyst</span></span>
<span id="cb47-774"><a href="#cb47-774" aria-hidden="true" tabindex="-1"></a><span class="in">RUN useradd --create-home --shell /bin/zsh ${USERNAME}</span></span>
<span id="cb47-775"><a href="#cb47-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-776"><a href="#cb47-776" aria-hidden="true" tabindex="-1"></a><span class="in"># Set up R environment with renv</span></span>
<span id="cb47-777"><a href="#cb47-777" aria-hidden="true" tabindex="-1"></a><span class="in">WORKDIR /home/${USERNAME}/project</span></span>
<span id="cb47-778"><a href="#cb47-778" aria-hidden="true" tabindex="-1"></a><span class="in">COPY --chown=${USERNAME}:${USERNAME} renv.lock ./</span></span>
<span id="cb47-779"><a href="#cb47-779" aria-hidden="true" tabindex="-1"></a><span class="in">USER ${USERNAME}</span></span>
<span id="cb47-780"><a href="#cb47-780" aria-hidden="true" tabindex="-1"></a><span class="in">RUN R -e "install.packages('renv'); renv::restore()"</span></span>
<span id="cb47-781"><a href="#cb47-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-782"><a href="#cb47-782" aria-hidden="true" tabindex="-1"></a><span class="in"># Copy project files and install</span></span>
<span id="cb47-783"><a href="#cb47-783" aria-hidden="true" tabindex="-1"></a><span class="in">COPY --chown=${USERNAME}:${USERNAME} . .</span></span>
<span id="cb47-784"><a href="#cb47-784" aria-hidden="true" tabindex="-1"></a><span class="in">RUN R -e "devtools::install('.')"</span></span>
<span id="cb47-785"><a href="#cb47-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-786"><a href="#cb47-786" aria-hidden="true" tabindex="-1"></a><span class="in">CMD ["/bin/zsh"]</span></span>
<span id="cb47-787"><a href="#cb47-787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-788"><a href="#cb47-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-789"><a href="#cb47-789" aria-hidden="true" tabindex="-1"></a>**Alternative: Pre-packaged Template**</span>
<span id="cb47-790"><a href="#cb47-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-791"><a href="#cb47-791" aria-hidden="true" tabindex="-1"></a>For projects using common packages, the pluspackages template includes TinyTeX and popular R packages:</span>
<span id="cb47-792"><a href="#cb47-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-793"><a href="#cb47-793" aria-hidden="true" tabindex="-1"></a><span class="in">```dockerfile</span></span>
<span id="cb47-794"><a href="#cb47-794" aria-hidden="true" tabindex="-1"></a><span class="in"># Install TinyTeX for PDF rendering</span></span>
<span id="cb47-795"><a href="#cb47-795" aria-hidden="true" tabindex="-1"></a><span class="in">RUN R -e "install.packages('tinytex')" &amp;&amp; \</span></span>
<span id="cb47-796"><a href="#cb47-796" aria-hidden="true" tabindex="-1"></a><span class="in">    R -e "tinytex::install_tinytex()" &amp;&amp; \</span></span>
<span id="cb47-797"><a href="#cb47-797" aria-hidden="true" tabindex="-1"></a><span class="in">    /root/.TinyTeX/bin/*/tlmgr path add</span></span>
<span id="cb47-798"><a href="#cb47-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-799"><a href="#cb47-799" aria-hidden="true" tabindex="-1"></a><span class="in"># Install common R packages (cached layer)</span></span>
<span id="cb47-800"><a href="#cb47-800" aria-hidden="true" tabindex="-1"></a><span class="in">RUN R -e "install.packages(c('renv', 'remotes', 'devtools', \</span></span>
<span id="cb47-801"><a href="#cb47-801" aria-hidden="true" tabindex="-1"></a><span class="in">    'testthat', 'naniar', 'DT', 'conflicted', 'ggthemes', \</span></span>
<span id="cb47-802"><a href="#cb47-802" aria-hidden="true" tabindex="-1"></a><span class="in">    'datapasta', 'janitor', 'kableExtra', 'tidytuesdayR', \</span></span>
<span id="cb47-803"><a href="#cb47-803" aria-hidden="true" tabindex="-1"></a><span class="in">    'tidyverse'), repos = c(CRAN = 'https://cloud.r-project.org'))"</span></span>
<span id="cb47-804"><a href="#cb47-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-805"><a href="#cb47-805" aria-hidden="true" tabindex="-1"></a><span class="in"># Give user write permissions to R library</span></span>
<span id="cb47-806"><a href="#cb47-806" aria-hidden="true" tabindex="-1"></a><span class="in">RUN chown -R ${USERNAME}:${USERNAME} /usr/local/lib/R/site-library</span></span>
<span id="cb47-807"><a href="#cb47-807" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-808"><a href="#cb47-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-809"><a href="#cb47-809" aria-hidden="true" tabindex="-1"></a>**For production Dockerfiles with development environment configuration (zsh, vim plugins, dotfiles integration), see Appendix F: Docker Configuration Examples.**</span>
<span id="cb47-810"><a href="#cb47-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-811"><a href="#cb47-811" aria-hidden="true" tabindex="-1"></a>**R Version Synchronization:**</span>
<span id="cb47-812"><a href="#cb47-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-813"><a href="#cb47-813" aria-hidden="true" tabindex="-1"></a>The Dockerfile uses a build argument to ensure the R version exactly matches what's specified in <span class="in">`renv.lock`</span>. This eliminates potential issues from R version mismatches between the package environment and the underlying R interpreter. The build command extracts the R version from the renv lockfile:</span>
<span id="cb47-814"><a href="#cb47-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-815"><a href="#cb47-815" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-816"><a href="#cb47-816" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract R version from renv.lock</span></span>
<span id="cb47-817"><a href="#cb47-817" aria-hidden="true" tabindex="-1"></a><span class="va">R_VERSION</span><span class="op">=</span><span class="va">$(</span><span class="ex">jq</span> <span class="at">-r</span> <span class="st">'.R.Version'</span> renv.lock<span class="va">)</span></span>
<span id="cb47-818"><a href="#cb47-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-819"><a href="#cb47-819" aria-hidden="true" tabindex="-1"></a><span class="co"># Build Docker image with extracted R version</span></span>
<span id="cb47-820"><a href="#cb47-820" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">--build-arg</span> R_VERSION=<span class="va">${R_VERSION}</span> <span class="dt">\</span></span>
<span id="cb47-821"><a href="#cb47-821" aria-hidden="true" tabindex="-1"></a>  <span class="at">-t</span> ghcr.io/joe/penguins_analysis:v1.0 .</span>
<span id="cb47-822"><a href="#cb47-822" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-823"><a href="#cb47-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-824"><a href="#cb47-824" aria-hidden="true" tabindex="-1"></a>If the <span class="in">`renv.lock`</span> file specifies R 4.3.1, the Docker image will use <span class="in">`rocker/r-ver:4.3.1`</span>. If renv is updated to R 4.4.0, the Docker build will use <span class="in">`rocker/r-ver:4.4.0`</span>. This maintains consistency between the package environment and system environment.</span>
<span id="cb47-825"><a href="#cb47-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-826"><a href="#cb47-826" aria-hidden="true" tabindex="-1"></a>**Step 8: Container-Based Development**</span>
<span id="cb47-827"><a href="#cb47-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-828"><a href="#cb47-828" aria-hidden="true" tabindex="-1"></a>Joe performs all development work inside the Docker container, ensuring consistent environments and immediate visibility of changes to the host system through volume mounting. The container provides a complete development environment with package management, editing tools, and validation utilities.</span>
<span id="cb47-829"><a href="#cb47-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-830"><a href="#cb47-830" aria-hidden="true" tabindex="-1"></a>**Step 9: Update and Share Environment**</span>
<span id="cb47-831"><a href="#cb47-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-832"><a href="#cb47-832" aria-hidden="true" tabindex="-1"></a>When package dependencies change, GitHub Actions automatically rebuilds the Docker image with updated renv.lock specifications and pushes the updated environment to Docker Hub for team access. This ensures collaborators have access to the identical development environment.</span>
<span id="cb47-833"><a href="#cb47-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-834"><a href="#cb47-834" aria-hidden="true" tabindex="-1"></a>**Step 10: Prepare for Team Handoff**</span>
<span id="cb47-835"><a href="#cb47-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-836"><a href="#cb47-836" aria-hidden="true" tabindex="-1"></a>Before handing off to team members, Joe must complete several critical steps:</span>
<span id="cb47-837"><a href="#cb47-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-838"><a href="#cb47-838" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-839"><a href="#cb47-839" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Validate all dependencies are properly captured</span></span>
<span id="cb47-840"><a href="#cb47-840" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-fix</span>
<span id="cb47-841"><a href="#cb47-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-842"><a href="#cb47-842" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Run complete test suite to ensure everything works</span></span>
<span id="cb47-843"><a href="#cb47-843" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-test</span>
<span id="cb47-844"><a href="#cb47-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-845"><a href="#cb47-845" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Render paper to verify end-to-end workflow</span></span>
<span id="cb47-846"><a href="#cb47-846" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-render</span>
<span id="cb47-847"><a href="#cb47-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-848"><a href="#cb47-848" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Build and tag the Docker image</span></span>
<span id="cb47-849"><a href="#cb47-849" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build</span>
<span id="cb47-850"><a href="#cb47-850" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> tag penguins_analysis ghcr.io/joe/penguins_analysis:v1.0</span>
<span id="cb47-851"><a href="#cb47-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-852"><a href="#cb47-852" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Push Docker image to Docker Hub for team access</span></span>
<span id="cb47-853"><a href="#cb47-853" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$GITHUB_TOKEN</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="at">-u</span> joe <span class="at">--password-stdin</span></span>
<span id="cb47-854"><a href="#cb47-854" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push ghcr.io/joe/penguins_analysis:v1.0</span>
<span id="cb47-855"><a href="#cb47-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-856"><a href="#cb47-856" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Commit all setup files and push to repository</span></span>
<span id="cb47-857"><a href="#cb47-857" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb47-858"><a href="#cb47-858" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Initial research compendium setup with Docker environment"</span></span>
<span id="cb47-859"><a href="#cb47-859" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push origin main</span>
<span id="cb47-860"><a href="#cb47-860" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-861"><a href="#cb47-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-862"><a href="#cb47-862" aria-hidden="true" tabindex="-1"></a>**Step 11: Enable Team Access**</span>
<span id="cb47-863"><a href="#cb47-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-864"><a href="#cb47-864" aria-hidden="true" tabindex="-1"></a>Joe configures repository permissions for team collaboration:</span>
<span id="cb47-865"><a href="#cb47-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-866"><a href="#cb47-866" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Repository Settings** → **Collaborators** → Add team members</span>
<span id="cb47-867"><a href="#cb47-867" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Grant "Write" access** to enable forking and pull requests</span>
<span id="cb47-868"><a href="#cb47-868" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Share repository URL** and Docker Hub image name with team</span>
<span id="cb47-869"><a href="#cb47-869" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Document onboarding process** in README or team communication</span>
<span id="cb47-870"><a href="#cb47-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-871"><a href="#cb47-871" aria-hidden="true" tabindex="-1"></a>At this point, Joe has established a reproducible research framework ready for collaborative development. The containerized environment is available via the registry, and team members can join with zero local setup requirements.</span>
<span id="cb47-872"><a href="#cb47-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-873"><a href="#cb47-873" aria-hidden="true" tabindex="-1"></a><span class="fu">### Team Member Onboarding (Sam)</span></span>
<span id="cb47-874"><a href="#cb47-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-875"><a href="#cb47-875" aria-hidden="true" tabindex="-1"></a>**What Sam Receives from Joe:**</span>
<span id="cb47-876"><a href="#cb47-876" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Repository URL: <span class="in">`https://github.com/joe/penguins_analysis`</span></span>
<span id="cb47-877"><a href="#cb47-877" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Container registry access (GitHub Personal Access Token)</span>
<span id="cb47-878"><a href="#cb47-878" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Brief project overview and development guidelines</span>
<span id="cb47-879"><a href="#cb47-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-880"><a href="#cb47-880" aria-hidden="true" tabindex="-1"></a>**Sam's Onboarding Process:**</span>
<span id="cb47-881"><a href="#cb47-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-882"><a href="#cb47-882" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-883"><a href="#cb47-883" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Clone the zzrrtools framework</span></span>
<span id="cb47-884"><a href="#cb47-884" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/username/zzrrtools.git ~/prj/zzrrtools</span>
<span id="cb47-885"><a href="#cb47-885" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/prj/zzrrtools</span>
<span id="cb47-886"><a href="#cb47-886" aria-hidden="true" tabindex="-1"></a><span class="ex">./install.sh</span>  <span class="co"># Creates zzrrtools command in PATH</span></span>
<span id="cb47-887"><a href="#cb47-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-888"><a href="#cb47-888" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Fork and clone the project repository</span></span>
<span id="cb47-889"><a href="#cb47-889" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/sam/penguins_analysis.git  <span class="co"># Sam's fork</span></span>
<span id="cb47-890"><a href="#cb47-890" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> penguins_analysis</span>
<span id="cb47-891"><a href="#cb47-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-892"><a href="#cb47-892" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Run zzrrtools setup with personal preferences</span></span>
<span id="cb47-893"><a href="#cb47-893" aria-hidden="true" tabindex="-1"></a><span class="ex">zzrrtools</span> <span class="at">--dotfiles</span> ~/.config/shell  <span class="co"># Customize with personal dotfiles</span></span>
<span id="cb47-894"><a href="#cb47-894" aria-hidden="true" tabindex="-1"></a><span class="co"># Or use other options:</span></span>
<span id="cb47-895"><a href="#cb47-895" aria-hidden="true" tabindex="-1"></a><span class="co"># zzrrtools --base-image rgt47/r-pluspackages  # Use pre-packaged template</span></span>
<span id="cb47-896"><a href="#cb47-896" aria-hidden="true" tabindex="-1"></a><span class="co"># zzrrtools --no-docker                       # Skip Docker build</span></span>
<span id="cb47-897"><a href="#cb47-897" aria-hidden="true" tabindex="-1"></a><span class="co"># zzrrtools --next-steps                      # Show workflow guidance</span></span>
<span id="cb47-898"><a href="#cb47-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-899"><a href="#cb47-899" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Pull the pre-built Docker environment</span></span>
<span id="cb47-900"><a href="#cb47-900" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull ghcr.io/joe/penguins_analysis:v1.0</span>
<span id="cb47-901"><a href="#cb47-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-902"><a href="#cb47-902" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Start development in identical environment</span></span>
<span id="cb47-903"><a href="#cb47-903" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r</span>
<span id="cb47-904"><a href="#cb47-904" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-905"><a href="#cb47-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-906"><a href="#cb47-906" aria-hidden="true" tabindex="-1"></a>**Key Advantage**: After one-time zzrrtools installation, Sam has access to the framework for all future projects. The development environment setup becomes a simple script execution.</span>
<span id="cb47-907"><a href="#cb47-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-908"><a href="#cb47-908" aria-hidden="true" tabindex="-1"></a>Sam develops new analysis components within the same containerized environment, ensuring identical results across team members.</span>
<span id="cb47-909"><a href="#cb47-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-910"><a href="#cb47-910" aria-hidden="true" tabindex="-1"></a>**Step 5: Paper Integration and Testing**</span>
<span id="cb47-911"><a href="#cb47-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-912"><a href="#cb47-912" aria-hidden="true" tabindex="-1"></a>Sam integrates the new analysis into the research paper, combining Joe's original visualizations with the new body mass analysis. Sam also creates tests to validate the new functionality and ensure package dependencies are properly documented.</span>
<span id="cb47-913"><a href="#cb47-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-914"><a href="#cb47-914" aria-hidden="true" tabindex="-1"></a>**Step 6: Validation and Quality Assurance**</span>
<span id="cb47-915"><a href="#cb47-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-916"><a href="#cb47-916" aria-hidden="true" tabindex="-1"></a>Sam creates tests for the new body mass analysis, validates data integrity and statistical relationships, then runs the complete test suite and verifies paper rendering to ensure no regressions before submission.</span>
<span id="cb47-917"><a href="#cb47-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-918"><a href="#cb47-918" aria-hidden="true" tabindex="-1"></a>**Step 7: Contribution Submission**</span>
<span id="cb47-919"><a href="#cb47-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-920"><a href="#cb47-920" aria-hidden="true" tabindex="-1"></a>When Sam completes the analysis iteration, the submission process follows these steps:</span>
<span id="cb47-921"><a href="#cb47-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-922"><a href="#cb47-922" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Validate dependencies**: Run <span class="in">`make docker-check-renv-fix`</span> to ensure package consistency</span>
<span id="cb47-923"><a href="#cb47-923" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Run complete test suite**: Execute <span class="in">`make docker-test`</span> to verify all tests pass</span>
<span id="cb47-924"><a href="#cb47-924" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Verify paper rendering**: Run <span class="in">`make docker-render`</span> to confirm analysis integrates properly</span>
<span id="cb47-925"><a href="#cb47-925" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Commit changes**: </span>
<span id="cb47-926"><a href="#cb47-926" aria-hidden="true" tabindex="-1"></a>   <span class="in">```bash</span></span>
<span id="cb47-927"><a href="#cb47-927" aria-hidden="true" tabindex="-1"></a>   <span class="fu">git</span> add .</span>
<span id="cb47-928"><a href="#cb47-928" aria-hidden="true" tabindex="-1"></a>   <span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Add body mass analysis and associated tests"</span></span>
<span id="cb47-929"><a href="#cb47-929" aria-hidden="true" tabindex="-1"></a>   <span class="fu">git</span> push origin feature/body-mass-analysis</span>
<span id="cb47-930"><a href="#cb47-930" aria-hidden="true" tabindex="-1"></a>   <span class="in">```</span></span>
<span id="cb47-931"><a href="#cb47-931" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Create pull request**: Submit pull request from Sam's fork to Joe's original repository</span>
<span id="cb47-932"><a href="#cb47-932" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Notify Joe**: Alert project maintainer about new packages or Docker changes needed</span>
<span id="cb47-933"><a href="#cb47-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-934"><a href="#cb47-934" aria-hidden="true" tabindex="-1"></a>**Note**: Only Joe (project maintainer) can accept pull requests. The official Docker image is automatically rebuilt and pushed to Docker Hub by GitHub Actions when package dependencies change.</span>
<span id="cb47-935"><a href="#cb47-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-936"><a href="#cb47-936" aria-hidden="true" tabindex="-1"></a>**CI Feedback Loop**: If the CI workflow fails (e.g., renv validation issues), Sam receives automatic GitHub notifications and can view detailed failure logs to fix the issues before Joe reviews the PR.</span>
<span id="cb47-937"><a href="#cb47-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-938"><a href="#cb47-938" aria-hidden="true" tabindex="-1"></a>Sam commits the completed analysis, tests, and documentation to their feature branch and creates a cross-repository pull request to the original repository. This ensures proper code review and governance while maintaining clear attribution of contributions.</span>
<span id="cb47-939"><a href="#cb47-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-940"><a href="#cb47-940" aria-hidden="true" tabindex="-1"></a>At this point, Sam has successfully contributed new analysis through the collaborative workflow. Joe reviews the pull request, tests the changes in the containerized environment, and merges the contribution while maintaining project governance and quality standards.</span>
<span id="cb47-941"><a href="#cb47-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-942"><a href="#cb47-942" aria-hidden="true" tabindex="-1"></a><span class="fu">## Complete Handoff Workflow Summary</span></span>
<span id="cb47-943"><a href="#cb47-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-944"><a href="#cb47-944" aria-hidden="true" tabindex="-1"></a>**Initiating Developer (Joe) Responsibilities:**</span>
<span id="cb47-945"><a href="#cb47-945" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Run <span class="in">`zzrrtools.sh`</span> to create research compendium</span>
<span id="cb47-946"><a href="#cb47-946" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Develop initial analysis and create tests</span>
<span id="cb47-947"><a href="#cb47-947" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Validate dependencies with <span class="in">`make check-renv-fix`</span>  </span>
<span id="cb47-948"><a href="#cb47-948" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Build initial Docker image and configure automated rebuilds via GitHub Actions</span>
<span id="cb47-949"><a href="#cb47-949" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Push team Docker image to Docker Hub (public registry for reproducibility)</span>
<span id="cb47-950"><a href="#cb47-950" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Commit all files and push to repository</span>
<span id="cb47-951"><a href="#cb47-951" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Grant team member repository access  </span>
<span id="cb47-952"><a href="#cb47-952" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Share repository URL and Docker Hub image name</span>
<span id="cb47-953"><a href="#cb47-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-954"><a href="#cb47-954" aria-hidden="true" tabindex="-1"></a>**Joining Developer (Sam) Process:**</span>
<span id="cb47-955"><a href="#cb47-955" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Receive repository URL and Docker Hub image name from Joe</span>
<span id="cb47-956"><a href="#cb47-956" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Clone zzrrtools framework: <span class="in">`git clone zzrrtools ~/prj/zzrrtools`</span></span>
<span id="cb47-957"><a href="#cb47-957" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Install zzrrtools: <span class="in">`cd ~/prj/zzrrtools &amp;&amp; ./install.sh`</span> (creates <span class="in">`zzrrtools`</span> command in PATH)</span>
<span id="cb47-958"><a href="#cb47-958" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Fork and clone project repository </span>
<span id="cb47-959"><a href="#cb47-959" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Pull pre-built team Docker image: <span class="in">`docker pull [TEAM]/project:latest`</span> (from Docker Hub)</span>
<span id="cb47-960"><a href="#cb47-960" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Start development immediately: <span class="in">`make docker-r`</span> (no local setup needed)</span>
<span id="cb47-961"><a href="#cb47-961" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Submit contributions via pull requests to private repository</span>
<span id="cb47-962"><a href="#cb47-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-963"><a href="#cb47-963" aria-hidden="true" tabindex="-1"></a>**Key Success Factor**: The containerized environment and centralized zzrrtools framework eliminate project-specific configuration requirements for team members after one-time framework installation.</span>
<span id="cb47-964"><a href="#cb47-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-965"><a href="#cb47-965" aria-hidden="true" tabindex="-1"></a><span class="fu">## Collaboration Results</span></span>
<span id="cb47-966"><a href="#cb47-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-967"><a href="#cb47-967" aria-hidden="true" tabindex="-1"></a>This workflow achieves:</span>
<span id="cb47-968"><a href="#cb47-968" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Identical development environments across team members</span>
<span id="cb47-969"><a href="#cb47-969" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dependency validation preventing conflicts</span>
<span id="cb47-970"><a href="#cb47-970" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Standardized project structure</span>
<span id="cb47-971"><a href="#cb47-971" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Automated testing and CI/CD integration</span>
<span id="cb47-972"><a href="#cb47-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-973"><a href="#cb47-973" aria-hidden="true" tabindex="-1"></a>**For GitHub Actions setup instructions, workflow examples, and CI/CD configuration, see Appendix E: GitHub Actions CI/CD Setup.**</span>
<span id="cb47-974"><a href="#cb47-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-975"><a href="#cb47-975" aria-hidden="true" tabindex="-1"></a>The collaborative workflow demonstrated above illustrates the power of combining zzrrtools, renv, and Docker for reproducible research. However, successful implementation of this approach requires understanding both when it's most beneficial and how to apply it effectively. The following best practices and considerations provide guidance for teams considering this strategy.</span>
<span id="cb47-976"><a href="#cb47-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-977"><a href="#cb47-977" aria-hidden="true" tabindex="-1"></a><span class="fu"># Best Practices and Considerations</span></span>
<span id="cb47-978"><a href="#cb47-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-979"><a href="#cb47-979" aria-hidden="true" tabindex="-1"></a><span class="fu">## When to Use This Approach</span></span>
<span id="cb47-980"><a href="#cb47-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-981"><a href="#cb47-981" aria-hidden="true" tabindex="-1"></a>The zzrrtools + renv + Docker approach with testing is particularly valuable for:</span>
<span id="cb47-982"><a href="#cb47-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-983"><a href="#cb47-983" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Long-term research projects** where reproducibility over time is crucial</span>
<span id="cb47-984"><a href="#cb47-984" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Collaborative analyses** with multiple contributors on different systems</span>
<span id="cb47-985"><a href="#cb47-985" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Production analytical pipelines** that need to run consistently</span>
<span id="cb47-986"><a href="#cb47-986" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Academic publications** where methods must be reproducible</span>
<span id="cb47-987"><a href="#cb47-987" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Teaching and education** to ensure consistent student experiences</span>
<span id="cb47-988"><a href="#cb47-988" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Complex analyses** that require testing to validate results</span>
<span id="cb47-989"><a href="#cb47-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-990"><a href="#cb47-990" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tips for Efficient Implementation</span></span>
<span id="cb47-991"><a href="#cb47-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-992"><a href="#cb47-992" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Keep Docker images minimal**: Include only what's necessary for reproducibility.</span>
<span id="cb47-993"><a href="#cb47-993" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Use specific version tags**: For both R packages and Docker base images, specify exact versions.</span>
<span id="cb47-994"><a href="#cb47-994" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Document system requirements**: Include notes on RAM and storage requirements.</span>
<span id="cb47-995"><a href="#cb47-995" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Leverage bind mounts**: Mount local directories to containers for easier development.</span>
<span id="cb47-996"><a href="#cb47-996" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Write meaningful tests**: Focus on validating both data integrity and analytical results.</span>
<span id="cb47-997"><a href="#cb47-997" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Test regularly**: Use CI/CD pipelines to run tests on every change.</span>
<span id="cb47-998"><a href="#cb47-998" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>**Consider computational requirements**: Particularly for resource-intensive analyses.</span>
<span id="cb47-999"><a href="#cb47-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1000"><a href="#cb47-1000" aria-hidden="true" tabindex="-1"></a><span class="fu">## Testing Strategies for R Analyses</span></span>
<span id="cb47-1001"><a href="#cb47-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1002"><a href="#cb47-1002" aria-hidden="true" tabindex="-1"></a>Testing data analysis code differs from traditional software testing but provides crucial value for reproducible research:</span>
<span id="cb47-1003"><a href="#cb47-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1004"><a href="#cb47-1004" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Data Validation Tests**: Ensure data has the expected structure, types, and values.</span>
<span id="cb47-1005"><a href="#cb47-1005" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Function Tests**: Verify that custom functions work as expected with known inputs and outputs.</span>
<span id="cb47-1006"><a href="#cb47-1006" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Edge Case Tests**: Check how code handles missing values, outliers, or unexpected inputs.</span>
<span id="cb47-1007"><a href="#cb47-1007" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Integration Tests**: Confirm that different parts of the analysis work correctly together.</span>
<span id="cb47-1008"><a href="#cb47-1008" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Regression Tests**: Make sure new changes don't break existing functionality.</span>
<span id="cb47-1009"><a href="#cb47-1009" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Output Validation**: Verify that final results match expected patterns or benchmarks.</span>
<span id="cb47-1010"><a href="#cb47-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1011"><a href="#cb47-1011" aria-hidden="true" tabindex="-1"></a>While uncommon in traditional data analysis, these tests catch silent errors, validate assumptions, and provide confidence that analyses remain correct as code and data evolve.</span>
<span id="cb47-1012"><a href="#cb47-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1013"><a href="#cb47-1013" aria-hidden="true" tabindex="-1"></a><span class="fu">## Potential Challenges</span></span>
<span id="cb47-1014"><a href="#cb47-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1015"><a href="#cb47-1015" aria-hidden="true" tabindex="-1"></a>Some challenges to be aware of:</span>
<span id="cb47-1016"><a href="#cb47-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1017"><a href="#cb47-1017" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Docker image size**: Images with many packages can become large</span>
<span id="cb47-1018"><a href="#cb47-1018" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Learning curve**: Docker, renv, and testing frameworks require some initial learning</span>
<span id="cb47-1019"><a href="#cb47-1019" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**System-specific features**: Some analyses may rely on hardware features</span>
<span id="cb47-1020"><a href="#cb47-1020" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Performance considerations**: Containers may have different performance characteristics</span>
<span id="cb47-1021"><a href="#cb47-1021" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Test maintenance**: Tests need to be updated as the analysis evolves</span>
<span id="cb47-1022"><a href="#cb47-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1023"><a href="#cb47-1023" aria-hidden="true" tabindex="-1"></a><span class="fu">## Troubleshooting Common Issues</span></span>
<span id="cb47-1024"><a href="#cb47-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1025"><a href="#cb47-1025" aria-hidden="true" tabindex="-1"></a>**Docker Build Failures:**</span>
<span id="cb47-1026"><a href="#cb47-1026" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Try: <span class="in">`export DOCKER_BUILDKIT=0`</span> (disable BuildKit)</span>
<span id="cb47-1027"><a href="#cb47-1027" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check Docker has sufficient memory/disk space</span>
<span id="cb47-1028"><a href="#cb47-1028" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ensure Docker is running and up to date</span>
<span id="cb47-1029"><a href="#cb47-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1030"><a href="#cb47-1030" aria-hidden="true" tabindex="-1"></a>**Platform Warnings on ARM64/Apple Silicon:**</span>
<span id="cb47-1031"><a href="#cb47-1031" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use updated Makefile with <span class="in">`--platform linux/amd64`</span> flags</span>
<span id="cb47-1032"><a href="#cb47-1032" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Or set: <span class="in">`export DOCKER_DEFAULT_PLATFORM=linux/amd64`</span></span>
<span id="cb47-1033"><a href="#cb47-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1034"><a href="#cb47-1034" aria-hidden="true" tabindex="-1"></a>**Permission Errors in Container:**</span>
<span id="cb47-1035"><a href="#cb47-1035" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rebuild image after copying dotfiles</span>
<span id="cb47-1036"><a href="#cb47-1036" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check file ownership in project directory</span>
<span id="cb47-1037"><a href="#cb47-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1038"><a href="#cb47-1038" aria-hidden="true" tabindex="-1"></a>**Package Name Errors:**</span>
<span id="cb47-1039"><a href="#cb47-1039" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ensure directory name contains only letters/numbers/periods</span>
<span id="cb47-1040"><a href="#cb47-1040" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Avoid underscores and special characters</span>
<span id="cb47-1041"><a href="#cb47-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1042"><a href="#cb47-1042" aria-hidden="true" tabindex="-1"></a>**Missing Dotfiles in Container:**</span>
<span id="cb47-1043"><a href="#cb47-1043" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`--dotfiles`</span> or <span class="in">`--dotfiles-nodot`</span> flag during setup</span>
<span id="cb47-1044"><a href="#cb47-1044" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rebuild Docker image after adding dotfiles</span>
<span id="cb47-1045"><a href="#cb47-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1046"><a href="#cb47-1046" aria-hidden="true" tabindex="-1"></a>Despite these challenges, the benefits of reproducible research outweigh the implementation costs, particularly for collaborative and long-term projects. The approach described in this white paper provides a foundation for achieving reproducibility that meets the standards expected in data science and academic research.</span>
<span id="cb47-1047"><a href="#cb47-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1048"><a href="#cb47-1048" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion</span></span>
<span id="cb47-1049"><a href="#cb47-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1050"><a href="#cb47-1050" aria-hidden="true" tabindex="-1"></a>Achieving full reproducibility in R requires addressing project organization, package dependencies, and system-level consistency, while ensuring code quality through testing. By combining zzrrtools for research compendium structure, renv for R package management, Docker for environment containerization, and testing for code validation, data scientists and researchers can create truly portable, reproducible, and reliable workflows.</span>
<span id="cb47-1051"><a href="#cb47-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1052"><a href="#cb47-1052" aria-hidden="true" tabindex="-1"></a>The approach presented in this white paper ensures that the common frustration of "it works on my machine" becomes a thing of the past. Instead, research compendia become easy to share and fully reproducible. A collaborator or reviewer can launch the Docker container and get identical results, without worrying about package versions, system setup, or project organization.</span>
<span id="cb47-1053"><a href="#cb47-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1054"><a href="#cb47-1054" aria-hidden="true" tabindex="-1"></a>The case study demonstrates how two developers can effectively collaborate on an analysis while maintaining reproducibility and code quality throughout the project lifecycle. By integrating testing into the workflow, the team can be confident that their analysis is not only reproducible but also correct.</span>
<span id="cb47-1055"><a href="#cb47-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1056"><a href="#cb47-1056" aria-hidden="true" tabindex="-1"></a>This strategy represents a method for long-term reproducibility in R, meeting the standards required for data science and research documentation. The combination of standardized research compendium structure, dependency management, and containerized environments creates a foundation for reproducible research. By adopting this approach, the R community can make progress toward the goal of reproducible and reliable research and analysis.</span>
<span id="cb47-1057"><a href="#cb47-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1058"><a href="#cb47-1058" aria-hidden="true" tabindex="-1"></a><span class="fu"># References</span></span>
<span id="cb47-1059"><a href="#cb47-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1060"><a href="#cb47-1060" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Marwick, B., Boettiger, C., &amp; Mullen, L. (2018). Packaging data analytical work reproducibly using R (and friends). *The American Statistician*, 72(1), 80-88.</span>
<span id="cb47-1061"><a href="#cb47-1061" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Marwick, B. (2017). rrtools: Creates a Reproducible Research Compendium. R package version 0.1.6. https://github.com/benmarwick/rrtools (Extended in zzrrtools framework)</span>
<span id="cb47-1062"><a href="#cb47-1062" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Ushey, K., Wickham, H., &amp; RStudio. (2023). renv: Project Environments. R package. https://rstudio.github.io/renv/</span>
<span id="cb47-1063"><a href="#cb47-1063" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>The Rocker Project. (2023). Docker containers for the R environment. https://www.rocker-project.org/</span>
<span id="cb47-1064"><a href="#cb47-1064" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Wickham, H. (2023). testthat: Unit Testing for R. https://testthat.r-lib.org/</span>
<span id="cb47-1065"><a href="#cb47-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1066"><a href="#cb47-1066" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix A: GitHub Personal Access Token Setup {.unnumbered}</span></span>
<span id="cb47-1067"><a href="#cb47-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1068"><a href="#cb47-1068" aria-hidden="true" tabindex="-1"></a>This appendix provides step-by-step instructions for creating a GitHub Personal Access Token with the required permissions for container registry operations.</span>
<span id="cb47-1069"><a href="#cb47-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1070"><a href="#cb47-1070" aria-hidden="true" tabindex="-1"></a>**Why Container Access is Required:** Both collaborators need container-related permissions because Docker images are stored in GitHub Container Registry as private packages that require authentication to access.</span>
<span id="cb47-1071"><a href="#cb47-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1072"><a href="#cb47-1072" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step-by-Step Token Creation</span></span>
<span id="cb47-1073"><a href="#cb47-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1074"><a href="#cb47-1074" aria-hidden="true" tabindex="-1"></a>**1. Navigate to GitHub Settings:**</span>
<span id="cb47-1075"><a href="#cb47-1075" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Go to <span class="co">[</span><span class="ot">GitHub.com</span><span class="co">](https://github.com)</span> and sign in</span>
<span id="cb47-1076"><a href="#cb47-1076" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Click your profile picture (top right) → Settings</span>
<span id="cb47-1077"><a href="#cb47-1077" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the left sidebar: Developer settings → Personal access tokens</span>
<span id="cb47-1078"><a href="#cb47-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1079"><a href="#cb47-1079" aria-hidden="true" tabindex="-1"></a>**Note**: GitHub now offers two token types:</span>
<span id="cb47-1080"><a href="#cb47-1080" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Fine-grained personal access tokens** (recommended for new projects)</span>
<span id="cb47-1081"><a href="#cb47-1081" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Personal access tokens (classic)** (for broader compatibility)</span>
<span id="cb47-1082"><a href="#cb47-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1083"><a href="#cb47-1083" aria-hidden="true" tabindex="-1"></a>**2. Create New Token:**</span>
<span id="cb47-1084"><a href="#cb47-1084" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Click "Generate new token" and select the appropriate type</span>
<span id="cb47-1085"><a href="#cb47-1085" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add a descriptive note (e.g., "Docker Container Registry Access")</span>
<span id="cb47-1086"><a href="#cb47-1086" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set expiration (recommended: 90 days for security)</span>
<span id="cb47-1087"><a href="#cb47-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1088"><a href="#cb47-1088" aria-hidden="true" tabindex="-1"></a>**3. Select Required Scopes** (check these boxes):</span>
<span id="cb47-1089"><a href="#cb47-1089" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>✅ **repo** (Full control of private repositories) - *Required for private repos*</span>
<span id="cb47-1090"><a href="#cb47-1090" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>✅ **write:packages** (Upload Docker images to GitHub Container </span>
<span id="cb47-1091"><a href="#cb47-1091" aria-hidden="true" tabindex="-1"></a>  Registry) - *Required for project maintainer*</span>
<span id="cb47-1092"><a href="#cb47-1092" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>✅ **read:packages** (Download Docker images from GitHub Container </span>
<span id="cb47-1093"><a href="#cb47-1093" aria-hidden="true" tabindex="-1"></a>  Registry) - *Required for all team members*</span>
<span id="cb47-1094"><a href="#cb47-1094" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>✅ **delete:packages** (Delete packages from GitHub Package Registry) </span>
<span id="cb47-1095"><a href="#cb47-1095" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>*Optional but recommended*</span>
<span id="cb47-1096"><a href="#cb47-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1097"><a href="#cb47-1097" aria-hidden="true" tabindex="-1"></a>**Note**: Team members only need <span class="in">`read:packages`</span> and <span class="in">`repo`</span>, but the project maintainer needs all container permissions to push Docker images.</span>
<span id="cb47-1098"><a href="#cb47-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1099"><a href="#cb47-1099" aria-hidden="true" tabindex="-1"></a>**Token Type Recommendation**: Use fine-grained personal access tokens for new projects as they provide better security and more precise permissions.</span>
<span id="cb47-1100"><a href="#cb47-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1101"><a href="#cb47-1101" aria-hidden="true" tabindex="-1"></a>**4. Generate and Copy Token:**</span>
<span id="cb47-1102"><a href="#cb47-1102" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Click "Generate token" at the bottom</span>
<span id="cb47-1103"><a href="#cb47-1103" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Important**: Copy the token immediately - you won't see it again</span>
<span id="cb47-1104"><a href="#cb47-1104" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Store it securely (see security practices below)</span>
<span id="cb47-1105"><a href="#cb47-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1106"><a href="#cb47-1106" aria-hidden="true" tabindex="-1"></a><span class="fu">## Token Security Best Practices</span></span>
<span id="cb47-1107"><a href="#cb47-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1108"><a href="#cb47-1108" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Never commit tokens to repositories** - Use <span class="in">`.gitignore`</span> to exclude files containing tokens</span>
<span id="cb47-1109"><a href="#cb47-1109" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Use environment variables** - Store tokens in shell environment variables</span>
<span id="cb47-1110"><a href="#cb47-1110" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Set reasonable expiration dates** - Use 30-90 day expiration for security</span>
<span id="cb47-1111"><a href="#cb47-1111" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Revoke unused tokens** - Clean up tokens when no longer needed</span>
<span id="cb47-1112"><a href="#cb47-1112" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Consider GitHub CLI** - Use <span class="in">`gh auth login`</span> for easier management</span>
<span id="cb47-1113"><a href="#cb47-1113" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Monitor token usage** - Check GitHub Settings → Developer settings → Personal access tokens for activity</span>
<span id="cb47-1114"><a href="#cb47-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1115"><a href="#cb47-1115" aria-hidden="true" tabindex="-1"></a><span class="fu">## Alternative: Using GitHub CLI</span></span>
<span id="cb47-1116"><a href="#cb47-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1117"><a href="#cb47-1117" aria-hidden="true" tabindex="-1"></a>For simpler token management, consider using GitHub CLI instead of manual tokens:</span>
<span id="cb47-1118"><a href="#cb47-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1119"><a href="#cb47-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-1120"><a href="#cb47-1120" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and authenticate (handles tokens)</span></span>
<span id="cb47-1121"><a href="#cb47-1121" aria-hidden="true" tabindex="-1"></a><span class="ex">gh</span> auth login <span class="at">--scopes</span> write:packages,read:packages,repo</span>
<span id="cb47-1122"><a href="#cb47-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1123"><a href="#cb47-1123" aria-hidden="true" tabindex="-1"></a><span class="co"># Login to container registry (works with gh auth)</span></span>
<span id="cb47-1124"><a href="#cb47-1124" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$(</span><span class="ex">gh</span> auth token<span class="va">)</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="dt">\</span></span>
<span id="cb47-1125"><a href="#cb47-1125" aria-hidden="true" tabindex="-1"></a>  <span class="at">-u</span> <span class="va">$(</span><span class="ex">gh</span> api user <span class="at">--jq</span> .login<span class="va">)</span> <span class="at">--password-stdin</span></span>
<span id="cb47-1126"><a href="#cb47-1126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1127"><a href="#cb47-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1128"><a href="#cb47-1128" aria-hidden="true" tabindex="-1"></a><span class="fu">## Troubleshooting Common Issues</span></span>
<span id="cb47-1129"><a href="#cb47-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1130"><a href="#cb47-1130" aria-hidden="true" tabindex="-1"></a>**"permission_denied: The token provided does not match expected scopes"**</span>
<span id="cb47-1131"><a href="#cb47-1131" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Verify your token includes <span class="in">`write:packages`</span> and <span class="in">`read:packages`</span> scopes</span>
<span id="cb47-1132"><a href="#cb47-1132" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For private repositories, ensure <span class="in">`repo`</span> scope is also selected</span>
<span id="cb47-1133"><a href="#cb47-1133" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a new token with correct permissions if needed</span>
<span id="cb47-1134"><a href="#cb47-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1135"><a href="#cb47-1135" aria-hidden="true" tabindex="-1"></a>**Token not recognized:**</span>
<span id="cb47-1136"><a href="#cb47-1136" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ensure token is properly exported: <span class="in">`export GITHUB_TOKEN=your_token_here`</span></span>
<span id="cb47-1137"><a href="#cb47-1137" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Verify token hasn't expired</span>
<span id="cb47-1138"><a href="#cb47-1138" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check that you're using the full token (starts with <span class="in">`ghp_`</span>)</span>
<span id="cb47-1139"><a href="#cb47-1139" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Horst, A.M., Hill, A.P., &amp; Gorman, K.B. (2020). palmerpenguins: Palmer Archipelago (Antarctica) penguin data. R package version 0.1.0. https://allisonhorst.github.io/palmerpenguins/</span>
<span id="cb47-1140"><a href="#cb47-1140" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Marwick, B. (2016). Computational reproducibility in archaeological research: Basic principles and a case study of their implementation. *Journal of Archaeological Method and Theory*, 24(2), 424-473.</span>
<span id="cb47-1141"><a href="#cb47-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1142"><a href="#cb47-1142" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix B: Comprehensive Test Suite {.unnumbered}</span></span>
<span id="cb47-1143"><a href="#cb47-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1144"><a href="#cb47-1144" aria-hidden="true" tabindex="-1"></a>This appendix provides a set of tests that can be used to validate the Palmer Penguins analysis. These tests demonstrate best practices for data analysis testing and can be adapted for other projects.</span>
<span id="cb47-1145"><a href="#cb47-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1146"><a href="#cb47-1146" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test File: `tests/testthat/test-comprehensive-analysis.R`</span></span>
<span id="cb47-1147"><a href="#cb47-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1148"><a href="#cb47-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb47-1149"><a href="#cb47-1149" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb47-1150"><a href="#cb47-1150" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb47-1151"><a href="#cb47-1151" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb47-1152"><a href="#cb47-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1153"><a href="#cb47-1153" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 1: Data Availability and Basic Structure</span></span>
<span id="cb47-1154"><a href="#cb47-1154" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify your primary dataset loads correctly and has </span></span>
<span id="cb47-1155"><a href="#cb47-1155" aria-hidden="true" tabindex="-1"></a><span class="co"># expected dimensions</span></span>
<span id="cb47-1156"><a href="#cb47-1156" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Package loading issues, file path problems, corrupted data files</span></span>
<span id="cb47-1157"><a href="#cb47-1157" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Palmer Penguins dataset is available and has correct structure"</span>, </span>
<span id="cb47-1158"><a href="#cb47-1158" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb47-1159"><a href="#cb47-1159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">exists</span>(<span class="st">"penguins"</span>, <span class="at">where =</span> <span class="st">"package:palmerpenguins"</span>))</span>
<span id="cb47-1160"><a href="#cb47-1160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_s3_class</span>(palmerpenguins<span class="sc">::</span>penguins, <span class="st">"data.frame"</span>)</span>
<span id="cb47-1161"><a href="#cb47-1161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(palmerpenguins<span class="sc">::</span>penguins), <span class="dv">8</span>)  <span class="co"># Adapt: Set expected </span></span>
<span id="cb47-1162"><a href="#cb47-1162" aria-hidden="true" tabindex="-1"></a>                                                    <span class="co"># column count</span></span>
<span id="cb47-1163"><a href="#cb47-1163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">nrow</span>(palmerpenguins<span class="sc">::</span>penguins), <span class="dv">300</span>)   <span class="co"># Adapt: Set minimum </span></span>
<span id="cb47-1164"><a href="#cb47-1164" aria-hidden="true" tabindex="-1"></a>                                                    <span class="co"># row threshold</span></span>
<span id="cb47-1165"><a href="#cb47-1165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(palmerpenguins<span class="sc">::</span>penguins), <span class="dv">344</span>)  <span class="co"># Adapt: Set exact </span></span>
<span id="cb47-1166"><a href="#cb47-1166" aria-hidden="true" tabindex="-1"></a>                                                      <span class="co"># expected count </span></span>
<span id="cb47-1167"><a href="#cb47-1167" aria-hidden="true" tabindex="-1"></a>                                                      <span class="co"># if known</span></span>
<span id="cb47-1168"><a href="#cb47-1168" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-1169"><a href="#cb47-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1170"><a href="#cb47-1170" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 2: Required Columns Exist with Correct Types</span></span>
<span id="cb47-1171"><a href="#cb47-1171" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Ensure your analysis depends on columns that </span></span>
<span id="cb47-1172"><a href="#cb47-1172" aria-hidden="true" tabindex="-1"></a><span class="co"># actually </span></span>
<span id="cb47-1173"><a href="#cb47-1173" aria-hidden="true" tabindex="-1"></a><span class="co"># exist with correct types</span></span>
<span id="cb47-1174"><a href="#cb47-1174" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Column name changes, type coercion issues, CSV import problems</span></span>
<span id="cb47-1175"><a href="#cb47-1175" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Dataset contains required columns with expected data types"</span>, {</span>
<span id="cb47-1176"><a href="#cb47-1176" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb47-1177"><a href="#cb47-1177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1178"><a href="#cb47-1178" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check column existence - Adapt: List columns your analysis requires</span></span>
<span id="cb47-1179"><a href="#cb47-1179" aria-hidden="true" tabindex="-1"></a>  required_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"species"</span>, <span class="st">"island"</span>, <span class="st">"bill_length_mm"</span>, </span>
<span id="cb47-1180"><a href="#cb47-1180" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"bill_depth_mm"</span>, <span class="st">"flipper_length_mm"</span>, </span>
<span id="cb47-1181"><a href="#cb47-1181" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"body_mass_g"</span>, <span class="st">"sex"</span>, <span class="st">"year"</span>)</span>
<span id="cb47-1182"><a href="#cb47-1182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(required_cols <span class="sc">%in%</span> <span class="fu">names</span>(df)))</span>
<span id="cb47-1183"><a href="#cb47-1183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1184"><a href="#cb47-1184" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check data types - Adapt: Verify types match your analysis </span></span>
<span id="cb47-1185"><a href="#cb47-1185" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expectations</span></span>
<span id="cb47-1186"><a href="#cb47-1186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>species, <span class="st">"integer"</span>)  <span class="co"># Factor stored as integer</span></span>
<span id="cb47-1187"><a href="#cb47-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>bill_length_mm, <span class="st">"double"</span>)  <span class="co"># Continuous measurements</span></span>
<span id="cb47-1188"><a href="#cb47-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>flipper_length_mm, <span class="st">"integer"</span>)  <span class="co"># Discrete measurements</span></span>
<span id="cb47-1189"><a href="#cb47-1189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>body_mass_g, <span class="st">"integer"</span>)  <span class="co"># Integer measurements</span></span>
<span id="cb47-1190"><a href="#cb47-1190" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-1191"><a href="#cb47-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1192"><a href="#cb47-1192" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 3: Categorical Variables Have Expected Levels</span></span>
<span id="cb47-1193"><a href="#cb47-1193" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify factor levels for categorical variables used</span></span>
<span id="cb47-1194"><a href="#cb47-1194" aria-hidden="true" tabindex="-1"></a><span class="co"># in </span></span>
<span id="cb47-1195"><a href="#cb47-1195" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis</span></span>
<span id="cb47-1196"><a href="#cb47-1196" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Missing categories, typos in factor levels, data encoding issues</span></span>
<span id="cb47-1197"><a href="#cb47-1197" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Species factor has expected levels"</span>, {</span>
<span id="cb47-1198"><a href="#cb47-1198" aria-hidden="true" tabindex="-1"></a>  species_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(palmerpenguins<span class="sc">::</span>penguins<span class="sc">$</span>species)</span>
<span id="cb47-1199"><a href="#cb47-1199" aria-hidden="true" tabindex="-1"></a>  expected_species <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Adelie"</span>, <span class="st">"Chinstrap"</span>, <span class="st">"Gentoo"</span>)  <span class="co"># Adapt: Your </span></span>
<span id="cb47-1200"><a href="#cb47-1200" aria-hidden="true" tabindex="-1"></a>                                                          <span class="co"># expected </span></span>
<span id="cb47-1201"><a href="#cb47-1201" aria-hidden="true" tabindex="-1"></a>                                                          <span class="co"># categories</span></span>
<span id="cb47-1202"><a href="#cb47-1202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sort</span>(species_levels), <span class="fu">sort</span>(expected_species))</span>
<span id="cb47-1203"><a href="#cb47-1203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">length</span>(species_levels), <span class="dv">3</span>)  <span class="co"># Adapt: Expected number of </span></span>
<span id="cb47-1204"><a href="#cb47-1204" aria-hidden="true" tabindex="-1"></a>                                           <span class="co"># categories</span></span>
<span id="cb47-1205"><a href="#cb47-1205" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For other datasets: Test treatment groups, regions, product types, etc.</span></span>
<span id="cb47-1206"><a href="#cb47-1206" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-1207"><a href="#cb47-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1208"><a href="#cb47-1208" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 4: Data Value Ranges are Domain-Reasonable</span></span>
<span id="cb47-1209"><a href="#cb47-1209" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify numeric values fall within realistic ranges</span></span>
<span id="cb47-1210"><a href="#cb47-1210" aria-hidden="true" tabindex="-1"></a><span class="co"># for </span></span>
<span id="cb47-1211"><a href="#cb47-1211" aria-hidden="true" tabindex="-1"></a><span class="co"># your domain</span></span>
<span id="cb47-1212"><a href="#cb47-1212" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Data entry errors, unit conversion mistakes, outliers from </span></span>
<span id="cb47-1213"><a href="#cb47-1213" aria-hidden="true" tabindex="-1"></a><span class="co"># measurement errors</span></span>
<span id="cb47-1214"><a href="#cb47-1214" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Measurement values fall within reasonable biological ranges"</span>, {</span>
<span id="cb47-1215"><a href="#cb47-1215" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb47-1216"><a href="#cb47-1216" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1217"><a href="#cb47-1217" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bill length - Adapt: Set realistic bounds for your numeric variables</span></span>
<span id="cb47-1218"><a href="#cb47-1218" aria-hidden="true" tabindex="-1"></a>  bill_lengths <span class="ot">&lt;-</span> df<span class="sc">$</span>bill_length_mm[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>bill_length_mm)]</span>
<span id="cb47-1219"><a href="#cb47-1219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(bill_lengths <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> bill_lengths <span class="sc">&lt;=</span> <span class="dv">70</span>))  <span class="co"># Penguin-</span></span>
<span id="cb47-1220"><a href="#cb47-1220" aria-hidden="true" tabindex="-1"></a>                                                              <span class="co"># specific </span></span>
<span id="cb47-1221"><a href="#cb47-1221" aria-hidden="true" tabindex="-1"></a>                                                              <span class="co"># range</span></span>
<span id="cb47-1222"><a href="#cb47-1222" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1223"><a href="#cb47-1223" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Flipper length - Examples for other domains:</span></span>
<span id="cb47-1224"><a href="#cb47-1224" aria-hidden="true" tabindex="-1"></a>  flipper_lengths <span class="ot">&lt;-</span> df<span class="sc">$</span>flipper_length_mm[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>flipper_length_mm)]</span>
<span id="cb47-1225"><a href="#cb47-1225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(flipper_lengths <span class="sc">&gt;=</span> <span class="dv">150</span> <span class="sc">&amp;</span> flipper_lengths <span class="sc">&lt;=</span> <span class="dv">250</span>))</span>
<span id="cb47-1226"><a href="#cb47-1226" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Finance: stock prices &gt; 0, percentages 0-100</span></span>
<span id="cb47-1227"><a href="#cb47-1227" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Health: age 0-120, BMI 10-80, blood pressure 50-300</span></span>
<span id="cb47-1228"><a href="#cb47-1228" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Engineering: temperatures -273+°C, pressures &gt; 0</span></span>
<span id="cb47-1229"><a href="#cb47-1229" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1230"><a href="#cb47-1230" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Body mass</span></span>
<span id="cb47-1231"><a href="#cb47-1231" aria-hidden="true" tabindex="-1"></a>  body_masses <span class="ot">&lt;-</span> df<span class="sc">$</span>body_mass_g[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>body_mass_g)]</span>
<span id="cb47-1232"><a href="#cb47-1232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(body_masses <span class="sc">&gt;=</span> <span class="dv">2000</span> <span class="sc">&amp;</span> body_masses <span class="sc">&lt;=</span> <span class="dv">7000</span>))</span>
<span id="cb47-1233"><a href="#cb47-1233" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-1234"><a href="#cb47-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1235"><a href="#cb47-1235" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 5: Missing Data Patterns are as Expected</span></span>
<span id="cb47-1236"><a href="#cb47-1236" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify missingness patterns match your data </span></span>
<span id="cb47-1237"><a href="#cb47-1237" aria-hidden="true" tabindex="-1"></a><span class="co"># collection </span></span>
<span id="cb47-1238"><a href="#cb47-1238" aria-hidden="true" tabindex="-1"></a><span class="co"># expectations</span></span>
<span id="cb47-1239"><a href="#cb47-1239" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Unexpected data loss, systematic missingness, data pipeline </span></span>
<span id="cb47-1240"><a href="#cb47-1240" aria-hidden="true" tabindex="-1"></a><span class="co"># failures</span></span>
<span id="cb47-1241"><a href="#cb47-1241" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Missing data follows expected patterns"</span>, {</span>
<span id="cb47-1242"><a href="#cb47-1242" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb47-1243"><a href="#cb47-1243" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1244"><a href="#cb47-1244" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total missing values should be manageable</span></span>
<span id="cb47-1245"><a href="#cb47-1245" aria-hidden="true" tabindex="-1"></a>  total_na <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(df))</span>
<span id="cb47-1246"><a href="#cb47-1246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(total_na, <span class="fu">nrow</span>(df))  <span class="co"># Adapt: Set acceptable threshold for </span></span>
<span id="cb47-1247"><a href="#cb47-1247" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># missing </span></span>
<span id="cb47-1248"><a href="#cb47-1248" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># data</span></span>
<span id="cb47-1249"><a href="#cb47-1249" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1250"><a href="#cb47-1250" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Some variables may have expected missingness</span></span>
<span id="cb47-1251"><a href="#cb47-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>sex)), <span class="dv">0</span>)  <span class="co"># Sex determination sometimes difficult</span></span>
<span id="cb47-1252"><a href="#cb47-1252" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt examples: Optional survey questions, historical data gaps, sensor </span></span>
<span id="cb47-1253"><a href="#cb47-1253" aria-hidden="true" tabindex="-1"></a>  <span class="co"># failures</span></span>
<span id="cb47-1254"><a href="#cb47-1254" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1255"><a href="#cb47-1255" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Critical variables should be complete</span></span>
<span id="cb47-1256"><a href="#cb47-1256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>species)), <span class="dv">0</span>)  <span class="co"># Primary identifier must be </span></span>
<span id="cb47-1257"><a href="#cb47-1257" aria-hidden="true" tabindex="-1"></a>                                           <span class="co"># complete</span></span>
<span id="cb47-1258"><a href="#cb47-1258" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: ID columns, primary keys, required fields should have no NAs</span></span>
<span id="cb47-1259"><a href="#cb47-1259" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-1260"><a href="#cb47-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1261"><a href="#cb47-1261" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 6: Expected Statistical Relationships Hold</span></span>
<span id="cb47-1262"><a href="#cb47-1262" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Test known relationships between variables in your </span></span>
<span id="cb47-1263"><a href="#cb47-1263" aria-hidden="true" tabindex="-1"></a><span class="co"># domain</span></span>
<span id="cb47-1264"><a href="#cb47-1264" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Data corruption, encoding errors, units mix-ups that break known </span></span>
<span id="cb47-1265"><a href="#cb47-1265" aria-hidden="true" tabindex="-1"></a><span class="co"># patterns</span></span>
<span id="cb47-1266"><a href="#cb47-1266" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Expected correlations between measurements exist"</span>, {</span>
<span id="cb47-1267"><a href="#cb47-1267" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb47-1268"><a href="#cb47-1268" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1269"><a href="#cb47-1269" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test strong expected relationships</span></span>
<span id="cb47-1270"><a href="#cb47-1270" aria-hidden="true" tabindex="-1"></a>  correlation <span class="ot">&lt;-</span> <span class="fu">cor</span>(df<span class="sc">$</span>flipper_length_mm, df<span class="sc">$</span>body_mass_g, </span>
<span id="cb47-1271"><a href="#cb47-1271" aria-hidden="true" tabindex="-1"></a>                     <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb47-1272"><a href="#cb47-1272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(correlation, <span class="fl">0.8</span>)  <span class="co"># Strong positive correlation expected</span></span>
<span id="cb47-1273"><a href="#cb47-1273" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt examples: height vs weight, price vs quality, experience vs salary</span></span>
<span id="cb47-1274"><a href="#cb47-1274" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1275"><a href="#cb47-1275" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test weaker but expected relationships</span></span>
<span id="cb47-1276"><a href="#cb47-1276" aria-hidden="true" tabindex="-1"></a>  bill_cor <span class="ot">&lt;-</span> <span class="fu">cor</span>(df<span class="sc">$</span>bill_length_mm, df<span class="sc">$</span>bill_depth_mm, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb47-1277"><a href="#cb47-1277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">abs</span>(bill_cor), <span class="fl">0.1</span>)  <span class="co"># Some relationship should exist</span></span>
<span id="cb47-1278"><a href="#cb47-1278" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Education vs income, advertising vs sales, temperature vs </span></span>
<span id="cb47-1279"><a href="#cb47-1279" aria-hidden="true" tabindex="-1"></a>  <span class="co"># energy use</span></span>
<span id="cb47-1280"><a href="#cb47-1280" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-1281"><a href="#cb47-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1282"><a href="#cb47-1282" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 7: Visualization Functions Work Correctly</span></span>
<span id="cb47-1283"><a href="#cb47-1283" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Ensure your key plots and visualizations can be </span></span>
<span id="cb47-1284"><a href="#cb47-1284" aria-hidden="true" tabindex="-1"></a><span class="co"># generated</span></span>
<span id="cb47-1285"><a href="#cb47-1285" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Missing aesthetic mappings, incompatible data types, package </span></span>
<span id="cb47-1286"><a href="#cb47-1286" aria-hidden="true" tabindex="-1"></a><span class="co"># conflicts</span></span>
<span id="cb47-1287"><a href="#cb47-1287" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Basic plots can be generated without errors"</span>, {</span>
<span id="cb47-1288"><a href="#cb47-1288" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb47-1289"><a href="#cb47-1289" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1290"><a href="#cb47-1290" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test basic plot creation without errors</span></span>
<span id="cb47-1291"><a href="#cb47-1291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_no_error</span>({</span>
<span id="cb47-1292"><a href="#cb47-1292" aria-hidden="true" tabindex="-1"></a>    p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb47-1293"><a href="#cb47-1293" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb47-1294"><a href="#cb47-1294" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>()</span>
<span id="cb47-1295"><a href="#cb47-1295" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb47-1296"><a href="#cb47-1296" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Test your key plot types - histograms, boxplots, time series,</span></span>
<span id="cb47-1297"><a href="#cb47-1297" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb47-1298"><a href="#cb47-1298" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1299"><a href="#cb47-1299" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that plot object is properly created</span></span>
<span id="cb47-1300"><a href="#cb47-1300" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb47-1301"><a href="#cb47-1301" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span>
<span id="cb47-1302"><a href="#cb47-1302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_s3_class</span>(p1, <span class="st">"ggplot"</span>)  <span class="co"># Adapt: Check for your plotting </span></span>
<span id="cb47-1303"><a href="#cb47-1303" aria-hidden="true" tabindex="-1"></a>                                   <span class="co"># framework objects</span></span>
<span id="cb47-1304"><a href="#cb47-1304" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-1305"><a href="#cb47-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1306"><a href="#cb47-1306" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 8: Data Filtering and Subsetting Work Correctly</span></span>
<span id="cb47-1307"><a href="#cb47-1307" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify data manipulation operations produce expected</span></span>
<span id="cb47-1308"><a href="#cb47-1308" aria-hidden="true" tabindex="-1"></a><span class="co"># results</span></span>
<span id="cb47-1309"><a href="#cb47-1309" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Logic errors in filtering, unexpected factor behaviors, </span></span>
<span id="cb47-1310"><a href="#cb47-1310" aria-hidden="true" tabindex="-1"></a><span class="co"># indexing mistakes</span></span>
<span id="cb47-1311"><a href="#cb47-1311" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Data can be properly filtered and subsetted"</span>, {</span>
<span id="cb47-1312"><a href="#cb47-1312" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb47-1313"><a href="#cb47-1313" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1314"><a href="#cb47-1314" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test categorical filtering</span></span>
<span id="cb47-1315"><a href="#cb47-1315" aria-hidden="true" tabindex="-1"></a>  adelie_penguins <span class="ot">&lt;-</span> df[df<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"Adelie"</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>species), ]</span>
<span id="cb47-1316"><a href="#cb47-1316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">nrow</span>(adelie_penguins), <span class="dv">100</span>)  <span class="co"># Adapt: Expected subset size</span></span>
<span id="cb47-1317"><a href="#cb47-1317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(adelie_penguins<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"Adelie"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb47-1318"><a href="#cb47-1318" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Filter by treatment groups, regions, time periods, etc.</span></span>
<span id="cb47-1319"><a href="#cb47-1319" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1320"><a href="#cb47-1320" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test missing data handling</span></span>
<span id="cb47-1321"><a href="#cb47-1321" aria-hidden="true" tabindex="-1"></a>  complete_cases <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df), ]</span>
<span id="cb47-1322"><a href="#cb47-1322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(<span class="fu">nrow</span>(complete_cases), <span class="fu">nrow</span>(df))  <span class="co"># Some rows should be removed</span></span>
<span id="cb47-1323"><a href="#cb47-1323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(complete_cases)), <span class="dv">0</span>)  <span class="co"># No NAs remaining</span></span>
<span id="cb47-1324"><a href="#cb47-1324" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Test your specific data cleaning operations</span></span>
<span id="cb47-1325"><a href="#cb47-1325" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-1326"><a href="#cb47-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1327"><a href="#cb47-1327" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 9: Summary Statistics are Reasonable</span></span>
<span id="cb47-1328"><a href="#cb47-1328" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify computed statistics match domain knowledge </span></span>
<span id="cb47-1329"><a href="#cb47-1329" aria-hidden="true" tabindex="-1"></a><span class="co"># expectations</span></span>
<span id="cb47-1330"><a href="#cb47-1330" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Calculation errors, unit mistakes, algorithm bugs, extreme </span></span>
<span id="cb47-1331"><a href="#cb47-1331" aria-hidden="true" tabindex="-1"></a><span class="co"># outliers</span></span>
<span id="cb47-1332"><a href="#cb47-1332" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Summary statistics fall within expected ranges"</span>, {</span>
<span id="cb47-1333"><a href="#cb47-1333" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb47-1334"><a href="#cb47-1334" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1335"><a href="#cb47-1335" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test means fall within expected ranges</span></span>
<span id="cb47-1336"><a href="#cb47-1336" aria-hidden="true" tabindex="-1"></a>  mean_flipper <span class="ot">&lt;-</span> <span class="fu">mean</span>(df<span class="sc">$</span>flipper_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-1337"><a href="#cb47-1337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(mean_flipper, <span class="dv">190</span>)  <span class="co"># Adapt: Set realistic bounds for your </span></span>
<span id="cb47-1338"><a href="#cb47-1338" aria-hidden="true" tabindex="-1"></a>                                <span class="co"># variables</span></span>
<span id="cb47-1339"><a href="#cb47-1339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(mean_flipper, <span class="dv">210</span>)</span>
<span id="cb47-1340"><a href="#cb47-1340" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Examples: Average customer age 20-80, mean salary $30k-200k, etc.</span></span>
<span id="cb47-1341"><a href="#cb47-1341" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1342"><a href="#cb47-1342" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test other central tendencies</span></span>
<span id="cb47-1343"><a href="#cb47-1343" aria-hidden="true" tabindex="-1"></a>  mean_mass <span class="ot">&lt;-</span> <span class="fu">mean</span>(df<span class="sc">$</span>body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-1344"><a href="#cb47-1344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(mean_mass, <span class="dv">4000</span>)</span>
<span id="cb47-1345"><a href="#cb47-1345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(mean_mass, <span class="dv">5000</span>)</span>
<span id="cb47-1346"><a href="#cb47-1346" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1347"><a href="#cb47-1347" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test variability measures are reasonable</span></span>
<span id="cb47-1348"><a href="#cb47-1348" aria-hidden="true" tabindex="-1"></a>  sd_flipper <span class="ot">&lt;-</span> <span class="fu">sd</span>(df<span class="sc">$</span>flipper_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-1349"><a href="#cb47-1349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(sd_flipper, <span class="dv">5</span>)   <span class="co"># Not zero variance</span></span>
<span id="cb47-1350"><a href="#cb47-1350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(sd_flipper, <span class="dv">30</span>)  <span class="co"># Not excessive variance</span></span>
<span id="cb47-1351"><a href="#cb47-1351" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: CV should be &lt;50%, SD should be meaningful relative to mean</span></span>
<span id="cb47-1352"><a href="#cb47-1352" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-1353"><a href="#cb47-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1354"><a href="#cb47-1354" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 10: Complete Analysis Pipeline Integration Test</span></span>
<span id="cb47-1355"><a href="#cb47-1355" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Test your entire analysis workflow runs without </span></span>
<span id="cb47-1356"><a href="#cb47-1356" aria-hidden="true" tabindex="-1"></a><span class="co"># errors</span></span>
<span id="cb47-1357"><a href="#cb47-1357" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Pipeline breaks, dependency issues, function interaction problems</span></span>
<span id="cb47-1358"><a href="#cb47-1358" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Complete analysis pipeline executes successfully"</span>, {</span>
<span id="cb47-1359"><a href="#cb47-1359" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb47-1360"><a href="#cb47-1360" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1361"><a href="#cb47-1361" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that full workflow executes without errors</span></span>
<span id="cb47-1362"><a href="#cb47-1362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_no_error</span>({</span>
<span id="cb47-1363"><a href="#cb47-1363" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data preparation step</span></span>
<span id="cb47-1364"><a href="#cb47-1364" aria-hidden="true" tabindex="-1"></a>    clean_df <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df[<span class="fu">c</span>(<span class="st">"flipper_length_mm"</span>, </span>
<span id="cb47-1365"><a href="#cb47-1365" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"bill_length_mm"</span>)]), ]</span>
<span id="cb47-1366"><a href="#cb47-1366" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-1367"><a href="#cb47-1367" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Statistical analysis step - Adapt: Your key analyses</span></span>
<span id="cb47-1368"><a href="#cb47-1368" aria-hidden="true" tabindex="-1"></a>    correlation_result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(clean_df<span class="sc">$</span>flipper_length_mm, </span>
<span id="cb47-1369"><a href="#cb47-1369" aria-hidden="true" tabindex="-1"></a>                                   clean_df<span class="sc">$</span>bill_length_mm)</span>
<span id="cb47-1370"><a href="#cb47-1370" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-1371"><a href="#cb47-1371" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization step - Adapt: Your key plots</span></span>
<span id="cb47-1372"><a href="#cb47-1372" aria-hidden="true" tabindex="-1"></a>    plot_result <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(clean_df, </span>
<span id="cb47-1373"><a href="#cb47-1373" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb47-1374"><a href="#cb47-1374" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb47-1375"><a href="#cb47-1375" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb47-1376"><a href="#cb47-1376" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb47-1377"><a href="#cb47-1377" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Flipper Length vs. Bill Length"</span>,</span>
<span id="cb47-1378"><a href="#cb47-1378" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span id="cb47-1379"><a href="#cb47-1379" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"Bill Length (mm)"</span>)</span>
<span id="cb47-1380"><a href="#cb47-1380" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb47-1381"><a href="#cb47-1381" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Add model fitting, prediction, reporting steps as needed</span></span>
<span id="cb47-1382"><a href="#cb47-1382" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1383"><a href="#cb47-1383" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify analysis produces meaningful results</span></span>
<span id="cb47-1384"><a href="#cb47-1384" aria-hidden="true" tabindex="-1"></a>  clean_df <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df[<span class="fu">c</span>(<span class="st">"flipper_length_mm"</span>, </span>
<span id="cb47-1385"><a href="#cb47-1385" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"bill_length_mm"</span>)]), ]</span>
<span id="cb47-1386"><a href="#cb47-1386" aria-hidden="true" tabindex="-1"></a>  correlation_result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(clean_df<span class="sc">$</span>flipper_length_mm, </span>
<span id="cb47-1387"><a href="#cb47-1387" aria-hidden="true" tabindex="-1"></a>                                 clean_df<span class="sc">$</span>bill_length_mm)</span>
<span id="cb47-1388"><a href="#cb47-1388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(correlation_result<span class="sc">$</span>p.value, <span class="fl">0.05</span>)  <span class="co"># Significant result expected</span></span>
<span id="cb47-1389"><a href="#cb47-1389" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Check model R², prediction accuracy, convergence, etc.</span></span>
<span id="cb47-1390"><a href="#cb47-1390" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-1391"><a href="#cb47-1391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1392"><a href="#cb47-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1393"><a href="#cb47-1393" aria-hidden="true" tabindex="-1"></a><span class="fu">## Running the Tests</span></span>
<span id="cb47-1394"><a href="#cb47-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1395"><a href="#cb47-1395" aria-hidden="true" tabindex="-1"></a>To run all tests in your project:</span>
<span id="cb47-1396"><a href="#cb47-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1397"><a href="#cb47-1397" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb47-1398"><a href="#cb47-1398" aria-hidden="true" tabindex="-1"></a><span class="co"># Run all tests</span></span>
<span id="cb47-1399"><a href="#cb47-1399" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_dir</span>(<span class="st">"tests/testthat"</span>)</span>
<span id="cb47-1400"><a href="#cb47-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1401"><a href="#cb47-1401" aria-hidden="true" tabindex="-1"></a><span class="co"># Run specific test file</span></span>
<span id="cb47-1402"><a href="#cb47-1402" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_file</span>(<span class="st">"tests/testthat/test-comprehensive-analysis.R"</span>)</span>
<span id="cb47-1403"><a href="#cb47-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1404"><a href="#cb47-1404" aria-hidden="true" tabindex="-1"></a><span class="co"># Run tests with detailed output</span></span>
<span id="cb47-1405"><a href="#cb47-1405" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_dir</span>(<span class="st">"tests/testthat"</span>, <span class="at">reporter =</span> <span class="st">"detailed"</span>)</span>
<span id="cb47-1406"><a href="#cb47-1406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1407"><a href="#cb47-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1408"><a href="#cb47-1408" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test Categories Explained</span></span>
<span id="cb47-1409"><a href="#cb47-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1410"><a href="#cb47-1410" aria-hidden="true" tabindex="-1"></a>**Data Validation Tests (1-5)**: Verify data structure, types, ranges, and</span>
<span id="cb47-1411"><a href="#cb47-1411" aria-hidden="true" tabindex="-1"></a>missing patterns</span>
<span id="cb47-1412"><a href="#cb47-1412" aria-hidden="true" tabindex="-1"></a>**Statistical Tests (6)**: Confirm expected relationships in the data</span>
<span id="cb47-1413"><a href="#cb47-1413" aria-hidden="true" tabindex="-1"></a>**Functional Tests (7-8)**: Ensure analysis functions work correctly</span>
<span id="cb47-1414"><a href="#cb47-1414" aria-hidden="true" tabindex="-1"></a>**Sanity Tests (9)**: Check that summary statistics are reasonable</span>
<span id="cb47-1415"><a href="#cb47-1415" aria-hidden="true" tabindex="-1"></a>**Integration Tests (10)**: Verify the complete analysis pipeline works </span>
<span id="cb47-1416"><a href="#cb47-1416" aria-hidden="true" tabindex="-1"></a>end-to-end</span>
<span id="cb47-1417"><a href="#cb47-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1418"><a href="#cb47-1418" aria-hidden="true" tabindex="-1"></a>These tests provide coverage for a data analysis project and </span>
<span id="cb47-1419"><a href="#cb47-1419" aria-hidden="true" tabindex="-1"></a>can catch issues ranging from data corruption to environment setup problems.</span>
<span id="cb47-1420"><a href="#cb47-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1421"><a href="#cb47-1421" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix C: Directory Structure {.unnumbered}</span></span>
<span id="cb47-1422"><a href="#cb47-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1423"><a href="#cb47-1423" aria-hidden="true" tabindex="-1"></a>The zzrrtools setup creates the following directory structure:</span>
<span id="cb47-1424"><a href="#cb47-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1425"><a href="#cb47-1425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1426"><a href="#cb47-1426" aria-hidden="true" tabindex="-1"></a><span class="in">project/</span></span>
<span id="cb47-1427"><a href="#cb47-1427" aria-hidden="true" tabindex="-1"></a><span class="in">├── DESCRIPTION              # Package metadata and dependencies</span></span>
<span id="cb47-1428"><a href="#cb47-1428" aria-hidden="true" tabindex="-1"></a><span class="in">├── LICENSE                  # Project license  </span></span>
<span id="cb47-1429"><a href="#cb47-1429" aria-hidden="true" tabindex="-1"></a><span class="in">├── README.md               # Project documentation</span></span>
<span id="cb47-1430"><a href="#cb47-1430" aria-hidden="true" tabindex="-1"></a><span class="in">├── project.Rproj           # R project file</span></span>
<span id="cb47-1431"><a href="#cb47-1431" aria-hidden="true" tabindex="-1"></a><span class="in">├── renv.lock               # Package dependency lockfile</span></span>
<span id="cb47-1432"><a href="#cb47-1432" aria-hidden="true" tabindex="-1"></a><span class="in">├── setup_renv.R            # Automated renv setup script</span></span>
<span id="cb47-1433"><a href="#cb47-1433" aria-hidden="true" tabindex="-1"></a><span class="in">├── Dockerfile              # Container specification</span></span>
<span id="cb47-1434"><a href="#cb47-1434" aria-hidden="true" tabindex="-1"></a><span class="in">├── docker-compose.yml      # Multi-service Docker setup</span></span>
<span id="cb47-1435"><a href="#cb47-1435" aria-hidden="true" tabindex="-1"></a><span class="in">├── Makefile                # Build automation (native R + Docker)</span></span>
<span id="cb47-1436"><a href="#cb47-1436" aria-hidden="true" tabindex="-1"></a><span class="in">├── .Rprofile               # R startup configuration</span></span>
<span id="cb47-1437"><a href="#cb47-1437" aria-hidden="true" tabindex="-1"></a><span class="in">├── .dockerignore           # Docker build exclusions</span></span>
<span id="cb47-1438"><a href="#cb47-1438" aria-hidden="true" tabindex="-1"></a><span class="in">├── ZZRRTOOLS_USER_GUIDE.md # Comprehensive user documentation</span></span>
<span id="cb47-1439"><a href="#cb47-1439" aria-hidden="true" tabindex="-1"></a><span class="in">├── .zshrc_docker           # zsh configuration for Docker container</span></span>
<span id="cb47-1440"><a href="#cb47-1440" aria-hidden="true" tabindex="-1"></a><span class="in">├── .github/workflows/      # Multiple GitHub Actions workflows</span></span>
<span id="cb47-1441"><a href="#cb47-1441" aria-hidden="true" tabindex="-1"></a><span class="in">│   ├── docker-ci.yml       # Docker-based CI/CD</span></span>
<span id="cb47-1442"><a href="#cb47-1442" aria-hidden="true" tabindex="-1"></a><span class="in">│   ├── r-package.yml       # R package checking</span></span>
<span id="cb47-1443"><a href="#cb47-1443" aria-hidden="true" tabindex="-1"></a><span class="in">│   └── render-paper.yml    # Automated paper rendering</span></span>
<span id="cb47-1444"><a href="#cb47-1444" aria-hidden="true" tabindex="-1"></a><span class="in">├── check_renv_for_commit.R # renv consistency validation script</span></span>
<span id="cb47-1445"><a href="#cb47-1445" aria-hidden="true" tabindex="-1"></a><span class="in">├── R/                      # R functions and utilities</span></span>
<span id="cb47-1446"><a href="#cb47-1446" aria-hidden="true" tabindex="-1"></a><span class="in">│   └── utils.R             # Pre-built utility functions</span></span>
<span id="cb47-1447"><a href="#cb47-1447" aria-hidden="true" tabindex="-1"></a><span class="in">├── man/                    # Generated function documentation</span></span>
<span id="cb47-1448"><a href="#cb47-1448" aria-hidden="true" tabindex="-1"></a><span class="in">├── data/                   # Comprehensive data organization</span></span>
<span id="cb47-1449"><a href="#cb47-1449" aria-hidden="true" tabindex="-1"></a><span class="in">│   ├── raw_data/           # Original, unmodified data</span></span>
<span id="cb47-1450"><a href="#cb47-1450" aria-hidden="true" tabindex="-1"></a><span class="in">│   ├── derived_data/       # Processed/cleaned data</span></span>
<span id="cb47-1451"><a href="#cb47-1451" aria-hidden="true" tabindex="-1"></a><span class="in">│   ├── metadata/           # Data documentation</span></span>
<span id="cb47-1452"><a href="#cb47-1452" aria-hidden="true" tabindex="-1"></a><span class="in">│   ├── validation/         # Data validation scripts</span></span>
<span id="cb47-1453"><a href="#cb47-1453" aria-hidden="true" tabindex="-1"></a><span class="in">│   └── external_data/      # Third-party datasets</span></span>
<span id="cb47-1454"><a href="#cb47-1454" aria-hidden="true" tabindex="-1"></a><span class="in">├── analysis/               # Research analysis</span></span>
<span id="cb47-1455"><a href="#cb47-1455" aria-hidden="true" tabindex="-1"></a><span class="in">│   ├── paper/              # Manuscript with PDF output</span></span>
<span id="cb47-1456"><a href="#cb47-1456" aria-hidden="true" tabindex="-1"></a><span class="in">│   ├── figures/            # Generated plots and charts</span></span>
<span id="cb47-1457"><a href="#cb47-1457" aria-hidden="true" tabindex="-1"></a><span class="in">│   ├── tables/             # Generated tables</span></span>
<span id="cb47-1458"><a href="#cb47-1458" aria-hidden="true" tabindex="-1"></a><span class="in">│   └── templates/          # Document templates and CSL styles</span></span>
<span id="cb47-1459"><a href="#cb47-1459" aria-hidden="true" tabindex="-1"></a><span class="in">├── scripts/                # Working R scripts and code snippets</span></span>
<span id="cb47-1460"><a href="#cb47-1460" aria-hidden="true" tabindex="-1"></a><span class="in">├── tests/testthat/         # Unit tests and validation</span></span>
<span id="cb47-1461"><a href="#cb47-1461" aria-hidden="true" tabindex="-1"></a><span class="in">├── vignettes/              # Package vignettes and tutorials</span></span>
<span id="cb47-1462"><a href="#cb47-1462" aria-hidden="true" tabindex="-1"></a><span class="in">├── inst/doc/               # Package documentation</span></span>
<span id="cb47-1463"><a href="#cb47-1463" aria-hidden="true" tabindex="-1"></a><span class="in">├── docs/                   # Additional documentation</span></span>
<span id="cb47-1464"><a href="#cb47-1464" aria-hidden="true" tabindex="-1"></a><span class="in">├── archive/                # Archived files and old versions</span></span>
<span id="cb47-1465"><a href="#cb47-1465" aria-hidden="true" tabindex="-1"></a><span class="in">└── [a,n,f,t,s,m,e,o,c]    # Symbolic links for easy navigation</span></span>
<span id="cb47-1466"><a href="#cb47-1466" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1467"><a href="#cb47-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1468"><a href="#cb47-1468" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Features Explained:</span></span>
<span id="cb47-1469"><a href="#cb47-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1470"><a href="#cb47-1470" aria-hidden="true" tabindex="-1"></a>**Data Organization:**</span>
<span id="cb47-1471"><a href="#cb47-1471" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**raw_data/**: Original, unmodified datasets as received</span>
<span id="cb47-1472"><a href="#cb47-1472" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**derived_data/**: Processed, cleaned, or transformed data</span>
<span id="cb47-1473"><a href="#cb47-1473" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**metadata/**: Documentation about data sources, collection methods, </span>
<span id="cb47-1474"><a href="#cb47-1474" aria-hidden="true" tabindex="-1"></a>  variables</span>
<span id="cb47-1475"><a href="#cb47-1475" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**validation/**: Scripts that verify data integrity and quality</span>
<span id="cb47-1476"><a href="#cb47-1476" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**external_data/**: Third-party datasets or reference data</span>
<span id="cb47-1477"><a href="#cb47-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1478"><a href="#cb47-1478" aria-hidden="true" tabindex="-1"></a>**Multiple Output Formats:**</span>
<span id="cb47-1479"><a href="#cb47-1479" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**figures/**: Generated plots, charts, and visualizations</span>
<span id="cb47-1480"><a href="#cb47-1480" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**tables/**: Generated summary tables and statistical results</span>
<span id="cb47-1481"><a href="#cb47-1481" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**paper/**: Main manuscript and analysis documents</span>
<span id="cb47-1482"><a href="#cb47-1482" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**templates/**: Document templates and citation style files</span>
<span id="cb47-1483"><a href="#cb47-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1484"><a href="#cb47-1484" aria-hidden="true" tabindex="-1"></a>**R Package Structure:**</span>
<span id="cb47-1485"><a href="#cb47-1485" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**R/**: Custom functions and utilities</span>
<span id="cb47-1486"><a href="#cb47-1486" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**man/**: Generated documentation for R functions</span>
<span id="cb47-1487"><a href="#cb47-1487" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**tests/testthat/**: Unit tests and validation scripts</span>
<span id="cb47-1488"><a href="#cb47-1488" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**vignettes/**: Long-form documentation and tutorials</span>
<span id="cb47-1489"><a href="#cb47-1489" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**DESCRIPTION**: Package metadata and dependency specifications</span>
<span id="cb47-1490"><a href="#cb47-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1491"><a href="#cb47-1491" aria-hidden="true" tabindex="-1"></a>**Docker Orchestration:**</span>
<span id="cb47-1492"><a href="#cb47-1492" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Dockerfile**: Main container specification</span>
<span id="cb47-1493"><a href="#cb47-1493" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**docker-compose.yml**: Multi-service development environments</span>
<span id="cb47-1494"><a href="#cb47-1494" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Makefile**: Build automation supporting both native R and Docker </span>
<span id="cb47-1495"><a href="#cb47-1495" aria-hidden="true" tabindex="-1"></a>  workflows</span>
<span id="cb47-1496"><a href="#cb47-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1497"><a href="#cb47-1497" aria-hidden="true" tabindex="-1"></a>**Workflows:**</span>
<span id="cb47-1498"><a href="#cb47-1498" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**.github/workflows/**: GitHub Actions for testing, checking, and </span>
<span id="cb47-1499"><a href="#cb47-1499" aria-hidden="true" tabindex="-1"></a>  rendering</span>
<span id="cb47-1500"><a href="#cb47-1500" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**setup_renv.R**: Package environment setup</span>
<span id="cb47-1501"><a href="#cb47-1501" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**RRTOOLS_USER_GUIDE.md**: Usage documentation</span>
<span id="cb47-1502"><a href="#cb47-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1503"><a href="#cb47-1503" aria-hidden="true" tabindex="-1"></a>**Navigation Shortcuts:**</span>
<span id="cb47-1504"><a href="#cb47-1504" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Symbolic links**: Single-letter shortcuts for easy navigation</span>
<span id="cb47-1505"><a href="#cb47-1505" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`a`</span> → analysis/, <span class="in">`n`</span> → analysis/, <span class="in">`f`</span> → figures/</span>
<span id="cb47-1506"><a href="#cb47-1506" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`t`</span> → tests/, <span class="in">`s`</span> → scripts/, <span class="in">`m`</span> → man/</span>
<span id="cb47-1507"><a href="#cb47-1507" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`e`</span> → external_data/, <span class="in">`o`</span> → output/, <span class="in">`c`</span> → cache/</span>
<span id="cb47-1508"><a href="#cb47-1508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1509"><a href="#cb47-1509" aria-hidden="true" tabindex="-1"></a>This structure supports research projects while maintaining clear </span>
<span id="cb47-1510"><a href="#cb47-1510" aria-hidden="true" tabindex="-1"></a>organization and following established research compendium principles.</span>
<span id="cb47-1511"><a href="#cb47-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1512"><a href="#cb47-1512" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix D: Docker Workflow Options {.unnumbered}</span></span>
<span id="cb47-1513"><a href="#cb47-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1514"><a href="#cb47-1514" aria-hidden="true" tabindex="-1"></a>The zzrrtools setup provides a multi-service Docker architecture optimized </span>
<span id="cb47-1515"><a href="#cb47-1515" aria-hidden="true" tabindex="-1"></a>for collaborative shell-based development workflows.</span>
<span id="cb47-1516"><a href="#cb47-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1517"><a href="#cb47-1517" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multi-Service Docker Architecture</span></span>
<span id="cb47-1518"><a href="#cb47-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1519"><a href="#cb47-1519" aria-hidden="true" tabindex="-1"></a>zzrrtools creates specialized Docker environments for different development tasks:</span>
<span id="cb47-1520"><a href="#cb47-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1521"><a href="#cb47-1521" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-1522"><a href="#cb47-1522" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the containerized research environment</span></span>
<span id="cb47-1523"><a href="#cb47-1523" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build</span>
<span id="cb47-1524"><a href="#cb47-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1525"><a href="#cb47-1525" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive R console (primary development environment)</span></span>
<span id="cb47-1526"><a href="#cb47-1526" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r</span>
<span id="cb47-1527"><a href="#cb47-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1528"><a href="#cb47-1528" aria-hidden="true" tabindex="-1"></a><span class="co"># Development shell with personal dotfiles</span></span>
<span id="cb47-1529"><a href="#cb47-1529" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-zsh</span>
<span id="cb47-1530"><a href="#cb47-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1531"><a href="#cb47-1531" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive bash session</span></span>
<span id="cb47-1532"><a href="#cb47-1532" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-bash</span>
<span id="cb47-1533"><a href="#cb47-1533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1534"><a href="#cb47-1534" aria-hidden="true" tabindex="-1"></a><span class="co"># RStudio Server (web-based IDE)</span></span>
<span id="cb47-1535"><a href="#cb47-1535" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-rstudio    <span class="co"># Access at http://localhost:8787</span></span>
<span id="cb47-1536"><a href="#cb47-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1537"><a href="#cb47-1537" aria-hidden="true" tabindex="-1"></a><span class="co"># Render research paper</span></span>
<span id="cb47-1538"><a href="#cb47-1538" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-render</span>
<span id="cb47-1539"><a href="#cb47-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1540"><a href="#cb47-1540" aria-hidden="true" tabindex="-1"></a><span class="co"># Run tests</span></span>
<span id="cb47-1541"><a href="#cb47-1541" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-test</span>
<span id="cb47-1542"><a href="#cb47-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1543"><a href="#cb47-1543" aria-hidden="true" tabindex="-1"></a><span class="co"># Package checking</span></span>
<span id="cb47-1544"><a href="#cb47-1544" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check</span>
<span id="cb47-1545"><a href="#cb47-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1546"><a href="#cb47-1546" aria-hidden="true" tabindex="-1"></a><span class="co"># renv dependency validation</span></span>
<span id="cb47-1547"><a href="#cb47-1547" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check-renv-fix</span>
<span id="cb47-1548"><a href="#cb47-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1549"><a href="#cb47-1549" aria-hidden="true" tabindex="-1"></a><span class="co"># See all available commands</span></span>
<span id="cb47-1550"><a href="#cb47-1550" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> help</span>
<span id="cb47-1551"><a href="#cb47-1551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1552"><a href="#cb47-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1553"><a href="#cb47-1553" aria-hidden="true" tabindex="-1"></a>**Collaborative Benefits:**</span>
<span id="cb47-1554"><a href="#cb47-1554" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Zero-setup onboarding**: Team members run identical commands</span>
<span id="cb47-1555"><a href="#cb47-1555" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Consistent environments**: Same container across all developer machines</span>
<span id="cb47-1556"><a href="#cb47-1556" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**ARM64/Apple Silicon support**: Platform-specific flags ensure compatibility</span>
<span id="cb47-1557"><a href="#cb47-1557" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Shell-optimized workflows**: Command-line development with rich tooling</span>
<span id="cb47-1558"><a href="#cb47-1558" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Personal customization**: Dotfiles integration for familiar environments</span>
<span id="cb47-1559"><a href="#cb47-1559" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Web-based development**: Optional RStudio Server for GUI-based workflows</span>
<span id="cb47-1560"><a href="#cb47-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1561"><a href="#cb47-1561" aria-hidden="true" tabindex="-1"></a><span class="fu">## Option 2: Docker Compose Services</span></span>
<span id="cb47-1562"><a href="#cb47-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1563"><a href="#cb47-1563" aria-hidden="true" tabindex="-1"></a>Docker Compose orchestrates multiple container configurations:</span>
<span id="cb47-1564"><a href="#cb47-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1565"><a href="#cb47-1565" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-1566"><a href="#cb47-1566" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive R session</span></span>
<span id="cb47-1567"><a href="#cb47-1567" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> r-session</span>
<span id="cb47-1568"><a href="#cb47-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1569"><a href="#cb47-1569" aria-hidden="true" tabindex="-1"></a><span class="co"># Bash shell access</span></span>
<span id="cb47-1570"><a href="#cb47-1570" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> bash</span>
<span id="cb47-1571"><a href="#cb47-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1572"><a href="#cb47-1572" aria-hidden="true" tabindex="-1"></a><span class="co"># Automated paper rendering</span></span>
<span id="cb47-1573"><a href="#cb47-1573" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> research</span>
<span id="cb47-1574"><a href="#cb47-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1575"><a href="#cb47-1575" aria-hidden="true" tabindex="-1"></a><span class="co"># Package testing</span></span>
<span id="cb47-1576"><a href="#cb47-1576" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> test</span>
<span id="cb47-1577"><a href="#cb47-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1578"><a href="#cb47-1578" aria-hidden="true" tabindex="-1"></a><span class="co"># Package checking</span></span>
<span id="cb47-1579"><a href="#cb47-1579" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> check</span>
<span id="cb47-1580"><a href="#cb47-1580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1581"><a href="#cb47-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1582"><a href="#cb47-1582" aria-hidden="true" tabindex="-1"></a>**Docker Compose Configuration Example:**</span>
<span id="cb47-1583"><a href="#cb47-1583" aria-hidden="true" tabindex="-1"></a><span class="in">```yaml</span></span>
<span id="cb47-1584"><a href="#cb47-1584" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb47-1585"><a href="#cb47-1585" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">r-session</span><span class="kw">:</span></span>
<span id="cb47-1586"><a href="#cb47-1586" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb47-1587"><a href="#cb47-1587" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb47-1588"><a href="#cb47-1588" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span>.:/home/analyst/project</span>
<span id="cb47-1589"><a href="#cb47-1589" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span>./cache:/home/analyst/cache</span>
<span id="cb47-1590"><a href="#cb47-1590" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">working_dir</span><span class="kw">:</span><span class="at"> /home/analyst/project</span></span>
<span id="cb47-1591"><a href="#cb47-1591" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb47-1592"><a href="#cb47-1592" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bash</span><span class="kw">:</span></span>
<span id="cb47-1593"><a href="#cb47-1593" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb47-1594"><a href="#cb47-1594" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb47-1595"><a href="#cb47-1595" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span>.:/home/analyst/project</span>
<span id="cb47-1596"><a href="#cb47-1596" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">working_dir</span><span class="kw">:</span><span class="at"> /home/analyst/project</span></span>
<span id="cb47-1597"><a href="#cb47-1597" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">entrypoint</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"/bin/bash"</span><span class="kw">]</span></span>
<span id="cb47-1598"><a href="#cb47-1598" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb47-1599"><a href="#cb47-1599" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">research</span><span class="kw">:</span></span>
<span id="cb47-1600"><a href="#cb47-1600" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb47-1601"><a href="#cb47-1601" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb47-1602"><a href="#cb47-1602" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span>.:/home/analyst/project</span>
<span id="cb47-1603"><a href="#cb47-1603" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span>./analysis/figures:/home/analyst/output</span>
<span id="cb47-1604"><a href="#cb47-1604" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">working_dir</span><span class="kw">:</span><span class="at"> /home/analyst/project</span></span>
<span id="cb47-1605"><a href="#cb47-1605" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"R"</span><span class="kw">,</span><span class="at"> </span><span class="st">"-e"</span><span class="kw">,</span><span class="at"> </span><span class="st">"rmarkdown::render('analysis/paper/paper.Rmd')"</span><span class="kw">]</span></span>
<span id="cb47-1606"><a href="#cb47-1606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1607"><a href="#cb47-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1608"><a href="#cb47-1608" aria-hidden="true" tabindex="-1"></a>**Benefits:**</span>
<span id="cb47-1609"><a href="#cb47-1609" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Service setup**: Multiple predefined container configurations</span>
<span id="cb47-1610"><a href="#cb47-1610" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Volume management**: Consistent volume mounting across services</span>
<span id="cb47-1611"><a href="#cb47-1611" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Environment isolation**: Different services for different purposes</span>
<span id="cb47-1612"><a href="#cb47-1612" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Parallel execution**: Can run multiple services simultaneously</span>
<span id="cb47-1613"><a href="#cb47-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1614"><a href="#cb47-1614" aria-hidden="true" tabindex="-1"></a><span class="fu">## Option 3: Direct Docker Commands</span></span>
<span id="cb47-1615"><a href="#cb47-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1616"><a href="#cb47-1616" aria-hidden="true" tabindex="-1"></a>For maximum control, use Docker commands directly:</span>
<span id="cb47-1617"><a href="#cb47-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1618"><a href="#cb47-1618" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-1619"><a href="#cb47-1619" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic interactive session</span></span>
<span id="cb47-1620"><a href="#cb47-1620" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-it</span> <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb47-1621"><a href="#cb47-1621" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0</span>
<span id="cb47-1622"><a href="#cb47-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1623"><a href="#cb47-1623" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive session with mounted cache</span></span>
<span id="cb47-1624"><a href="#cb47-1624" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-it</span> <span class="dt">\</span></span>
<span id="cb47-1625"><a href="#cb47-1625" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb47-1626"><a href="#cb47-1626" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/cache:/home/analyst/cache"</span> <span class="dt">\</span></span>
<span id="cb47-1627"><a href="#cb47-1627" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb47-1628"><a href="#cb47-1628" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0</span>
<span id="cb47-1629"><a href="#cb47-1629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1630"><a href="#cb47-1630" aria-hidden="true" tabindex="-1"></a><span class="co"># Render research paper</span></span>
<span id="cb47-1631"><a href="#cb47-1631" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb47-1632"><a href="#cb47-1632" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb47-1633"><a href="#cb47-1633" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/analysis/figures:/home/analyst/output"</span> <span class="dt">\</span></span>
<span id="cb47-1634"><a href="#cb47-1634" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb47-1635"><a href="#cb47-1635" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0 <span class="dt">\</span></span>
<span id="cb47-1636"><a href="#cb47-1636" aria-hidden="true" tabindex="-1"></a>  R <span class="at">-e</span> <span class="st">"rmarkdown::render('analysis/paper/paper.Rmd')"</span></span>
<span id="cb47-1637"><a href="#cb47-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1638"><a href="#cb47-1638" aria-hidden="true" tabindex="-1"></a><span class="co"># Run specific tests</span></span>
<span id="cb47-1639"><a href="#cb47-1639" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb47-1640"><a href="#cb47-1640" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb47-1641"><a href="#cb47-1641" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb47-1642"><a href="#cb47-1642" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0 <span class="dt">\</span></span>
<span id="cb47-1643"><a href="#cb47-1643" aria-hidden="true" tabindex="-1"></a>  R <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test-data-integrity.R')"</span></span>
<span id="cb47-1644"><a href="#cb47-1644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1645"><a href="#cb47-1645" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive bash session</span></span>
<span id="cb47-1646"><a href="#cb47-1646" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-it</span> <span class="dt">\</span></span>
<span id="cb47-1647"><a href="#cb47-1647" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb47-1648"><a href="#cb47-1648" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb47-1649"><a href="#cb47-1649" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0 <span class="dt">\</span></span>
<span id="cb47-1650"><a href="#cb47-1650" aria-hidden="true" tabindex="-1"></a>  /bin/bash</span>
<span id="cb47-1651"><a href="#cb47-1651" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1652"><a href="#cb47-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1653"><a href="#cb47-1653" aria-hidden="true" tabindex="-1"></a>**Common Docker Flags Explained:**</span>
<span id="cb47-1654"><a href="#cb47-1654" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`--rm`</span>: Remove container when it exits</span>
<span id="cb47-1655"><a href="#cb47-1655" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`-it`</span>: Interactive terminal session</span>
<span id="cb47-1656"><a href="#cb47-1656" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`-v`</span>: Mount volume (host:container)</span>
<span id="cb47-1657"><a href="#cb47-1657" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`-w`</span>: Set working directory inside container</span>
<span id="cb47-1658"><a href="#cb47-1658" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`--entrypoint`</span>: Override default command</span>
<span id="cb47-1659"><a href="#cb47-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1660"><a href="#cb47-1660" aria-hidden="true" tabindex="-1"></a>**Benefits:**</span>
<span id="cb47-1661"><a href="#cb47-1661" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Full flexibility**: Complete control over container configuration</span>
<span id="cb47-1662"><a href="#cb47-1662" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Educational**: Shows exactly what's happening under the hood</span>
<span id="cb47-1663"><a href="#cb47-1663" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Troubleshooting**: Easier to debug when you see all options</span>
<span id="cb47-1664"><a href="#cb47-1664" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Portability**: Commands work on any Docker installation</span>
<span id="cb47-1665"><a href="#cb47-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1666"><a href="#cb47-1666" aria-hidden="true" tabindex="-1"></a><span class="fu">## Volume Mounting Strategies</span></span>
<span id="cb47-1667"><a href="#cb47-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1668"><a href="#cb47-1668" aria-hidden="true" tabindex="-1"></a>**Project Files:**</span>
<span id="cb47-1669"><a href="#cb47-1669" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-1670"><a href="#cb47-1670" aria-hidden="true" tabindex="-1"></a><span class="co"># Mount entire project directory</span></span>
<span id="cb47-1671"><a href="#cb47-1671" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span></span>
<span id="cb47-1672"><a href="#cb47-1672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1673"><a href="#cb47-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1674"><a href="#cb47-1674" aria-hidden="true" tabindex="-1"></a>**Output Separation:**</span>
<span id="cb47-1675"><a href="#cb47-1675" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-1676"><a href="#cb47-1676" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate outputs from source</span></span>
<span id="cb47-1677"><a href="#cb47-1677" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/analysis/figures:/home/analyst/output"</span></span>
<span id="cb47-1678"><a href="#cb47-1678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1679"><a href="#cb47-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1680"><a href="#cb47-1680" aria-hidden="true" tabindex="-1"></a>**Cache Persistence:**</span>
<span id="cb47-1681"><a href="#cb47-1681" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-1682"><a href="#cb47-1682" aria-hidden="true" tabindex="-1"></a><span class="co"># Persistent package cache across sessions</span></span>
<span id="cb47-1683"><a href="#cb47-1683" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/cache:/home/analyst/cache"</span></span>
<span id="cb47-1684"><a href="#cb47-1684" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1685"><a href="#cb47-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1686"><a href="#cb47-1686" aria-hidden="true" tabindex="-1"></a>**Read-only Source:**</span>
<span id="cb47-1687"><a href="#cb47-1687" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-1688"><a href="#cb47-1688" aria-hidden="true" tabindex="-1"></a><span class="co"># Protect source files from modification</span></span>
<span id="cb47-1689"><a href="#cb47-1689" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project:ro"</span></span>
<span id="cb47-1690"><a href="#cb47-1690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1691"><a href="#cb47-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1692"><a href="#cb47-1692" aria-hidden="true" tabindex="-1"></a><span class="fu">## Choosing the Right Approach</span></span>
<span id="cb47-1693"><a href="#cb47-1693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1694"><a href="#cb47-1694" aria-hidden="true" tabindex="-1"></a>**Use Make Commands When:**</span>
<span id="cb47-1695"><a href="#cb47-1695" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You want simplicity and consistency</span>
<span id="cb47-1696"><a href="#cb47-1696" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're new to Docker</span>
<span id="cb47-1697"><a href="#cb47-1697" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're focusing on analysis rather than infrastructure</span>
<span id="cb47-1698"><a href="#cb47-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1699"><a href="#cb47-1699" aria-hidden="true" tabindex="-1"></a>**Use Docker Compose When:**</span>
<span id="cb47-1700"><a href="#cb47-1700" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You need multiple service configurations</span>
<span id="cb47-1701"><a href="#cb47-1701" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're working with a team using standardized environments</span>
<span id="cb47-1702"><a href="#cb47-1702" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You want to define complex volume and networking setups</span>
<span id="cb47-1703"><a href="#cb47-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1704"><a href="#cb47-1704" aria-hidden="true" tabindex="-1"></a>**Use Direct Commands When:**</span>
<span id="cb47-1705"><a href="#cb47-1705" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You need maximum flexibility</span>
<span id="cb47-1706"><a href="#cb47-1706" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're troubleshooting container issues</span>
<span id="cb47-1707"><a href="#cb47-1707" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're creating custom workflows not covered by Make targets</span>
<span id="cb47-1708"><a href="#cb47-1708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1709"><a href="#cb47-1709" aria-hidden="true" tabindex="-1"></a>All three approaches can be used together in the same project, depending on</span>
<span id="cb47-1710"><a href="#cb47-1710" aria-hidden="true" tabindex="-1"></a>the specific task and user preferences.</span>
<span id="cb47-1711"><a href="#cb47-1711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1712"><a href="#cb47-1712" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix E: GitHub Actions CI/CD Setup {.unnumbered}</span></span>
<span id="cb47-1713"><a href="#cb47-1713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1714"><a href="#cb47-1714" aria-hidden="true" tabindex="-1"></a>GitHub Actions provides testing and deployment for research </span>
<span id="cb47-1715"><a href="#cb47-1715" aria-hidden="true" tabindex="-1"></a>compendia. This appendix covers CI/CD setup for reproducible </span>
<span id="cb47-1716"><a href="#cb47-1716" aria-hidden="true" tabindex="-1"></a>research workflows.</span>
<span id="cb47-1717"><a href="#cb47-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1718"><a href="#cb47-1718" aria-hidden="true" tabindex="-1"></a><span class="fu">## Understanding GitHub Actions for Research</span></span>
<span id="cb47-1719"><a href="#cb47-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1720"><a href="#cb47-1720" aria-hidden="true" tabindex="-1"></a>**What is CI/CD for Research?**</span>
<span id="cb47-1721"><a href="#cb47-1721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1722"><a href="#cb47-1722" aria-hidden="true" tabindex="-1"></a>Continuous Integration/Continuous Deployment (CI/CD) tests </span>
<span id="cb47-1723"><a href="#cb47-1723" aria-hidden="true" tabindex="-1"></a>your research code whenever changes are made. For research compendia, this </span>
<span id="cb47-1724"><a href="#cb47-1724" aria-hidden="true" tabindex="-1"></a>means:</span>
<span id="cb47-1725"><a href="#cb47-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1726"><a href="#cb47-1726" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Testing**: Every push triggers your test suite</span>
<span id="cb47-1727"><a href="#cb47-1727" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Environment consistency**: Tests run in identical Docker environments</span>
<span id="cb47-1728"><a href="#cb47-1728" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Early error detection**: Problems caught during development</span>
<span id="cb47-1729"><a href="#cb47-1729" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Collaboration confidence**: Team members see if changes break </span>
<span id="cb47-1730"><a href="#cb47-1730" aria-hidden="true" tabindex="-1"></a>  functionality</span>
<span id="cb47-1731"><a href="#cb47-1731" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Reproducibility validation**: Ensures analysis works across different </span>
<span id="cb47-1732"><a href="#cb47-1732" aria-hidden="true" tabindex="-1"></a>  systems</span>
<span id="cb47-1733"><a href="#cb47-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1734"><a href="#cb47-1734" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step-by-Step Setup</span></span>
<span id="cb47-1735"><a href="#cb47-1735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1736"><a href="#cb47-1736" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 1: Create Workflow Directory</span></span>
<span id="cb47-1737"><a href="#cb47-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1738"><a href="#cb47-1738" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-1739"><a href="#cb47-1739" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the GitHub Actions directory</span></span>
<span id="cb47-1740"><a href="#cb47-1740" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> .github/workflows</span>
<span id="cb47-1741"><a href="#cb47-1741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1742"><a href="#cb47-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1743"><a href="#cb47-1743" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 2: Docker-based CI Workflow with renv Validation</span></span>
<span id="cb47-1744"><a href="#cb47-1744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1745"><a href="#cb47-1745" aria-hidden="true" tabindex="-1"></a>Create <span class="in">`.github/workflows/docker-ci.yml`</span>:</span>
<span id="cb47-1746"><a href="#cb47-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1747"><a href="#cb47-1747" aria-hidden="true" tabindex="-1"></a><span class="in">```yaml</span></span>
<span id="cb47-1748"><a href="#cb47-1748" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Docker CI with renv Validation</span></span>
<span id="cb47-1749"><a href="#cb47-1749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1750"><a href="#cb47-1750" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb47-1751"><a href="#cb47-1751" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb47-1752"><a href="#cb47-1752" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb47-1753"><a href="#cb47-1753" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb47-1754"><a href="#cb47-1754" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb47-1755"><a href="#cb47-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1756"><a href="#cb47-1756" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb47-1757"><a href="#cb47-1757" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">build-and-test</span><span class="kw">:</span></span>
<span id="cb47-1758"><a href="#cb47-1758" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb47-1759"><a href="#cb47-1759" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb47-1760"><a href="#cb47-1760" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb47-1761"><a href="#cb47-1761" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout repository</span></span>
<span id="cb47-1762"><a href="#cb47-1762" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb47-1763"><a href="#cb47-1763" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb47-1764"><a href="#cb47-1764" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up R for renv validation</span></span>
<span id="cb47-1765"><a href="#cb47-1765" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r@v2</span></span>
<span id="cb47-1766"><a href="#cb47-1766" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb47-1767"><a href="#cb47-1767" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">r-version</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span></span>
<span id="cb47-1768"><a href="#cb47-1768" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb47-1769"><a href="#cb47-1769" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install renv for validation</span></span>
<span id="cb47-1770"><a href="#cb47-1770" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb47-1771"><a href="#cb47-1771" aria-hidden="true" tabindex="-1"></a>        install.packages("renv")</span>
<span id="cb47-1772"><a href="#cb47-1772" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">shell</span><span class="kw">:</span><span class="at"> Rscript {0}</span></span>
<span id="cb47-1773"><a href="#cb47-1773" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb47-1774"><a href="#cb47-1774" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Validate renv consistency before Docker build</span></span>
<span id="cb47-1775"><a href="#cb47-1775" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb47-1776"><a href="#cb47-1776" aria-hidden="true" tabindex="-1"></a>        # Validate renv environment before building Docker image</span>
<span id="cb47-1777"><a href="#cb47-1777" aria-hidden="true" tabindex="-1"></a>        Rscript check_renv_for_commit.R --fail-on-issues --quiet</span>
<span id="cb47-1778"><a href="#cb47-1778" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb47-1779"><a href="#cb47-1779" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb47-1780"><a href="#cb47-1780" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb47-1781"><a href="#cb47-1781" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb47-1782"><a href="#cb47-1782" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Extract R version from renv.lock</span></span>
<span id="cb47-1783"><a href="#cb47-1783" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">id</span><span class="kw">:</span><span class="at"> r-version</span></span>
<span id="cb47-1784"><a href="#cb47-1784" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb47-1785"><a href="#cb47-1785" aria-hidden="true" tabindex="-1"></a>        R_VERSION=$(Rscript -e "cat(renv::lockfile_read()\$R\$Version)")</span>
<span id="cb47-1786"><a href="#cb47-1786" aria-hidden="true" tabindex="-1"></a>        echo "r-version=${R_VERSION}" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb47-1787"><a href="#cb47-1787" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb47-1788"><a href="#cb47-1788" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build Docker image</span></span>
<span id="cb47-1789"><a href="#cb47-1789" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v5</span></span>
<span id="cb47-1790"><a href="#cb47-1790" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb47-1791"><a href="#cb47-1791" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb47-1792"><a href="#cb47-1792" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">push</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb47-1793"><a href="#cb47-1793" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> ${{ github.repository }}:latest</span></span>
<span id="cb47-1794"><a href="#cb47-1794" aria-hidden="true" tabindex="-1"></a><span class="fu">        build-args</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb47-1795"><a href="#cb47-1795" aria-hidden="true" tabindex="-1"></a>          R_VERSION=${{ steps.r-version.outputs.r-version }}</span>
<span id="cb47-1796"><a href="#cb47-1796" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">cache-from</span><span class="kw">:</span><span class="at"> type=gha</span></span>
<span id="cb47-1797"><a href="#cb47-1797" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">cache-to</span><span class="kw">:</span><span class="at"> type=gha,mode=max</span></span>
<span id="cb47-1798"><a href="#cb47-1798" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb47-1799"><a href="#cb47-1799" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run tests in container</span></span>
<span id="cb47-1800"><a href="#cb47-1800" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb47-1801"><a href="#cb47-1801" aria-hidden="true" tabindex="-1"></a>        docker run --rm -v $PWD:/home/analyst/project \</span>
<span id="cb47-1802"><a href="#cb47-1802" aria-hidden="true" tabindex="-1"></a>          ${{ github.repository }}:latest \</span>
<span id="cb47-1803"><a href="#cb47-1803" aria-hidden="true" tabindex="-1"></a>          R -e "testthat::test_dir('tests/testthat')"</span>
<span id="cb47-1804"><a href="#cb47-1804" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb47-1805"><a href="#cb47-1805" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Render research paper</span></span>
<span id="cb47-1806"><a href="#cb47-1806" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb47-1807"><a href="#cb47-1807" aria-hidden="true" tabindex="-1"></a>        docker run --rm -v $PWD:/home/analyst/project \</span>
<span id="cb47-1808"><a href="#cb47-1808" aria-hidden="true" tabindex="-1"></a>          -v $PWD/analysis/figures:/home/analyst/output \</span>
<span id="cb47-1809"><a href="#cb47-1809" aria-hidden="true" tabindex="-1"></a>          ${{ github.repository }}:latest \</span>
<span id="cb47-1810"><a href="#cb47-1810" aria-hidden="true" tabindex="-1"></a>          R -e "rmarkdown::render('analysis/paper/paper.Rmd')"</span>
<span id="cb47-1811"><a href="#cb47-1811" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb47-1812"><a href="#cb47-1812" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Upload rendered paper</span></span>
<span id="cb47-1813"><a href="#cb47-1813" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/upload-artifact@v4</span></span>
<span id="cb47-1814"><a href="#cb47-1814" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">if</span><span class="kw">:</span><span class="at"> success()</span></span>
<span id="cb47-1815"><a href="#cb47-1815" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb47-1816"><a href="#cb47-1816" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> research-paper</span></span>
<span id="cb47-1817"><a href="#cb47-1817" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">path</span><span class="kw">:</span><span class="at"> analysis/paper/paper.pdf</span></span>
<span id="cb47-1818"><a href="#cb47-1818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1819"><a href="#cb47-1819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1820"><a href="#cb47-1820" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 3: R Package Check Workflow</span></span>
<span id="cb47-1821"><a href="#cb47-1821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1822"><a href="#cb47-1822" aria-hidden="true" tabindex="-1"></a>Create <span class="in">`.github/workflows/r-package.yml`</span>:</span>
<span id="cb47-1823"><a href="#cb47-1823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1824"><a href="#cb47-1824" aria-hidden="true" tabindex="-1"></a><span class="in">```yaml</span></span>
<span id="cb47-1825"><a href="#cb47-1825" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> R Package Check</span></span>
<span id="cb47-1826"><a href="#cb47-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1827"><a href="#cb47-1827" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb47-1828"><a href="#cb47-1828" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb47-1829"><a href="#cb47-1829" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb47-1830"><a href="#cb47-1830" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb47-1831"><a href="#cb47-1831" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb47-1832"><a href="#cb47-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1833"><a href="#cb47-1833" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb47-1834"><a href="#cb47-1834" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">R-CMD-check</span><span class="kw">:</span></span>
<span id="cb47-1835"><a href="#cb47-1835" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ${{ matrix.config.os }}</span></span>
<span id="cb47-1836"><a href="#cb47-1836" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb47-1837"><a href="#cb47-1837" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ${{ matrix.config.os }} (${{ matrix.config.r }})</span></span>
<span id="cb47-1838"><a href="#cb47-1838" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb47-1839"><a href="#cb47-1839" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb47-1840"><a href="#cb47-1840" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">fail-fast</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb47-1841"><a href="#cb47-1841" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb47-1842"><a href="#cb47-1842" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb47-1843"><a href="#cb47-1843" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="fu">os</span><span class="kw">:</span><span class="at"> ubuntu-latest</span><span class="kw">,</span><span class="at">   </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span><span class="kw">}</span></span>
<span id="cb47-1844"><a href="#cb47-1844" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="fu">os</span><span class="kw">:</span><span class="at"> macOS-latest</span><span class="kw">,</span><span class="at">    </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span><span class="kw">}</span></span>
<span id="cb47-1845"><a href="#cb47-1845" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="fu">os</span><span class="kw">:</span><span class="at"> windows-latest</span><span class="kw">,</span><span class="at">  </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span><span class="kw">}</span></span>
<span id="cb47-1846"><a href="#cb47-1846" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb47-1847"><a href="#cb47-1847" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb47-1848"><a href="#cb47-1848" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">GITHUB_PAT</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb47-1849"><a href="#cb47-1849" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">R_KEEP_PKG_SOURCE</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb47-1850"><a href="#cb47-1850" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb47-1851"><a href="#cb47-1851" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb47-1852"><a href="#cb47-1852" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb47-1853"><a href="#cb47-1853" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb47-1854"><a href="#cb47-1854" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-pandoc@v2</span></span>
<span id="cb47-1855"><a href="#cb47-1855" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb47-1856"><a href="#cb47-1856" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r@v2</span></span>
<span id="cb47-1857"><a href="#cb47-1857" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb47-1858"><a href="#cb47-1858" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">r-version</span><span class="kw">:</span><span class="at"> ${{ matrix.config.r }}</span></span>
<span id="cb47-1859"><a href="#cb47-1859" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">http-user-agent</span><span class="kw">:</span><span class="at"> ${{ matrix.config.http-user-agent }}</span></span>
<span id="cb47-1860"><a href="#cb47-1860" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">use-public-rspm</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb47-1861"><a href="#cb47-1861" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb47-1862"><a href="#cb47-1862" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-renv@v2</span></span>
<span id="cb47-1863"><a href="#cb47-1863" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb47-1864"><a href="#cb47-1864" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install system dependencies</span></span>
<span id="cb47-1865"><a href="#cb47-1865" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> runner.os == 'Linux'</span></span>
<span id="cb47-1866"><a href="#cb47-1866" aria-hidden="true" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb47-1867"><a href="#cb47-1867" aria-hidden="true" tabindex="-1"></a>          sudo apt-get update</span>
<span id="cb47-1868"><a href="#cb47-1868" aria-hidden="true" tabindex="-1"></a>          sudo apt-get install -y \</span>
<span id="cb47-1869"><a href="#cb47-1869" aria-hidden="true" tabindex="-1"></a>            libcurl4-openssl-dev \</span>
<span id="cb47-1870"><a href="#cb47-1870" aria-hidden="true" tabindex="-1"></a>            libssl-dev \</span>
<span id="cb47-1871"><a href="#cb47-1871" aria-hidden="true" tabindex="-1"></a>            libxml2-dev</span>
<span id="cb47-1872"><a href="#cb47-1872" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-1873"><a href="#cb47-1873" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Validate renv consistency</span></span>
<span id="cb47-1874"><a href="#cb47-1874" aria-hidden="true" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb47-1875"><a href="#cb47-1875" aria-hidden="true" tabindex="-1"></a>          # Use the renv validation script included in the repository</span>
<span id="cb47-1876"><a href="#cb47-1876" aria-hidden="true" tabindex="-1"></a>          Rscript check_renv_for_commit.R --fail-on-issues --quiet</span>
<span id="cb47-1877"><a href="#cb47-1877" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-1878"><a href="#cb47-1878" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/check-r-package@v2</span></span>
<span id="cb47-1879"><a href="#cb47-1879" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb47-1880"><a href="#cb47-1880" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">upload-snapshots</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb47-1881"><a href="#cb47-1881" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1882"><a href="#cb47-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1883"><a href="#cb47-1883" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 4: Automated Paper Rendering</span></span>
<span id="cb47-1884"><a href="#cb47-1884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1885"><a href="#cb47-1885" aria-hidden="true" tabindex="-1"></a>Create <span class="in">`.github/workflows/render-paper.yml`</span>:</span>
<span id="cb47-1886"><a href="#cb47-1886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1887"><a href="#cb47-1887" aria-hidden="true" tabindex="-1"></a><span class="in">```yaml</span></span>
<span id="cb47-1888"><a href="#cb47-1888" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Render Research Paper</span></span>
<span id="cb47-1889"><a href="#cb47-1889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1890"><a href="#cb47-1890" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb47-1891"><a href="#cb47-1891" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span><span class="co">  # Manual trigger</span></span>
<span id="cb47-1892"><a href="#cb47-1892" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb47-1893"><a href="#cb47-1893" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb47-1894"><a href="#cb47-1894" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb47-1895"><a href="#cb47-1895" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'analysis/paper/**'</span></span>
<span id="cb47-1896"><a href="#cb47-1896" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'analysis/data/**'</span></span>
<span id="cb47-1897"><a href="#cb47-1897" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'R/**'</span></span>
<span id="cb47-1898"><a href="#cb47-1898" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'data/**'</span></span>
<span id="cb47-1899"><a href="#cb47-1899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1900"><a href="#cb47-1900" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb47-1901"><a href="#cb47-1901" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">render</span><span class="kw">:</span></span>
<span id="cb47-1902"><a href="#cb47-1902" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb47-1903"><a href="#cb47-1903" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb47-1904"><a href="#cb47-1904" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb47-1905"><a href="#cb47-1905" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout repository</span></span>
<span id="cb47-1906"><a href="#cb47-1906" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb47-1907"><a href="#cb47-1907" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb47-1908"><a href="#cb47-1908" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb47-1909"><a href="#cb47-1909" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb47-1910"><a href="#cb47-1910" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb47-1911"><a href="#cb47-1911" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build Docker image</span></span>
<span id="cb47-1912"><a href="#cb47-1912" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v5</span></span>
<span id="cb47-1913"><a href="#cb47-1913" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb47-1914"><a href="#cb47-1914" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb47-1915"><a href="#cb47-1915" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">push</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb47-1916"><a href="#cb47-1916" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> paper-render:latest</span></span>
<span id="cb47-1917"><a href="#cb47-1917" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-from</span><span class="kw">:</span><span class="at"> type=gha</span></span>
<span id="cb47-1918"><a href="#cb47-1918" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-to</span><span class="kw">:</span><span class="at"> type=gha,mode=max</span></span>
<span id="cb47-1919"><a href="#cb47-1919" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb47-1920"><a href="#cb47-1920" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Render paper in container</span></span>
<span id="cb47-1921"><a href="#cb47-1921" aria-hidden="true" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb47-1922"><a href="#cb47-1922" aria-hidden="true" tabindex="-1"></a>          docker run --rm \</span>
<span id="cb47-1923"><a href="#cb47-1923" aria-hidden="true" tabindex="-1"></a>            -v $PWD:/home/analyst/project \</span>
<span id="cb47-1924"><a href="#cb47-1924" aria-hidden="true" tabindex="-1"></a>            -v $PWD/analysis/figures:/home/analyst/output \</span>
<span id="cb47-1925"><a href="#cb47-1925" aria-hidden="true" tabindex="-1"></a>            paper-render:latest \</span>
<span id="cb47-1926"><a href="#cb47-1926" aria-hidden="true" tabindex="-1"></a>            R -e "rmarkdown::render('analysis/paper/paper.Rmd')"</span>
<span id="cb47-1927"><a href="#cb47-1927" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-1928"><a href="#cb47-1928" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Upload rendered paper</span></span>
<span id="cb47-1929"><a href="#cb47-1929" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/upload-artifact@v4</span></span>
<span id="cb47-1930"><a href="#cb47-1930" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb47-1931"><a href="#cb47-1931" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> research-paper-${{ github.sha }}</span></span>
<span id="cb47-1932"><a href="#cb47-1932" aria-hidden="true" tabindex="-1"></a><span class="fu">          path</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb47-1933"><a href="#cb47-1933" aria-hidden="true" tabindex="-1"></a>            analysis/paper/paper.pdf</span>
<span id="cb47-1934"><a href="#cb47-1934" aria-hidden="true" tabindex="-1"></a>            analysis/figures/*.png</span>
<span id="cb47-1935"><a href="#cb47-1935" aria-hidden="true" tabindex="-1"></a>            analysis/figures/*.jpg</span>
<span id="cb47-1936"><a href="#cb47-1936" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">retention-days</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span></span>
<span id="cb47-1937"><a href="#cb47-1937" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1938"><a href="#cb47-1938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1939"><a href="#cb47-1939" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 5: Container Registry Integration</span></span>
<span id="cb47-1940"><a href="#cb47-1940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1941"><a href="#cb47-1941" aria-hidden="true" tabindex="-1"></a>Create <span class="in">`.github/workflows/container-publish.yml`</span>:</span>
<span id="cb47-1942"><a href="#cb47-1942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1943"><a href="#cb47-1943" aria-hidden="true" tabindex="-1"></a><span class="in">```yaml</span></span>
<span id="cb47-1944"><a href="#cb47-1944" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and Push Container</span></span>
<span id="cb47-1945"><a href="#cb47-1945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1946"><a href="#cb47-1946" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb47-1947"><a href="#cb47-1947" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb47-1948"><a href="#cb47-1948" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main </span><span class="kw">]</span></span>
<span id="cb47-1949"><a href="#cb47-1949" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> </span><span class="st">'v*'</span><span class="at"> </span><span class="kw">]</span></span>
<span id="cb47-1950"><a href="#cb47-1950" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb47-1951"><a href="#cb47-1951" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main </span><span class="kw">]</span></span>
<span id="cb47-1952"><a href="#cb47-1952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1953"><a href="#cb47-1953" aria-hidden="true" tabindex="-1"></a><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb47-1954"><a href="#cb47-1954" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">REGISTRY</span><span class="kw">:</span><span class="at"> ghcr.io</span></span>
<span id="cb47-1955"><a href="#cb47-1955" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">IMAGE_NAME</span><span class="kw">:</span><span class="at"> ${{ github.repository }}</span></span>
<span id="cb47-1956"><a href="#cb47-1956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1957"><a href="#cb47-1957" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb47-1958"><a href="#cb47-1958" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">build-and-push</span><span class="kw">:</span></span>
<span id="cb47-1959"><a href="#cb47-1959" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb47-1960"><a href="#cb47-1960" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb47-1961"><a href="#cb47-1961" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> read</span></span>
<span id="cb47-1962"><a href="#cb47-1962" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">packages</span><span class="kw">:</span><span class="at"> write</span></span>
<span id="cb47-1963"><a href="#cb47-1963" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb47-1964"><a href="#cb47-1964" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb47-1965"><a href="#cb47-1965" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout repository</span></span>
<span id="cb47-1966"><a href="#cb47-1966" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb47-1967"><a href="#cb47-1967" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb47-1968"><a href="#cb47-1968" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb47-1969"><a href="#cb47-1969" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb47-1970"><a href="#cb47-1970" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb47-1971"><a href="#cb47-1971" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Log in to Container Registry</span></span>
<span id="cb47-1972"><a href="#cb47-1972" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name != 'pull_request'</span></span>
<span id="cb47-1973"><a href="#cb47-1973" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/login-action@v3</span></span>
<span id="cb47-1974"><a href="#cb47-1974" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb47-1975"><a href="#cb47-1975" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">registry</span><span class="kw">:</span><span class="at"> ${{ env.REGISTRY }}</span></span>
<span id="cb47-1976"><a href="#cb47-1976" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">username</span><span class="kw">:</span><span class="at"> ${{ github.actor }}</span></span>
<span id="cb47-1977"><a href="#cb47-1977" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb47-1978"><a href="#cb47-1978" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb47-1979"><a href="#cb47-1979" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Extract metadata</span></span>
<span id="cb47-1980"><a href="#cb47-1980" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> meta</span></span>
<span id="cb47-1981"><a href="#cb47-1981" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/metadata-action@v5</span></span>
<span id="cb47-1982"><a href="#cb47-1982" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb47-1983"><a href="#cb47-1983" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">images</span><span class="kw">:</span><span class="at"> ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}</span></span>
<span id="cb47-1984"><a href="#cb47-1984" aria-hidden="true" tabindex="-1"></a><span class="fu">          tags</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb47-1985"><a href="#cb47-1985" aria-hidden="true" tabindex="-1"></a>            type=ref,event=branch</span>
<span id="cb47-1986"><a href="#cb47-1986" aria-hidden="true" tabindex="-1"></a>            type=ref,event=pr</span>
<span id="cb47-1987"><a href="#cb47-1987" aria-hidden="true" tabindex="-1"></a>            type=semver,pattern={{version}}</span>
<span id="cb47-1988"><a href="#cb47-1988" aria-hidden="true" tabindex="-1"></a>            type=semver,pattern={{major}}.{{minor}}</span>
<span id="cb47-1989"><a href="#cb47-1989" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-1990"><a href="#cb47-1990" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and push Docker image</span></span>
<span id="cb47-1991"><a href="#cb47-1991" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v5</span></span>
<span id="cb47-1992"><a href="#cb47-1992" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb47-1993"><a href="#cb47-1993" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb47-1994"><a href="#cb47-1994" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">platforms</span><span class="kw">:</span><span class="at"> linux/amd64,linux/arm64</span></span>
<span id="cb47-1995"><a href="#cb47-1995" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">push</span><span class="kw">:</span><span class="at"> ${{ github.event_name != 'pull_request' }}</span></span>
<span id="cb47-1996"><a href="#cb47-1996" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.tags }}</span></span>
<span id="cb47-1997"><a href="#cb47-1997" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">labels</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.labels }}</span></span>
<span id="cb47-1998"><a href="#cb47-1998" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-from</span><span class="kw">:</span><span class="at"> type=gha</span></span>
<span id="cb47-1999"><a href="#cb47-1999" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-to</span><span class="kw">:</span><span class="at"> type=gha,mode=max</span></span>
<span id="cb47-2000"><a href="#cb47-2000" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-2001"><a href="#cb47-2001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2002"><a href="#cb47-2002" aria-hidden="true" tabindex="-1"></a><span class="fu">## Workflow Explanations</span></span>
<span id="cb47-2003"><a href="#cb47-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2004"><a href="#cb47-2004" aria-hidden="true" tabindex="-1"></a><span class="fu">### Docker CI Workflow Features:</span></span>
<span id="cb47-2005"><a href="#cb47-2005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2006"><a href="#cb47-2006" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Pre-build renv Validation**: Validates package dependency consistency before Docker build (prevents build failures)</span>
<span id="cb47-2007"><a href="#cb47-2007" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Dynamic R Version**: Extracts R version from renv.lock and passes it to Docker build</span>
<span id="cb47-2008"><a href="#cb47-2008" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Build Testing**: Ensures Docker image builds with latest changes using correct R version</span>
<span id="cb47-2009"><a href="#cb47-2009" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Testing**: Runs R package tests and renders paper in container</span>
<span id="cb47-2010"><a href="#cb47-2010" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Artifact Generation**: Saves rendered papers as downloadable artifacts</span>
<span id="cb47-2011"><a href="#cb47-2011" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Caching**: Uses GitHub Actions cache for faster builds</span>
<span id="cb47-2012"><a href="#cb47-2012" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Early Failure**: Stops pipeline if dependency issues are detected</span>
<span id="cb47-2013"><a href="#cb47-2013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2014"><a href="#cb47-2014" aria-hidden="true" tabindex="-1"></a><span class="fu">### R Package Check Features:</span></span>
<span id="cb47-2015"><a href="#cb47-2015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2016"><a href="#cb47-2016" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Multi-platform Testing**: Tests on Ubuntu, macOS, and Windows</span>
<span id="cb47-2017"><a href="#cb47-2017" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**R CMD Check**: Package validation</span>
<span id="cb47-2018"><a href="#cb47-2018" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**renv Integration**: Restores package environment</span>
<span id="cb47-2019"><a href="#cb47-2019" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**renv Consistency Validation**: Verifies dependency synchronization across platforms</span>
<span id="cb47-2020"><a href="#cb47-2020" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**System Dependencies**: Installs required system libraries</span>
<span id="cb47-2021"><a href="#cb47-2021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2022"><a href="#cb47-2022" aria-hidden="true" tabindex="-1"></a><span class="fu">### Paper Rendering Features:</span></span>
<span id="cb47-2023"><a href="#cb47-2023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2024"><a href="#cb47-2024" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Selective Triggering**: Only runs when relevant files change</span>
<span id="cb47-2025"><a href="#cb47-2025" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Manual Execution**: Can be triggered manually via GitHub interface</span>
<span id="cb47-2026"><a href="#cb47-2026" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Artifact Storage**: Saves PDFs and figures with retention policy</span>
<span id="cb47-2027"><a href="#cb47-2027" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Path-based Triggers**: Responds to changes in analysis files</span>
<span id="cb47-2028"><a href="#cb47-2028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2029"><a href="#cb47-2029" aria-hidden="true" tabindex="-1"></a><span class="fu">### Container Publishing Features:</span></span>
<span id="cb47-2030"><a href="#cb47-2030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2031"><a href="#cb47-2031" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Building**: Builds on pushes and tags</span>
<span id="cb47-2032"><a href="#cb47-2032" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Multi-platform**: Supports AMD64 and ARM64 platforms</span>
<span id="cb47-2033"><a href="#cb47-2033" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Semantic Versioning**: Tagging based on git tags</span>
<span id="cb47-2034"><a href="#cb47-2034" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Security**: Uses built-in GitHub token for authentication</span>
<span id="cb47-2035"><a href="#cb47-2035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2036"><a href="#cb47-2036" aria-hidden="true" tabindex="-1"></a><span class="fu">## Authentication and Permissions</span></span>
<span id="cb47-2037"><a href="#cb47-2037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2038"><a href="#cb47-2038" aria-hidden="true" tabindex="-1"></a><span class="fu">### Built-in GITHUB_TOKEN:</span></span>
<span id="cb47-2039"><a href="#cb47-2039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2040"><a href="#cb47-2040" aria-hidden="true" tabindex="-1"></a>The built-in <span class="in">`GITHUB_TOKEN`</span> automatically provides:</span>
<span id="cb47-2041"><a href="#cb47-2041" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Read access to repository contents</span>
<span id="cb47-2042"><a href="#cb47-2042" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Write access to GitHub Packages (when permissions are set)</span>
<span id="cb47-2043"><a href="#cb47-2043" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No manual setup required</span>
<span id="cb47-2044"><a href="#cb47-2044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2045"><a href="#cb47-2045" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setting Repository Permissions:</span></span>
<span id="cb47-2046"><a href="#cb47-2046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2047"><a href="#cb47-2047" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Repository Settings** → **Actions** → **General**</span>
<span id="cb47-2048"><a href="#cb47-2048" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Workflow permissions**: Choose "Read and write permissions"</span>
<span id="cb47-2049"><a href="#cb47-2049" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Allow GitHub Actions to create and approve pull requests**: Enable if needed</span>
<span id="cb47-2050"><a href="#cb47-2050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2051"><a href="#cb47-2051" aria-hidden="true" tabindex="-1"></a><span class="fu">### Using Personal Access Tokens (Advanced):</span></span>
<span id="cb47-2052"><a href="#cb47-2052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2053"><a href="#cb47-2053" aria-hidden="true" tabindex="-1"></a>For broader permissions, create repository secrets:</span>
<span id="cb47-2054"><a href="#cb47-2054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2055"><a href="#cb47-2055" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Repository Settings** → **Secrets and variables** → **Actions**</span>
<span id="cb47-2056"><a href="#cb47-2056" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**New repository secret**: Add <span class="in">`GHCR_TOKEN`</span> with Personal Access Token</span>
<span id="cb47-2057"><a href="#cb47-2057" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Reference in workflow**: <span class="in">`password: ${{ secrets.GHCR_TOKEN }}`</span></span>
<span id="cb47-2058"><a href="#cb47-2058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2059"><a href="#cb47-2059" aria-hidden="true" tabindex="-1"></a><span class="fu">## Integration with Collaborative Workflow</span></span>
<span id="cb47-2060"><a href="#cb47-2060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2061"><a href="#cb47-2061" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pull Request Integration:</span></span>
<span id="cb47-2062"><a href="#cb47-2062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2063"><a href="#cb47-2063" aria-hidden="true" tabindex="-1"></a>When a team member submits a pull request:</span>
<span id="cb47-2064"><a href="#cb47-2064" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>GitHub automatically triggers CI workflows</span>
<span id="cb47-2065"><a href="#cb47-2065" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Tests run in clean environment identical to production</span>
<span id="cb47-2066"><a href="#cb47-2066" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Results displayed directly in pull request interface</span>
<span id="cb47-2067"><a href="#cb47-2067" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Merge can be blocked if tests fail</span>
<span id="cb47-2068"><a href="#cb47-2068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2069"><a href="#cb47-2069" aria-hidden="true" tabindex="-1"></a><span class="fu">### Branch Protection Rules:</span></span>
<span id="cb47-2070"><a href="#cb47-2070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2071"><a href="#cb47-2071" aria-hidden="true" tabindex="-1"></a>Enable in **Repository Settings** → **Branches**:</span>
<span id="cb47-2072"><a href="#cb47-2072" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Require status checks**: Force CI to pass before merging</span>
<span id="cb47-2073"><a href="#cb47-2073" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Require branches to be up to date**: Ensure latest code is tested</span>
<span id="cb47-2074"><a href="#cb47-2074" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Include administrators**: Apply rules to all users</span>
<span id="cb47-2075"><a href="#cb47-2075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2076"><a href="#cb47-2076" aria-hidden="true" tabindex="-1"></a><span class="fu">## Monitoring and Troubleshooting</span></span>
<span id="cb47-2077"><a href="#cb47-2077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2078"><a href="#cb47-2078" aria-hidden="true" tabindex="-1"></a><span class="fu">### Viewing Workflow Results:</span></span>
<span id="cb47-2079"><a href="#cb47-2079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2080"><a href="#cb47-2080" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Repository** → **Actions** tab</span>
<span id="cb47-2081"><a href="#cb47-2081" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Click specific workflow run to see details</span>
<span id="cb47-2082"><a href="#cb47-2082" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Expand steps to see detailed logs</span>
<span id="cb47-2083"><a href="#cb47-2083" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Download artifacts (rendered papers, test results)</span>
<span id="cb47-2084"><a href="#cb47-2084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2085"><a href="#cb47-2085" aria-hidden="true" tabindex="-1"></a><span class="fu">### Common Issues and Solutions:</span></span>
<span id="cb47-2086"><a href="#cb47-2086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2087"><a href="#cb47-2087" aria-hidden="true" tabindex="-1"></a>**Docker Build Failures:**</span>
<span id="cb47-2088"><a href="#cb47-2088" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check Dockerfile syntax</span>
<span id="cb47-2089"><a href="#cb47-2089" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Verify all COPY paths exist</span>
<span id="cb47-2090"><a href="#cb47-2090" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ensure base image is accessible</span>
<span id="cb47-2091"><a href="#cb47-2091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2092"><a href="#cb47-2092" aria-hidden="true" tabindex="-1"></a>**renv Restore Failures:**</span>
<span id="cb47-2093"><a href="#cb47-2093" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Verify renv.lock is committed</span>
<span id="cb47-2094"><a href="#cb47-2094" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check for platform-specific packages</span>
<span id="cb47-2095"><a href="#cb47-2095" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Consider using RSPM for faster installs</span>
<span id="cb47-2096"><a href="#cb47-2096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2097"><a href="#cb47-2097" aria-hidden="true" tabindex="-1"></a>**Permission Errors:**</span>
<span id="cb47-2098"><a href="#cb47-2098" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Verify GITHUB_TOKEN permissions</span>
<span id="cb47-2099"><a href="#cb47-2099" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check repository secrets configuration</span>
<span id="cb47-2100"><a href="#cb47-2100" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ensure workflows have necessary permissions</span>
<span id="cb47-2101"><a href="#cb47-2101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2102"><a href="#cb47-2102" aria-hidden="true" tabindex="-1"></a><span class="fu">### Performance Optimization:</span></span>
<span id="cb47-2103"><a href="#cb47-2103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2104"><a href="#cb47-2104" aria-hidden="true" tabindex="-1"></a>**Caching Strategies:**</span>
<span id="cb47-2105"><a href="#cb47-2105" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Docker layer caching with <span class="in">`cache-from/cache-to`</span></span>
<span id="cb47-2106"><a href="#cb47-2106" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>renv package caching with <span class="in">`r-lib/actions/setup-renv`</span></span>
<span id="cb47-2107"><a href="#cb47-2107" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Artifact caching for large datasets</span>
<span id="cb47-2108"><a href="#cb47-2108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2109"><a href="#cb47-2109" aria-hidden="true" tabindex="-1"></a>**Parallel Execution:**</span>
<span id="cb47-2110"><a href="#cb47-2110" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Run tests and documentation in parallel jobs</span>
<span id="cb47-2111"><a href="#cb47-2111" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use matrix strategies for multi-platform testing</span>
<span id="cb47-2112"><a href="#cb47-2112" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Conditional execution based on changed files</span>
<span id="cb47-2113"><a href="#cb47-2113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2114"><a href="#cb47-2114" aria-hidden="true" tabindex="-1"></a>This CI/CD setup ensures that research compendia remain reproducible, tested, and deployment-ready throughout the development lifecycle.</span>
<span id="cb47-2115"><a href="#cb47-2115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2116"><a href="#cb47-2116" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix F: Docker Configuration Examples {.unnumbered}</span></span>
<span id="cb47-2117"><a href="#cb47-2117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2118"><a href="#cb47-2118" aria-hidden="true" tabindex="-1"></a>This appendix provides Dockerfile examples ranging from minimal configurations to full development environments.</span>
<span id="cb47-2119"><a href="#cb47-2119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2120"><a href="#cb47-2120" aria-hidden="true" tabindex="-1"></a><span class="fu">## Production Dockerfile</span></span>
<span id="cb47-2121"><a href="#cb47-2121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2122"><a href="#cb47-2122" aria-hidden="true" tabindex="-1"></a>The following Dockerfile provides a development environment with zsh, vim plugins, dotfiles integration, and development tools:</span>
<span id="cb47-2123"><a href="#cb47-2123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2124"><a href="#cb47-2124" aria-hidden="true" tabindex="-1"></a><span class="in">```dockerfile</span></span>
<span id="cb47-2125"><a href="#cb47-2125" aria-hidden="true" tabindex="-1"></a><span class="in"># Use R version from renv.lock for perfect consistency</span></span>
<span id="cb47-2126"><a href="#cb47-2126" aria-hidden="true" tabindex="-1"></a><span class="in">ARG R_VERSION=4.3.0</span></span>
<span id="cb47-2127"><a href="#cb47-2127" aria-hidden="true" tabindex="-1"></a><span class="in">FROM rocker/r-ver:${R_VERSION}</span></span>
<span id="cb47-2128"><a href="#cb47-2128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2129"><a href="#cb47-2129" aria-hidden="true" tabindex="-1"></a><span class="in"># Install system dependencies including zsh and development tools</span></span>
<span id="cb47-2130"><a href="#cb47-2130" aria-hidden="true" tabindex="-1"></a><span class="in">RUN apt-get update &amp;&amp; apt-get install -y \</span></span>
<span id="cb47-2131"><a href="#cb47-2131" aria-hidden="true" tabindex="-1"></a><span class="in">    libxml2-dev \</span></span>
<span id="cb47-2132"><a href="#cb47-2132" aria-hidden="true" tabindex="-1"></a><span class="in">    libcurl4-openssl-dev \</span></span>
<span id="cb47-2133"><a href="#cb47-2133" aria-hidden="true" tabindex="-1"></a><span class="in">    libssl-dev \</span></span>
<span id="cb47-2134"><a href="#cb47-2134" aria-hidden="true" tabindex="-1"></a><span class="in">    libgit2-dev \</span></span>
<span id="cb47-2135"><a href="#cb47-2135" aria-hidden="true" tabindex="-1"></a><span class="in">    libfontconfig1-dev \</span></span>
<span id="cb47-2136"><a href="#cb47-2136" aria-hidden="true" tabindex="-1"></a><span class="in">    libcairo2-dev \</span></span>
<span id="cb47-2137"><a href="#cb47-2137" aria-hidden="true" tabindex="-1"></a><span class="in">    libxt-dev \</span></span>
<span id="cb47-2138"><a href="#cb47-2138" aria-hidden="true" tabindex="-1"></a><span class="in">    pandoc \</span></span>
<span id="cb47-2139"><a href="#cb47-2139" aria-hidden="true" tabindex="-1"></a><span class="in">    zsh \</span></span>
<span id="cb47-2140"><a href="#cb47-2140" aria-hidden="true" tabindex="-1"></a><span class="in">    curl \</span></span>
<span id="cb47-2141"><a href="#cb47-2141" aria-hidden="true" tabindex="-1"></a><span class="in">    git \</span></span>
<span id="cb47-2142"><a href="#cb47-2142" aria-hidden="true" tabindex="-1"></a><span class="in">    fonts-dejavu \</span></span>
<span id="cb47-2143"><a href="#cb47-2143" aria-hidden="true" tabindex="-1"></a><span class="in">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span>
<span id="cb47-2144"><a href="#cb47-2144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2145"><a href="#cb47-2145" aria-hidden="true" tabindex="-1"></a><span class="in"># Create non-root user with zsh as default shell</span></span>
<span id="cb47-2146"><a href="#cb47-2146" aria-hidden="true" tabindex="-1"></a><span class="in">ARG USERNAME=analyst</span></span>
<span id="cb47-2147"><a href="#cb47-2147" aria-hidden="true" tabindex="-1"></a><span class="in">RUN useradd --create-home --shell /bin/zsh ${USERNAME}</span></span>
<span id="cb47-2148"><a href="#cb47-2148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2149"><a href="#cb47-2149" aria-hidden="true" tabindex="-1"></a><span class="in"># Set working directory</span></span>
<span id="cb47-2150"><a href="#cb47-2150" aria-hidden="true" tabindex="-1"></a><span class="in">WORKDIR /home/${USERNAME}/project</span></span>
<span id="cb47-2151"><a href="#cb47-2151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2152"><a href="#cb47-2152" aria-hidden="true" tabindex="-1"></a><span class="in"># Copy project files first (for better Docker layer caching)</span></span>
<span id="cb47-2153"><a href="#cb47-2153" aria-hidden="true" tabindex="-1"></a><span class="in">COPY --chown=${USERNAME}:${USERNAME} DESCRIPTION .</span></span>
<span id="cb47-2154"><a href="#cb47-2154" aria-hidden="true" tabindex="-1"></a><span class="in">COPY --chown=${USERNAME}:${USERNAME} renv.lock* ./</span></span>
<span id="cb47-2155"><a href="#cb47-2155" aria-hidden="true" tabindex="-1"></a><span class="in">COPY --chown=${USERNAME}:${USERNAME} .Rprofile* ./</span></span>
<span id="cb47-2156"><a href="#cb47-2156" aria-hidden="true" tabindex="-1"></a><span class="in">COPY --chown=${USERNAME}:${USERNAME} renv/activate.R* renv/activate.R</span></span>
<span id="cb47-2157"><a href="#cb47-2157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2158"><a href="#cb47-2158" aria-hidden="true" tabindex="-1"></a><span class="in"># Configure renv library path</span></span>
<span id="cb47-2159"><a href="#cb47-2159" aria-hidden="true" tabindex="-1"></a><span class="in">ENV RENV_PATHS_LIBRARY renv/library</span></span>
<span id="cb47-2160"><a href="#cb47-2160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2161"><a href="#cb47-2161" aria-hidden="true" tabindex="-1"></a><span class="in"># Switch to non-root user for R package installation</span></span>
<span id="cb47-2162"><a href="#cb47-2162" aria-hidden="true" tabindex="-1"></a><span class="in">USER ${USERNAME}</span></span>
<span id="cb47-2163"><a href="#cb47-2163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2164"><a href="#cb47-2164" aria-hidden="true" tabindex="-1"></a><span class="in"># Install renv and essential R packages</span></span>
<span id="cb47-2165"><a href="#cb47-2165" aria-hidden="true" tabindex="-1"></a><span class="in">RUN R -e "install.packages(c('renv', 'remotes', 'devtools', 'knitr', \</span></span>
<span id="cb47-2166"><a href="#cb47-2166" aria-hidden="true" tabindex="-1"></a><span class="in">    'rmarkdown'), repos = c(CRAN = 'https://cloud.r-project.org'))"</span></span>
<span id="cb47-2167"><a href="#cb47-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2168"><a href="#cb47-2168" aria-hidden="true" tabindex="-1"></a><span class="in"># Restore R packages from lockfile (if exists)</span></span>
<span id="cb47-2169"><a href="#cb47-2169" aria-hidden="true" tabindex="-1"></a><span class="in">RUN R -e "if (file.exists('renv.lock')) renv::restore() else \</span></span>
<span id="cb47-2170"><a href="#cb47-2170" aria-hidden="true" tabindex="-1"></a><span class="in">    cat('No renv.lock found, skipping restore\\n')"</span></span>
<span id="cb47-2171"><a href="#cb47-2171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2172"><a href="#cb47-2172" aria-hidden="true" tabindex="-1"></a><span class="in"># Copy dotfiles for development environment</span></span>
<span id="cb47-2173"><a href="#cb47-2173" aria-hidden="true" tabindex="-1"></a><span class="in"># Note: Ensure .vimrc and .zshrc_docker exist in build context or create </span></span>
<span id="cb47-2174"><a href="#cb47-2174" aria-hidden="true" tabindex="-1"></a><span class="in"># defaults</span></span>
<span id="cb47-2175"><a href="#cb47-2175" aria-hidden="true" tabindex="-1"></a><span class="in">COPY --chown=${USERNAME}:${USERNAME} .vimrc /home/${USERNAME}/.vimrc</span></span>
<span id="cb47-2176"><a href="#cb47-2176" aria-hidden="true" tabindex="-1"></a><span class="in">COPY --chown=${USERNAME}:${USERNAME} .zshrc_docker /home/${USERNAME}/.zshrc</span></span>
<span id="cb47-2177"><a href="#cb47-2177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2178"><a href="#cb47-2178" aria-hidden="true" tabindex="-1"></a><span class="in"># Install zsh plugins for shell experience</span></span>
<span id="cb47-2179"><a href="#cb47-2179" aria-hidden="true" tabindex="-1"></a><span class="in">RUN mkdir -p /home/${USERNAME}/.zsh &amp;&amp; \</span></span>
<span id="cb47-2180"><a href="#cb47-2180" aria-hidden="true" tabindex="-1"></a><span class="in">    git clone https://github.com/zsh-users/zsh-autosuggestions \</span></span>
<span id="cb47-2181"><a href="#cb47-2181" aria-hidden="true" tabindex="-1"></a><span class="in">        /home/${USERNAME}/.zsh/zsh-autosuggestions &amp;&amp; \</span></span>
<span id="cb47-2182"><a href="#cb47-2182" aria-hidden="true" tabindex="-1"></a><span class="in">    chown -R ${USERNAME}:${USERNAME} /home/${USERNAME}/.zsh</span></span>
<span id="cb47-2183"><a href="#cb47-2183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2184"><a href="#cb47-2184" aria-hidden="true" tabindex="-1"></a><span class="in"># Install vim-plug and configure vim environment</span></span>
<span id="cb47-2185"><a href="#cb47-2185" aria-hidden="true" tabindex="-1"></a><span class="in">RUN mkdir -p /home/${USERNAME}/.vim/autoload &amp;&amp; \</span></span>
<span id="cb47-2186"><a href="#cb47-2186" aria-hidden="true" tabindex="-1"></a><span class="in">    curl -fLo /home/${USERNAME}/.vim/autoload/plug.vim \</span></span>
<span id="cb47-2187"><a href="#cb47-2187" aria-hidden="true" tabindex="-1"></a><span class="in">    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim &amp;&amp; \</span></span>
<span id="cb47-2188"><a href="#cb47-2188" aria-hidden="true" tabindex="-1"></a><span class="in">    chown -R ${USERNAME}:${USERNAME} /home/${USERNAME}/.vim</span></span>
<span id="cb47-2189"><a href="#cb47-2189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2190"><a href="#cb47-2190" aria-hidden="true" tabindex="-1"></a><span class="in"># Install vim plugins (suppress interactive mode)</span></span>
<span id="cb47-2191"><a href="#cb47-2191" aria-hidden="true" tabindex="-1"></a><span class="in">RUN vim +PlugInstall +qall || true</span></span>
<span id="cb47-2192"><a href="#cb47-2192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2193"><a href="#cb47-2193" aria-hidden="true" tabindex="-1"></a><span class="in"># Copy rest of project</span></span>
<span id="cb47-2194"><a href="#cb47-2194" aria-hidden="true" tabindex="-1"></a><span class="in">COPY --chown=${USERNAME}:${USERNAME} . .</span></span>
<span id="cb47-2195"><a href="#cb47-2195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2196"><a href="#cb47-2196" aria-hidden="true" tabindex="-1"></a><span class="in"># Install the research compendium as a package</span></span>
<span id="cb47-2197"><a href="#cb47-2197" aria-hidden="true" tabindex="-1"></a><span class="in">RUN R -e "devtools::install('.', dependencies = TRUE)"</span></span>
<span id="cb47-2198"><a href="#cb47-2198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2199"><a href="#cb47-2199" aria-hidden="true" tabindex="-1"></a><span class="in"># Set default shell to zsh for development experience</span></span>
<span id="cb47-2200"><a href="#cb47-2200" aria-hidden="true" tabindex="-1"></a><span class="in">WORKDIR /home/${USERNAME}/project</span></span>
<span id="cb47-2201"><a href="#cb47-2201" aria-hidden="true" tabindex="-1"></a><span class="in">CMD ["/bin/zsh"]</span></span>
<span id="cb47-2202"><a href="#cb47-2202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-2203"><a href="#cb47-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2204"><a href="#cb47-2204" aria-hidden="true" tabindex="-1"></a><span class="fu">## Features of the Production Dockerfile</span></span>
<span id="cb47-2205"><a href="#cb47-2205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2206"><a href="#cb47-2206" aria-hidden="true" tabindex="-1"></a>This production-ready Dockerfile provides:</span>
<span id="cb47-2207"><a href="#cb47-2207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2208"><a href="#cb47-2208" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**R version consistency**: Matches exact R version specified in renv.lock for perfect environment alignment</span>
<span id="cb47-2209"><a href="#cb47-2209" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Minimal base**: rocker/r-ver provides clean R installation without unnecessary packages</span>
<span id="cb47-2210"><a href="#cb47-2210" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Shell environment**: zsh with autosuggestions and professional prompt for improved productivity</span>
<span id="cb47-2211"><a href="#cb47-2211" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Editor environment**: vim with plugins configured automatically during build</span>
<span id="cb47-2212"><a href="#cb47-2212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Dotfiles integration**: Personal development preferences (.vimrc, .zshrc) copied from host system</span>
<span id="cb47-2213"><a href="#cb47-2213" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Development tools**: git, curl, pandoc, and essential development libraries pre-installed</span>
<span id="cb47-2214"><a href="#cb47-2214" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Security**: Non-root user execution with proper file permissions</span>
<span id="cb47-2215"><a href="#cb47-2215" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**renv integration**: Automatic package restoration with proper library path configuration</span>
<span id="cb47-2216"><a href="#cb47-2216" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Container-optimized workflow**: Optimized layer caching and build process for efficient rebuilds</span>
<span id="cb47-2217"><a href="#cb47-2217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2218"><a href="#cb47-2218" aria-hidden="true" tabindex="-1"></a><span class="fu">## R Version Extraction</span></span>
<span id="cb47-2219"><a href="#cb47-2219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2220"><a href="#cb47-2220" aria-hidden="true" tabindex="-1"></a>The Dockerfile uses a build argument to ensure the R version exactly matches what's specified in <span class="in">`renv.lock`</span>. The build command extracts the R version directly from the renv lockfile:</span>
<span id="cb47-2221"><a href="#cb47-2221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2222"><a href="#cb47-2222" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-2223"><a href="#cb47-2223" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract R version from renv.lock</span></span>
<span id="cb47-2224"><a href="#cb47-2224" aria-hidden="true" tabindex="-1"></a><span class="va">R_VERSION</span><span class="op">=</span><span class="va">$(</span><span class="ex">jq</span> <span class="at">-r</span> <span class="st">'.R.Version'</span> renv.lock<span class="va">)</span></span>
<span id="cb47-2225"><a href="#cb47-2225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2226"><a href="#cb47-2226" aria-hidden="true" tabindex="-1"></a><span class="co"># Build Docker image with extracted R version</span></span>
<span id="cb47-2227"><a href="#cb47-2227" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">--build-arg</span> R_VERSION=<span class="va">${R_VERSION}</span> <span class="dt">\</span></span>
<span id="cb47-2228"><a href="#cb47-2228" aria-hidden="true" tabindex="-1"></a>  <span class="at">-t</span> ghcr.io/username/penguins_analysis:v1.0 .</span>
<span id="cb47-2229"><a href="#cb47-2229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-2230"><a href="#cb47-2230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2231"><a href="#cb47-2231" aria-hidden="true" tabindex="-1"></a>If the <span class="in">`renv.lock`</span> file specifies R 4.3.1, the Docker image will use <span class="in">`rocker/r-ver:4.3.1`</span>. If renv is updated to R 4.4.0, the Docker build will use <span class="in">`rocker/r-ver:4.4.0`</span>. This maintains consistency between the package environment and system environment.</span>
<span id="cb47-2232"><a href="#cb47-2232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2233"><a href="#cb47-2233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2234"><a href="#cb47-2234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2235"><a href="#cb47-2235" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix G: renv Management and Validation {.unnumbered}</span></span>
<span id="cb47-2236"><a href="#cb47-2236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2237"><a href="#cb47-2237" aria-hidden="true" tabindex="-1"></a>This appendix provides details for the renv consistency checking script and dependency management workflows.</span>
<span id="cb47-2238"><a href="#cb47-2238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2239"><a href="#cb47-2239" aria-hidden="true" tabindex="-1"></a><span class="fu">## renv Consistency Checker Features</span></span>
<span id="cb47-2240"><a href="#cb47-2240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2241"><a href="#cb47-2241" aria-hidden="true" tabindex="-1"></a>The <span class="in">`check_renv_for_commit.R`</span> script provides advanced team collaboration </span>
<span id="cb47-2242"><a href="#cb47-2242" aria-hidden="true" tabindex="-1"></a>features through dependency validation:</span>
<span id="cb47-2243"><a href="#cb47-2243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2244"><a href="#cb47-2244" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Team conflict prevention**: Pre-commit validation stops dependency </span>
<span id="cb47-2245"><a href="#cb47-2245" aria-hidden="true" tabindex="-1"></a>  inconsistencies before they reach the repository</span>
<span id="cb47-2246"><a href="#cb47-2246" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Automated dependency discovery**: Scans R/, scripts/, and analysis/ </span>
<span id="cb47-2247"><a href="#cb47-2247" aria-hidden="true" tabindex="-1"></a>  directories for <span class="in">`library()`</span>, <span class="in">`require()`</span>, and <span class="in">`pkg::`</span> calls</span>
<span id="cb47-2248"><a href="#cb47-2248" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Multi-source synchronization**: Ensures packages are consistent across </span>
<span id="cb47-2249"><a href="#cb47-2249" aria-hidden="true" tabindex="-1"></a>  code files, DESCRIPTION, and renv.lock</span>
<span id="cb47-2250"><a href="#cb47-2250" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**CRAN validation**: Verifies packages exist and are properly named before </span>
<span id="cb47-2251"><a href="#cb47-2251" aria-hidden="true" tabindex="-1"></a>  team integration</span>
<span id="cb47-2252"><a href="#cb47-2252" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Automatic fixing**: Updates DESCRIPTION and regenerates renv.lock to </span>
<span id="cb47-2253"><a href="#cb47-2253" aria-hidden="true" tabindex="-1"></a>  maintain team synchronization</span>
<span id="cb47-2254"><a href="#cb47-2254" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**CI/CD fail-fast**: Provides proper exit codes for automated workflows</span>
<span id="cb47-2255"><a href="#cb47-2255" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Interactive collaboration mode**: Guides developers through dependency </span>
<span id="cb47-2256"><a href="#cb47-2256" aria-hidden="true" tabindex="-1"></a>  resolution during development</span>
<span id="cb47-2257"><a href="#cb47-2257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2258"><a href="#cb47-2258" aria-hidden="true" tabindex="-1"></a><span class="fu">## Team Collaboration Commands</span></span>
<span id="cb47-2259"><a href="#cb47-2259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2260"><a href="#cb47-2260" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-2261"><a href="#cb47-2261" aria-hidden="true" tabindex="-1"></a><span class="co"># Team development workflow (via Make)</span></span>
<span id="cb47-2262"><a href="#cb47-2262" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv          <span class="co"># Interactive dependency checking</span></span>
<span id="cb47-2263"><a href="#cb47-2263" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-fix      <span class="co"># Auto-fix dependency issues</span></span>
<span id="cb47-2264"><a href="#cb47-2264" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-ci       <span class="co"># CI/CD validation with fail-fast</span></span>
<span id="cb47-2265"><a href="#cb47-2265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2266"><a href="#cb47-2266" aria-hidden="true" tabindex="-1"></a><span class="co"># Docker-based validation (no local R required)</span></span>
<span id="cb47-2267"><a href="#cb47-2267" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check-renv-fix  <span class="co"># Fix dependencies in container</span></span>
<span id="cb47-2268"><a href="#cb47-2268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2269"><a href="#cb47-2269" aria-hidden="true" tabindex="-1"></a><span class="co"># Direct script usage</span></span>
<span id="cb47-2270"><a href="#cb47-2270" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span> <span class="at">--fail-on-issues</span>  <span class="co"># CI mode</span></span>
<span id="cb47-2271"><a href="#cb47-2271" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--quiet</span>                 <span class="co"># Minimal output</span></span>
<span id="cb47-2272"><a href="#cb47-2272" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--help</span>                  <span class="co"># Usage info</span></span>
<span id="cb47-2273"><a href="#cb47-2273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-2274"><a href="#cb47-2274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2275"><a href="#cb47-2275" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multi-Developer Workflow</span></span>
<span id="cb47-2276"><a href="#cb47-2276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2277"><a href="#cb47-2277" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Install packages in container**: Use <span class="in">`install.packages()`</span> or <span class="in">`renv::install()`</span> within Docker environment</span>
<span id="cb47-2278"><a href="#cb47-2278" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Validate team dependencies**: Run <span class="in">`make check-renv`</span> to check for conflicts before committing</span>
<span id="cb47-2279"><a href="#cb47-2279" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Review team impacts**: Script identifies packages that would affect other team members</span>
<span id="cb47-2280"><a href="#cb47-2280" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Synchronize team environment**: Use <span class="in">`make check-renv-fix`</span> to update shared dependency files</span>
<span id="cb47-2281"><a href="#cb47-2281" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Commit with team confidence**: Other developers can reproduce your exact environment</span>
<span id="cb47-2282"><a href="#cb47-2282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2283"><a href="#cb47-2283" aria-hidden="true" tabindex="-1"></a><span class="fu">## Integration with Development Workflows</span></span>
<span id="cb47-2284"><a href="#cb47-2284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2285"><a href="#cb47-2285" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pre-commit Hooks</span></span>
<span id="cb47-2286"><a href="#cb47-2286" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-2287"><a href="#cb47-2287" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to .git/hooks/pre-commit</span></span>
<span id="cb47-2288"><a href="#cb47-2288" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fail-on-issues</span> <span class="at">--quiet</span></span>
<span id="cb47-2289"><a href="#cb47-2289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-2290"><a href="#cb47-2290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2291"><a href="#cb47-2291" aria-hidden="true" tabindex="-1"></a><span class="fu">### Makefile Integration</span></span>
<span id="cb47-2292"><a href="#cb47-2292" aria-hidden="true" tabindex="-1"></a><span class="in">```makefile</span></span>
<span id="cb47-2293"><a href="#cb47-2293" aria-hidden="true" tabindex="-1"></a><span class="in">check-renv:</span></span>
<span id="cb47-2294"><a href="#cb47-2294" aria-hidden="true" tabindex="-1"></a><span class="in">    Rscript check_renv_for_commit.R</span></span>
<span id="cb47-2295"><a href="#cb47-2295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2296"><a href="#cb47-2296" aria-hidden="true" tabindex="-1"></a><span class="in">check-renv-fix:</span></span>
<span id="cb47-2297"><a href="#cb47-2297" aria-hidden="true" tabindex="-1"></a><span class="in">    Rscript check_renv_for_commit.R --fix</span></span>
<span id="cb47-2298"><a href="#cb47-2298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2299"><a href="#cb47-2299" aria-hidden="true" tabindex="-1"></a><span class="in">check-renv-ci:</span></span>
<span id="cb47-2300"><a href="#cb47-2300" aria-hidden="true" tabindex="-1"></a><span class="in">    Rscript check_renv_for_commit.R --quiet --fail-on-issues</span></span>
<span id="cb47-2301"><a href="#cb47-2301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-2302"><a href="#cb47-2302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2303"><a href="#cb47-2303" aria-hidden="true" tabindex="-1"></a><span class="fu">### CI/CD Integration</span></span>
<span id="cb47-2304"><a href="#cb47-2304" aria-hidden="true" tabindex="-1"></a><span class="in">```yaml</span></span>
<span id="cb47-2305"><a href="#cb47-2305" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Validate renv consistency</span></span>
<span id="cb47-2306"><a href="#cb47-2306" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">run</span><span class="kw">:</span><span class="at"> Rscript check_renv_for_commit.R --fail-on-issues --quiet</span></span>
<span id="cb47-2307"><a href="#cb47-2307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-2308"><a href="#cb47-2308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2309"><a href="#cb47-2309" aria-hidden="true" tabindex="-1"></a>This approach ensures that collaborators can reliably reproduce your package environment and that CI/CD pipelines have all necessary dependency information.</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2023-2025, Ronald G. Thomas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<!-- PDF view/download button for blog posts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Only add the button on post pages
  if (window.location.pathname.includes('/posts/') && !window.location.pathname.endsWith('/posts/') && !window.location.pathname.endsWith('/posts/index.html')) {
    var currentPath = window.location.pathname;
    var pdfPath = currentPath.replace('.html', '.pdf');

    // Check if PDF exists first
    fetch(pdfPath, { method: 'HEAD' })
      .then(function(response) {
        if (response.ok) {
          // PDF exists, show download button
          showDownloadButton(pdfPath);
        } else {
          // PDF doesn't exist, show link to generate
          showGenerateButton(currentPath);
        }
      })
      .catch(function() {
        // Error checking PDF, show generate button
        showGenerateButton(currentPath);
      });
  }
});

function showDownloadButton(pdfPath) {
  var downloadBtn = document.createElement('div');
  downloadBtn.className = 'pdf-download-button';

  // Get file size if possible
  fetch(pdfPath, { method: 'HEAD' })
    .then(function(response) {
      var size = response.headers.get('Content-Length');
      var sizeText = '';

      if (size) {
        // Convert to MB or KB
        var sizeInMB = size / (1024 * 1024);
        if (sizeInMB >= 1) {
          sizeText = ' (' + sizeInMB.toFixed(1) + ' MB)';
        } else {
          sizeText = ' (' + (size / 1024).toFixed(0) + ' KB)';
        }
      }

      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' + sizeText +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    })
    .catch(function() {
      // Basic fallback if we can't get file size
      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    });

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(downloadBtn);
  }
}

function showGenerateButton(htmlPath) {
  var qmdPath = htmlPath.replace('/posts/', 'posts/').replace('index.html', 'index.qmd');

  var generateBtn = document.createElement('div');
  generateBtn.className = 'pdf-download-button';
  generateBtn.innerHTML =
    '<div class="alert alert-secondary d-flex flex-column gap-2 p-3" role="alert">' +
    '  <div><i class="bi bi-file-pdf me-2"></i><strong>PDF version available</strong></div>' +
    '  <div class="small">Generate a PDF version of this article by running this command in the terminal:</div>' +
    '  <pre class="bg-light p-2 rounded mb-0 mt-1"><code>./generate_pdf.sh ' + qmdPath + '</code></pre>' +
    '</div>';

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(generateBtn);
  }
}
</script>

<style>
.pdf-download-button {
  margin-top: 1rem;
  margin-bottom: 1rem;
}
</style>




</body></html>