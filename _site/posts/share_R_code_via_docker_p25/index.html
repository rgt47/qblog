<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="R.G. Thomas">
<meta name="dcterms.date" content="2025-07-01">

<title>Research Compendia for Full Reproducibility in R: A zzrrtools, renv, and Docker Strategy – Thomas Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;1,400&amp;family=Open+Sans:ital,wght@0,400;0,600;1,400&amp;family=Fira+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/0fba9333d8.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">

<!-- Custom meta tags for social sharing -->
<meta property="og:site_name" content="Thomas Lab">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@rgt47">

<!-- Add responsive features -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Add analytics if needed -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXX');
</script> -->

<!-- Add custom javascript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Remove code tools button completely
  const codeButton = document.querySelector('.code-tools-button');
  if (codeButton) {
    codeButton.remove();
  }
  
  // Add any custom JavaScript functionality here
  
  // Example: Add smooth scrolling
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      
      document.querySelector(this.getAttribute('href')).scrollIntoView({
        behavior: 'smooth'
      });
    });
  });
  
  // Make sidebar category items clickable (but not TOC items)
  const categoryLinks = {
    'Programming & Development': '/posts/?category=Programming+%26+Development',
    'Data Analysis & Visualization': '/posts/?category=Data+Analysis+%26+Visualization',
    'Deployment & Operations': '/posts/?category=Deployment+%26+Operations',
    'Development Environment': '/posts/?category=Development+Environment',
    'Shiny Applications': '/posts/?category=Shiny+Applications',
    'AI & Automation': '/posts/?category=AI+%26+Automation',
    'System Administration': '/posts/?category=System+Administration'
  };
  
  // Only target sidebar items that are not in the TOC
  document.querySelectorAll('.sidebar-item-section .sidebar-item-text').forEach(item => {
    // Skip if this is inside the TOC
    if (item.closest('#TOC')) return;
    
    const text = item.textContent.trim();
    if (categoryLinks[text]) {
      item.addEventListener('click', function() {
        window.location.href = categoryLinks[text];
      });
    }
  });
});
</script>


<meta property="og:title" content="Research Compendia for Full Reproducibility in R: A zzrrtools, renv, and Docker Strategy – Thomas Lab">
<meta property="og:description" content="This white paper presents an approach to achieving reproducibility in R workflows by combining three tools: zzrrtools for creating structured research compendia, renv for R package management, and Docker for containerizing the computing environment. The zzrrtools framework provides a standardized research compendium structure, renv manages package dependencies, and Docker ensures consistent execution environments. Together, these tools create self-contained research compendia that run identically across different systems. The paper includes a practical case study demonstrating multi-developer collaborative workflows with clear governance roles, where a project maintainer manages the technical infrastructure while multiple contributors extend the research analysis.">
<meta property="og:site_name" content="Thomas Lab">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Thomas Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../misc/index.html"> 
<span class="menu-text">Misc</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive Summary</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#the-challenge-of-reproducibility-in-r" id="toc-the-challenge-of-reproducibility-in-r" class="nav-link" data-scroll-target="#the-challenge-of-reproducibility-in-r"><span class="header-section-number">1.1</span> The Challenge of Reproducibility in R</a></li>
  <li><a href="#a-three-level-solution" id="toc-a-three-level-solution" class="nav-link" data-scroll-target="#a-three-level-solution"><span class="header-section-number">1.2</span> A Three-Level Solution</a></li>
  </ul></li>
  <li><a href="#zzrrtools-project-level-reproducibility" id="toc-zzrrtools-project-level-reproducibility" class="nav-link" data-scroll-target="#zzrrtools-project-level-reproducibility"><span class="header-section-number">2</span> zzrrtools: Project-Level Reproducibility</a>
  <ul class="collapse">
  <li><a href="#what-is-zzrrtools" id="toc-what-is-zzrrtools" class="nav-link" data-scroll-target="#what-is-zzrrtools"><span class="header-section-number">2.1</span> What is zzrrtools?</a></li>
  <li><a href="#key-features-of-zzrrtools" id="toc-key-features-of-zzrrtools" class="nav-link" data-scroll-target="#key-features-of-zzrrtools"><span class="header-section-number">2.2</span> Key Features of zzrrtools</a></li>
  <li><a href="#zzrrtools-workflow-self-replicating-collaboration" id="toc-zzrrtools-workflow-self-replicating-collaboration" class="nav-link" data-scroll-target="#zzrrtools-workflow-self-replicating-collaboration"><span class="header-section-number">2.3</span> zzrrtools Workflow: Self-Replicating Collaboration</a>
  <ul class="collapse">
  <li><a href="#integrated-renv-consistency-checking" id="toc-integrated-renv-consistency-checking" class="nav-link" data-scroll-target="#integrated-renv-consistency-checking"><span class="header-section-number">2.3.1</span> Integrated renv Consistency Checking</a></li>
  </ul></li>
  <li><a href="#research-compendium-structure" id="toc-research-compendium-structure" class="nav-link" data-scroll-target="#research-compendium-structure"><span class="header-section-number">2.4</span> Research Compendium Structure</a></li>
  <li><a href="#iterative-development-workflow" id="toc-iterative-development-workflow" class="nav-link" data-scroll-target="#iterative-development-workflow"><span class="header-section-number">2.5</span> Iterative Development Workflow</a>
  <ul class="collapse">
  <li><a href="#phase-1-exploration-development-scripts" id="toc-phase-1-exploration-development-scripts" class="nav-link" data-scroll-target="#phase-1-exploration-development-scripts"><span class="header-section-number">2.5.1</span> Phase 1: Exploration &amp; Development (<code>scripts/</code>)</a></li>
  <li><a href="#phase-2-function-extraction-r" id="toc-phase-2-function-extraction-r" class="nav-link" data-scroll-target="#phase-2-function-extraction-r"><span class="header-section-number">2.5.2</span> Phase 2: Function Extraction (<code>R/</code>)</a></li>
  <li><a href="#phase-3-publication-integration-analysispaper" id="toc-phase-3-publication-integration-analysispaper" class="nav-link" data-scroll-target="#phase-3-publication-integration-analysispaper"><span class="header-section-number">2.5.3</span> Phase 3: Publication Integration (<code>analysis/paper/</code>)</a></li>
  <li><a href="#recommended-collaborative-workflow" id="toc-recommended-collaborative-workflow" class="nav-link" data-scroll-target="#recommended-collaborative-workflow"><span class="header-section-number">2.5.4</span> Recommended Collaborative Workflow:</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#renv-package-level-reproducibility" id="toc-renv-package-level-reproducibility" class="nav-link" data-scroll-target="#renv-package-level-reproducibility"><span class="header-section-number">3</span> renv: Package-Level Reproducibility</a>
  <ul class="collapse">
  <li><a href="#what-is-renv" id="toc-what-is-renv" class="nav-link" data-scroll-target="#what-is-renv"><span class="header-section-number">3.1</span> What is renv?</a></li>
  <li><a href="#key-features-of-renv" id="toc-key-features-of-renv" class="nav-link" data-scroll-target="#key-features-of-renv"><span class="header-section-number">3.2</span> Key Features of renv</a></li>
  <li><a href="#basic-renv-workflow" id="toc-basic-renv-workflow" class="nav-link" data-scroll-target="#basic-renv-workflow"><span class="header-section-number">3.3</span> Basic renv Workflow</a></li>
  </ul></li>
  <li><a href="#docker-system-level-reproducibility" id="toc-docker-system-level-reproducibility" class="nav-link" data-scroll-target="#docker-system-level-reproducibility"><span class="header-section-number">4</span> Docker: System-Level Reproducibility</a>
  <ul class="collapse">
  <li><a href="#what-is-docker" id="toc-what-is-docker" class="nav-link" data-scroll-target="#what-is-docker"><span class="header-section-number">4.1</span> What is Docker?</a></li>
  <li><a href="#dockers-role-in-reproducibility" id="toc-dockers-role-in-reproducibility" class="nav-link" data-scroll-target="#dockers-role-in-reproducibility"><span class="header-section-number">4.2</span> Docker’s Role in Reproducibility</a></li>
  <li><a href="#docker-components-for-r-workflows" id="toc-docker-components-for-r-workflows" class="nav-link" data-scroll-target="#docker-components-for-r-workflows"><span class="header-section-number">4.3</span> Docker Components for R Workflows</a></li>
  </ul></li>
  <li><a href="#combining-zzrrtools-renv-and-docker-a-comprehensive-approach" id="toc-combining-zzrrtools-renv-and-docker-a-comprehensive-approach" class="nav-link" data-scroll-target="#combining-zzrrtools-renv-and-docker-a-comprehensive-approach"><span class="header-section-number">5</span> Combining zzrrtools, renv, and Docker: A Comprehensive Approach</a>
  <ul class="collapse">
  <li><a href="#why-use-all-three" id="toc-why-use-all-three" class="nav-link" data-scroll-target="#why-use-all-three"><span class="header-section-number">5.1</span> Why Use All Three?</a></li>
  <li><a href="#integration-strategy-with-governance-model" id="toc-integration-strategy-with-governance-model" class="nav-link" data-scroll-target="#integration-strategy-with-governance-model"><span class="header-section-number">5.2</span> Integration Strategy with Governance Model</a></li>
  </ul></li>
  <li><a href="#practical-example-collaborative-research-compendium-development-with-testing" id="toc-practical-example-collaborative-research-compendium-development-with-testing" class="nav-link" data-scroll-target="#practical-example-collaborative-research-compendium-development-with-testing"><span class="header-section-number">6</span> Practical Example: Collaborative Research Compendium Development with Testing</a>
  <ul class="collapse">
  <li><a href="#project-scenario" id="toc-project-scenario" class="nav-link" data-scroll-target="#project-scenario"><span class="header-section-number">6.1</span> Project Scenario</a></li>
  <li><a href="#implementation-example" id="toc-implementation-example" class="nav-link" data-scroll-target="#implementation-example"><span class="header-section-number">6.2</span> Implementation Example</a>
  <ul class="collapse">
  <li><a href="#project-maintainer-setup-joe" id="toc-project-maintainer-setup-joe" class="nav-link" data-scroll-target="#project-maintainer-setup-joe"><span class="header-section-number">6.2.1</span> Project Maintainer Setup (Joe)</a></li>
  <li><a href="#team-member-onboarding-sam" id="toc-team-member-onboarding-sam" class="nav-link" data-scroll-target="#team-member-onboarding-sam"><span class="header-section-number">6.2.2</span> Team Member Onboarding (Sam)</a></li>
  </ul></li>
  <li><a href="#complete-handoff-workflow-summary" id="toc-complete-handoff-workflow-summary" class="nav-link" data-scroll-target="#complete-handoff-workflow-summary"><span class="header-section-number">6.3</span> Complete Handoff Workflow Summary</a></li>
  <li><a href="#collaboration-results" id="toc-collaboration-results" class="nav-link" data-scroll-target="#collaboration-results"><span class="header-section-number">6.4</span> Collaboration Results</a></li>
  </ul></li>
  <li><a href="#best-practices-and-considerations" id="toc-best-practices-and-considerations" class="nav-link" data-scroll-target="#best-practices-and-considerations"><span class="header-section-number">7</span> Best Practices and Considerations</a>
  <ul class="collapse">
  <li><a href="#when-to-use-this-approach" id="toc-when-to-use-this-approach" class="nav-link" data-scroll-target="#when-to-use-this-approach"><span class="header-section-number">7.1</span> When to Use This Approach</a></li>
  <li><a href="#tips-for-efficient-implementation" id="toc-tips-for-efficient-implementation" class="nav-link" data-scroll-target="#tips-for-efficient-implementation"><span class="header-section-number">7.2</span> Tips for Efficient Implementation</a></li>
  <li><a href="#testing-strategies-for-r-analyses" id="toc-testing-strategies-for-r-analyses" class="nav-link" data-scroll-target="#testing-strategies-for-r-analyses"><span class="header-section-number">7.3</span> Testing Strategies for R Analyses</a></li>
  <li><a href="#potential-challenges" id="toc-potential-challenges" class="nav-link" data-scroll-target="#potential-challenges"><span class="header-section-number">7.4</span> Potential Challenges</a></li>
  <li><a href="#troubleshooting-common-issues" id="toc-troubleshooting-common-issues" class="nav-link" data-scroll-target="#troubleshooting-common-issues"><span class="header-section-number">7.5</span> Troubleshooting Common Issues</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">8</span> Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">9</span> References</a></li>
  <li><a href="#appendix-a-github-personal-access-token-setup" id="toc-appendix-a-github-personal-access-token-setup" class="nav-link" data-scroll-target="#appendix-a-github-personal-access-token-setup">Appendix A: GitHub Personal Access Token Setup</a>
  <ul class="collapse">
  <li><a href="#step-by-step-token-creation" id="toc-step-by-step-token-creation" class="nav-link" data-scroll-target="#step-by-step-token-creation"><span class="header-section-number">9.1</span> Step-by-Step Token Creation</a></li>
  <li><a href="#token-security-best-practices" id="toc-token-security-best-practices" class="nav-link" data-scroll-target="#token-security-best-practices"><span class="header-section-number">9.2</span> Token Security Best Practices</a></li>
  <li><a href="#alternative-using-github-cli" id="toc-alternative-using-github-cli" class="nav-link" data-scroll-target="#alternative-using-github-cli"><span class="header-section-number">9.3</span> Alternative: Using GitHub CLI</a></li>
  <li><a href="#troubleshooting-common-issues-1" id="toc-troubleshooting-common-issues-1" class="nav-link" data-scroll-target="#troubleshooting-common-issues-1"><span class="header-section-number">9.4</span> Troubleshooting Common Issues</a></li>
  </ul></li>
  <li><a href="#appendix-b-comprehensive-test-suite" id="toc-appendix-b-comprehensive-test-suite" class="nav-link" data-scroll-target="#appendix-b-comprehensive-test-suite">Appendix B: Comprehensive Test Suite</a>
  <ul class="collapse">
  <li><a href="#test-file-teststestthattest-comprehensive-analysis.r" id="toc-test-file-teststestthattest-comprehensive-analysis.r" class="nav-link" data-scroll-target="#test-file-teststestthattest-comprehensive-analysis.r"><span class="header-section-number">9.5</span> Test File: <code>tests/testthat/test-comprehensive-analysis.R</code></a></li>
  <li><a href="#running-the-tests" id="toc-running-the-tests" class="nav-link" data-scroll-target="#running-the-tests"><span class="header-section-number">9.6</span> Running the Tests</a></li>
  <li><a href="#test-categories-explained" id="toc-test-categories-explained" class="nav-link" data-scroll-target="#test-categories-explained"><span class="header-section-number">9.7</span> Test Categories Explained</a></li>
  </ul></li>
  <li><a href="#appendix-c-directory-structure" id="toc-appendix-c-directory-structure" class="nav-link" data-scroll-target="#appendix-c-directory-structure">Appendix C: Directory Structure</a>
  <ul class="collapse">
  <li><a href="#key-features-explained" id="toc-key-features-explained" class="nav-link" data-scroll-target="#key-features-explained"><span class="header-section-number">9.8</span> Key Features Explained:</a></li>
  </ul></li>
  <li><a href="#appendix-d-docker-workflow-options" id="toc-appendix-d-docker-workflow-options" class="nav-link" data-scroll-target="#appendix-d-docker-workflow-options">Appendix D: Docker Workflow Options</a>
  <ul class="collapse">
  <li><a href="#multi-service-docker-architecture" id="toc-multi-service-docker-architecture" class="nav-link" data-scroll-target="#multi-service-docker-architecture"><span class="header-section-number">9.9</span> Multi-Service Docker Architecture</a></li>
  <li><a href="#option-2-docker-compose-services" id="toc-option-2-docker-compose-services" class="nav-link" data-scroll-target="#option-2-docker-compose-services"><span class="header-section-number">9.10</span> Option 2: Docker Compose Services</a></li>
  <li><a href="#option-3-direct-docker-commands" id="toc-option-3-direct-docker-commands" class="nav-link" data-scroll-target="#option-3-direct-docker-commands"><span class="header-section-number">9.11</span> Option 3: Direct Docker Commands</a></li>
  <li><a href="#volume-mounting-strategies" id="toc-volume-mounting-strategies" class="nav-link" data-scroll-target="#volume-mounting-strategies"><span class="header-section-number">9.12</span> Volume Mounting Strategies</a></li>
  <li><a href="#choosing-the-right-approach" id="toc-choosing-the-right-approach" class="nav-link" data-scroll-target="#choosing-the-right-approach"><span class="header-section-number">9.13</span> Choosing the Right Approach</a></li>
  </ul></li>
  <li><a href="#appendix-e-github-actions-cicd-setup" id="toc-appendix-e-github-actions-cicd-setup" class="nav-link" data-scroll-target="#appendix-e-github-actions-cicd-setup">Appendix E: GitHub Actions CI/CD Setup</a>
  <ul class="collapse">
  <li><a href="#understanding-github-actions-for-research" id="toc-understanding-github-actions-for-research" class="nav-link" data-scroll-target="#understanding-github-actions-for-research"><span class="header-section-number">9.14</span> Understanding GitHub Actions for Research</a></li>
  <li><a href="#step-by-step-setup" id="toc-step-by-step-setup" class="nav-link" data-scroll-target="#step-by-step-setup"><span class="header-section-number">9.15</span> Step-by-Step Setup</a>
  <ul class="collapse">
  <li><a href="#step-1-create-workflow-directory" id="toc-step-1-create-workflow-directory" class="nav-link" data-scroll-target="#step-1-create-workflow-directory"><span class="header-section-number">9.15.1</span> Step 1: Create Workflow Directory</a></li>
  <li><a href="#step-2-docker-based-ci-workflow-with-renv-validation" id="toc-step-2-docker-based-ci-workflow-with-renv-validation" class="nav-link" data-scroll-target="#step-2-docker-based-ci-workflow-with-renv-validation"><span class="header-section-number">9.15.2</span> Step 2: Docker-based CI Workflow with renv Validation</a></li>
  <li><a href="#step-3-r-package-check-workflow" id="toc-step-3-r-package-check-workflow" class="nav-link" data-scroll-target="#step-3-r-package-check-workflow"><span class="header-section-number">9.15.3</span> Step 3: R Package Check Workflow</a></li>
  <li><a href="#step-4-automated-paper-rendering" id="toc-step-4-automated-paper-rendering" class="nav-link" data-scroll-target="#step-4-automated-paper-rendering"><span class="header-section-number">9.15.4</span> Step 4: Automated Paper Rendering</a></li>
  <li><a href="#step-5-container-registry-integration" id="toc-step-5-container-registry-integration" class="nav-link" data-scroll-target="#step-5-container-registry-integration"><span class="header-section-number">9.15.5</span> Step 5: Container Registry Integration</a></li>
  </ul></li>
  <li><a href="#workflow-explanations" id="toc-workflow-explanations" class="nav-link" data-scroll-target="#workflow-explanations"><span class="header-section-number">9.16</span> Workflow Explanations</a>
  <ul class="collapse">
  <li><a href="#docker-ci-workflow-features" id="toc-docker-ci-workflow-features" class="nav-link" data-scroll-target="#docker-ci-workflow-features"><span class="header-section-number">9.16.1</span> Docker CI Workflow Features:</a></li>
  <li><a href="#r-package-check-features" id="toc-r-package-check-features" class="nav-link" data-scroll-target="#r-package-check-features"><span class="header-section-number">9.16.2</span> R Package Check Features:</a></li>
  <li><a href="#paper-rendering-features" id="toc-paper-rendering-features" class="nav-link" data-scroll-target="#paper-rendering-features"><span class="header-section-number">9.16.3</span> Paper Rendering Features:</a></li>
  <li><a href="#container-publishing-features" id="toc-container-publishing-features" class="nav-link" data-scroll-target="#container-publishing-features"><span class="header-section-number">9.16.4</span> Container Publishing Features:</a></li>
  </ul></li>
  <li><a href="#authentication-and-permissions" id="toc-authentication-and-permissions" class="nav-link" data-scroll-target="#authentication-and-permissions"><span class="header-section-number">9.17</span> Authentication and Permissions</a>
  <ul class="collapse">
  <li><a href="#built-in-github_token" id="toc-built-in-github_token" class="nav-link" data-scroll-target="#built-in-github_token"><span class="header-section-number">9.17.1</span> Built-in GITHUB_TOKEN:</a></li>
  <li><a href="#setting-repository-permissions" id="toc-setting-repository-permissions" class="nav-link" data-scroll-target="#setting-repository-permissions"><span class="header-section-number">9.17.2</span> Setting Repository Permissions:</a></li>
  <li><a href="#using-personal-access-tokens-advanced" id="toc-using-personal-access-tokens-advanced" class="nav-link" data-scroll-target="#using-personal-access-tokens-advanced"><span class="header-section-number">9.17.3</span> Using Personal Access Tokens (Advanced):</a></li>
  </ul></li>
  <li><a href="#integration-with-collaborative-workflow" id="toc-integration-with-collaborative-workflow" class="nav-link" data-scroll-target="#integration-with-collaborative-workflow"><span class="header-section-number">9.18</span> Integration with Collaborative Workflow</a>
  <ul class="collapse">
  <li><a href="#pull-request-integration" id="toc-pull-request-integration" class="nav-link" data-scroll-target="#pull-request-integration"><span class="header-section-number">9.18.1</span> Pull Request Integration:</a></li>
  <li><a href="#branch-protection-rules" id="toc-branch-protection-rules" class="nav-link" data-scroll-target="#branch-protection-rules"><span class="header-section-number">9.18.2</span> Branch Protection Rules:</a></li>
  </ul></li>
  <li><a href="#monitoring-and-troubleshooting" id="toc-monitoring-and-troubleshooting" class="nav-link" data-scroll-target="#monitoring-and-troubleshooting"><span class="header-section-number">9.19</span> Monitoring and Troubleshooting</a>
  <ul class="collapse">
  <li><a href="#viewing-workflow-results" id="toc-viewing-workflow-results" class="nav-link" data-scroll-target="#viewing-workflow-results"><span class="header-section-number">9.19.1</span> Viewing Workflow Results:</a></li>
  <li><a href="#common-issues-and-solutions" id="toc-common-issues-and-solutions" class="nav-link" data-scroll-target="#common-issues-and-solutions"><span class="header-section-number">9.19.2</span> Common Issues and Solutions:</a></li>
  <li><a href="#performance-optimization" id="toc-performance-optimization" class="nav-link" data-scroll-target="#performance-optimization"><span class="header-section-number">9.19.3</span> Performance Optimization:</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#appendix-f-docker-configuration-examples" id="toc-appendix-f-docker-configuration-examples" class="nav-link" data-scroll-target="#appendix-f-docker-configuration-examples">Appendix F: Docker Configuration Examples</a>
  <ul class="collapse">
  <li><a href="#production-dockerfile" id="toc-production-dockerfile" class="nav-link" data-scroll-target="#production-dockerfile"><span class="header-section-number">9.20</span> Production Dockerfile</a></li>
  <li><a href="#features-of-the-production-dockerfile" id="toc-features-of-the-production-dockerfile" class="nav-link" data-scroll-target="#features-of-the-production-dockerfile"><span class="header-section-number">9.21</span> Features of the Production Dockerfile</a></li>
  <li><a href="#r-version-extraction" id="toc-r-version-extraction" class="nav-link" data-scroll-target="#r-version-extraction"><span class="header-section-number">9.22</span> R Version Extraction</a></li>
  </ul></li>
  <li><a href="#appendix-g-renv-management-and-validation" id="toc-appendix-g-renv-management-and-validation" class="nav-link" data-scroll-target="#appendix-g-renv-management-and-validation">Appendix G: renv Management and Validation</a>
  <ul class="collapse">
  <li><a href="#renv-consistency-checker-features" id="toc-renv-consistency-checker-features" class="nav-link" data-scroll-target="#renv-consistency-checker-features"><span class="header-section-number">9.23</span> renv Consistency Checker Features</a></li>
  <li><a href="#team-collaboration-commands" id="toc-team-collaboration-commands" class="nav-link" data-scroll-target="#team-collaboration-commands"><span class="header-section-number">9.24</span> Team Collaboration Commands</a></li>
  <li><a href="#multi-developer-workflow" id="toc-multi-developer-workflow" class="nav-link" data-scroll-target="#multi-developer-workflow"><span class="header-section-number">9.25</span> Multi-Developer Workflow</a></li>
  <li><a href="#integration-with-development-workflows" id="toc-integration-with-development-workflows" class="nav-link" data-scroll-target="#integration-with-development-workflows"><span class="header-section-number">9.26</span> Integration with Development Workflows</a>
  <ul class="collapse">
  <li><a href="#pre-commit-hooks" id="toc-pre-commit-hooks" class="nav-link" data-scroll-target="#pre-commit-hooks"><span class="header-section-number">9.26.1</span> Pre-commit Hooks</a></li>
  <li><a href="#makefile-integration" id="toc-makefile-integration" class="nav-link" data-scroll-target="#makefile-integration"><span class="header-section-number">9.26.2</span> Makefile Integration</a></li>
  <li><a href="#cicd-integration" id="toc-cicd-integration" class="nav-link" data-scroll-target="#cicd-integration"><span class="header-section-number">9.26.3</span> CI/CD Integration</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Research Compendia for Full Reproducibility in R: A zzrrtools, renv, and Docker Strategy</h1>
</div>



<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>R.G. Thomas </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    <p>This white paper presents an approach to achieving reproducibility in R workflows by combining three tools: zzrrtools for creating structured research compendia, renv for R package management, and Docker for containerizing the computing environment. The zzrrtools framework provides a standardized research compendium structure, renv manages package dependencies, and Docker ensures consistent execution environments. Together, these tools create self-contained research compendia that run identically across different systems. The paper includes a practical case study demonstrating multi-developer collaborative workflows with clear governance roles, where a project maintainer manages the technical infrastructure while multiple contributors extend the research analysis.</p>
  </div>
</div>


</header>


<section id="executive-summary" class="level1 unnumbered">
<h1 class="unnumbered">Executive Summary</h1>
<p>Reproducibility is key to conducting data analysis, yet in practice, achieving it consistently with R workflows can be quite challenging. R projects frequently break when transferred between computers due to mismatched R versions, package dependencies, or inconsistent project organization. This white paper describes an approach to solving this problem by combining three tools: <strong>zzrrtools</strong> for creating structured research compendia, <strong>renv</strong> for R package management, and <strong>Docker</strong> for containerizing the computing environment. Together, these tools ensure that an R workflow runs identically across different computers by providing standardized project structure, identical R packages and versions, consistent R versions, and the same operating system libraries as the original setup.</p>
</section>
<section id="motivation" class="level1 unnumbered">
<h1 class="unnumbered">Motivation</h1>
<p>Imagine you’ve written code that you want to share with a colleague. At first glance, this may seem like a straightforward task—simply share the files electronically. However, ensuring that your colleague can run the code without errors, and obtain the same results is often much more challenging than anticipated.</p>
<p>When sharing R code, several potential problems can arise that can lead to code that won’t run or won’t match your results:</p>
<ul>
<li>Different versions of R installed on each machine</li>
<li>Mismatched R package versions</li>
<li>Missing or mismatched system dependencies (like pandoc or LaTeX)</li>
<li>Missing supplemental files referenced by the program (bibliography files, LaTeX preambles, datasets, images)</li>
<li>Different R startup configurations (.Rprofile or .Renviron)</li>
<li>Different Operating Systems (macOS, Windows, Linux, etc.)</li>
</ul>
<p>A real-world scenario often unfolds like this:</p>
<ol type="1">
<li>You email your analysis files to a colleague</li>
<li>They attempt to run your analysis with the commands you provided</li>
<li>But R isn’t installed on their system</li>
<li>After installing R, they get an error: “could not find function ‘render’” since they don’t have the <code>rmarkdown</code> package installed</li>
<li>They install the rmarkdown package and run the R command again</li>
<li>Now pandoc is missing</li>
<li>After installing pandoc, a required package, say <code>ggplot</code>, is missing</li>
<li>After installing <code>ggplot</code>, several external files are missing (e.g.&nbsp; bibliography, images)</li>
<li>And so on…</li>
</ol>
<p>This cycle of troubleshooting can be time-consuming and frustrating. Even when the code eventually runs, there’s no guarantee that they will get the same results that you did.</p>
<p>To ensure true reproducibility, your colleague should have a computing environment as similar to yours as possible. Given the dynamic nature of open source software, not to mention hardware and operating system differences, this can be difficult to achieve through manual installation and configuration.</p>
<p>The approach outlined in this white paper offers a systematic solution. Rather than sending standalone text files, with modest additional effort, you can provide a complete, containerized, hardware and OS independent environment that includes everything needed to run your analysis. With this approach, your colleague can run a simple command like:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="dt">\</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/analysis/figures:/home/analyst/output"</span> <span class="dt">\</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(The details of this docker command are explained below.)</p>
<p>This creates an identical R environment on their desktop, ready for them to run or modify your code with confidence that it will work as intended.</p>
<p>The Docker command shown above represents the end goal of this white paper’s approach, but achieving this level of reproducibility requires understanding and implementing three complementary technologies. The following sections provide a framework for building such reproducible environments from the ground up.</p>
</section>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<section id="the-challenge-of-reproducibility-in-r" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="the-challenge-of-reproducibility-in-r"><span class="header-section-number">1.1</span> The Challenge of Reproducibility in R</h2>
<p>R has become a standard tool for data science and statistical analysis across numerous scientific disciplines. However, as R projects grow in complexity, they often develop complex webs of dependencies that can make sharing and reproducing analyses difficult. Some common challenges include:</p>
<ul>
<li>Different R versions across machines</li>
<li>Incompatible package versions</li>
<li>Missing system-level dependencies</li>
<li>Operating system differences (macOS vs.&nbsp;Windows vs.&nbsp;Linux)</li>
<li>Conflicts with other installed packages</li>
<li>R startup files (.Rprofile, .Renviron, .RData) that can affect code behavior</li>
</ul>
<p>These challenges often manifest as the frustrating “it works on my machine” problem, where analysis code runs perfectly for the original author but fails when others attempt to use it. This undermines the scientific and collaborative potential of R-based analyses.</p>
</section>
<section id="a-three-level-solution" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="a-three-level-solution"><span class="header-section-number">1.2</span> A Three-Level Solution</h2>
<p>To address these challenges, we need to tackle reproducibility at three distinct levels:</p>
<ol type="1">
<li><p><strong>Project-level reproducibility</strong>: Ensuring consistent project structure and organization using research compendium standards</p></li>
<li><p><strong>Package-level reproducibility</strong>: Ensuring exact package versions and dependencies are maintained</p></li>
<li><p><strong>System-level reproducibility</strong>: Guaranteeing consistent R versions, operating system, and system libraries</p></li>
</ol>
<p>The strategy presented in this white paper leverages <strong>zzrrtools</strong> for project-level structure, <strong>renv</strong> for package-level consistency, and <strong>Docker</strong> for system-level consistency. When combined, they provide a framework for end-to-end reproducible R workflows with proper research compendium organization.</p>
<p>With this three-level framework established, we can now examine how each tool addresses its specific layer of reproducibility. We begin with zzrrtools, which tackles the foundational challenge of project-level organization and provides the structural framework upon which package and system-level reproducibility can be built.</p>
</section>
</section>
<section id="zzrrtools-project-level-reproducibility" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> zzrrtools: Project-Level Reproducibility</h1>
<section id="what-is-zzrrtools" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="what-is-zzrrtools"><span class="header-section-number">2.1</span> What is zzrrtools?</h2>
<p><strong>zzrrtools</strong> is a Docker-first framework that creates reproducible research compendia with containerized development workflows. The framework extends the research compendium concept introduced by Ben Marwick’s rrtools, adding container-based development and automated dependency validation. Team members install zzrrtools once on their system, then can create or join any zzrrtools-based project using the same framework. A research compendium organizes digital research materials to enable others to inspect, reproduce, and extend the research.</p>
</section>
<section id="key-features-of-zzrrtools" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="key-features-of-zzrrtools"><span class="header-section-number">2.2</span> Key Features of zzrrtools</h2>
<p><strong>zzrrtools</strong> creates containerized research compendia with these key features:</p>
<ul>
<li><p><strong>Docker-first development</strong>: All workflows operate within containers, eliminating “works on my machine” issues</p></li>
<li><p><strong>Centralized framework</strong>: One-time zzrrtools installation enables consistent project creation and team collaboration</p></li>
<li><p><strong>Multi-service architecture</strong>: Provides specialized Docker environments for interactive R sessions, shell development, and paper rendering</p></li>
<li><p><strong>Flexible base images</strong>: Choice of minimal (rocker/r-ver) or pre-packaged (rgt47/r-pluspackages) Docker templates with common R packages</p></li>
<li><p><strong>Advanced dependency validation</strong>: Automated renv consistency checking with CRAN verification and pre-commit validation</p></li>
<li><p><strong>Shell-based workflows</strong>: Optimized for command-line development with rich automation via Make targets</p></li>
<li><p><strong>Team collaboration focus</strong>: Designed for multi-developer teams working on shared research projects</p></li>
</ul>
</section>
<section id="zzrrtools-workflow-self-replicating-collaboration" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="zzrrtools-workflow-self-replicating-collaboration"><span class="header-section-number">2.3</span> zzrrtools Workflow: Self-Replicating Collaboration</h2>
<p>The zzrrtools workflow is designed for team collaboration:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Project creator initializes the research compendium</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/prj/zzrrtools/zzrrtools.sh</span> <span class="pp">[</span><span class="ss">OPTIONS</span><span class="pp">]</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Available options:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   --dotfiles DIR       Copy personal dotfiles (with leading dots)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   --dotfiles-nodot DIR Copy dotfiles (without leading dots) </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   --base-image NAME    Use custom Docker base image (default: rocker/r-ver)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                        Popular options: rgt47/r-pluspackages (includes tidyverse)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   --no-docker          Skip Docker image build</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   --next-steps         Show workflow guidance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This creates a Docker-first research compendium with:</p>
<ul>
<li><strong>Framework-based setup</strong> using centrally installed zzrrtools for consistent project creation</li>
<li><strong>Multi-service Docker architecture</strong> for interactive R, shell, and rendering</li>
<li><strong>Advanced renv validation</strong> with CRAN verification and pre-commit checking</li>
<li><strong>Dual-track automation</strong> supporting both native R and Docker workflows</li>
<li><strong>Navigation shortcuts</strong> via symbolic links (a→data, p→paper, s→scripts)</li>
<li><strong>Developer environment integration</strong> with personal dotfiles support</li>
<li><strong>Team synchronization</strong> via automated dependency validation</li>
</ul>
<p>Team members can collaborate after one-time zzrrtools installation:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One-time zzrrtools installation</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone zzrrtools-repo ~/prj/zzrrtools</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/prj/zzrrtools <span class="kw">&amp;&amp;</span> <span class="ex">./install.sh</span>  <span class="co"># Creates zzrrtools command in PATH</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Per-project workflow</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone project-repo <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> project-repo</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">zzrrtools</span>  <span class="co"># Set up project environment (command available anywhere)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r   <span class="co"># Start interactive R session</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="integrated-renv-consistency-checking" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="integrated-renv-consistency-checking"><span class="header-section-number">2.3.1</span> Integrated renv Consistency Checking</h3>
<p>The workflow includes advanced renv management through the <code>check_renv_for_commit.R</code> script, which provides automated dependency validation and team conflict prevention. This script:</p>
<ul>
<li><strong>Scans multiple directories</strong> (R/, scripts/, analysis/) for package dependencies</li>
<li><strong>Validates against CRAN</strong> to ensure packages exist and are properly named<br>
</li>
<li><strong>Synchronizes dependencies</strong> across code files, DESCRIPTION, and renv.lock</li>
<li><strong>Provides automated fixes</strong> to maintain team environment consistency</li>
<li><strong>Integrates with CI/CD</strong> for fail-fast validation workflows</li>
</ul>
<p>Usage examples:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive dependency checking (development)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto-fix dependency issues</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># CI/CD validation with fail-fast</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span> <span class="at">--fail-on-issues</span> <span class="at">--quiet</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Via Make targets (recommended)</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv          <span class="co"># Check dependencies</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-fix      <span class="co"># Fix dependency issues</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check-renv-fix  <span class="co"># Fix in container</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This approach ensures collaborators can reliably reproduce package environments and CI/CD pipelines have all necessary dependency information.</p>
</section>
</section>
<section id="research-compendium-structure" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="research-compendium-structure"><span class="header-section-number">2.4</span> Research Compendium Structure</h2>
<p>The zzrrtools setup creates a directory structure that follows research compendium best practices. The structure includes organized data folders, analysis directories, testing frameworks, and workflows.</p>
<p><strong>Key organizational principles:</strong></p>
<ul>
<li><strong>Data management</strong>: Separate folders for raw, derived, and external data with proper documentation</li>
<li><strong>Analysis workflow</strong>: Dedicated spaces for papers, figures, tables, and working scripts<br>
</li>
<li><strong>Package structure</strong>: R package organization with documentation and testing</li>
<li><strong>Integration support</strong>: Works with Docker, GitHub Actions, and build systems</li>
</ul>
<p>This organizational framework provides the foundation for reproducible research while supporting team collaboration and automated workflows.</p>
</section>
<section id="iterative-development-workflow" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="iterative-development-workflow"><span class="header-section-number">2.5</span> Iterative Development Workflow</h2>
<p>For collaborative analysis development, the research compendium structure supports a phased approach that balances rapid iteration with publication-quality outputs:</p>
<section id="phase-1-exploration-development-scripts" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="phase-1-exploration-development-scripts"><span class="header-section-number">2.5.1</span> Phase 1: Exploration &amp; Development (<code>scripts/</code>)</h3>
<p>During active analysis development, team members should work primarily in the <code>scripts/</code> directory:</p>
<pre><code>scripts/
├── 01_data_exploration.R
├── 02_penguin_correlations.R  
├── 03_species_analysis.R
├── 04_body_mass_analysis.R    # Additional analysis
└── 05_visualization_experiments.R</code></pre>
<p><strong>Benefits of script-based development:</strong> - <strong>Fast iteration</strong>: No need to knit/render documents during development - <strong>Interactive debugging</strong>: Can run code line-by-line in R console - <strong>Version control friendly</strong>: Pure R files produce clean diffs in Git - <strong>Easy collaboration</strong>: Contributors can add numbered script files - <strong>Flexible experimentation</strong>: Quick to test ideas and approaches</p>
</section>
<section id="phase-2-function-extraction-r" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="phase-2-function-extraction-r"><span class="header-section-number">2.5.2</span> Phase 2: Function Extraction (<code>R/</code>)</h3>
<p>As analysis patterns emerge, extract reusable functions to the <code>R/</code> directory:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R/penguin_utils.R</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>calculate_species_correlation <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_var, y_var, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">species_filter =</span> <span class="cn">NULL</span>) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reusable function extracted from scripts</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(species_filter)) {</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data[data<span class="sc">$</span>species <span class="sc">==</span> species_filter, ]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(data[[x_var]], data[[y_var]], <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>create_species_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_var, y_var) {</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standardized plotting function</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes_string</span>(<span class="at">x =</span> x_var, <span class="at">y =</span> y_var, </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> <span class="st">"species"</span>)) <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="phase-3-publication-integration-analysispaper" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="phase-3-publication-integration-analysispaper"><span class="header-section-number">2.5.3</span> Phase 3: Publication Integration (<code>analysis/paper/</code>)</h3>
<p>Once analysis approaches stabilize, integrate polished results into the manuscript:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In analysis/paper/paper.Rmd</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: Source complete scripts</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../scripts/02_penguin_correlations.R"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../scripts/04_body_mass_analysis.R"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: Use extracted functions</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"penguin_utils.R"</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>correlation_result <span class="ot">&lt;-</span> <span class="fu">calculate_species_correlation</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  penguins, <span class="st">"flipper_length_mm"</span>, <span class="st">"bill_length_mm"</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="recommended-collaborative-workflow" class="level3" data-number="2.5.4">
<h3 data-number="2.5.4" class="anchored" data-anchor-id="recommended-collaborative-workflow"><span class="header-section-number">2.5.4</span> Recommended Collaborative Workflow:</h3>
<ol type="1">
<li><strong>Project initialization</strong>: Project maintainer runs <code>zzrrtools.sh</code> to create project structure</li>
<li><strong>Immediate containerization</strong>: Build Docker container and switch to container-based development from day one</li>
<li><strong>Initial development</strong>: Create exploratory scripts in <code>scripts/</code> directory <strong>inside the container</strong></li>
<li><strong>Collaborative iteration</strong>: Team members clone repo, build identical container, add additional script files through pull requests <strong>from within the container</strong></li>
<li><strong>Code review in scripts</strong>: Both developers refine analysis logic in script files while working in identical Docker environments</li>
<li><strong>Function extraction</strong>: Move stable, reusable code to <code>R/</code> directory</li>
<li><strong>Paper integration</strong>: Source scripts or use functions in <code>analysis/paper/paper.Rmd</code></li>
<li><strong>Continuous validation</strong>: All development and testing occurs within the containerized environment</li>
</ol>
<p><strong>Why this container-first approach works:</strong></p>
<ul>
<li><strong>Reproducibility</strong>: Eliminates “works on my machine” problems from day one</li>
<li><strong>Identical environments</strong>: All collaborators work in exactly the same computational environment</li>
<li><strong>No environment drift</strong>: Cannot occur when everyone develops within containers</li>
<li><strong>Speed</strong>: Script development is faster than R Markdown knitting</li>
<li><strong>Modularity</strong>: Each script can focus on a specific analysis aspect</li>
<li><strong>Testability</strong>: Functions in <code>R/</code> can be easily unit tested in the same environment they’ll run in production</li>
<li><strong>Simple collaboration</strong>: Environment setup becomes a one-time <code>docker build</code> command for all contributors</li>
<li><strong>Development-production parity</strong>: The development environment IS the production environment</li>
</ul>
<p>This container-first, phased approach gives collaborators the speed of script-based development during exploration while maintaining the reproducibility and narrative flow of literate programming for final outputs. Most importantly, it ensures that all development occurs within the exact computational environment that will be used for final analysis and publication.</p>
<p>While zzrrtools establishes the organizational foundation for reproducible research, it relies on consistent R package environments to function effectively across different systems. The directory structure and R package framework created by zzrrtools becomes most useful when combined with precise dependency management. This is where renv becomes essential, providing the package-level consistency that complements zzrrtools’ structural approach.</p>
</section>
</section>
</section>
<section id="renv-package-level-reproducibility" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> renv: Package-Level Reproducibility</h1>
<section id="what-is-renv" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="what-is-renv"><span class="header-section-number">3.1</span> What is renv?</h2>
<p><strong>renv</strong> (Reproducible Environment) is an R package designed to create isolated, project-specific library environments. Instead of relying on a shared system-wide R library that might change over time, renv gives each project its own separate collection of packages with specific versions.</p>
</section>
<section id="key-features-of-renv" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="key-features-of-renv"><span class="header-section-number">3.2</span> Key Features of renv</h2>
<ul>
<li><p><strong>Isolated project library</strong>: renv creates a project-specific library (typically in <code>renv/library</code>) containing only the packages used by that project. This isolation ensures that updates or changes to packages in one project won’t affect others.</p></li>
<li><p><strong>Lockfile for dependencies</strong>: When you finish installing or updating packages, <code>renv::snapshot()</code> produces a <code>renv.lock</code> file - a JSON document listing each package and its exact version and source. This lockfile is designed to be committed to version control and shared.</p></li>
<li><p><strong>Environment restoration</strong>: On a new machine (or when reproducing past results), <code>renv::restore()</code> installs the exact versions of packages specified in the lockfile. This creates an R package environment identical to the one that created the lockfile, provided the same R version is available. The R version is important since critical components of the R system, such as random number generation, and default factor handling policy vary between versions.</p></li>
</ul>
</section>
<section id="basic-renv-workflow" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="basic-renv-workflow"><span class="header-section-number">3.3</span> Basic renv Workflow</h2>
<p>The typical workflow with renv involves:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One-time installation of renv</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"renv"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize renv for the project</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">init</span>()  <span class="co"># Creates renv infrastructure</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Install project-specific packages</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the package state to renv.lock</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">snapshot</span>()</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Later or on another system...</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">restore</span>()  <span class="co"># Restore packages from renv.lock</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>While renv successfully addresses package-level reproducibility by ensuring identical R package versions across environments, even perfect package consistency cannot prevent analyses from failing or producing different results due to variations in R versions, operating systems, or system-level dependencies. A complete reproducibility solution requires addressing these system-level differences, which is where Docker containerization becomes essential.</p>
</section>
</section>
<section id="docker-system-level-reproducibility" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Docker: System-Level Reproducibility</h1>
<section id="what-is-docker" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="what-is-docker"><span class="header-section-number">4.1</span> What is Docker?</h2>
<p>Docker is a platform that allows you to package software into standardized units called containers. A Docker container is like a lightweight virtual machine that includes everything needed to run an application: the code, runtime, system tools, libraries, and settings.</p>
</section>
<section id="dockers-role-in-reproducibility" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="dockers-role-in-reproducibility"><span class="header-section-number">4.2</span> Docker’s Role in Reproducibility</h2>
<p>While renv handles R packages, Docker ensures consistency for:</p>
<ul>
<li><strong>Operating system</strong>: The specific Linux distribution or OS version</li>
<li><strong>R interpreter</strong>: The exact R version</li>
<li><strong>System libraries</strong>: Required C/C++ libraries and other dependencies</li>
<li><strong>Computational environment</strong>: Memory limits, CPU configuration, etc.</li>
<li><strong>External tools</strong>: pandoc, LaTeX, and other utilities needed for R Markdown</li>
</ul>
<p>By running an R Markdown project in Docker, you eliminate differences in OS or R installation as potential sources of irreproducibility. Any machine running Docker will execute the container in an identical environment.</p>
</section>
<section id="docker-components-for-r-workflows" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="docker-components-for-r-workflows"><span class="header-section-number">4.3</span> Docker Components for R Workflows</h2>
<p>For R-based projects, a typical Docker approach involves:</p>
<ol type="1">
<li><strong>Base image</strong>: Starting from a pre-configured R image (e.g., from the Rocker project)</li>
<li><strong>Dependencies</strong>: Adding system and R package dependencies</li>
<li><strong>Configuration</strong>: Setting working directories and environment variables</li>
<li><strong>Content</strong>: Adding project files</li>
<li><strong>Execution</strong>: Defining how the project should run</li>
</ol>
<p>The zzrrtools setup uses a streamlined Dockerfile based on rocker/r-ver with TinyTeX for LaTeX support. The R version is matched to the renv.lock file:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use R version from renv.lock for perfect consistency</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> R_VERSION=4.3.0</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> rocker/r-ver:${R_VERSION}</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Prevent interactive prompts</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> DEBIAN_FRONTEND=noninteractive</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Install minimal system dependencies</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="at">--no-install-recommends</span> <span class="dt">\</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    pandoc <span class="dt">\</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    vim <span class="dt">\</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    git <span class="dt">\</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    curl <span class="dt">\</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    fonts-dejavu <span class="dt">\</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> clean <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> <span class="at">-rf</span> /var/lib/apt/lists/<span class="pp">*</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create non-root user</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> USERNAME=analyst</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">useradd</span> <span class="at">--create-home</span> <span class="at">--shell</span> /bin/bash <span class="va">${USERNAME}</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Set user R library path</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> R_LIBS_USER=/home/${USERNAME}/R/library</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create user R library directory and assign permissions</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> /home/<span class="va">${USERNAME}</span>/R/library <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">chown</span> <span class="at">-R</span> <span class="va">${USERNAME}</span>:<span class="va">${USERNAME}</span> /home/<span class="va">${USERNAME}</span>/R</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /home/${USERNAME}</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy renv files with correct ownership</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> renv.lock ./</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> renv/activate.R ./renv/</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Switch to non-root user</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="kw">USER</span> ${USERNAME}</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Install base R packages to user library</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">'.libPaths(Sys.getenv("R_LIBS_USER")); \</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="st">    install.packages(c("tinytex", "rmarkdown", "renv"), \</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="st">    repos = "https://cloud.r-project.org")'</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Install TinyTeX in user directory</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">'tinytex::install_tinytex()'</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Add TinyTeX binaries to PATH</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> PATH=/home/${USERNAME}/.TinyTeX/bin/x86_64-linux:$PATH</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Restore R packages via renv</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">'.libPaths(Sys.getenv("R_LIBS_USER")); \</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="st">    renv::restore()'</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Default to interactive shell</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"/bin/bash"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This configuration provides a minimal R installation with LaTeX support for PDF rendering and secure non-root user execution.</p>
<p><strong>Docker Compose Integration:</strong></p>
<p>The setup also includes a docker-compose.yml that provides multiple development environments:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple services for different workflows</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">r-session</span><span class="kw">:</span><span class="co">   # Interactive R session  </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bash</span><span class="kw">:</span><span class="co">        # Bash shell access</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">research</span><span class="kw">:</span><span class="co">    # Automated paper rendering</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">test</span><span class="kw">:</span><span class="co">        # Package testing</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">check</span><span class="kw">:</span><span class="co">       # Package checking</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This allows developers to choose their preferred development environment while maintaining identical package dependencies and system configuration.</p>
</section>
</section>
<section id="combining-zzrrtools-renv-and-docker-a-comprehensive-approach" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Combining zzrrtools, renv, and Docker: A Comprehensive Approach</h1>
<section id="why-use-all-three" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="why-use-all-three"><span class="header-section-number">5.1</span> Why Use All Three?</h2>
<p>Using any single tool improves reproducibility, but combining all three provides the most complete solution:</p>
<ul>
<li><strong>zzrrtools</strong> provides standardized project structure and research compendium organization</li>
<li><strong>renv</strong> guarantees the R packages and their versions</li>
<li><strong>Docker</strong> guarantees the OS and R version</li>
<li><strong>Together</strong> they achieve end-to-end reproducibility from project organization through package dependencies to operating system consistency</li>
</ul>
<p>This approach creates a fully portable, well-organized research compendium that can be shared and will produce identical results across different computers while following established research best practices.</p>
</section>
<section id="integration-strategy-with-governance-model" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="integration-strategy-with-governance-model"><span class="header-section-number">5.2</span> Integration Strategy with Governance Model</h2>
<p>The workflow integrates zzrrtools, renv, and Docker with a clear governance structure suitable for multi-developer research teams:</p>
<p><strong>Project Maintainer Role:</strong> - Creates and maintains the research compendium structure - Manages renv environment and package dependencies using consistency checking - Updates and maintains Docker images - Reviews and approves contributor changes - Runs renv validation before accepting pull requests</p>
<p><strong>Contributor Role (Other Developers)</strong>: - Access the private research compendium as invited collaborators - Add analysis content, papers, and documentation using feature branches - Propose new package dependencies through contributions - Submit changes via pull requests from feature branches</p>
<p><strong>Workflow Steps</strong>:</p>
<ol type="1">
<li><p><strong>Initialize Research Compendium (Maintainer)</strong>:</p>
<ul>
<li>Create standardized project structure using zzrrtools framework</li>
<li>Set up analysis directories with data organization</li>
<li>Initialize renv environment with <code>renv::init()</code></li>
<li>Create Dockerfile with container configuration</li>
</ul></li>
<li><p><strong>Establish Development Environment (Maintainer)</strong>:</p>
<ul>
<li><p>Install required packages and develop initial analysis</p></li>
<li><p>Create tests for analytical functions</p></li>
<li><p>Use the renv consistency checker to validate and create initial lockfile:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate dependencies and create snapshot</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Build and test Docker image locally</p></li>
</ul></li>
<li><p><strong>Maintain Infrastructure (Maintainer)</strong>:</p>
<ul>
<li><p>Review contributor pull requests for package additions</p></li>
<li><p>Use renv consistency checker to validate and update dependencies:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate contributor's package requirements</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fail-on-issues</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># If validation passes, update environment</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Update <code>renv.lock</code> by selectively incorporating new dependencies</p></li>
<li><p>Rebuild Docker images when system dependencies change</p></li>
<li><p>Push updated images to container registry (Docker Hub, GitHub Container Registry)</p></li>
</ul></li>
<li><p><strong>Collaborative Development (All Developers)</strong>:</p>
<p><strong>Research Compendium Files in GitHub Repository:</strong></p>
<ul>
<li><strong>Project Structure</strong>: <code>DESCRIPTION</code>, <code>LICENSE</code>, <code>README.qmd</code> (zzrrtools-generated)</li>
<li><strong>Analysis Content</strong>: Files in <code>analysis/paper/</code> directory (R Markdown manuscripts)</li>
<li><strong>Dependencies</strong>: <code>renv.lock</code> (managed by maintainer), <code>renv/activate.R</code></li>
<li><strong>Infrastructure</strong>: <code>Dockerfile</code> (maintained by project maintainer)</li>
<li><strong>Code</strong>: <code>R/</code> directory (utility functions), <code>tests/</code> directory</li>
<li><strong>Documentation</strong>: Generated README files and project documentation</li>
<li><strong>Configuration</strong>: <code>.gitignore</code>, <code>.github/</code> (CI/CD workflows)</li>
</ul>
<p><strong>Sharing the Docker image using Docker Hub:</strong></p>
<p>Docker Hub provides public image hosting that enables reproducible research by sharing computational environments while protecting private research code in GitHub.</p>
<p><strong>Docker Hub (Recommended for Reproducible Research)</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the image with GitHub Container Registry URL</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> ghcr.io/username/penguins_analysis:v1.0 .</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Login to GitHub Container Registry (using GitHub Personal Access Token)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$GITHUB_TOKEN</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="at">-u</span> username <span class="dt">\</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">--password-stdin</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Push to GitHub Container Registry (automatically private)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push ghcr.io/username/penguins_analysis:v1.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Setting up GitHub Personal Access Token:</strong></p>
<p>Create a Personal Access Token with the required permissions for container registry operations. The token must include <code>write:packages</code> and <code>read:packages</code> scopes, plus <code>repo</code> access for private repositories.</p>
<p><strong>For detailed step-by-step instructions, see Appendix A: GitHub Personal Access Token Setup.</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export token as environment variable (replace with your actual token)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">GITHUB_TOKEN</span><span class="op">=</span>ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Login and push</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$GITHUB_TOKEN</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="at">-u</span> username <span class="dt">\</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">--password-stdin</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> ghcr.io/username/penguins_analysis:v1.0 .</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push ghcr.io/username/penguins_analysis:v1.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Note</strong>: If you get a “permission_denied” error when pushing, ensure your token includes the correct scopes (see Appendix A for details).</p>
<p><strong>GitHub Container Registry Benefits:</strong></p>
<ul>
<li><strong>Free tier</strong>: 0.5GB storage included, no billing currently active</li>
<li><strong>Automatic access control</strong>: Inherits repository permissions</li>
<li><strong>Integrated with GitHub Actions</strong>: Direct authentication in CI/CD</li>
<li><strong>Simple team sharing</strong>: Repository collaborators automatically have access</li>
<li><strong>Package management</strong>: Integrated with GitHub Packages ecosystem</li>
</ul>
<p><strong>Docker Workflow:</strong></p>
<p>The zzrrtools setup provides multiple approaches for working with containers, from simple Make commands to direct Docker execution. Make commands offer simplicity:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build and run with Make (recommended)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build    <span class="co"># Build the container</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r        <span class="co"># Interactive R session</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-render   <span class="co"># Render research paper</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>For Docker workflow options including Docker Compose and direct commands, see Appendix D: Docker Workflow Options.</strong></p></li>
<li><p><strong>Execute consistently</strong>:</p>
<ul>
<li>Run analyses in the Docker container for guaranteed reproducibility</li>
<li>Use volume mounts to access local files while maintaining environment consistency</li>
<li>Run tests within the container to verify functionality</li>
</ul></li>
</ol>
<p>This strategy ensures that your R Markdown documents and analyses will run identically for anyone who has access to your Docker container, regardless of their local setup.</p>
</section>
</section>
<section id="practical-example-collaborative-research-compendium-development-with-testing" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Practical Example: Collaborative Research Compendium Development with Testing</h1>
<p>The following case study demonstrates how two developers can collaborate on a research compendium using zzrrtools, renv, and Docker to ensure reproducibility, with integrated testing procedures to maintain code quality.</p>
<section id="project-scenario" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="project-scenario"><span class="header-section-number">6.1</span> Project Scenario</h2>
<p>A team of data scientists collaborates on Palmer Penguins analysis using zzrrtools’ Docker-first workflow that eliminates environment setup friction:</p>
<ul>
<li><strong>Joe</strong> (<code>joe</code>): Project maintainer who initializes the repository</li>
<li><strong>Sam</strong> (<code>sam</code>): Contributor who extends the analysis<br>
</li>
<li><strong>Additional team members</strong>: Can join without any local R installation</li>
</ul>
<p>The collaboration model emphasizes <strong>zero-setup team onboarding</strong> through self-replicating project distribution and containerized development environments.</p>
<blockquote class="blockquote">
<p><strong>Collaboration Philosophy</strong>: - <strong>Self-contained projects</strong>: Each repository includes its own setup script - <strong>Container-first development</strong>: All work happens in identical Docker environments - <strong>Automated dependency validation</strong>: Pre-commit checks prevent conflicts - <strong>Shell-based workflows</strong>: Command-line tools for maximum flexibility</p>
</blockquote>
<p><strong>Key Workflow Principles:</strong> - Joe initializes with zzrrtools and commits the setup script to the repository - Team members run the included script - no separate installation required - All development occurs in containers for perfect environment consistency - Dependency changes are validated before commits to prevent team conflicts - Each developer works in identical environments regardless of host system</p>
</section>
<section id="implementation-example" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="implementation-example"><span class="header-section-number">6.2</span> Implementation Example</h2>
<section id="project-maintainer-setup-joe" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="project-maintainer-setup-joe"><span class="header-section-number">6.2.1</span> Project Maintainer Setup (Joe)</h3>
<p>Joe initializes a private GitHub repository and creates the containerized research environment:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create repository and initialize zzrrtools</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/joe/penguins_analysis.git</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> penguins_analysis</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">~/prj/zzrrtools/zzrrtools.sh</span> <span class="at">--dotfiles</span> ~/.config/shell <span class="dt">\</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">--base-image</span> rgt47/r-pluspackages</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This creates: - Research compendium directory structure - Docker container configuration - renv dependency management - Automated validation scripts - GitHub Actions workflows</p>
<p><strong>For a detailed view of the complete directory structure created by zzrrtools, see Appendix C: Directory Structure.</strong></p>
<p>Joe completes the setup and begins development:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate dependencies and build container</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Start container-based development</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>For detailed information on renv dependency validation, troubleshooting, and team collaboration workflows, see Appendix G: renv Management and Validation.</strong></p>
<p>The validation script ensures package environment consistency by verifying dependencies across code files, DESCRIPTION, and renv.lock, preventing common collaboration issues where team members have mismatched environments.</p>
<p><strong>Step 4: Create Initial Analysis Paper</strong></p>
<p>Joe creates an initial analysis examining flipper length vs.&nbsp;bill length relationships in the Palmer Penguins dataset, implementing basic visualization and statistical exploration within the research compendium structure.</p>
<p><strong>Step 5: Create Tests for Analysis Functions</strong></p>
<p>Joe implements testing to ensure reproducible research through data validation, error detection, and environment verification. Testing provides collaboration confidence and supports publication standards by validating data integrity, statistical relationships, and pipeline functionality.</p>
<p>Joe sets up the testing framework and creates basic data validation tests to verify dataset availability, dimensions, and required columns. These tests ensure the analysis environment is correctly configured and catch data-related issues early in the development process.</p>
<p><strong>For a complete test suite with data validation, statistical tests, and integration tests, see Appendix B: Test Suite.</strong></p>
<p><strong>Step 6: Create a .gitignore file</strong></p>
<p>Joe configures version control to track source code and dependencies while excluding generated outputs and temporary files. The principle: track the “recipe” (code + dependencies), not the “meal” (outputs).</p>
<p>Joe creates a <code>.gitignore</code> file excluding renv libraries, generated outputs, temporary files, and system artifacts. This keeps the repository lightweight while ensuring collaborators can recreate the complete environment from tracked dependencies.</p>
<p><strong>Step 7: Create a Dockerfile</strong></p>
<p>zzrrtools generates a Dockerfile with multiple template options. The standard template uses rocker/r-ver, while the pluspackages template includes common R packages like tidyverse. Both provide:</p>
<ul>
<li><strong>R version consistency</strong>: Matches exact R version specified in renv.lock</li>
<li><strong>Development environment</strong>: Includes zsh, vim, tmux, Node.js for plugin support</li>
<li><strong>Security</strong>: Non-root user execution with proper file permissions</li>
<li><strong>TinyTeX integration</strong>: LaTeX support for PDF rendering (pluspackages template)</li>
<li><strong>Pre-installed packages</strong>: Common packages like tidyverse, DT, testthat (pluspackages template)</li>
</ul>
<p>The generated Dockerfile includes development tools and optimizations:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> R_VERSION=latest</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> rocker/r-ver:${R_VERSION}</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Install comprehensive development environment</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="dt">\</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    git ssh curl wget vim tmux zsh build-essential <span class="dt">\</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    libcurl4-openssl-dev libssl-dev libxml2-dev <span class="dt">\</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    libfontconfig1-dev libharfbuzz-dev libfribidi-dev <span class="dt">\</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    libfreetype6-dev libpng-dev libtiff5-dev libjpeg-dev <span class="dt">\</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    man-db pandoc <span class="dt">\</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> <span class="at">-rf</span> /var/lib/apt/lists/<span class="pp">*</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Node.js for vim plugins</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">curl</span> <span class="at">-fsSL</span> https://deb.nodesource.com/setup_lts.x <span class="kw">|</span> <span class="fu">bash</span> <span class="at">-</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> install <span class="at">-y</span> nodejs</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create non-root user with zsh shell</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> USERNAME=analyst</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">useradd</span> <span class="at">--create-home</span> <span class="at">--shell</span> /bin/zsh <span class="va">${USERNAME}</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up R environment with renv</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /home/${USERNAME}/project</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> renv.lock ./</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="kw">USER</span> ${USERNAME}</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"install.packages('renv'); renv::restore()"</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy project files and install</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> . .</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::install('.')"</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"/bin/zsh"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Alternative: Pre-packaged Template</strong></p>
<p>For projects using common packages, the pluspackages template includes TinyTeX and popular R packages:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install TinyTeX for PDF rendering</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"install.packages('tinytex')"</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">R</span> <span class="at">-e</span> <span class="st">"tinytex::install_tinytex()"</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">/root/.TinyTeX/bin/*/tlmgr</span> path add</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Install common R packages (cached layer)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"install.packages(c('renv', 'remotes', 'devtools', </span><span class="dt">\</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="st">    'testthat', 'naniar', 'DT', 'conflicted', 'ggthemes', </span><span class="dt">\</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="st">    'datapasta', 'janitor', 'kableExtra', 'tidytuesdayR', </span><span class="dt">\</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="st">    'tidyverse'), repos = c(CRAN = 'https://cloud.r-project.org'))"</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Give user write permissions to R library</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">chown</span> <span class="at">-R</span> <span class="va">${USERNAME}</span>:<span class="va">${USERNAME}</span> /usr/local/lib/R/site-library</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>For production Dockerfiles with development environment configuration (zsh, vim plugins, dotfiles integration), see Appendix F: Docker Configuration Examples.</strong></p>
<p><strong>R Version Synchronization:</strong></p>
<p>The Dockerfile uses a build argument to ensure the R version exactly matches what’s specified in <code>renv.lock</code>. This eliminates potential issues from R version mismatches between the package environment and the underlying R interpreter. The build command extracts the R version from the renv lockfile:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract R version from renv.lock</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="va">R_VERSION</span><span class="op">=</span><span class="va">$(</span><span class="ex">jq</span> <span class="at">-r</span> <span class="st">'.R.Version'</span> renv.lock<span class="va">)</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Build Docker image with extracted R version</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">--build-arg</span> R_VERSION=<span class="va">${R_VERSION}</span> <span class="dt">\</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-t</span> ghcr.io/joe/penguins_analysis:v1.0 .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If the <code>renv.lock</code> file specifies R 4.3.1, the Docker image will use <code>rocker/r-ver:4.3.1</code>. If renv is updated to R 4.4.0, the Docker build will use <code>rocker/r-ver:4.4.0</code>. This maintains consistency between the package environment and system environment.</p>
<p><strong>Step 8: Container-Based Development</strong></p>
<p>Joe performs all development work inside the Docker container, ensuring consistent environments and immediate visibility of changes to the host system through volume mounting. The container provides a complete development environment with package management, editing tools, and validation utilities.</p>
<p><strong>Step 9: Update and Share Environment</strong></p>
<p>When package dependencies change, GitHub Actions automatically rebuilds the Docker image with updated renv.lock specifications and pushes the updated environment to Docker Hub for team access. This ensures collaborators have access to the identical development environment.</p>
<p><strong>Step 10: Prepare for Team Handoff</strong></p>
<p>Before handing off to team members, Joe must complete several critical steps:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Validate all dependencies are properly captured</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-fix</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Run complete test suite to ensure everything works</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-test</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Render paper to verify end-to-end workflow</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-render</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Build and tag the Docker image</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> tag penguins_analysis ghcr.io/joe/penguins_analysis:v1.0</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Push Docker image to Docker Hub for team access</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$GITHUB_TOKEN</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="at">-u</span> joe <span class="at">--password-stdin</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push ghcr.io/joe/penguins_analysis:v1.0</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Commit all setup files and push to repository</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Initial research compendium setup with Docker environment"</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push origin main</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step 11: Enable Team Access</strong></p>
<p>Joe configures repository permissions for team collaboration:</p>
<ol type="1">
<li><strong>Repository Settings</strong> → <strong>Collaborators</strong> → Add team members</li>
<li><strong>Grant “Write” access</strong> to enable forking and pull requests</li>
<li><strong>Share repository URL</strong> and Docker Hub image name with team</li>
<li><strong>Document onboarding process</strong> in README or team communication</li>
</ol>
<p>At this point, Joe has established a reproducible research framework ready for collaborative development. The containerized environment is available via the registry, and team members can join with zero local setup requirements.</p>
</section>
<section id="team-member-onboarding-sam" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="team-member-onboarding-sam"><span class="header-section-number">6.2.2</span> Team Member Onboarding (Sam)</h3>
<p><strong>What Sam Receives from Joe:</strong> - Repository URL: <code>https://github.com/joe/penguins_analysis</code> - Container registry access (GitHub Personal Access Token) - Brief project overview and development guidelines</p>
<p><strong>Sam’s Onboarding Process:</strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Clone the zzrrtools framework</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/username/zzrrtools.git ~/prj/zzrrtools</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/prj/zzrrtools</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./install.sh</span>  <span class="co"># Creates zzrrtools command in PATH</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Fork and clone the project repository</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/sam/penguins_analysis.git  <span class="co"># Sam's fork</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> penguins_analysis</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Run zzrrtools setup with personal preferences</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="ex">zzrrtools</span> <span class="at">--dotfiles</span> ~/.config/shell  <span class="co"># Customize with personal dotfiles</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Or use other options:</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># zzrrtools --base-image rgt47/r-pluspackages  # Use pre-packaged template</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># zzrrtools --no-docker                       # Skip Docker build</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># zzrrtools --next-steps                      # Show workflow guidance</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Pull the pre-built Docker environment</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull ghcr.io/joe/penguins_analysis:v1.0</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Start development in identical environment</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Key Advantage</strong>: After one-time zzrrtools installation, Sam has access to the framework for all future projects. The development environment setup becomes a simple script execution.</p>
<p>Sam develops new analysis components within the same containerized environment, ensuring identical results across team members.</p>
<p><strong>Step 5: Paper Integration and Testing</strong></p>
<p>Sam integrates the new analysis into the research paper, combining Joe’s original visualizations with the new body mass analysis. Sam also creates tests to validate the new functionality and ensure package dependencies are properly documented.</p>
<p><strong>Step 6: Validation and Quality Assurance</strong></p>
<p>Sam creates tests for the new body mass analysis, validates data integrity and statistical relationships, then runs the complete test suite and verifies paper rendering to ensure no regressions before submission.</p>
<p><strong>Step 7: Contribution Submission</strong></p>
<p>When Sam completes the analysis iteration, the submission process follows these steps:</p>
<ol type="1">
<li><p><strong>Validate dependencies</strong>: Run <code>make docker-check-renv-fix</code> to ensure package consistency</p></li>
<li><p><strong>Run complete test suite</strong>: Execute <code>make docker-test</code> to verify all tests pass</p></li>
<li><p><strong>Verify paper rendering</strong>: Run <code>make docker-render</code> to confirm analysis integrates properly</p></li>
<li><p><strong>Commit changes</strong>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Add body mass analysis and associated tests"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push origin feature/body-mass-analysis</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Create pull request</strong>: Submit pull request from Sam’s fork to Joe’s original repository</p></li>
<li><p><strong>Notify Joe</strong>: Alert project maintainer about new packages or Docker changes needed</p></li>
</ol>
<p><strong>Note</strong>: Only Joe (project maintainer) can accept pull requests. The official Docker image is automatically rebuilt and pushed to Docker Hub by GitHub Actions when package dependencies change.</p>
<p><strong>CI Feedback Loop</strong>: If the CI workflow fails (e.g., renv validation issues), Sam receives automatic GitHub notifications and can view detailed failure logs to fix the issues before Joe reviews the PR.</p>
<p>Sam commits the completed analysis, tests, and documentation to their feature branch and creates a cross-repository pull request to the original repository. This ensures proper code review and governance while maintaining clear attribution of contributions.</p>
<p>At this point, Sam has successfully contributed new analysis through the collaborative workflow. Joe reviews the pull request, tests the changes in the containerized environment, and merges the contribution while maintaining project governance and quality standards.</p>
</section>
</section>
<section id="complete-handoff-workflow-summary" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="complete-handoff-workflow-summary"><span class="header-section-number">6.3</span> Complete Handoff Workflow Summary</h2>
<p><strong>Initiating Developer (Joe) Responsibilities:</strong> 1. Run <code>zzrrtools.sh</code> to create research compendium 2. Develop initial analysis and create tests 3. Validate dependencies with <code>make check-renv-fix</code><br>
4. Build initial Docker image and configure automated rebuilds via GitHub Actions 5. Push team Docker image to Docker Hub (public registry for reproducibility) 6. Commit all files and push to repository 7. Grant team member repository access<br>
8. Share repository URL and Docker Hub image name</p>
<p><strong>Joining Developer (Sam) Process:</strong> 1. Receive repository URL and Docker Hub image name from Joe 2. Clone zzrrtools framework: <code>git clone zzrrtools ~/prj/zzrrtools</code> 3. Install zzrrtools: <code>cd ~/prj/zzrrtools &amp;&amp; ./install.sh</code> (creates <code>zzrrtools</code> command in PATH) 4. Fork and clone project repository 5. Pull pre-built team Docker image: <code>docker pull [TEAM]/project:latest</code> (from Docker Hub) 6. Start development immediately: <code>make docker-r</code> (no local setup needed) 7. Submit contributions via pull requests to private repository</p>
<p><strong>Key Success Factor</strong>: The containerized environment and centralized zzrrtools framework eliminate project-specific configuration requirements for team members after one-time framework installation.</p>
</section>
<section id="collaboration-results" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="collaboration-results"><span class="header-section-number">6.4</span> Collaboration Results</h2>
<p>This workflow achieves: - Identical development environments across team members - Dependency validation preventing conflicts - Standardized project structure - Automated testing and CI/CD integration</p>
<p><strong>For GitHub Actions setup instructions, workflow examples, and CI/CD configuration, see Appendix E: GitHub Actions CI/CD Setup.</strong></p>
<p>The collaborative workflow demonstrated above illustrates the power of combining zzrrtools, renv, and Docker for reproducible research. However, successful implementation of this approach requires understanding both when it’s most beneficial and how to apply it effectively. The following best practices and considerations provide guidance for teams considering this strategy.</p>
</section>
</section>
<section id="best-practices-and-considerations" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Best Practices and Considerations</h1>
<section id="when-to-use-this-approach" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="when-to-use-this-approach"><span class="header-section-number">7.1</span> When to Use This Approach</h2>
<p>The zzrrtools + renv + Docker approach with testing is particularly valuable for:</p>
<ul>
<li><strong>Long-term research projects</strong> where reproducibility over time is crucial</li>
<li><strong>Collaborative analyses</strong> with multiple contributors on different systems</li>
<li><strong>Production analytical pipelines</strong> that need to run consistently</li>
<li><strong>Academic publications</strong> where methods must be reproducible</li>
<li><strong>Teaching and education</strong> to ensure consistent student experiences</li>
<li><strong>Complex analyses</strong> that require testing to validate results</li>
</ul>
</section>
<section id="tips-for-efficient-implementation" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="tips-for-efficient-implementation"><span class="header-section-number">7.2</span> Tips for Efficient Implementation</h2>
<ol type="1">
<li><strong>Keep Docker images minimal</strong>: Include only what’s necessary for reproducibility.</li>
<li><strong>Use specific version tags</strong>: For both R packages and Docker base images, specify exact versions.</li>
<li><strong>Document system requirements</strong>: Include notes on RAM and storage requirements.</li>
<li><strong>Leverage bind mounts</strong>: Mount local directories to containers for easier development.</li>
<li><strong>Write meaningful tests</strong>: Focus on validating both data integrity and analytical results.</li>
<li><strong>Test regularly</strong>: Use CI/CD pipelines to run tests on every change.</li>
<li><strong>Consider computational requirements</strong>: Particularly for resource-intensive analyses.</li>
</ol>
</section>
<section id="testing-strategies-for-r-analyses" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="testing-strategies-for-r-analyses"><span class="header-section-number">7.3</span> Testing Strategies for R Analyses</h2>
<p>Testing data analysis code differs from traditional software testing but provides crucial value for reproducible research:</p>
<ol type="1">
<li><strong>Data Validation Tests</strong>: Ensure data has the expected structure, types, and values.</li>
<li><strong>Function Tests</strong>: Verify that custom functions work as expected with known inputs and outputs.</li>
<li><strong>Edge Case Tests</strong>: Check how code handles missing values, outliers, or unexpected inputs.</li>
<li><strong>Integration Tests</strong>: Confirm that different parts of the analysis work correctly together.</li>
<li><strong>Regression Tests</strong>: Make sure new changes don’t break existing functionality.</li>
<li><strong>Output Validation</strong>: Verify that final results match expected patterns or benchmarks.</li>
</ol>
<p>While uncommon in traditional data analysis, these tests catch silent errors, validate assumptions, and provide confidence that analyses remain correct as code and data evolve.</p>
</section>
<section id="potential-challenges" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="potential-challenges"><span class="header-section-number">7.4</span> Potential Challenges</h2>
<p>Some challenges to be aware of:</p>
<ul>
<li><strong>Docker image size</strong>: Images with many packages can become large</li>
<li><strong>Learning curve</strong>: Docker, renv, and testing frameworks require some initial learning</li>
<li><strong>System-specific features</strong>: Some analyses may rely on hardware features</li>
<li><strong>Performance considerations</strong>: Containers may have different performance characteristics</li>
<li><strong>Test maintenance</strong>: Tests need to be updated as the analysis evolves</li>
</ul>
</section>
<section id="troubleshooting-common-issues" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="troubleshooting-common-issues"><span class="header-section-number">7.5</span> Troubleshooting Common Issues</h2>
<p><strong>Docker Build Failures:</strong> - Try: <code>export DOCKER_BUILDKIT=0</code> (disable BuildKit) - Check Docker has sufficient memory/disk space - Ensure Docker is running and up to date</p>
<p><strong>Platform Warnings on ARM64/Apple Silicon:</strong> - Use updated Makefile with <code>--platform linux/amd64</code> flags - Or set: <code>export DOCKER_DEFAULT_PLATFORM=linux/amd64</code></p>
<p><strong>Permission Errors in Container:</strong> - Rebuild image after copying dotfiles - Check file ownership in project directory</p>
<p><strong>Package Name Errors:</strong> - Ensure directory name contains only letters/numbers/periods - Avoid underscores and special characters</p>
<p><strong>Missing Dotfiles in Container:</strong> - Use <code>--dotfiles</code> or <code>--dotfiles-nodot</code> flag during setup - Rebuild Docker image after adding dotfiles</p>
<p>Despite these challenges, the benefits of reproducible research outweigh the implementation costs, particularly for collaborative and long-term projects. The approach described in this white paper provides a foundation for achieving reproducibility that meets the standards expected in data science and academic research.</p>
</section>
</section>
<section id="conclusion" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Conclusion</h1>
<p>Achieving full reproducibility in R requires addressing project organization, package dependencies, and system-level consistency, while ensuring code quality through testing. By combining zzrrtools for research compendium structure, renv for R package management, Docker for environment containerization, and testing for code validation, data scientists and researchers can create truly portable, reproducible, and reliable workflows.</p>
<p>The approach presented in this white paper ensures that the common frustration of “it works on my machine” becomes a thing of the past. Instead, research compendia become easy to share and fully reproducible. A collaborator or reviewer can launch the Docker container and get identical results, without worrying about package versions, system setup, or project organization.</p>
<p>The case study demonstrates how two developers can effectively collaborate on an analysis while maintaining reproducibility and code quality throughout the project lifecycle. By integrating testing into the workflow, the team can be confident that their analysis is not only reproducible but also correct.</p>
<p>This strategy represents a method for long-term reproducibility in R, meeting the standards required for data science and research documentation. The combination of standardized research compendium structure, dependency management, and containerized environments creates a foundation for reproducible research. By adopting this approach, the R community can make progress toward the goal of reproducible and reliable research and analysis.</p>
</section>
<section id="references" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> References</h1>
<ol type="1">
<li>Marwick, B., Boettiger, C., &amp; Mullen, L. (2018). Packaging data analytical work reproducibly using R (and friends). <em>The American Statistician</em>, 72(1), 80-88.</li>
<li>Marwick, B. (2017). rrtools: Creates a Reproducible Research Compendium. R package version 0.1.6. https://github.com/benmarwick/rrtools (Extended in zzrrtools framework)</li>
<li>Ushey, K., Wickham, H., &amp; RStudio. (2023). renv: Project Environments. R package. https://rstudio.github.io/renv/</li>
<li>The Rocker Project. (2023). Docker containers for the R environment. https://www.rocker-project.org/</li>
<li>Wickham, H. (2023). testthat: Unit Testing for R. https://testthat.r-lib.org/</li>
</ol>
</section>
<section id="appendix-a-github-personal-access-token-setup" class="level1 unnumbered">
<h1 class="unnumbered">Appendix A: GitHub Personal Access Token Setup</h1>
<p>This appendix provides step-by-step instructions for creating a GitHub Personal Access Token with the required permissions for container registry operations.</p>
<p><strong>Why Container Access is Required:</strong> Both collaborators need container-related permissions because Docker images are stored in GitHub Container Registry as private packages that require authentication to access.</p>
<section id="step-by-step-token-creation" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="step-by-step-token-creation"><span class="header-section-number">9.1</span> Step-by-Step Token Creation</h2>
<p><strong>1. Navigate to GitHub Settings:</strong> - Go to <a href="https://github.com">GitHub.com</a> and sign in - Click your profile picture (top right) → Settings - In the left sidebar: Developer settings → Personal access tokens</p>
<p><strong>Note</strong>: GitHub now offers two token types: - <strong>Fine-grained personal access tokens</strong> (recommended for new projects) - <strong>Personal access tokens (classic)</strong> (for broader compatibility)</p>
<p><strong>2. Create New Token:</strong> - Click “Generate new token” and select the appropriate type - Add a descriptive note (e.g., “Docker Container Registry Access”) - Set expiration (recommended: 90 days for security)</p>
<p><strong>3. Select Required Scopes</strong> (check these boxes): - ✅ <strong>repo</strong> (Full control of private repositories) - <em>Required for private repos</em> - ✅ <strong>write:packages</strong> (Upload Docker images to GitHub Container Registry) - <em>Required for project maintainer</em> - ✅ <strong>read:packages</strong> (Download Docker images from GitHub Container Registry) - <em>Required for all team members</em> - ✅ <strong>delete:packages</strong> (Delete packages from GitHub Package Registry) - <em>Optional but recommended</em></p>
<p><strong>Note</strong>: Team members only need <code>read:packages</code> and <code>repo</code>, but the project maintainer needs all container permissions to push Docker images.</p>
<p><strong>Token Type Recommendation</strong>: Use fine-grained personal access tokens for new projects as they provide better security and more precise permissions.</p>
<p><strong>4. Generate and Copy Token:</strong> - Click “Generate token” at the bottom - <strong>Important</strong>: Copy the token immediately - you won’t see it again - Store it securely (see security practices below)</p>
</section>
<section id="token-security-best-practices" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="token-security-best-practices"><span class="header-section-number">9.2</span> Token Security Best Practices</h2>
<ul>
<li><strong>Never commit tokens to repositories</strong> - Use <code>.gitignore</code> to exclude files containing tokens</li>
<li><strong>Use environment variables</strong> - Store tokens in shell environment variables</li>
<li><strong>Set reasonable expiration dates</strong> - Use 30-90 day expiration for security</li>
<li><strong>Revoke unused tokens</strong> - Clean up tokens when no longer needed</li>
<li><strong>Consider GitHub CLI</strong> - Use <code>gh auth login</code> for easier management</li>
<li><strong>Monitor token usage</strong> - Check GitHub Settings → Developer settings → Personal access tokens for activity</li>
</ul>
</section>
<section id="alternative-using-github-cli" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="alternative-using-github-cli"><span class="header-section-number">9.3</span> Alternative: Using GitHub CLI</h2>
<p>For simpler token management, consider using GitHub CLI instead of manual tokens:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and authenticate (handles tokens)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gh</span> auth login <span class="at">--scopes</span> write:packages,read:packages,repo</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Login to container registry (works with gh auth)</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$(</span><span class="ex">gh</span> auth token<span class="va">)</span> <span class="kw">|</span> <span class="ex">docker</span> login ghcr.io <span class="dt">\</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-u</span> <span class="va">$(</span><span class="ex">gh</span> api user <span class="at">--jq</span> .login<span class="va">)</span> <span class="at">--password-stdin</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="troubleshooting-common-issues-1" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="troubleshooting-common-issues-1"><span class="header-section-number">9.4</span> Troubleshooting Common Issues</h2>
<p><strong>“permission_denied: The token provided does not match expected scopes”</strong> - Verify your token includes <code>write:packages</code> and <code>read:packages</code> scopes - For private repositories, ensure <code>repo</code> scope is also selected - Create a new token with correct permissions if needed</p>
<p><strong>Token not recognized:</strong> - Ensure token is properly exported: <code>export GITHUB_TOKEN=your_token_here</code> - Verify token hasn’t expired - Check that you’re using the full token (starts with <code>ghp_</code>) 6. Horst, A.M., Hill, A.P., &amp; Gorman, K.B. (2020). palmerpenguins: Palmer Archipelago (Antarctica) penguin data. R package version 0.1.0. https://allisonhorst.github.io/palmerpenguins/ 7. Marwick, B. (2016). Computational reproducibility in archaeological research: Basic principles and a case study of their implementation. <em>Journal of Archaeological Method and Theory</em>, 24(2), 424-473.</p>
</section>
</section>
<section id="appendix-b-comprehensive-test-suite" class="level1 unnumbered">
<h1 class="unnumbered">Appendix B: Comprehensive Test Suite</h1>
<p>This appendix provides a set of tests that can be used to validate the Palmer Penguins analysis. These tests demonstrate best practices for data analysis testing and can be adapted for other projects.</p>
<section id="test-file-teststestthattest-comprehensive-analysis.r" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="test-file-teststestthattest-comprehensive-analysis.r"><span class="header-section-number">9.5</span> Test File: <code>tests/testthat/test-comprehensive-analysis.R</code></h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 1: Data Availability and Basic Structure</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify your primary dataset loads correctly and has </span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expected dimensions</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Package loading issues, file path problems, corrupted data files</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Palmer Penguins dataset is available and has correct structure"</span>, </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">exists</span>(<span class="st">"penguins"</span>, <span class="at">where =</span> <span class="st">"package:palmerpenguins"</span>))</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_s3_class</span>(palmerpenguins<span class="sc">::</span>penguins, <span class="st">"data.frame"</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(palmerpenguins<span class="sc">::</span>penguins), <span class="dv">8</span>)  <span class="co"># Adapt: Set expected </span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                                                    <span class="co"># column count</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">nrow</span>(palmerpenguins<span class="sc">::</span>penguins), <span class="dv">300</span>)   <span class="co"># Adapt: Set minimum </span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                                                    <span class="co"># row threshold</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(palmerpenguins<span class="sc">::</span>penguins), <span class="dv">344</span>)  <span class="co"># Adapt: Set exact </span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>                                                      <span class="co"># expected count </span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>                                                      <span class="co"># if known</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 2: Required Columns Exist with Correct Types</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Ensure your analysis depends on columns that </span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co"># actually </span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># exist with correct types</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Column name changes, type coercion issues, CSV import problems</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Dataset contains required columns with expected data types"</span>, {</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check column existence - Adapt: List columns your analysis requires</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  required_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"species"</span>, <span class="st">"island"</span>, <span class="st">"bill_length_mm"</span>, </span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"bill_depth_mm"</span>, <span class="st">"flipper_length_mm"</span>, </span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"body_mass_g"</span>, <span class="st">"sex"</span>, <span class="st">"year"</span>)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(required_cols <span class="sc">%in%</span> <span class="fu">names</span>(df)))</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check data types - Adapt: Verify types match your analysis </span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expectations</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>species, <span class="st">"integer"</span>)  <span class="co"># Factor stored as integer</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>bill_length_mm, <span class="st">"double"</span>)  <span class="co"># Continuous measurements</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>flipper_length_mm, <span class="st">"integer"</span>)  <span class="co"># Discrete measurements</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_type</span>(df<span class="sc">$</span>body_mass_g, <span class="st">"integer"</span>)  <span class="co"># Integer measurements</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 3: Categorical Variables Have Expected Levels</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify factor levels for categorical variables used</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="co"># in </span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Missing categories, typos in factor levels, data encoding issues</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Species factor has expected levels"</span>, {</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>  species_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(palmerpenguins<span class="sc">::</span>penguins<span class="sc">$</span>species)</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>  expected_species <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Adelie"</span>, <span class="st">"Chinstrap"</span>, <span class="st">"Gentoo"</span>)  <span class="co"># Adapt: Your </span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>                                                          <span class="co"># expected </span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>                                                          <span class="co"># categories</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sort</span>(species_levels), <span class="fu">sort</span>(expected_species))</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">length</span>(species_levels), <span class="dv">3</span>)  <span class="co"># Adapt: Expected number of </span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>                                           <span class="co"># categories</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For other datasets: Test treatment groups, regions, product types, etc.</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 4: Data Value Ranges are Domain-Reasonable</span></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify numeric values fall within realistic ranges</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a><span class="co"># for </span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a><span class="co"># your domain</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Data entry errors, unit conversion mistakes, outliers from </span></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a><span class="co"># measurement errors</span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Measurement values fall within reasonable biological ranges"</span>, {</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bill length - Adapt: Set realistic bounds for your numeric variables</span></span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>  bill_lengths <span class="ot">&lt;-</span> df<span class="sc">$</span>bill_length_mm[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>bill_length_mm)]</span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(bill_lengths <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> bill_lengths <span class="sc">&lt;=</span> <span class="dv">70</span>))  <span class="co"># Penguin-</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>                                                              <span class="co"># specific </span></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>                                                              <span class="co"># range</span></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Flipper length - Examples for other domains:</span></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>  flipper_lengths <span class="ot">&lt;-</span> df<span class="sc">$</span>flipper_length_mm[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>flipper_length_mm)]</span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(flipper_lengths <span class="sc">&gt;=</span> <span class="dv">150</span> <span class="sc">&amp;</span> flipper_lengths <span class="sc">&lt;=</span> <span class="dv">250</span>))</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Finance: stock prices &gt; 0, percentages 0-100</span></span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Health: age 0-120, BMI 10-80, blood pressure 50-300</span></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Engineering: temperatures -273+°C, pressures &gt; 0</span></span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Body mass</span></span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>  body_masses <span class="ot">&lt;-</span> df<span class="sc">$</span>body_mass_g[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>body_mass_g)]</span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(body_masses <span class="sc">&gt;=</span> <span class="dv">2000</span> <span class="sc">&amp;</span> body_masses <span class="sc">&lt;=</span> <span class="dv">7000</span>))</span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 5: Missing Data Patterns are as Expected</span></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify missingness patterns match your data </span></span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a><span class="co"># collection </span></span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a><span class="co"># expectations</span></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Unexpected data loss, systematic missingness, data pipeline </span></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a><span class="co"># failures</span></span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Missing data follows expected patterns"</span>, {</span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total missing values should be manageable</span></span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a>  total_na <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(df))</span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(total_na, <span class="fu">nrow</span>(df))  <span class="co"># Adapt: Set acceptable threshold for </span></span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># missing </span></span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># data</span></span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Some variables may have expected missingness</span></span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>sex)), <span class="dv">0</span>)  <span class="co"># Sex determination sometimes difficult</span></span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt examples: Optional survey questions, historical data gaps, sensor </span></span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># failures</span></span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Critical variables should be complete</span></span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>species)), <span class="dv">0</span>)  <span class="co"># Primary identifier must be </span></span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a>                                           <span class="co"># complete</span></span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: ID columns, primary keys, required fields should have no NAs</span></span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 6: Expected Statistical Relationships Hold</span></span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Test known relationships between variables in your </span></span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a><span class="co"># domain</span></span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Data corruption, encoding errors, units mix-ups that break known </span></span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a><span class="co"># patterns</span></span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Expected correlations between measurements exist"</span>, {</span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test strong expected relationships</span></span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a>  correlation <span class="ot">&lt;-</span> <span class="fu">cor</span>(df<span class="sc">$</span>flipper_length_mm, df<span class="sc">$</span>body_mass_g, </span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a>                     <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(correlation, <span class="fl">0.8</span>)  <span class="co"># Strong positive correlation expected</span></span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt examples: height vs weight, price vs quality, experience vs salary</span></span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test weaker but expected relationships</span></span>
<span id="cb25-128"><a href="#cb25-128" aria-hidden="true" tabindex="-1"></a>  bill_cor <span class="ot">&lt;-</span> <span class="fu">cor</span>(df<span class="sc">$</span>bill_length_mm, df<span class="sc">$</span>bill_depth_mm, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb25-129"><a href="#cb25-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">abs</span>(bill_cor), <span class="fl">0.1</span>)  <span class="co"># Some relationship should exist</span></span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Education vs income, advertising vs sales, temperature vs </span></span>
<span id="cb25-131"><a href="#cb25-131" aria-hidden="true" tabindex="-1"></a>  <span class="co"># energy use</span></span>
<span id="cb25-132"><a href="#cb25-132" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-133"><a href="#cb25-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 7: Visualization Functions Work Correctly</span></span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Ensure your key plots and visualizations can be </span></span>
<span id="cb25-136"><a href="#cb25-136" aria-hidden="true" tabindex="-1"></a><span class="co"># generated</span></span>
<span id="cb25-137"><a href="#cb25-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Missing aesthetic mappings, incompatible data types, package </span></span>
<span id="cb25-138"><a href="#cb25-138" aria-hidden="true" tabindex="-1"></a><span class="co"># conflicts</span></span>
<span id="cb25-139"><a href="#cb25-139" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Basic plots can be generated without errors"</span>, {</span>
<span id="cb25-140"><a href="#cb25-140" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-141"><a href="#cb25-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test basic plot creation without errors</span></span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_no_error</span>({</span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a>    p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb25-145"><a href="#cb25-145" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-146"><a href="#cb25-146" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>()</span>
<span id="cb25-147"><a href="#cb25-147" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb25-148"><a href="#cb25-148" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Test your key plot types - histograms, boxplots, time series,</span></span>
<span id="cb25-149"><a href="#cb25-149" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb25-150"><a href="#cb25-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-151"><a href="#cb25-151" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that plot object is properly created</span></span>
<span id="cb25-152"><a href="#cb25-152" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb25-153"><a href="#cb25-153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span>
<span id="cb25-154"><a href="#cb25-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_s3_class</span>(p1, <span class="st">"ggplot"</span>)  <span class="co"># Adapt: Check for your plotting </span></span>
<span id="cb25-155"><a href="#cb25-155" aria-hidden="true" tabindex="-1"></a>                                   <span class="co"># framework objects</span></span>
<span id="cb25-156"><a href="#cb25-156" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-157"><a href="#cb25-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-158"><a href="#cb25-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 8: Data Filtering and Subsetting Work Correctly</span></span>
<span id="cb25-159"><a href="#cb25-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify data manipulation operations produce expected</span></span>
<span id="cb25-160"><a href="#cb25-160" aria-hidden="true" tabindex="-1"></a><span class="co"># results</span></span>
<span id="cb25-161"><a href="#cb25-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Logic errors in filtering, unexpected factor behaviors, </span></span>
<span id="cb25-162"><a href="#cb25-162" aria-hidden="true" tabindex="-1"></a><span class="co"># indexing mistakes</span></span>
<span id="cb25-163"><a href="#cb25-163" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Data can be properly filtered and subsetted"</span>, {</span>
<span id="cb25-164"><a href="#cb25-164" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-165"><a href="#cb25-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-166"><a href="#cb25-166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test categorical filtering</span></span>
<span id="cb25-167"><a href="#cb25-167" aria-hidden="true" tabindex="-1"></a>  adelie_penguins <span class="ot">&lt;-</span> df[df<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"Adelie"</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>species), ]</span>
<span id="cb25-168"><a href="#cb25-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(<span class="fu">nrow</span>(adelie_penguins), <span class="dv">100</span>)  <span class="co"># Adapt: Expected subset size</span></span>
<span id="cb25-169"><a href="#cb25-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(adelie_penguins<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"Adelie"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb25-170"><a href="#cb25-170" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Filter by treatment groups, regions, time periods, etc.</span></span>
<span id="cb25-171"><a href="#cb25-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-172"><a href="#cb25-172" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test missing data handling</span></span>
<span id="cb25-173"><a href="#cb25-173" aria-hidden="true" tabindex="-1"></a>  complete_cases <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df), ]</span>
<span id="cb25-174"><a href="#cb25-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(<span class="fu">nrow</span>(complete_cases), <span class="fu">nrow</span>(df))  <span class="co"># Some rows should be removed</span></span>
<span id="cb25-175"><a href="#cb25-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(complete_cases)), <span class="dv">0</span>)  <span class="co"># No NAs remaining</span></span>
<span id="cb25-176"><a href="#cb25-176" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Test your specific data cleaning operations</span></span>
<span id="cb25-177"><a href="#cb25-177" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-178"><a href="#cb25-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-179"><a href="#cb25-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 9: Summary Statistics are Reasonable</span></span>
<span id="cb25-180"><a href="#cb25-180" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Verify computed statistics match domain knowledge </span></span>
<span id="cb25-181"><a href="#cb25-181" aria-hidden="true" tabindex="-1"></a><span class="co"># expectations</span></span>
<span id="cb25-182"><a href="#cb25-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Calculation errors, unit mistakes, algorithm bugs, extreme </span></span>
<span id="cb25-183"><a href="#cb25-183" aria-hidden="true" tabindex="-1"></a><span class="co"># outliers</span></span>
<span id="cb25-184"><a href="#cb25-184" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Summary statistics fall within expected ranges"</span>, {</span>
<span id="cb25-185"><a href="#cb25-185" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-186"><a href="#cb25-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-187"><a href="#cb25-187" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test means fall within expected ranges</span></span>
<span id="cb25-188"><a href="#cb25-188" aria-hidden="true" tabindex="-1"></a>  mean_flipper <span class="ot">&lt;-</span> <span class="fu">mean</span>(df<span class="sc">$</span>flipper_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-189"><a href="#cb25-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(mean_flipper, <span class="dv">190</span>)  <span class="co"># Adapt: Set realistic bounds for your </span></span>
<span id="cb25-190"><a href="#cb25-190" aria-hidden="true" tabindex="-1"></a>                                <span class="co"># variables</span></span>
<span id="cb25-191"><a href="#cb25-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(mean_flipper, <span class="dv">210</span>)</span>
<span id="cb25-192"><a href="#cb25-192" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Examples: Average customer age 20-80, mean salary $30k-200k, etc.</span></span>
<span id="cb25-193"><a href="#cb25-193" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-194"><a href="#cb25-194" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test other central tendencies</span></span>
<span id="cb25-195"><a href="#cb25-195" aria-hidden="true" tabindex="-1"></a>  mean_mass <span class="ot">&lt;-</span> <span class="fu">mean</span>(df<span class="sc">$</span>body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-196"><a href="#cb25-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(mean_mass, <span class="dv">4000</span>)</span>
<span id="cb25-197"><a href="#cb25-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(mean_mass, <span class="dv">5000</span>)</span>
<span id="cb25-198"><a href="#cb25-198" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-199"><a href="#cb25-199" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test variability measures are reasonable</span></span>
<span id="cb25-200"><a href="#cb25-200" aria-hidden="true" tabindex="-1"></a>  sd_flipper <span class="ot">&lt;-</span> <span class="fu">sd</span>(df<span class="sc">$</span>flipper_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-201"><a href="#cb25-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_gt</span>(sd_flipper, <span class="dv">5</span>)   <span class="co"># Not zero variance</span></span>
<span id="cb25-202"><a href="#cb25-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(sd_flipper, <span class="dv">30</span>)  <span class="co"># Not excessive variance</span></span>
<span id="cb25-203"><a href="#cb25-203" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: CV should be &lt;50%, SD should be meaningful relative to mean</span></span>
<span id="cb25-204"><a href="#cb25-204" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-205"><a href="#cb25-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-206"><a href="#cb25-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 10: Complete Analysis Pipeline Integration Test</span></span>
<span id="cb25-207"><a href="#cb25-207" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic application: Test your entire analysis workflow runs without </span></span>
<span id="cb25-208"><a href="#cb25-208" aria-hidden="true" tabindex="-1"></a><span class="co"># errors</span></span>
<span id="cb25-209"><a href="#cb25-209" aria-hidden="true" tabindex="-1"></a><span class="co"># Catches: Pipeline breaks, dependency issues, function interaction problems</span></span>
<span id="cb25-210"><a href="#cb25-210" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Complete analysis pipeline executes successfully"</span>, {</span>
<span id="cb25-211"><a href="#cb25-211" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb25-212"><a href="#cb25-212" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-213"><a href="#cb25-213" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that full workflow executes without errors</span></span>
<span id="cb25-214"><a href="#cb25-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_no_error</span>({</span>
<span id="cb25-215"><a href="#cb25-215" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data preparation step</span></span>
<span id="cb25-216"><a href="#cb25-216" aria-hidden="true" tabindex="-1"></a>    clean_df <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df[<span class="fu">c</span>(<span class="st">"flipper_length_mm"</span>, </span>
<span id="cb25-217"><a href="#cb25-217" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"bill_length_mm"</span>)]), ]</span>
<span id="cb25-218"><a href="#cb25-218" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-219"><a href="#cb25-219" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Statistical analysis step - Adapt: Your key analyses</span></span>
<span id="cb25-220"><a href="#cb25-220" aria-hidden="true" tabindex="-1"></a>    correlation_result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(clean_df<span class="sc">$</span>flipper_length_mm, </span>
<span id="cb25-221"><a href="#cb25-221" aria-hidden="true" tabindex="-1"></a>                                   clean_df<span class="sc">$</span>bill_length_mm)</span>
<span id="cb25-222"><a href="#cb25-222" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-223"><a href="#cb25-223" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization step - Adapt: Your key plots</span></span>
<span id="cb25-224"><a href="#cb25-224" aria-hidden="true" tabindex="-1"></a>    plot_result <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(clean_df, </span>
<span id="cb25-225"><a href="#cb25-225" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb25-226"><a href="#cb25-226" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-227"><a href="#cb25-227" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb25-228"><a href="#cb25-228" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-229"><a href="#cb25-229" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Flipper Length vs. Bill Length"</span>,</span>
<span id="cb25-230"><a href="#cb25-230" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span id="cb25-231"><a href="#cb25-231" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"Bill Length (mm)"</span>)</span>
<span id="cb25-232"><a href="#cb25-232" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb25-233"><a href="#cb25-233" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Add model fitting, prediction, reporting steps as needed</span></span>
<span id="cb25-234"><a href="#cb25-234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-235"><a href="#cb25-235" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify analysis produces meaningful results</span></span>
<span id="cb25-236"><a href="#cb25-236" aria-hidden="true" tabindex="-1"></a>  clean_df <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df[<span class="fu">c</span>(<span class="st">"flipper_length_mm"</span>, </span>
<span id="cb25-237"><a href="#cb25-237" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"bill_length_mm"</span>)]), ]</span>
<span id="cb25-238"><a href="#cb25-238" aria-hidden="true" tabindex="-1"></a>  correlation_result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(clean_df<span class="sc">$</span>flipper_length_mm, </span>
<span id="cb25-239"><a href="#cb25-239" aria-hidden="true" tabindex="-1"></a>                                 clean_df<span class="sc">$</span>bill_length_mm)</span>
<span id="cb25-240"><a href="#cb25-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_lt</span>(correlation_result<span class="sc">$</span>p.value, <span class="fl">0.05</span>)  <span class="co"># Significant result expected</span></span>
<span id="cb25-241"><a href="#cb25-241" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adapt: Check model R², prediction accuracy, convergence, etc.</span></span>
<span id="cb25-242"><a href="#cb25-242" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="running-the-tests" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="running-the-tests"><span class="header-section-number">9.6</span> Running the Tests</h2>
<p>To run all tests in your project:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run all tests</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_dir</span>(<span class="st">"tests/testthat"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run specific test file</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_file</span>(<span class="st">"tests/testthat/test-comprehensive-analysis.R"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Run tests with detailed output</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_dir</span>(<span class="st">"tests/testthat"</span>, <span class="at">reporter =</span> <span class="st">"detailed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="test-categories-explained" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="test-categories-explained"><span class="header-section-number">9.7</span> Test Categories Explained</h2>
<p><strong>Data Validation Tests (1-5)</strong>: Verify data structure, types, ranges, and missing patterns <strong>Statistical Tests (6)</strong>: Confirm expected relationships in the data <strong>Functional Tests (7-8)</strong>: Ensure analysis functions work correctly <strong>Sanity Tests (9)</strong>: Check that summary statistics are reasonable <strong>Integration Tests (10)</strong>: Verify the complete analysis pipeline works end-to-end</p>
<p>These tests provide coverage for a data analysis project and can catch issues ranging from data corruption to environment setup problems.</p>
</section>
</section>
<section id="appendix-c-directory-structure" class="level1 unnumbered">
<h1 class="unnumbered">Appendix C: Directory Structure</h1>
<p>The zzrrtools setup creates the following directory structure:</p>
<pre><code>project/
├── DESCRIPTION              # Package metadata and dependencies
├── LICENSE                  # Project license  
├── README.md               # Project documentation
├── project.Rproj           # R project file
├── renv.lock               # Package dependency lockfile
├── setup_renv.R            # Automated renv setup script
├── Dockerfile              # Container specification
├── docker-compose.yml      # Multi-service Docker setup
├── Makefile                # Build automation (native R + Docker)
├── .Rprofile               # R startup configuration
├── .dockerignore           # Docker build exclusions
├── ZZRRTOOLS_USER_GUIDE.md # Comprehensive user documentation
├── .zshrc_docker           # zsh configuration for Docker container
├── .github/workflows/      # Multiple GitHub Actions workflows
│   ├── docker-ci.yml       # Docker-based CI/CD
│   ├── r-package.yml       # R package checking
│   └── render-paper.yml    # Automated paper rendering
├── check_renv_for_commit.R # renv consistency validation script
├── R/                      # R functions and utilities
│   └── utils.R             # Pre-built utility functions
├── man/                    # Generated function documentation
├── data/                   # Comprehensive data organization
│   ├── raw_data/           # Original, unmodified data
│   ├── derived_data/       # Processed/cleaned data
│   ├── metadata/           # Data documentation
│   ├── validation/         # Data validation scripts
│   └── external_data/      # Third-party datasets
├── analysis/               # Research analysis
│   ├── paper/              # Manuscript with PDF output
│   ├── figures/            # Generated plots and charts
│   ├── tables/             # Generated tables
│   └── templates/          # Document templates and CSL styles
├── scripts/                # Working R scripts and code snippets
├── tests/testthat/         # Unit tests and validation
├── vignettes/              # Package vignettes and tutorials
├── inst/doc/               # Package documentation
├── docs/                   # Additional documentation
├── archive/                # Archived files and old versions
└── [a,n,f,t,s,m,e,o,c]    # Symbolic links for easy navigation</code></pre>
<section id="key-features-explained" class="level2" data-number="9.8">
<h2 data-number="9.8" class="anchored" data-anchor-id="key-features-explained"><span class="header-section-number">9.8</span> Key Features Explained:</h2>
<p><strong>Data Organization:</strong> - <strong>raw_data/</strong>: Original, unmodified datasets as received - <strong>derived_data/</strong>: Processed, cleaned, or transformed data - <strong>metadata/</strong>: Documentation about data sources, collection methods, variables - <strong>validation/</strong>: Scripts that verify data integrity and quality - <strong>external_data/</strong>: Third-party datasets or reference data</p>
<p><strong>Multiple Output Formats:</strong> - <strong>figures/</strong>: Generated plots, charts, and visualizations - <strong>tables/</strong>: Generated summary tables and statistical results - <strong>paper/</strong>: Main manuscript and analysis documents - <strong>templates/</strong>: Document templates and citation style files</p>
<p><strong>R Package Structure:</strong> - <strong>R/</strong>: Custom functions and utilities - <strong>man/</strong>: Generated documentation for R functions - <strong>tests/testthat/</strong>: Unit tests and validation scripts - <strong>vignettes/</strong>: Long-form documentation and tutorials - <strong>DESCRIPTION</strong>: Package metadata and dependency specifications</p>
<p><strong>Docker Orchestration:</strong> - <strong>Dockerfile</strong>: Main container specification - <strong>docker-compose.yml</strong>: Multi-service development environments - <strong>Makefile</strong>: Build automation supporting both native R and Docker workflows</p>
<p><strong>Workflows:</strong> - <strong>.github/workflows/</strong>: GitHub Actions for testing, checking, and rendering - <strong>setup_renv.R</strong>: Package environment setup - <strong>RRTOOLS_USER_GUIDE.md</strong>: Usage documentation</p>
<p><strong>Navigation Shortcuts:</strong> - <strong>Symbolic links</strong>: Single-letter shortcuts for easy navigation - <code>a</code> → analysis/, <code>n</code> → analysis/, <code>f</code> → figures/ - <code>t</code> → tests/, <code>s</code> → scripts/, <code>m</code> → man/ - <code>e</code> → external_data/, <code>o</code> → output/, <code>c</code> → cache/</p>
<p>This structure supports research projects while maintaining clear organization and following established research compendium principles.</p>
</section>
</section>
<section id="appendix-d-docker-workflow-options" class="level1 unnumbered">
<h1 class="unnumbered">Appendix D: Docker Workflow Options</h1>
<p>The zzrrtools setup provides a multi-service Docker architecture optimized for collaborative shell-based development workflows.</p>
<section id="multi-service-docker-architecture" class="level2" data-number="9.9">
<h2 data-number="9.9" class="anchored" data-anchor-id="multi-service-docker-architecture"><span class="header-section-number">9.9</span> Multi-Service Docker Architecture</h2>
<p>zzrrtools creates specialized Docker environments for different development tasks:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the containerized research environment</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive R console (primary development environment)</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-r</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Development shell with personal dotfiles</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-zsh</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive bash session</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-bash</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># RStudio Server (web-based IDE)</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-rstudio    <span class="co"># Access at http://localhost:8787</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Render research paper</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-render</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Run tests</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-test</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Package checking</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co"># renv dependency validation</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check-renv-fix</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="co"># See all available commands</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> help</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Collaborative Benefits:</strong> - <strong>Zero-setup onboarding</strong>: Team members run identical commands - <strong>Consistent environments</strong>: Same container across all developer machines - <strong>ARM64/Apple Silicon support</strong>: Platform-specific flags ensure compatibility - <strong>Shell-optimized workflows</strong>: Command-line development with rich tooling - <strong>Personal customization</strong>: Dotfiles integration for familiar environments - <strong>Web-based development</strong>: Optional RStudio Server for GUI-based workflows</p>
</section>
<section id="option-2-docker-compose-services" class="level2" data-number="9.10">
<h2 data-number="9.10" class="anchored" data-anchor-id="option-2-docker-compose-services"><span class="header-section-number">9.10</span> Option 2: Docker Compose Services</h2>
<p>Docker Compose orchestrates multiple container configurations:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive R session</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> r-session</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Bash shell access</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> bash</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Automated paper rendering</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> research</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Package testing</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> test</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Package checking</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run <span class="at">--rm</span> check</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Docker Compose Configuration Example:</strong></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">r-session</span><span class="kw">:</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .:/home/analyst/project</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./cache:/home/analyst/cache</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">working_dir</span><span class="kw">:</span><span class="at"> /home/analyst/project</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bash</span><span class="kw">:</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .:/home/analyst/project</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">working_dir</span><span class="kw">:</span><span class="at"> /home/analyst/project</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">entrypoint</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"/bin/bash"</span><span class="kw">]</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">research</span><span class="kw">:</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .:/home/analyst/project</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./analysis/figures:/home/analyst/output</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">working_dir</span><span class="kw">:</span><span class="at"> /home/analyst/project</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"R"</span><span class="kw">,</span><span class="at"> </span><span class="st">"-e"</span><span class="kw">,</span><span class="at"> </span><span class="st">"rmarkdown::render('analysis/paper/paper.Rmd')"</span><span class="kw">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Benefits:</strong> - <strong>Service setup</strong>: Multiple predefined container configurations - <strong>Volume management</strong>: Consistent volume mounting across services - <strong>Environment isolation</strong>: Different services for different purposes - <strong>Parallel execution</strong>: Can run multiple services simultaneously</p>
</section>
<section id="option-3-direct-docker-commands" class="level2" data-number="9.11">
<h2 data-number="9.11" class="anchored" data-anchor-id="option-3-direct-docker-commands"><span class="header-section-number">9.11</span> Option 3: Direct Docker Commands</h2>
<p>For maximum control, use Docker commands directly:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic interactive session</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-it</span> <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive session with mounted cache</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-it</span> <span class="dt">\</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/cache:/home/analyst/cache"</span> <span class="dt">\</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Render research paper</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/analysis/figures:/home/analyst/output"</span> <span class="dt">\</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0 <span class="dt">\</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  R <span class="at">-e</span> <span class="st">"rmarkdown::render('analysis/paper/paper.Rmd')"</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Run specific tests</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0 <span class="dt">\</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  R <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test-data-integrity.R')"</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive bash session</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-it</span> <span class="dt">\</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span> <span class="dt">\</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /home/analyst/project <span class="dt">\</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  ghcr.io/username/penguins_analysis:v1.0 <span class="dt">\</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  /bin/bash</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Common Docker Flags Explained:</strong> - <code>--rm</code>: Remove container when it exits - <code>-it</code>: Interactive terminal session - <code>-v</code>: Mount volume (host:container) - <code>-w</code>: Set working directory inside container - <code>--entrypoint</code>: Override default command</p>
<p><strong>Benefits:</strong> - <strong>Full flexibility</strong>: Complete control over container configuration - <strong>Educational</strong>: Shows exactly what’s happening under the hood - <strong>Troubleshooting</strong>: Easier to debug when you see all options - <strong>Portability</strong>: Commands work on any Docker installation</p>
</section>
<section id="volume-mounting-strategies" class="level2" data-number="9.12">
<h2 data-number="9.12" class="anchored" data-anchor-id="volume-mounting-strategies"><span class="header-section-number">9.12</span> Volume Mounting Strategies</h2>
<p><strong>Project Files:</strong></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mount entire project directory</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Output Separation:</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate outputs from source</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/analysis/figures:/home/analyst/output"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Cache Persistence:</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Persistent package cache across sessions</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/cache:/home/analyst/cache"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Read-only Source:</strong></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Protect source files from modification</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="st">"</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">:/home/analyst/project:ro"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="choosing-the-right-approach" class="level2" data-number="9.13">
<h2 data-number="9.13" class="anchored" data-anchor-id="choosing-the-right-approach"><span class="header-section-number">9.13</span> Choosing the Right Approach</h2>
<p><strong>Use Make Commands When:</strong> - You want simplicity and consistency - You’re new to Docker - You’re focusing on analysis rather than infrastructure</p>
<p><strong>Use Docker Compose When:</strong> - You need multiple service configurations - You’re working with a team using standardized environments - You want to define complex volume and networking setups</p>
<p><strong>Use Direct Commands When:</strong> - You need maximum flexibility - You’re troubleshooting container issues - You’re creating custom workflows not covered by Make targets</p>
<p>All three approaches can be used together in the same project, depending on the specific task and user preferences.</p>
</section>
</section>
<section id="appendix-e-github-actions-cicd-setup" class="level1 unnumbered">
<h1 class="unnumbered">Appendix E: GitHub Actions CI/CD Setup</h1>
<p>GitHub Actions provides testing and deployment for research compendia. This appendix covers CI/CD setup for reproducible research workflows.</p>
<section id="understanding-github-actions-for-research" class="level2" data-number="9.14">
<h2 data-number="9.14" class="anchored" data-anchor-id="understanding-github-actions-for-research"><span class="header-section-number">9.14</span> Understanding GitHub Actions for Research</h2>
<p><strong>What is CI/CD for Research?</strong></p>
<p>Continuous Integration/Continuous Deployment (CI/CD) tests your research code whenever changes are made. For research compendia, this means:</p>
<ul>
<li><strong>Testing</strong>: Every push triggers your test suite</li>
<li><strong>Environment consistency</strong>: Tests run in identical Docker environments</li>
<li><strong>Early error detection</strong>: Problems caught during development</li>
<li><strong>Collaboration confidence</strong>: Team members see if changes break functionality</li>
<li><strong>Reproducibility validation</strong>: Ensures analysis works across different systems</li>
</ul>
</section>
<section id="step-by-step-setup" class="level2" data-number="9.15">
<h2 data-number="9.15" class="anchored" data-anchor-id="step-by-step-setup"><span class="header-section-number">9.15</span> Step-by-Step Setup</h2>
<section id="step-1-create-workflow-directory" class="level3" data-number="9.15.1">
<h3 data-number="9.15.1" class="anchored" data-anchor-id="step-1-create-workflow-directory"><span class="header-section-number">9.15.1</span> Step 1: Create Workflow Directory</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the GitHub Actions directory</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> .github/workflows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-2-docker-based-ci-workflow-with-renv-validation" class="level3" data-number="9.15.2">
<h3 data-number="9.15.2" class="anchored" data-anchor-id="step-2-docker-based-ci-workflow-with-renv-validation"><span class="header-section-number">9.15.2</span> Step 2: Docker-based CI Workflow with renv Validation</h3>
<p>Create <code>.github/workflows/docker-ci.yml</code>:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Docker CI with renv Validation</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">build-and-test</span><span class="kw">:</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout repository</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up R for renv validation</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r@v2</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">r-version</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install renv for validation</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>        install.packages("renv")</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">shell</span><span class="kw">:</span><span class="at"> Rscript {0}</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Validate renv consistency before Docker build</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>        # Validate renv environment before building Docker image</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>        Rscript check_renv_for_commit.R --fail-on-issues --quiet</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Extract R version from renv.lock</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">id</span><span class="kw">:</span><span class="at"> r-version</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>        R_VERSION=$(Rscript -e "cat(renv::lockfile_read()\$R\$Version)")</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>        echo "r-version=${R_VERSION}" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build Docker image</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v5</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">push</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> ${{ github.repository }}:latest</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a><span class="fu">        build-args</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>          R_VERSION=${{ steps.r-version.outputs.r-version }}</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">cache-from</span><span class="kw">:</span><span class="at"> type=gha</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">cache-to</span><span class="kw">:</span><span class="at"> type=gha,mode=max</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run tests in container</span></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>        docker run --rm -v $PWD:/home/analyst/project \</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>          ${{ github.repository }}:latest \</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>          R -e "testthat::test_dir('tests/testthat')"</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Render research paper</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>        docker run --rm -v $PWD:/home/analyst/project \</span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>          -v $PWD/analysis/figures:/home/analyst/output \</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>          ${{ github.repository }}:latest \</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>          R -e "rmarkdown::render('analysis/paper/paper.Rmd')"</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Upload rendered paper</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/upload-artifact@v4</span></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">if</span><span class="kw">:</span><span class="at"> success()</span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> research-paper</span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">path</span><span class="kw">:</span><span class="at"> analysis/paper/paper.pdf</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-3-r-package-check-workflow" class="level3" data-number="9.15.3">
<h3 data-number="9.15.3" class="anchored" data-anchor-id="step-3-r-package-check-workflow"><span class="header-section-number">9.15.3</span> Step 3: R Package Check Workflow</h3>
<p>Create <code>.github/workflows/r-package.yml</code>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> R Package Check</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">R-CMD-check</span><span class="kw">:</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ${{ matrix.config.os }}</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ${{ matrix.config.os }} (${{ matrix.config.r }})</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">fail-fast</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="fu">os</span><span class="kw">:</span><span class="at"> ubuntu-latest</span><span class="kw">,</span><span class="at">   </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span><span class="kw">}</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="fu">os</span><span class="kw">:</span><span class="at"> macOS-latest</span><span class="kw">,</span><span class="at">    </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span><span class="kw">}</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="fu">os</span><span class="kw">:</span><span class="at"> windows-latest</span><span class="kw">,</span><span class="at">  </span><span class="fu">r</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span><span class="kw">}</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">GITHUB_PAT</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">R_KEEP_PKG_SOURCE</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-pandoc@v2</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r@v2</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">r-version</span><span class="kw">:</span><span class="at"> ${{ matrix.config.r }}</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">http-user-agent</span><span class="kw">:</span><span class="at"> ${{ matrix.config.http-user-agent }}</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">use-public-rspm</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-renv@v2</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install system dependencies</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> runner.os == 'Linux'</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>          sudo apt-get update</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>          sudo apt-get install -y \</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>            libcurl4-openssl-dev \</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>            libssl-dev \</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>            libxml2-dev</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Validate renv consistency</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>          # Use the renv validation script included in the repository</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>          Rscript check_renv_for_commit.R --fail-on-issues --quiet</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/check-r-package@v2</span></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">upload-snapshots</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4-automated-paper-rendering" class="level3" data-number="9.15.4">
<h3 data-number="9.15.4" class="anchored" data-anchor-id="step-4-automated-paper-rendering"><span class="header-section-number">9.15.4</span> Step 4: Automated Paper Rendering</h3>
<p>Create <code>.github/workflows/render-paper.yml</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Render Research Paper</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span><span class="co">  # Manual trigger</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main</span><span class="kw">,</span><span class="at"> master </span><span class="kw">]</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'analysis/paper/**'</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'analysis/data/**'</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'R/**'</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'data/**'</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">render</span><span class="kw">:</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout repository</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build Docker image</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v5</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">push</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> paper-render:latest</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-from</span><span class="kw">:</span><span class="at"> type=gha</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-to</span><span class="kw">:</span><span class="at"> type=gha,mode=max</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Render paper in container</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>          docker run --rm \</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>            -v $PWD:/home/analyst/project \</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>            -v $PWD/analysis/figures:/home/analyst/output \</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>            paper-render:latest \</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>            R -e "rmarkdown::render('analysis/paper/paper.Rmd')"</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Upload rendered paper</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/upload-artifact@v4</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> research-paper-${{ github.sha }}</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="fu">          path</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>            analysis/paper/paper.pdf</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>            analysis/figures/*.png</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>            analysis/figures/*.jpg</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">retention-days</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-5-container-registry-integration" class="level3" data-number="9.15.5">
<h3 data-number="9.15.5" class="anchored" data-anchor-id="step-5-container-registry-integration"><span class="header-section-number">9.15.5</span> Step 5: Container Registry Integration</h3>
<p>Create <code>.github/workflows/container-publish.yml</code>:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and Push Container</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main </span><span class="kw">]</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> </span><span class="st">'v*'</span><span class="at"> </span><span class="kw">]</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> main </span><span class="kw">]</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">REGISTRY</span><span class="kw">:</span><span class="at"> ghcr.io</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">IMAGE_NAME</span><span class="kw">:</span><span class="at"> ${{ github.repository }}</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">build-and-push</span><span class="kw">:</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> read</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">packages</span><span class="kw">:</span><span class="at"> write</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout repository</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Log in to Container Registry</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name != 'pull_request'</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/login-action@v3</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">registry</span><span class="kw">:</span><span class="at"> ${{ env.REGISTRY }}</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">username</span><span class="kw">:</span><span class="at"> ${{ github.actor }}</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Extract metadata</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> meta</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/metadata-action@v5</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">images</span><span class="kw">:</span><span class="at"> ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a><span class="fu">          tags</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>            type=ref,event=branch</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>            type=ref,event=pr</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>            type=semver,pattern={{version}}</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>            type=semver,pattern={{major}}.{{minor}}</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and push Docker image</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v5</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">platforms</span><span class="kw">:</span><span class="at"> linux/amd64,linux/arm64</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">push</span><span class="kw">:</span><span class="at"> ${{ github.event_name != 'pull_request' }}</span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.tags }}</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">labels</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.labels }}</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-from</span><span class="kw">:</span><span class="at"> type=gha</span></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cache-to</span><span class="kw">:</span><span class="at"> type=gha,mode=max</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="workflow-explanations" class="level2" data-number="9.16">
<h2 data-number="9.16" class="anchored" data-anchor-id="workflow-explanations"><span class="header-section-number">9.16</span> Workflow Explanations</h2>
<section id="docker-ci-workflow-features" class="level3" data-number="9.16.1">
<h3 data-number="9.16.1" class="anchored" data-anchor-id="docker-ci-workflow-features"><span class="header-section-number">9.16.1</span> Docker CI Workflow Features:</h3>
<ul>
<li><strong>Pre-build renv Validation</strong>: Validates package dependency consistency before Docker build (prevents build failures)</li>
<li><strong>Dynamic R Version</strong>: Extracts R version from renv.lock and passes it to Docker build</li>
<li><strong>Build Testing</strong>: Ensures Docker image builds with latest changes using correct R version</li>
<li><strong>Testing</strong>: Runs R package tests and renders paper in container</li>
<li><strong>Artifact Generation</strong>: Saves rendered papers as downloadable artifacts</li>
<li><strong>Caching</strong>: Uses GitHub Actions cache for faster builds</li>
<li><strong>Early Failure</strong>: Stops pipeline if dependency issues are detected</li>
</ul>
</section>
<section id="r-package-check-features" class="level3" data-number="9.16.2">
<h3 data-number="9.16.2" class="anchored" data-anchor-id="r-package-check-features"><span class="header-section-number">9.16.2</span> R Package Check Features:</h3>
<ul>
<li><strong>Multi-platform Testing</strong>: Tests on Ubuntu, macOS, and Windows</li>
<li><strong>R CMD Check</strong>: Package validation</li>
<li><strong>renv Integration</strong>: Restores package environment</li>
<li><strong>renv Consistency Validation</strong>: Verifies dependency synchronization across platforms</li>
<li><strong>System Dependencies</strong>: Installs required system libraries</li>
</ul>
</section>
<section id="paper-rendering-features" class="level3" data-number="9.16.3">
<h3 data-number="9.16.3" class="anchored" data-anchor-id="paper-rendering-features"><span class="header-section-number">9.16.3</span> Paper Rendering Features:</h3>
<ul>
<li><strong>Selective Triggering</strong>: Only runs when relevant files change</li>
<li><strong>Manual Execution</strong>: Can be triggered manually via GitHub interface</li>
<li><strong>Artifact Storage</strong>: Saves PDFs and figures with retention policy</li>
<li><strong>Path-based Triggers</strong>: Responds to changes in analysis files</li>
</ul>
</section>
<section id="container-publishing-features" class="level3" data-number="9.16.4">
<h3 data-number="9.16.4" class="anchored" data-anchor-id="container-publishing-features"><span class="header-section-number">9.16.4</span> Container Publishing Features:</h3>
<ul>
<li><strong>Building</strong>: Builds on pushes and tags</li>
<li><strong>Multi-platform</strong>: Supports AMD64 and ARM64 platforms</li>
<li><strong>Semantic Versioning</strong>: Tagging based on git tags</li>
<li><strong>Security</strong>: Uses built-in GitHub token for authentication</li>
</ul>
</section>
</section>
<section id="authentication-and-permissions" class="level2" data-number="9.17">
<h2 data-number="9.17" class="anchored" data-anchor-id="authentication-and-permissions"><span class="header-section-number">9.17</span> Authentication and Permissions</h2>
<section id="built-in-github_token" class="level3" data-number="9.17.1">
<h3 data-number="9.17.1" class="anchored" data-anchor-id="built-in-github_token"><span class="header-section-number">9.17.1</span> Built-in GITHUB_TOKEN:</h3>
<p>The built-in <code>GITHUB_TOKEN</code> automatically provides: - Read access to repository contents - Write access to GitHub Packages (when permissions are set) - No manual setup required</p>
</section>
<section id="setting-repository-permissions" class="level3" data-number="9.17.2">
<h3 data-number="9.17.2" class="anchored" data-anchor-id="setting-repository-permissions"><span class="header-section-number">9.17.2</span> Setting Repository Permissions:</h3>
<ol type="1">
<li><strong>Repository Settings</strong> → <strong>Actions</strong> → <strong>General</strong></li>
<li><strong>Workflow permissions</strong>: Choose “Read and write permissions”</li>
<li><strong>Allow GitHub Actions to create and approve pull requests</strong>: Enable if needed</li>
</ol>
</section>
<section id="using-personal-access-tokens-advanced" class="level3" data-number="9.17.3">
<h3 data-number="9.17.3" class="anchored" data-anchor-id="using-personal-access-tokens-advanced"><span class="header-section-number">9.17.3</span> Using Personal Access Tokens (Advanced):</h3>
<p>For broader permissions, create repository secrets:</p>
<ol type="1">
<li><strong>Repository Settings</strong> → <strong>Secrets and variables</strong> → <strong>Actions</strong></li>
<li><strong>New repository secret</strong>: Add <code>GHCR_TOKEN</code> with Personal Access Token</li>
<li><strong>Reference in workflow</strong>: <code>password: ${{ secrets.GHCR_TOKEN }}</code></li>
</ol>
</section>
</section>
<section id="integration-with-collaborative-workflow" class="level2" data-number="9.18">
<h2 data-number="9.18" class="anchored" data-anchor-id="integration-with-collaborative-workflow"><span class="header-section-number">9.18</span> Integration with Collaborative Workflow</h2>
<section id="pull-request-integration" class="level3" data-number="9.18.1">
<h3 data-number="9.18.1" class="anchored" data-anchor-id="pull-request-integration"><span class="header-section-number">9.18.1</span> Pull Request Integration:</h3>
<p>When a team member submits a pull request: 1. GitHub automatically triggers CI workflows 2. Tests run in clean environment identical to production 3. Results displayed directly in pull request interface 4. Merge can be blocked if tests fail</p>
</section>
<section id="branch-protection-rules" class="level3" data-number="9.18.2">
<h3 data-number="9.18.2" class="anchored" data-anchor-id="branch-protection-rules"><span class="header-section-number">9.18.2</span> Branch Protection Rules:</h3>
<p>Enable in <strong>Repository Settings</strong> → <strong>Branches</strong>: - <strong>Require status checks</strong>: Force CI to pass before merging - <strong>Require branches to be up to date</strong>: Ensure latest code is tested - <strong>Include administrators</strong>: Apply rules to all users</p>
</section>
</section>
<section id="monitoring-and-troubleshooting" class="level2" data-number="9.19">
<h2 data-number="9.19" class="anchored" data-anchor-id="monitoring-and-troubleshooting"><span class="header-section-number">9.19</span> Monitoring and Troubleshooting</h2>
<section id="viewing-workflow-results" class="level3" data-number="9.19.1">
<h3 data-number="9.19.1" class="anchored" data-anchor-id="viewing-workflow-results"><span class="header-section-number">9.19.1</span> Viewing Workflow Results:</h3>
<ol type="1">
<li><strong>Repository</strong> → <strong>Actions</strong> tab</li>
<li>Click specific workflow run to see details</li>
<li>Expand steps to see detailed logs</li>
<li>Download artifacts (rendered papers, test results)</li>
</ol>
</section>
<section id="common-issues-and-solutions" class="level3" data-number="9.19.2">
<h3 data-number="9.19.2" class="anchored" data-anchor-id="common-issues-and-solutions"><span class="header-section-number">9.19.2</span> Common Issues and Solutions:</h3>
<p><strong>Docker Build Failures:</strong> - Check Dockerfile syntax - Verify all COPY paths exist - Ensure base image is accessible</p>
<p><strong>renv Restore Failures:</strong> - Verify renv.lock is committed - Check for platform-specific packages - Consider using RSPM for faster installs</p>
<p><strong>Permission Errors:</strong> - Verify GITHUB_TOKEN permissions - Check repository secrets configuration - Ensure workflows have necessary permissions</p>
</section>
<section id="performance-optimization" class="level3" data-number="9.19.3">
<h3 data-number="9.19.3" class="anchored" data-anchor-id="performance-optimization"><span class="header-section-number">9.19.3</span> Performance Optimization:</h3>
<p><strong>Caching Strategies:</strong> - Docker layer caching with <code>cache-from/cache-to</code> - renv package caching with <code>r-lib/actions/setup-renv</code> - Artifact caching for large datasets</p>
<p><strong>Parallel Execution:</strong> - Run tests and documentation in parallel jobs - Use matrix strategies for multi-platform testing - Conditional execution based on changed files</p>
<p>This CI/CD setup ensures that research compendia remain reproducible, tested, and deployment-ready throughout the development lifecycle.</p>
</section>
</section>
</section>
<section id="appendix-f-docker-configuration-examples" class="level1 unnumbered">
<h1 class="unnumbered">Appendix F: Docker Configuration Examples</h1>
<p>This appendix provides Dockerfile examples ranging from minimal configurations to full development environments.</p>
<section id="production-dockerfile" class="level2" data-number="9.20">
<h2 data-number="9.20" class="anchored" data-anchor-id="production-dockerfile"><span class="header-section-number">9.20</span> Production Dockerfile</h2>
<p>The following Dockerfile provides a development environment with zsh, vim plugins, dotfiles integration, and development tools:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use R version from renv.lock for perfect consistency</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> R_VERSION=4.3.0</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> rocker/r-ver:${R_VERSION}</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install system dependencies including zsh and development tools</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="dt">\</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    libxml2-dev <span class="dt">\</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    libcurl4-openssl-dev <span class="dt">\</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    libssl-dev <span class="dt">\</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    libgit2-dev <span class="dt">\</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    libfontconfig1-dev <span class="dt">\</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    libcairo2-dev <span class="dt">\</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    libxt-dev <span class="dt">\</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    pandoc <span class="dt">\</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    zsh <span class="dt">\</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    curl <span class="dt">\</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    git <span class="dt">\</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    fonts-dejavu <span class="dt">\</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> <span class="at">-rf</span> /var/lib/apt/lists/<span class="pp">*</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create non-root user with zsh as default shell</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> USERNAME=analyst</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">useradd</span> <span class="at">--create-home</span> <span class="at">--shell</span> /bin/zsh <span class="va">${USERNAME}</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /home/${USERNAME}/project</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy project files first (for better Docker layer caching)</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> DESCRIPTION .</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> renv.lock* ./</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> .Rprofile* ./</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> renv/activate.R* renv/activate.R</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure renv library path</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> RENV_PATHS_LIBRARY renv/library</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Switch to non-root user for R package installation</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="kw">USER</span> ${USERNAME}</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Install renv and essential R packages</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"install.packages(c('renv', 'remotes', 'devtools', 'knitr', </span><span class="dt">\</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="st">    'rmarkdown'), repos = c(CRAN = 'https://cloud.r-project.org'))"</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Restore R packages from lockfile (if exists)</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"if (file.exists('renv.lock')) renv::restore() else </span><span class="dt">\</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="st">    cat('No renv.lock found, skipping restore</span><span class="dt">\\</span><span class="st">n')"</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy dotfiles for development environment</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Ensure .vimrc and .zshrc_docker exist in build context or create </span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="co"># defaults</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> .vimrc /home/${USERNAME}/.vimrc</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> .zshrc_docker /home/${USERNAME}/.zshrc</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Install zsh plugins for shell experience</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> /home/<span class="va">${USERNAME}</span>/.zsh <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">git</span> clone https://github.com/zsh-users/zsh-autosuggestions <span class="dt">\</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>        /home/<span class="va">${USERNAME}</span>/.zsh/zsh-autosuggestions <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">chown</span> <span class="at">-R</span> <span class="va">${USERNAME}</span>:<span class="va">${USERNAME}</span> /home/<span class="va">${USERNAME}</span>/.zsh</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Install vim-plug and configure vim environment</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> /home/<span class="va">${USERNAME}</span>/.vim/autoload <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>    <span class="ex">curl</span> <span class="at">-fLo</span> /home/<span class="va">${USERNAME}</span>/.vim/autoload/plug.vim <span class="dt">\</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">chown</span> <span class="at">-R</span> <span class="va">${USERNAME}</span>:<span class="va">${USERNAME}</span> /home/<span class="va">${USERNAME}</span>/.vim</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Install vim plugins (suppress interactive mode)</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">vim</span> +PlugInstall +qall <span class="kw">||</span> <span class="fu">true</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy rest of project</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=${USERNAME}:${USERNAME}</span> . .</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Install the research compendium as a package</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::install('.', dependencies = TRUE)"</span></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Set default shell to zsh for development experience</span></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /home/${USERNAME}/project</span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"/bin/zsh"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="features-of-the-production-dockerfile" class="level2" data-number="9.21">
<h2 data-number="9.21" class="anchored" data-anchor-id="features-of-the-production-dockerfile"><span class="header-section-number">9.21</span> Features of the Production Dockerfile</h2>
<p>This production-ready Dockerfile provides:</p>
<ul>
<li><strong>R version consistency</strong>: Matches exact R version specified in renv.lock for perfect environment alignment</li>
<li><strong>Minimal base</strong>: rocker/r-ver provides clean R installation without unnecessary packages</li>
<li><strong>Shell environment</strong>: zsh with autosuggestions and professional prompt for improved productivity</li>
<li><strong>Editor environment</strong>: vim with plugins configured automatically during build</li>
<li><strong>Dotfiles integration</strong>: Personal development preferences (.vimrc, .zshrc) copied from host system</li>
<li><strong>Development tools</strong>: git, curl, pandoc, and essential development libraries pre-installed</li>
<li><strong>Security</strong>: Non-root user execution with proper file permissions</li>
<li><strong>renv integration</strong>: Automatic package restoration with proper library path configuration</li>
<li><strong>Container-optimized workflow</strong>: Optimized layer caching and build process for efficient rebuilds</li>
</ul>
</section>
<section id="r-version-extraction" class="level2" data-number="9.22">
<h2 data-number="9.22" class="anchored" data-anchor-id="r-version-extraction"><span class="header-section-number">9.22</span> R Version Extraction</h2>
<p>The Dockerfile uses a build argument to ensure the R version exactly matches what’s specified in <code>renv.lock</code>. The build command extracts the R version directly from the renv lockfile:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract R version from renv.lock</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="va">R_VERSION</span><span class="op">=</span><span class="va">$(</span><span class="ex">jq</span> <span class="at">-r</span> <span class="st">'.R.Version'</span> renv.lock<span class="va">)</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Build Docker image with extracted R version</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">--build-arg</span> R_VERSION=<span class="va">${R_VERSION}</span> <span class="dt">\</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-t</span> ghcr.io/username/penguins_analysis:v1.0 .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If the <code>renv.lock</code> file specifies R 4.3.1, the Docker image will use <code>rocker/r-ver:4.3.1</code>. If renv is updated to R 4.4.0, the Docker build will use <code>rocker/r-ver:4.4.0</code>. This maintains consistency between the package environment and system environment.</p>
</section>
</section>
<section id="appendix-g-renv-management-and-validation" class="level1 unnumbered">
<h1 class="unnumbered">Appendix G: renv Management and Validation</h1>
<p>This appendix provides details for the renv consistency checking script and dependency management workflows.</p>
<section id="renv-consistency-checker-features" class="level2" data-number="9.23">
<h2 data-number="9.23" class="anchored" data-anchor-id="renv-consistency-checker-features"><span class="header-section-number">9.23</span> renv Consistency Checker Features</h2>
<p>The <code>check_renv_for_commit.R</code> script provides advanced team collaboration features through dependency validation:</p>
<ul>
<li><strong>Team conflict prevention</strong>: Pre-commit validation stops dependency inconsistencies before they reach the repository</li>
<li><strong>Automated dependency discovery</strong>: Scans R/, scripts/, and analysis/ directories for <code>library()</code>, <code>require()</code>, and <code>pkg::</code> calls</li>
<li><strong>Multi-source synchronization</strong>: Ensures packages are consistent across code files, DESCRIPTION, and renv.lock</li>
<li><strong>CRAN validation</strong>: Verifies packages exist and are properly named before team integration</li>
<li><strong>Automatic fixing</strong>: Updates DESCRIPTION and regenerates renv.lock to maintain team synchronization</li>
<li><strong>CI/CD fail-fast</strong>: Provides proper exit codes for automated workflows</li>
<li><strong>Interactive collaboration mode</strong>: Guides developers through dependency resolution during development</li>
</ul>
</section>
<section id="team-collaboration-commands" class="level2" data-number="9.24">
<h2 data-number="9.24" class="anchored" data-anchor-id="team-collaboration-commands"><span class="header-section-number">9.24</span> Team Collaboration Commands</h2>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Team development workflow (via Make)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv          <span class="co"># Interactive dependency checking</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-fix      <span class="co"># Auto-fix dependency issues</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> check-renv-ci       <span class="co"># CI/CD validation with fail-fast</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Docker-based validation (no local R required)</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-check-renv-fix  <span class="co"># Fix dependencies in container</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Direct script usage</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fix</span> <span class="at">--fail-on-issues</span>  <span class="co"># CI mode</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--quiet</span>                 <span class="co"># Minimal output</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--help</span>                  <span class="co"># Usage info</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="multi-developer-workflow" class="level2" data-number="9.25">
<h2 data-number="9.25" class="anchored" data-anchor-id="multi-developer-workflow"><span class="header-section-number">9.25</span> Multi-Developer Workflow</h2>
<ol type="1">
<li><strong>Install packages in container</strong>: Use <code>install.packages()</code> or <code>renv::install()</code> within Docker environment</li>
<li><strong>Validate team dependencies</strong>: Run <code>make check-renv</code> to check for conflicts before committing</li>
<li><strong>Review team impacts</strong>: Script identifies packages that would affect other team members</li>
<li><strong>Synchronize team environment</strong>: Use <code>make check-renv-fix</code> to update shared dependency files</li>
<li><strong>Commit with team confidence</strong>: Other developers can reproduce your exact environment</li>
</ol>
</section>
<section id="integration-with-development-workflows" class="level2" data-number="9.26">
<h2 data-number="9.26" class="anchored" data-anchor-id="integration-with-development-workflows"><span class="header-section-number">9.26</span> Integration with Development Workflows</h2>
<section id="pre-commit-hooks" class="level3" data-number="9.26.1">
<h3 data-number="9.26.1" class="anchored" data-anchor-id="pre-commit-hooks"><span class="header-section-number">9.26.1</span> Pre-commit Hooks</h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to .git/hooks/pre-commit</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> check_renv_for_commit.R <span class="at">--fail-on-issues</span> <span class="at">--quiet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="makefile-integration" class="level3" data-number="9.26.2">
<h3 data-number="9.26.2" class="anchored" data-anchor-id="makefile-integration"><span class="header-section-number">9.26.2</span> Makefile Integration</h3>
<div class="sourceCode" id="cb45"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="dv">check-renv:</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>Rscript check_renv_for_commit.R</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="dv">check-renv-fix:</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>Rscript check_renv_for_commit.R --fix</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="dv">check-renv-ci:</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>Rscript check_renv_for_commit.R --quiet --fail-on-issues</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cicd-integration" class="level3" data-number="9.26.3">
<h3 data-number="9.26.3" class="anchored" data-anchor-id="cicd-integration"><span class="header-section-number">9.26.3</span> CI/CD Integration</h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Validate renv consistency</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">run</span><span class="kw">:</span><span class="at"> Rscript check_renv_for_commit.R --fail-on-issues --quiet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This approach ensures that collaborators can reliably reproduce your package environment and that CI/CD pipelines have all necessary dependency information.</p>


</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{(ryy)_glenn_thomas2025,
  author = {(Ryy) Glenn Thomas, Ronald and Thomas, R.G.},
  title = {Research {Compendia} for {Full} {Reproducibility} in {R:} {A}
    Zzrrtools, Renv, and {Docker} {Strategy}},
  date = {2025-07-01},
  url = {https://focusonr.org/posts/share_R_code_via_docker_p25/},
  langid = {en},
  abstract = {This white paper presents an approach to achieving
    reproducibility in R workflows by combining three tools: zzrrtools
    for creating structured research compendia, renv for R package
    management, and Docker for containerizing the computing environment.
    The zzrrtools framework provides a standardized research compendium
    structure, renv manages package dependencies, and Docker ensures
    consistent execution environments. Together, these tools create
    self-contained research compendia that run identically across
    different systems. The paper includes a practical case study
    demonstrating multi-developer collaborative workflows with clear
    governance roles, where a project maintainer manages the technical
    infrastructure while multiple contributors extend the research
    analysis.}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-(ryy)_glenn_thomas2025" class="csl-entry quarto-appendix-citeas" role="listitem">
(Ryy) Glenn Thomas, Ronald, and R.G. Thomas. 2025. <span>“Research
Compendia for Full Reproducibility in R: A Zzrrtools, Renv, and Docker
Strategy.”</span> July 1, 2025. <a href="https://focusonr.org/posts/share_R_code_via_docker_p25/">https://focusonr.org/posts/share_R_code_via_docker_p25/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/focusonr\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="rgt47/qblog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2023-2025, Ronald G. Thomas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<!-- PDF view/download button for blog posts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Only add the button on post pages
  if (window.location.pathname.includes('/posts/') && !window.location.pathname.endsWith('/posts/') && !window.location.pathname.endsWith('/posts/index.html')) {
    var currentPath = window.location.pathname;
    var pdfPath = currentPath.replace('.html', '.pdf');

    // Check if PDF exists first
    fetch(pdfPath, { method: 'HEAD' })
      .then(function(response) {
        if (response.ok) {
          // PDF exists, show download button
          showDownloadButton(pdfPath);
        } else {
          // PDF doesn't exist, show link to generate
          showGenerateButton(currentPath);
        }
      })
      .catch(function() {
        // Error checking PDF, show generate button
        showGenerateButton(currentPath);
      });
  }
});

function showDownloadButton(pdfPath) {
  var downloadBtn = document.createElement('div');
  downloadBtn.className = 'pdf-download-button';

  // Get file size if possible
  fetch(pdfPath, { method: 'HEAD' })
    .then(function(response) {
      var size = response.headers.get('Content-Length');
      var sizeText = '';

      if (size) {
        // Convert to MB or KB
        var sizeInMB = size / (1024 * 1024);
        if (sizeInMB >= 1) {
          sizeText = ' (' + sizeInMB.toFixed(1) + ' MB)';
        } else {
          sizeText = ' (' + (size / 1024).toFixed(0) + ' KB)';
        }
      }

      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' + sizeText +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    })
    .catch(function() {
      // Basic fallback if we can't get file size
      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    });

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(downloadBtn);
  }
}

function showGenerateButton(htmlPath) {
  var qmdPath = htmlPath.replace('/posts/', 'posts/').replace('index.html', 'index.qmd');

  var generateBtn = document.createElement('div');
  generateBtn.className = 'pdf-download-button';
  generateBtn.innerHTML =
    '<div class="alert alert-secondary d-flex flex-column gap-2 p-3" role="alert">' +
    '  <div><i class="bi bi-file-pdf me-2"></i><strong>PDF version available</strong></div>' +
    '  <div class="small">Generate a PDF version of this article by running this command in the terminal:</div>' +
    '  <pre class="bg-light p-2 rounded mb-0 mt-1"><code>./generate_pdf.sh ' + qmdPath + '</code></pre>' +
    '</div>';

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(generateBtn);
  }
}
</script>

<style>
.pdf-download-button {
  margin-top: 1rem;
  margin-bottom: 1rem;
}
</style>




</body></html>