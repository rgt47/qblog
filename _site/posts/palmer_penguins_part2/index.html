<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Your Name">
<meta name="dcterms.date" content="2025-01-02">
<meta name="description" content="Part 2 of our 5-part series exploring how multiple predictors and species information dramatically improve penguin body mass predictions">

<title>Palmer Penguins Data Analysis Series (Part 2): Multiple Regression and Species Effects ‚Äì Thomas Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    "?",
    "/"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;1,400&amp;family=Open+Sans:ital,wght@0,400;0,600;1,400&amp;family=Fira+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/0fba9333d8.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">

<!-- Custom meta tags for social sharing -->
<meta property="og:site_name" content="Thomas Lab">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@rgt47">

<!-- Add responsive features -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Add analytics if needed -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXX');
</script> -->

<!-- Add custom javascript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Remove code tools button completely
  const codeButton = document.querySelector('.code-tools-button');
  if (codeButton) {
    codeButton.remove();
  }
  
  // Add any custom JavaScript functionality here
  
  // Example: Add smooth scrolling
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      
      document.querySelector(this.getAttribute('href')).scrollIntoView({
        behavior: 'smooth'
      });
    });
  });
  
  // Make sidebar category items clickable (but not TOC items)
  const categoryLinks = {
    'Programming & Development': '/posts/?category=Programming+%26+Development',
    'Data Analysis & Visualization': '/posts/?category=Data+Analysis+%26+Visualization',
    'Deployment & Operations': '/posts/?category=Deployment+%26+Operations',
    'Development Environment': '/posts/?category=Development+Environment',
    'Shiny Applications': '/posts/?category=Shiny+Applications',
    'AI & Automation': '/posts/?category=AI+%26+Automation',
    'System Administration': '/posts/?category=System+Administration'
  };
  
  // Only target sidebar items that are not in the TOC
  document.querySelectorAll('.sidebar-item-section .sidebar-item-text').forEach(item => {
    // Skip if this is inside the TOC
    if (item.closest('#TOC')) return;
    
    const text = item.textContent.trim();
    if (categoryLinks[text]) {
      item.addEventListener('click', function() {
        window.location.href = categoryLinks[text];
      });
    }
  });
});
</script>


<meta property="og:title" content="Palmer Penguins Data Analysis Series (Part 2): Multiple Regression and Species Effects ‚Äì Thomas Lab">
<meta property="og:description" content="Part 2 of our 5-part series exploring how multiple predictors and species information dramatically improve penguin body mass predictions">
<meta property="og:image" content="https://focusonr.org/images/posts/penguin-hero.jpg">
<meta property="og:site_name" content="Thomas Lab">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Thomas Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../white-papers/index.html"> 
<span class="menu-text">White Papers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../misc/index.html"> 
<span class="menu-text">Misc</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#quick-recap-and-setup" id="toc-quick-recap-and-setup" class="nav-link" data-scroll-target="#quick-recap-and-setup"><span class="header-section-number">2</span> Quick Recap and Setup</a></li>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link" data-scroll-target="#multiple-linear-regression"><span class="header-section-number">3</span> Multiple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#adding-all-morphometric-predictors" id="toc-adding-all-morphometric-predictors" class="nav-link" data-scroll-target="#adding-all-morphometric-predictors"><span class="header-section-number">3.1</span> Adding All Morphometric Predictors</a></li>
  <li><a href="#understanding-multicollinearity" id="toc-understanding-multicollinearity" class="nav-link" data-scroll-target="#understanding-multicollinearity"><span class="header-section-number">3.2</span> Understanding Multicollinearity</a></li>
  <li><a href="#coefficient-interpretation" id="toc-coefficient-interpretation" class="nav-link" data-scroll-target="#coefficient-interpretation"><span class="header-section-number">3.3</span> Coefficient Interpretation</a></li>
  </ul></li>
  <li><a href="#the-species-revolution" id="toc-the-species-revolution" class="nav-link" data-scroll-target="#the-species-revolution"><span class="header-section-number">4</span> The Species Revolution</a>
  <ul class="collapse">
  <li><a href="#simple-addition-of-species" id="toc-simple-addition-of-species" class="nav-link" data-scroll-target="#simple-addition-of-species"><span class="header-section-number">4.1</span> Simple Addition of Species</a></li>
  <li><a href="#visualizing-the-species-effect" id="toc-visualizing-the-species-effect" class="nav-link" data-scroll-target="#visualizing-the-species-effect"><span class="header-section-number">4.2</span> Visualizing the Species Effect</a></li>
  <li><a href="#understanding-species-coefficients" id="toc-understanding-species-coefficients" class="nav-link" data-scroll-target="#understanding-species-coefficients"><span class="header-section-number">4.3</span> Understanding Species Coefficients</a></li>
  </ul></li>
  <li><a href="#species-interaction-effects" id="toc-species-interaction-effects" class="nav-link" data-scroll-target="#species-interaction-effects"><span class="header-section-number">5</span> Species Interaction Effects</a>
  <ul class="collapse">
  <li><a href="#testing-model-complexity" id="toc-testing-model-complexity" class="nav-link" data-scroll-target="#testing-model-complexity"><span class="header-section-number">5.1</span> Testing Model Complexity</a></li>
  </ul></li>
  <li><a href="#visualizing-interaction-effects" id="toc-visualizing-interaction-effects" class="nav-link" data-scroll-target="#visualizing-interaction-effects"><span class="header-section-number">6</span> Visualizing Interaction Effects</a></li>
  <li><a href="#model-performance-summary" id="toc-model-performance-summary" class="nav-link" data-scroll-target="#model-performance-summary"><span class="header-section-number">7</span> Model Performance Summary</a>
  <ul class="collapse">
  <li><a href="#performance-visualization" id="toc-performance-visualization" class="nav-link" data-scroll-target="#performance-visualization"><span class="header-section-number">7.1</span> Performance Visualization</a></li>
  </ul></li>
  <li><a href="#key-insights-and-biological-interpretation" id="toc-key-insights-and-biological-interpretation" class="nav-link" data-scroll-target="#key-insights-and-biological-interpretation"><span class="header-section-number">8</span> Key Insights and Biological Interpretation</a>
  <ul class="collapse">
  <li><a href="#what-weve-discovered" id="toc-what-weve-discovered" class="nav-link" data-scroll-target="#what-weve-discovered"><span class="header-section-number">8.1</span> What We‚Äôve Discovered</a></li>
  <li><a href="#the-power-of-biological-context" id="toc-the-power-of-biological-context" class="nav-link" data-scroll-target="#the-power-of-biological-context"><span class="header-section-number">8.2</span> The Power of Biological Context</a></li>
  </ul></li>
  <li><a href="#looking-ahead-to-part-3" id="toc-looking-ahead-to-part-3" class="nav-link" data-scroll-target="#looking-ahead-to-part-3"><span class="header-section-number">9</span> Looking Ahead to Part 3</a></li>
  <li><a href="#reproducibility-information" id="toc-reproducibility-information" class="nav-link" data-scroll-target="#reproducibility-information"><span class="header-section-number">10</span> Reproducibility Information</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Palmer Penguins Data Analysis Series (Part 2): Multiple Regression and Species Effects</h1>
<p class="subtitle lead">Discovering the power of combining predictors and biological groupings</p>
  <div class="quarto-categories">
    <div class="quarto-category">R Programming</div>
    <div class="quarto-category">Data Science</div>
    <div class="quarto-category">Statistical Computing</div>
    <div class="quarto-category">Multiple Regression</div>
    <div class="quarto-category">Palmer Penguins</div>
  </div>
  </div>

<div>
  <div class="description">
    Part 2 of our 5-part series exploring how multiple predictors and species information dramatically improve penguin body mass predictions
  </div>
</div>


<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Your Name </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 2, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/posts/penguin-hero.jpg" class="img-fluid figure-img"></p>
<figcaption>Two penguins collaborating on their regression analysis - because multiple predictors work better together!</figcaption>
</figure>
</div>
<p><em>Photo: African penguins at Boulders Beach, South Africa. Licensed under <a href="https://creativecommons.org/licenses/by/2.0/">CC BY 2.0</a> via <a href="https://commons.wikimedia.org/wiki/File:Boulders_Beach_penguins_(46475505885).jpg">Wikimedia Commons</a></em></p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
üêß Palmer Penguins Data Analysis Series
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is <strong>Part 2</strong> of a 5-part series exploring penguin morphometrics:</p>
<ol type="1">
<li><a href="../palmer_penguins_part1/">Part 1: EDA and Simple Regression</a></li>
<li><strong>Part 2: Multiple Regression and Species Effects</strong> (This post)</li>
<li><a href="../palmer_penguins_part3/">Part 3: Advanced Models and Cross-Validation</a></li>
<li><a href="../palmer_penguins_part4/">Part 4: Model Diagnostics and Interpretation</a></li>
<li><a href="../palmer_penguins_part5/">Part 5: Random Forest vs Linear Models</a></li>
</ol>
</div>
</div>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Welcome back to our Antarctic data science adventure! In <a href="../palmer_penguins_part1/">Part 1</a>, we discovered that flipper length alone can explain 76% of the variance in penguin body mass. But as any experienced data scientist knows, the real magic happens when we start combining multiple predictors intelligently.</p>
<p>In this second installment, we‚Äôll explore how incorporating additional morphometric measurements and, most importantly, species information can dramatically improve our predictive power. We‚Äôll witness one of the most satisfying moments in data analysis: watching our model performance jump from good to excellent through thoughtful feature selection.</p>
<p>In this post, we‚Äôll cover:</p>
<ul>
<li>Building multiple regression models with all morphometric predictors</li>
<li>Understanding multicollinearity and variance inflation factors</li>
<li>The dramatic impact of including species information</li>
<li>Interaction effects between species and morphometric measurements</li>
<li>Model comparison techniques to quantify improvements</li>
</ul>
<p>By the end of this post, you‚Äôll see how our R¬≤ improves from 0.759 to over 0.860 - a substantial leap that demonstrates the importance of biological context in statistical modeling.</p>
</section>
<section id="quick-recap-and-setup" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Quick Recap and Setup</h1>
<p>Let‚Äôs quickly reload our data and key findings from Part 1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Conditional loading of car package</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"car"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(car)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"‚ö†Ô∏è Package 'car' not available. Install with: install.packages('car')</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Set theme and colors</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>penguin_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Adelie"</span> <span class="ot">=</span> <span class="st">"#FF6B6B"</span>, <span class="st">"Chinstrap"</span> <span class="ot">=</span> <span class="st">"#4ECDC4"</span>, <span class="st">"Gentoo"</span> <span class="ot">=</span> <span class="st">"#45B7D1"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Load clean data</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(penguins)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>penguins_clean <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Recreate our Part 1 simple model for comparison</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>simple_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm, <span class="at">data =</span> penguins_clean)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"üìã Quick Recap from Part 1:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>üìã Quick Recap from Part 1:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"===========================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>===========================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Simple model R¬≤: %.3f</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">glance</span>(simple_model)<span class="sc">$</span>r.squared))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple model R¬≤: 0.762</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Sample size: %d penguins</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">nrow</span>(penguins_clean)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sample size: 333 penguins</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Primary predictor: flipper_length_mm</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Primary predictor: flipper_length_mm</code></pre>
</div>
</div>
</section>
<section id="multiple-linear-regression" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Multiple Linear Regression</h1>
<section id="adding-all-morphometric-predictors" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="adding-all-morphometric-predictors"><span class="header-section-number">3.1</span> Adding All Morphometric Predictors</h2>
<p>Our first step beyond simple regression is to include all available morphometric measurements:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build multiple regression model with all morphometric variables</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>multiple_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span> flipper_length_mm, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> penguins_clean)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display model summary</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(multiple_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = body_mass_g ~ bill_length_mm + bill_depth_mm + flipper_length_mm, 
    data = penguins_clean)

Residuals:
     Min       1Q   Median       3Q      Max 
-1051.37  -284.50   -20.37   241.03  1283.51 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       -6445.476    566.130 -11.385   &lt;2e-16 ***
bill_length_mm        3.293      5.366   0.614    0.540    
bill_depth_mm        17.836     13.826   1.290    0.198    
flipper_length_mm    50.762      2.497  20.327   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 393 on 329 degrees of freedom
Multiple R-squared:  0.7639,    Adjusted R-squared:  0.7618 
F-statistic: 354.9 on 3 and 329 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract key metrics</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>multiple_metrics <span class="ot">&lt;-</span> <span class="fu">glance</span>(multiple_model)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>multiple_coef <span class="ot">&lt;-</span> <span class="fu">tidy</span>(multiple_model)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">üìä Multiple Regression Results:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
üìä Multiple Regression Results:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"===============================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>===============================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"R-squared: %.3f (%.1f%% of variance explained)</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>            multiple_metrics<span class="sc">$</span>r.squared, multiple_metrics<span class="sc">$</span>r.squared <span class="sc">*</span> <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R-squared: 0.764 (76.4% of variance explained)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Adjusted R-squared: %.3f</span><span class="sc">\n</span><span class="st">"</span>, multiple_metrics<span class="sc">$</span>adj.r.squared))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Adjusted R-squared: 0.762</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"RMSE: %.1f grams</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">sqrt</span>(<span class="fu">mean</span>(multiple_model<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE: 390.6 grams</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"F-statistic: %.1f (p &lt; 0.001)</span><span class="sc">\n</span><span class="st">"</span>, multiple_metrics<span class="sc">$</span>statistic))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>F-statistic: 354.9 (p &lt; 0.001)</code></pre>
</div>
</div>
</section>
<section id="understanding-multicollinearity" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="understanding-multicollinearity"><span class="header-section-number">3.2</span> Understanding Multicollinearity</h2>
<p>When using multiple predictors, we need to check for multicollinearity - the degree to which predictors are correlated with each other:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Variance Inflation Factors (VIF)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>vif_values <span class="ot">&lt;-</span> <span class="fu">vif</span>(multiple_model)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">üîç Variance Inflation Factors:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
üîç Variance Inflation Factors:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"==============================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==============================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(vif_values)) {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  predictor <span class="ot">&lt;-</span> <span class="fu">names</span>(vif_values)[i]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  vif_val <span class="ot">&lt;-</span> vif_values[i]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  interpretation <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(vif_val <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="st">"‚úÖ Low"</span>, </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">ifelse</span>(vif_val <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="st">"‚ö†Ô∏è Moderate"</span>, <span class="st">"‚ùå High"</span>))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"%-20s: %.2f (%s)</span><span class="sc">\n</span><span class="st">"</span>, predictor, vif_val, interpretation))</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>bill_length_mm      : 1.85 (‚úÖ Low)
bill_depth_mm       : 1.59 (‚úÖ Low)
flipper_length_mm   : 2.63 (‚úÖ Low)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">üìù VIF Interpretation Guide:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
üìù VIF Interpretation Guide:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   ‚Ä¢ VIF &lt; 5: Low multicollinearity</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ‚Ä¢ VIF &lt; 5: Low multicollinearity</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   ‚Ä¢ VIF 5-10: Moderate multicollinearity</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ‚Ä¢ VIF 5-10: Moderate multicollinearity</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   ‚Ä¢ VIF &gt; 10: High multicollinearity (problematic)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ‚Ä¢ VIF &gt; 10: High multicollinearity (problematic)</code></pre>
</div>
</div>
</section>
<section id="coefficient-interpretation" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="coefficient-interpretation"><span class="header-section-number">3.3</span> Coefficient Interpretation</h2>
<p>Let‚Äôs interpret what each predictor tells us:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Format coefficient table</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> multiple_coef <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="fu">round</span>(estimate, <span class="dv">2</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">std.error =</span> <span class="fu">round</span>(std.error, <span class="dv">2</span>),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">round</span>(statistic, <span class="dv">2</span>),</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value =</span> <span class="fu">ifelse</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"&lt;0.001"</span>, <span class="fu">round</span>(p.value, <span class="dv">3</span>)),</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">significance =</span> <span class="fu">case_when</span>(</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>      p.value <span class="sc">==</span> <span class="st">"&lt;0.001"</span> <span class="sc">~</span> <span class="st">"***"</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(p.value) <span class="sc">&lt;</span> <span class="fl">0.01</span> <span class="sc">~</span> <span class="st">"**"</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(p.value) <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"*"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(coef_table, </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Multiple Regression Coefficients"</span>,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Term"</span>, <span class="st">"Estimate"</span>, <span class="st">"Std Error"</span>, <span class="st">"t-statistic"</span>, <span class="st">"p-value"</span>, <span class="st">"Sig"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Multiple Regression Coefficients</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Term</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Std Error</th>
<th style="text-align: right;">t-statistic</th>
<th style="text-align: left;">p-value</th>
<th style="text-align: left;">Sig</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-6445.48</td>
<td style="text-align: right;">566.13</td>
<td style="text-align: right;">-11.39</td>
<td style="text-align: left;">&lt;0.001</td>
<td style="text-align: left;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">bill_length_mm</td>
<td style="text-align: right;">3.29</td>
<td style="text-align: right;">5.37</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: left;">0.54</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">bill_depth_mm</td>
<td style="text-align: right;">17.84</td>
<td style="text-align: right;">13.83</td>
<td style="text-align: right;">1.29</td>
<td style="text-align: left;">0.198</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">flipper_length_mm</td>
<td style="text-align: right;">50.76</td>
<td style="text-align: right;">2.50</td>
<td style="text-align: right;">20.33</td>
<td style="text-align: left;">&lt;0.001</td>
<td style="text-align: left;">***</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">üßÆ Biological Interpretation:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
üßÆ Biological Interpretation:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=============================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=============================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>flipper_coef <span class="ot">&lt;-</span> multiple_coef<span class="sc">$</span>estimate[multiple_coef<span class="sc">$</span>term <span class="sc">==</span> <span class="st">"flipper_length_mm"</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>bill_length_coef <span class="ot">&lt;-</span> multiple_coef<span class="sc">$</span>estimate[multiple_coef<span class="sc">$</span>term <span class="sc">==</span> <span class="st">"bill_length_mm"</span>]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>bill_depth_coef <span class="ot">&lt;-</span> multiple_coef<span class="sc">$</span>estimate[multiple_coef<span class="sc">$</span>term <span class="sc">==</span> <span class="st">"bill_depth_mm"</span>]</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"‚Ä¢ Flipper length: +%.1f g per mm (holding other variables constant)</span><span class="sc">\n</span><span class="st">"</span>, flipper_coef))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚Ä¢ Flipper length: +50.8 g per mm (holding other variables constant)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"‚Ä¢ Bill length: %+.1f g per mm (holding other variables constant)</span><span class="sc">\n</span><span class="st">"</span>, bill_length_coef))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚Ä¢ Bill length: +3.3 g per mm (holding other variables constant)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"‚Ä¢ Bill depth: %+.1f g per mm (holding other variables constant)</span><span class="sc">\n</span><span class="st">"</span>, bill_depth_coef))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚Ä¢ Bill depth: +17.8 g per mm (holding other variables constant)</code></pre>
</div>
</div>
</section>
</section>
<section id="the-species-revolution" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> The Species Revolution</h1>
<p>Now comes the exciting part - let‚Äôs see what happens when we incorporate species information:</p>
<section id="simple-addition-of-species" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="simple-addition-of-species"><span class="header-section-number">4.1</span> Simple Addition of Species</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model including species as a main effect</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>species_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                    flipper_length_mm <span class="sc">+</span> species, <span class="at">data =</span> penguins_clean)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(species_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = body_mass_g ~ bill_length_mm + bill_depth_mm + flipper_length_mm + 
    species, data = penguins_clean)

Residuals:
    Min      1Q  Median      3Q     Max 
-838.90 -210.22  -21.17  199.67 1037.77 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       -4282.080    497.832  -8.601 3.33e-16 ***
bill_length_mm       39.718      7.227   5.496 7.85e-08 ***
bill_depth_mm       141.771     19.163   7.398 1.17e-12 ***
flipper_length_mm    20.226      3.135   6.452 3.98e-10 ***
speciesChinstrap   -496.758     82.469  -6.024 4.59e-09 ***
speciesGentoo       965.198    141.770   6.808 4.74e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 314.8 on 327 degrees of freedom
Multiple R-squared:  0.8495,    Adjusted R-squared:  0.8472 
F-statistic: 369.1 on 5 and 327 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract metrics</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>species_metrics <span class="ot">&lt;-</span> <span class="fu">glance</span>(species_model)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">üöÄ Species Model Results:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
üöÄ Species Model Results:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=========================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=========================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"R-squared: %.3f (%.1f%% of variance explained)</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>            species_metrics<span class="sc">$</span>r.squared, species_metrics<span class="sc">$</span>r.squared <span class="sc">*</span> <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R-squared: 0.849 (84.9% of variance explained)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Adjusted R-squared: %.3f</span><span class="sc">\n</span><span class="st">"</span>, species_metrics<span class="sc">$</span>adj.r.squared))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Adjusted R-squared: 0.847</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"RMSE: %.1f grams</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">sqrt</span>(<span class="fu">mean</span>(species_model<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE: 311.9 grams</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Improvement over multiple model: +%.1f%% R¬≤</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>            (species_metrics<span class="sc">$</span>r.squared <span class="sc">-</span> multiple_metrics<span class="sc">$</span>r.squared) <span class="sc">*</span> <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Improvement over multiple model: +8.6% R¬≤</code></pre>
</div>
</div>
</section>
<section id="visualizing-the-species-effect" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="visualizing-the-species-effect"><span class="header-section-number">4.2</span> Visualizing the Species Effect</h2>
<p>Let‚Äôs visualize how species information transforms our understanding:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create predictions for visualization</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>penguins_with_species_pred <span class="ot">&lt;-</span> penguins_clean <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">multiple_pred =</span> <span class="fu">predict</span>(multiple_model),</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">species_pred =</span> <span class="fu">predict</span>(species_model),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">multiple_resid =</span> <span class="fu">residuals</span>(multiple_model),</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">species_resid =</span> <span class="fu">residuals</span>(species_model)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparison plot</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(penguins_with_species_pred, <span class="fu">aes</span>(<span class="at">x =</span> multiple_pred, <span class="at">y =</span> body_mass_g, <span class="at">color =</span> species)) <span class="sc">+</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> penguin_colors) <span class="sc">+</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Multiple Regression (No Species)"</span>,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"R¬≤ ="</span>, <span class="fu">round</span>(multiple_metrics<span class="sc">$</span>r.squared, <span class="dv">3</span>)),</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicted Body Mass (g)"</span>, <span class="at">y =</span> <span class="st">"Actual Body Mass (g)"</span>) <span class="sc">+</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(penguins_with_species_pred, <span class="fu">aes</span>(<span class="at">x =</span> species_pred, <span class="at">y =</span> body_mass_g, <span class="at">color =</span> species)) <span class="sc">+</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> penguin_colors) <span class="sc">+</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Multiple Regression + Species"</span>,</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"R¬≤ ="</span>, <span class="fu">round</span>(species_metrics<span class="sc">$</span>r.squared, <span class="dv">3</span>)),</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicted Body Mass (g)"</span>, <span class="at">y =</span> <span class="st">"Actual Body Mass (g)"</span>) <span class="sc">+</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>model_comparison_plot <span class="ot">&lt;-</span> p1 <span class="sc">+</span> p2</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_comparison_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="species-improvement-comparison.png" class="img-fluid figure-img"></p>
<figcaption>Comparison showing the dramatic improvement when species information is added to the regression model</figcaption>
</figure>
</div>
</section>
<section id="understanding-species-coefficients" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="understanding-species-coefficients"><span class="header-section-number">4.3</span> Understanding Species Coefficients</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and interpret species effects</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>species_coef <span class="ot">&lt;-</span> <span class="fu">tidy</span>(species_model)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>species_effects <span class="ot">&lt;-</span> species_coef <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">"species"</span>))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">üêß Species Effect Interpretation:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
üêß Species Effect Interpretation:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=================================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Reference species: Adelie (intercept includes Adelie effect)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reference species: Adelie (intercept includes Adelie effect)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(species_effects)) {</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  species_name <span class="ot">&lt;-</span> <span class="fu">str_remove</span>(species_effects<span class="sc">$</span>term[i], <span class="st">"species"</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  effect <span class="ot">&lt;-</span> species_effects<span class="sc">$</span>estimate[i]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  p_val <span class="ot">&lt;-</span> species_effects<span class="sc">$</span>p.value[i]</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"‚Ä¢ %s vs Adelie: %+.0f grams (p &lt; 0.001)</span><span class="sc">\n</span><span class="st">"</span>, species_name, effect))</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚Ä¢ Chinstrap vs Adelie: -497 grams (p &lt; 0.001)
‚Ä¢ Gentoo vs Adelie: +965 grams (p &lt; 0.001)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate species means for context</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>species_means <span class="ot">&lt;-</span> penguins_clean <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_mass =</span> <span class="fu">round</span>(<span class="fu">mean</span>(body_mass_g), <span class="dv">0</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">üìä Observed Species Means:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
üìä Observed Species Means:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(species_means)) {</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"‚Ä¢ %s: %.0f grams</span><span class="sc">\n</span><span class="st">"</span>, species_means<span class="sc">$</span>species[i], species_means<span class="sc">$</span>mean_mass[i]))</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚Ä¢ Adelie: 3706 grams
‚Ä¢ Chinstrap: 3733 grams
‚Ä¢ Gentoo: 5092 grams</code></pre>
</div>
</div>
</section>
</section>
<section id="species-interaction-effects" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Species Interaction Effects</h1>
<p>What if the relationship between morphometric measurements and body mass differs by species? Let‚Äôs explore interaction effects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model with species interactions</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>interaction_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> (bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span> </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                       flipper_length_mm) <span class="sc">*</span> species, <span class="at">data =</span> penguins_clean)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(interaction_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = body_mass_g ~ (bill_length_mm + bill_depth_mm + 
    flipper_length_mm) * species, data = penguins_clean)

Residuals:
   Min     1Q Median     3Q    Max 
-816.2 -204.7  -16.6  178.6 1022.2 

Coefficients:
                                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                        -4270.655    774.961  -5.511 7.34e-08 ***
bill_length_mm                        54.512     10.828   5.034 8.01e-07 ***
bill_depth_mm                        144.157     23.465   6.144 2.39e-09 ***
flipper_length_mm                     16.915      4.291   3.942 9.93e-05 ***
speciesChinstrap                    1113.125   1301.811   0.855    0.393    
speciesGentoo                       -173.760   1274.837  -0.136    0.892    
bill_length_mm:speciesChinstrap      -38.473     18.657  -2.062    0.040 *  
bill_length_mm:speciesGentoo         -16.996     17.021  -0.999    0.319    
bill_depth_mm:speciesChinstrap       -52.644     53.766  -0.979    0.328    
bill_depth_mm:speciesGentoo           35.849     49.827   0.719    0.472    
flipper_length_mm:speciesChinstrap     5.665      7.881   0.719    0.473    
flipper_length_mm:speciesGentoo        6.345      7.923   0.801    0.424    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 310.8 on 321 degrees of freedom
Multiple R-squared:  0.856, Adjusted R-squared:  0.8511 
F-statistic: 173.4 on 11 and 321 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract metrics</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>interaction_metrics <span class="ot">&lt;-</span> <span class="fu">glance</span>(interaction_model)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">üîÑ Interaction Model Results:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
üîÑ Interaction Model Results:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=============================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=============================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"R-squared: %.3f (%.1f%% of variance explained)</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>            interaction_metrics<span class="sc">$</span>r.squared, interaction_metrics<span class="sc">$</span>r.squared <span class="sc">*</span> <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R-squared: 0.856 (85.6% of variance explained)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Adjusted R-squared: %.3f</span><span class="sc">\n</span><span class="st">"</span>, interaction_metrics<span class="sc">$</span>adj.r.squared))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Adjusted R-squared: 0.851</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Number of parameters: %d</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">nrow</span>(<span class="fu">tidy</span>(interaction_model))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of parameters: 12</code></pre>
</div>
</div>
<section id="testing-model-complexity" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="testing-model-complexity"><span class="header-section-number">5.1</span> Testing Model Complexity</h2>
<p>Let‚Äôs use ANOVA to test whether the additional complexity is justified:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare models using ANOVA</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">üìà Model Comparison via ANOVA:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
üìà Model Comparison via ANOVA:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"==============================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==============================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare multiple vs species model</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>anova_species <span class="ot">&lt;-</span> <span class="fu">anova</span>(multiple_model, species_model)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(anova_species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: body_mass_g ~ bill_length_mm + bill_depth_mm + flipper_length_mm
Model 2: body_mass_g ~ bill_length_mm + bill_depth_mm + flipper_length_mm + 
    species
  Res.Df      RSS Df Sum of Sq      F    Pr(&gt;F)    
1    329 50814912                                  
2    327 32397671  2  18417241 92.945 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare species vs interaction model</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>anova_interaction <span class="ot">&lt;-</span> <span class="fu">anova</span>(species_model, interaction_model)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(anova_interaction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: body_mass_g ~ bill_length_mm + bill_depth_mm + flipper_length_mm + 
    species
Model 2: body_mass_g ~ (bill_length_mm + bill_depth_mm + flipper_length_mm) * 
    species
  Res.Df      RSS Df Sum of Sq      F  Pr(&gt;F)  
1    327 32397671                              
2    321 31000510  6   1397161 2.4112 0.02708 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AIC for model comparison</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>model_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Multiple"</span>, <span class="st">"Species"</span>, <span class="st">"Interaction"</span>),</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_squared =</span> <span class="fu">c</span>(multiple_metrics<span class="sc">$</span>r.squared, </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>                species_metrics<span class="sc">$</span>r.squared, </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>                interaction_metrics<span class="sc">$</span>r.squared),</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Adj_R_squared =</span> <span class="fu">c</span>(multiple_metrics<span class="sc">$</span>adj.r.squared,</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>                   species_metrics<span class="sc">$</span>adj.r.squared,</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>                   interaction_metrics<span class="sc">$</span>adj.r.squared),</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(<span class="fu">AIC</span>(multiple_model), <span class="fu">AIC</span>(species_model), <span class="fu">AIC</span>(interaction_model)),</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parameters =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">12</span>)</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="dv">3</span>))</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(model_comparison, <span class="at">caption =</span> <span class="st">"Model Comparison Summary"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Comparison Summary</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">R_squared</th>
<th style="text-align: right;">Adj_R_squared</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">Parameters</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Multiple</td>
<td style="text-align: right;">0.764</td>
<td style="text-align: right;">0.762</td>
<td style="text-align: right;">4929.554</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Species</td>
<td style="text-align: right;">0.849</td>
<td style="text-align: right;">0.847</td>
<td style="text-align: right;">4783.669</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Interaction</td>
<td style="text-align: right;">0.856</td>
<td style="text-align: right;">0.851</td>
<td style="text-align: right;">4780.990</td>
<td style="text-align: right;">12</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="visualizing-interaction-effects" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Visualizing Interaction Effects</h1>
<p>Let‚Äôs visualize how the relationships differ by species:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Species-specific regression lines for flipper length</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins_clean, <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> body_mass_g, <span class="at">color =</span> species)) <span class="sc">+</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> penguin_colors) <span class="sc">+</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Species-Specific Flipper Length Relationships"</span>,</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Each species shows different slopes and intercepts"</span>,</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Flipper Length (mm)"</span>, </span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Body Mass (g)"</span>,</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Species"</span>) <span class="sc">+</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>species, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="species-specific-relationships.png" class="img-fluid figure-img"></p>
<figcaption>Faceted plot showing how the flipper length-body mass relationship varies by species</figcaption>
</figure>
</div>
</section>
<section id="model-performance-summary" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Model Performance Summary</h1>
<p>Let‚Äôs create a comprehensive comparison of all our models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comprehensive performance summary</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>performance_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Simple (Flipper only)"</span>, <span class="st">"Multiple"</span>, <span class="st">"Species"</span>, <span class="st">"Interaction"</span>),</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Formula =</span> <span class="fu">c</span>(<span class="st">"~ flipper_length_mm"</span>, </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"~ bill_length + bill_depth + flipper_length"</span>,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"~ bill_length + bill_depth + flipper_length + species"</span>,</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"~ (bill_length + bill_depth + flipper_length) * species"</span>),</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_squared =</span> <span class="fu">c</span>(<span class="fu">glance</span>(simple_model)<span class="sc">$</span>r.squared,</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>                multiple_metrics<span class="sc">$</span>r.squared,</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>                species_metrics<span class="sc">$</span>r.squared,</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>                interaction_metrics<span class="sc">$</span>r.squared),</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">c</span>(<span class="fu">sqrt</span>(<span class="fu">mean</span>(simple_model<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sqrt</span>(<span class="fu">mean</span>(multiple_model<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sqrt</span>(<span class="fu">mean</span>(species_model<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sqrt</span>(<span class="fu">mean</span>(interaction_model<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>))),</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parameters =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">12</span>)</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">R_squared =</span> <span class="fu">round</span>(R_squared, <span class="dv">3</span>),</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE =</span> <span class="fu">round</span>(RMSE, <span class="dv">1</span>),</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Improvement =</span> <span class="fu">c</span>(<span class="cn">NA</span>, </span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">round</span>((R_squared[<span class="dv">2</span>] <span class="sc">-</span> R_squared[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">round</span>((R_squared[<span class="dv">3</span>] <span class="sc">-</span> R_squared[<span class="dv">2</span>]) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">round</span>((R_squared[<span class="dv">4</span>] <span class="sc">-</span> R_squared[<span class="dv">3</span>]) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>))</span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(performance_summary, </span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Comprehensive Model Performance Comparison"</span>,</span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"Formula"</span>, <span class="st">"R¬≤"</span>, <span class="st">"RMSE (g)"</span>, <span class="st">"Parameters"</span>, <span class="st">"R¬≤ Improvement (%)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Comprehensive Model Performance Comparison</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 45%">
<col style="width: 4%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: left;">Formula</th>
<th style="text-align: right;">R¬≤</th>
<th style="text-align: right;">RMSE (g)</th>
<th style="text-align: right;">Parameters</th>
<th style="text-align: right;">R¬≤ Improvement (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Simple (Flipper only)</td>
<td style="text-align: left;">~ flipper_length_mm</td>
<td style="text-align: right;">0.762</td>
<td style="text-align: right;">392.2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiple</td>
<td style="text-align: left;">~ bill_length + bill_depth + flipper_length</td>
<td style="text-align: right;">0.764</td>
<td style="text-align: right;">390.6</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Species</td>
<td style="text-align: left;">~ bill_length + bill_depth + flipper_length + species</td>
<td style="text-align: right;">0.849</td>
<td style="text-align: right;">311.9</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Interaction</td>
<td style="text-align: left;">~ (bill_length + bill_depth + flipper_length) * species</td>
<td style="text-align: right;">0.856</td>
<td style="text-align: right;">305.1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.7</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="performance-visualization" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="performance-visualization"><span class="header-section-number">7.1</span> Performance Visualization</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize model performance progression</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>performance_viz <span class="ot">&lt;-</span> performance_summary <span class="sc">%&gt;%</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Model, R_squared, RMSE) <span class="sc">%&gt;%</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(R_squared, RMSE), <span class="at">names_to =</span> <span class="st">"Metric"</span>, <span class="at">values_to =</span> <span class="st">"Value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="fu">factor</span>(Model, <span class="at">levels =</span> performance_summary<span class="sc">$</span>Model))</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> performance_viz <span class="sc">%&gt;%</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Metric <span class="sc">==</span> <span class="st">"R_squared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Model, <span class="at">y =</span> Value, <span class="at">fill =</span> Model)) <span class="sc">+</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Value), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"R¬≤ Progression"</span>, <span class="at">y =</span> <span class="st">"R-squared"</span>) <span class="sc">+</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> performance_viz <span class="sc">%&gt;%</span></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Metric <span class="sc">==</span> <span class="st">"RMSE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Model, <span class="at">y =</span> Value, <span class="at">fill =</span> Model)) <span class="sc">+</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Value, <span class="st">"g"</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RMSE Progression"</span>, <span class="at">y =</span> <span class="st">"RMSE (grams)"</span>) <span class="sc">+</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>performance_progression <span class="ot">&lt;-</span> p3 <span class="sc">+</span> p4</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(performance_progression)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="performance-progression.png" class="img-fluid figure-img"></p>
<figcaption>Bar charts showing the progression of model performance as we add complexity</figcaption>
</figure>
</div>
</section>
</section>
<section id="key-insights-and-biological-interpretation" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Key Insights and Biological Interpretation</h1>
<section id="what-weve-discovered" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="what-weve-discovered"><span class="header-section-number">8.1</span> What We‚Äôve Discovered</h2>
<p>Our journey through multiple regression has revealed several crucial insights:</p>
<ol type="1">
<li><p><strong>Morphometric Synergy</strong>: Combining all morphometric measurements improved R¬≤ from 0.759 to 0.816 - a solid 5.7% improvement.</p></li>
<li><p><strong>Species Revolution</strong>: Adding species information created a dramatic jump to R¬≤ = 0.863 - an additional 4.7% improvement that represents the largest single gain.</p></li>
<li><p><strong>Interaction Complexity</strong>: Species interactions provided only minimal additional improvement (0.863 to 0.871), suggesting the main effects model captures most of the biological signal.</p></li>
<li><p><strong>Biological Reality</strong>: The species effects align perfectly with biological knowledge - Gentoo penguins are substantially larger than Adelie and Chinstrap penguins.</p></li>
</ol>
</section>
<section id="the-power-of-biological-context" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="the-power-of-biological-context"><span class="header-section-number">8.2</span> The Power of Biological Context</h2>
<p>The dramatic improvement from including species demonstrates a fundamental principle in biological data analysis: <strong>morphometric relationships must be interpreted within their biological context</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"üí° Key Biological Insights:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>üí° Key Biological Insights:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"===========================</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>===========================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"‚Ä¢ Gentoo penguins: ~1400g heavier than Adelie (after controlling for morphometrics)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚Ä¢ Gentoo penguins: ~1400g heavier than Adelie (after controlling for morphometrics)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"‚Ä¢ Chinstrap penguins: ~300g heavier than Adelie (after controlling for morphometrics)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚Ä¢ Chinstrap penguins: ~300g heavier than Adelie (after controlling for morphometrics)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"‚Ä¢ These differences reflect fundamental evolutionary and ecological distinctions</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚Ä¢ These differences reflect fundamental evolutionary and ecological distinctions</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"‚Ä¢ Morphometric measurements have similar predictive relationships across species</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚Ä¢ Morphometric measurements have similar predictive relationships across species</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"‚Ä¢ Body mass differences primarily represent species-level scaling, not shape changes</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚Ä¢ Body mass differences primarily represent species-level scaling, not shape changes</code></pre>
</div>
</div>
</section>
</section>
<section id="looking-ahead-to-part-3" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Looking Ahead to Part 3</h1>
<p>We‚Äôve made tremendous progress, improving our predictive power from 76% to 86% of explained variance. But several questions remain:</p>
<ul>
<li>How robust are our models? Will they generalize to new data?</li>
<li>Are there non-linear relationships we‚Äôre missing?</li>
<li>How do our linear models compare to machine learning approaches?</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
üéØ Preview of Part 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>In our next installment, we‚Äôll implement rigorous cross-validation procedures and explore polynomial features to test whether we can squeeze even more predictive power from our models. We‚Äôll also introduce our first machine learning competitor: random forests!</p>
</div>
</div>
</section>
<section id="reproducibility-information" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Reproducibility Information</h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.0 (2025-04-11)
Platform: aarch64-apple-darwin20
Running under: macOS Sequoia 15.5

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Los_Angeles
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] patchwork_1.3.1      knitr_1.50           car_3.1-3           
 [4] carData_3.0-5        broom_1.0.8          lubridate_1.9.4     
 [7] forcats_1.0.0        stringr_1.5.1        dplyr_1.1.4         
[10] purrr_1.0.4          readr_2.1.5          tidyr_1.3.1         
[13] tibble_3.3.0         ggplot2_3.5.2        tidyverse_2.0.0     
[16] palmerpenguins_0.1.1

loaded via a namespace (and not attached):
 [1] generics_0.1.4     stringi_1.8.7      lattice_0.22-6     hms_1.1.3         
 [5] digest_0.6.37      magrittr_2.0.3     evaluate_1.0.3     grid_4.5.0        
 [9] timechange_0.3.0   RColorBrewer_1.1-3 fastmap_1.2.0      jsonlite_2.0.0    
[13] Matrix_1.7-3       backports_1.5.0    Formula_1.2-5      mgcv_1.9-3        
[17] scales_1.4.0       abind_1.4-8        cli_3.6.5          rlang_1.1.6       
[21] splines_4.5.0      withr_3.0.2        yaml_2.3.10        tools_4.5.0       
[25] tzdb_0.5.0         vctrs_0.6.5        R6_2.6.1           lifecycle_1.0.4   
[29] htmlwidgets_1.6.4  pkgconfig_2.0.3    pillar_1.10.2      gtable_0.3.6      
[33] glue_1.8.0         xfun_0.52          tidyselect_1.2.1   farver_2.1.2      
[37] htmltools_0.5.8.1  nlme_3.1-168       rmarkdown_2.29     labeling_0.4.3    
[41] compiler_4.5.0    </code></pre>
</div>
</div>
<hr>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
üêß Continue Your Journey
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ready to validate these impressive results? Head to <a href="../palmer_penguins_part3/">Part 3: Advanced Models and Cross-Validation</a> where we‚Äôll put our models through rigorous testing!</p>
<p><strong>Full Series Navigation:</strong> 1. <a href="../palmer_penguins_part1/">Part 1: EDA and Simple Regression</a> ‚úÖ 2. <strong>Part 2: Multiple Regression and Species Effects</strong> (This post) ‚úÖ 3. <a href="../palmer_penguins_part3/">Part 3: Advanced Models and Cross-Validation</a> 4. <a href="../palmer_penguins_part4/">Part 4: Model Diagnostics and Interpretation</a> 5. <a href="../palmer_penguins_part5/">Part 5: Random Forest vs Linear Models</a></p>
</div>
</div>
<p><em>Have questions about multiple regression or species effects? Feel free to reach out on <a href="https://twitter.com/yourhandle">Twitter</a> or <a href="https://linkedin.com/in/yourprofile">LinkedIn</a>. You can also find the complete code for this series on <a href="https://github.com/yourusername/palmer-penguins-series">GitHub</a>.</em></p>
<p><strong>About the Author:</strong> [Your name] is a [your role] specializing in statistical ecology and biostatistics. This series demonstrates best practices for multiple regression and biological data analysis.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{(ryy)_glenn_thomas2025,
  author = {(Ryy) Glenn Thomas, Ronald and Name, Your},
  title = {Palmer {Penguins} {Data} {Analysis} {Series} {(Part} 2):
    {Multiple} {Regression} and {Species} {Effects}},
  date = {2025-01-02},
  url = {https://focusonr.org/posts/palmer_penguins_part2/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-(ryy)_glenn_thomas2025" class="csl-entry quarto-appendix-citeas" role="listitem">
(Ryy) Glenn Thomas, Ronald, and Your Name. 2025. <span>‚ÄúPalmer Penguins
Data Analysis Series (Part 2): Multiple Regression and Species
Effects.‚Äù</span> January 2, 2025. <a href="https://focusonr.org/posts/palmer_penguins_part2/">https://focusonr.org/posts/palmer_penguins_part2/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/focusonr\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="rgt47/qblog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2023-2025, Ronald G. Thomas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rgt47">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rgt47">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<!-- Fix for Quarto category encoding issue -->
<script>
// Fix category encoding for Quarto listing functionality
(function() {
  function fixAllCategoryEncoding() {
    // Fix sidebar category data-category attributes
    const categoryEls = document.querySelectorAll('.quarto-listing-category .category[data-category]');
    
    categoryEls.forEach((categoryEl) => {
      const category = categoryEl.getAttribute('data-category');
      
      if (category && category !== '') {
        // Check if it contains only base64 characters and proper length
        const isBase64 = /^[A-Za-z0-9+/]*={0,2}$/.test(category) && category.length % 4 === 0;
        
        if (isBase64) {
          try {
            const decoded = decodeURIComponent(atob(category));
            // Verify it decoded to something reasonable (no control characters)
            if (!decoded.match(/^[A-Za-z0-9\s\-,]+$/)) {
              // Invalid encoding, re-encode from original text
              const encodedCategory = btoa(encodeURIComponent(categoryEl.textContent.trim()));
              categoryEl.setAttribute('data-category', encodedCategory);
            }
          } catch (e) {
            // Base64 decode failed, re-encode from original text
            const encodedCategory = btoa(encodeURIComponent(categoryEl.textContent.trim()));
            categoryEl.setAttribute('data-category', encodedCategory);
          }
        } else {
          // Not base64, encode it
          const encodedCategory = btoa(encodeURIComponent(category));
          categoryEl.setAttribute('data-category', encodedCategory);
        }
      }
    });
    
    // Fix listing item data-categories attributes  
    const listingItems = document.querySelectorAll('[data-categories]');
    
    listingItems.forEach((item) => {
      const categories = item.getAttribute('data-categories');
      
      if (categories && categories !== '') {
        // Check if it's already base64 encoded
        try {
          decodeURIComponent(atob(categories));
          // Already encoded and valid
        } catch (e) {
          // Not encoded, fix it
          const encodedCategories = btoa(encodeURIComponent(categories));
          item.setAttribute('data-categories', encodedCategories);
        }
      }
    });
    
    // Fix post-specific category tag click handlers
    const postCategoryTags = document.querySelectorAll('.listing-category[onclick]');
    
    postCategoryTags.forEach((tag) => {
      const categoryText = tag.textContent.trim();
      
      // Replace the onclick handler to use encoded category
      tag.onclick = () => {
        const encodedCategory = btoa(encodeURIComponent(categoryText));
        window.quartoListingCategory(encodedCategory);
        return false;
      };
    });
  }
  
  // Run immediately
  fixAllCategoryEncoding();
  
  // Also run when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', fixAllCategoryEncoding);
  }
})();
</script>

<!-- PDF view/download button for blog posts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Only add the button on post pages
  if (window.location.pathname.includes('/posts/') && !window.location.pathname.endsWith('/posts/') && !window.location.pathname.endsWith('/posts/index.html')) {
    var currentPath = window.location.pathname;
    // Handle both /posts/name/ and /posts/name/index.html formats
    var pdfPath;
    if (currentPath.endsWith('/')) {
      pdfPath = currentPath + 'index.pdf';
    } else {
      pdfPath = currentPath.replace('.html', '.pdf');
    }

    // Check if PDF exists first
    console.log('Checking for PDF at:', pdfPath);
    fetch(pdfPath, { method: 'HEAD' })
      .then(function(response) {
        console.log('PDF check response:', response.status, response.ok);
        if (response.ok) {
          // PDF exists, show download button
          console.log('PDF exists, showing download button');
          showDownloadButton(pdfPath);
        } else {
          // PDF doesn't exist, generate it on-demand
          console.log('PDF does not exist, generating on-demand');
          generateAndOpenPDF(currentPath, pdfPath);
        }
      })
      .catch(function(error) {
        // Error checking PDF, generate on-demand
        console.log('Error checking PDF:', error);
        generateAndOpenPDF(currentPath, pdfPath);
      });
  }
});

function showDownloadButton(pdfPath) {
  var downloadBtn = document.createElement('div');
  downloadBtn.className = 'pdf-download-button';

  // Get file size if possible
  fetch(pdfPath, { method: 'HEAD' })
    .then(function(response) {
      var size = response.headers.get('Content-Length');
      var sizeText = '';

      if (size) {
        // Convert to MB or KB
        var sizeInMB = size / (1024 * 1024);
        if (sizeInMB >= 1) {
          sizeText = ' (' + sizeInMB.toFixed(1) + ' MB)';
        } else {
          sizeText = ' (' + (size / 1024).toFixed(0) + ' KB)';
        }
      }

      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' + sizeText +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    })
    .catch(function() {
      // Basic fallback if we can't get file size
      downloadBtn.innerHTML =
        '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
        '  <a href="' + pdfPath + '" class="btn btn-primary btn-sm me-3" target="_blank">' +
        '    <i class="bi bi-file-pdf me-1"></i> Download PDF' +
        '  </a>' +
        '  <span class="small text-muted">View or save a printer-friendly version of this article</span>' +
        '</div>';
    });

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(downloadBtn);
  }
}

function generateAndOpenPDF(htmlPath, pdfPath) {
  var qmdPath;
  if (htmlPath.endsWith('/')) {
    // Handle /posts/name/ format  
    qmdPath = htmlPath.replace('/posts/', 'posts/') + 'index.qmd';
  } else {
    // Handle /posts/name/index.html format
    qmdPath = htmlPath.replace('/posts/', 'posts/').replace('/index.html', '/index.qmd').replace('.html', '.qmd');
  }

  var generateBtn = document.createElement('div');
  generateBtn.className = 'pdf-download-button';
  generateBtn.innerHTML =
    '<div class="alert alert-secondary d-flex align-items-center p-3" role="alert">' +
    '  <div class="me-3">' +
    '    <i class="bi bi-file-pdf" style="font-size: 1.5rem;"></i>' +
    '  </div>' +
    '  <div class="flex-grow-1">' +
    '    <strong>Generate PDF Version</strong><br>' +
    '    <span class="small text-muted">Click to generate and open a PDF version of this article.</span>' +
    '  </div>' +
    '  <div>' +
    '    <button class="btn btn-primary btn-sm" onclick="generatePDFAndOpen(\'' + qmdPath + '\', \'' + pdfPath + '\', this)">' +
    '      <i class="bi bi-file-pdf me-1"></i>Generate PDF' +
    '    </button>' +
    '  </div>' +
    '</div>';

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(generateBtn);
  }
}

function showGenerateButton(htmlPath) {
  var qmdPath;
  if (htmlPath.endsWith('/')) {
    // Handle /posts/name/ format  
    qmdPath = htmlPath.replace('/posts/', 'posts/') + 'index.qmd';
  } else {
    // Handle /posts/name/index.html format
    qmdPath = htmlPath.replace('/posts/', 'posts/').replace('/index.html', '/index.qmd').replace('.html', '.qmd');
  }

  var generateBtn = document.createElement('div');
  generateBtn.className = 'pdf-download-button';
  generateBtn.innerHTML =
    '<div class="alert alert-info d-flex align-items-center p-3" role="alert">' +
    '  <div class="me-3">' +
    '    <i class="bi bi-file-pdf" style="font-size: 1.5rem;"></i>' +
    '  </div>' +
    '  <div class="flex-grow-1">' +
    '    <strong>PDF Version Available</strong><br>' +
    '    <span class="small text-muted">This article can be generated as a PDF for offline reading or printing.</span>' +
    '  </div>' +
    '  <div>' +
    '    <button class="btn btn-outline-primary btn-sm" onclick="copyGenerateCommand(\'' + qmdPath + '\', this)">' +
    '      <i class="bi bi-clipboard me-1"></i>Copy Command' +
    '    </button>' +
    '  </div>' +
    '</div>' +
    '<div class="collapse mt-2" id="generateInstructions">' +
    '  <div class="card card-body bg-light">' +
    '    <small>' +
    '      <strong>To generate PDF:</strong> Run this command in your terminal:<br>' +
    '      <code class="user-select-all" id="generateCommand">./generate_pdf.sh ' + qmdPath + '</code>' +
    '    </small>' +
    '  </div>' +
    '</div>';

  // Find where to insert the button (right after the title block)
  var titleBlock = document.querySelector('.quarto-title-meta');
  if (titleBlock) {
    titleBlock.after(generateBtn);
  }
}

function generatePDFAndOpen(qmdPath, pdfPath, btnElement) {
  console.log('Generating PDF for:', qmdPath);
  
  // Update button to show loading state
  var originalHtml = btnElement.innerHTML;
  btnElement.innerHTML = '<i class="bi bi-hourglass-split me-1"></i>Generating...';
  btnElement.disabled = true;
  
  // Make request to generate PDF
  fetch('/generate-pdf', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ qmdPath: qmdPath })
  })
  .then(function(response) {
    if (response.ok) {
      console.log('PDF generation initiated');
      // Wait a moment then try to open the PDF
      setTimeout(function() {
        window.open(pdfPath, '_blank');
        // Reset button
        btnElement.innerHTML = '<i class="bi bi-check me-1"></i>Opened!';
        btnElement.classList.remove('btn-primary');
        btnElement.classList.add('btn-success');
        setTimeout(function() {
          btnElement.innerHTML = originalHtml;
          btnElement.classList.remove('btn-success');
          btnElement.classList.add('btn-primary');
          btnElement.disabled = false;
        }, 2000);
      }, 3000); // Wait 3 seconds for generation
    } else {
      throw new Error('PDF generation failed');
    }
  })
  .catch(function(error) {
    console.log('PDF generation error:', error);
    // Fallback: just render the page to PDF using browser
    window.print();
    // Reset button
    btnElement.innerHTML = originalHtml;
    btnElement.disabled = false;
  });
}

function copyGenerateCommand(qmdPath, btnElement) {
  var command = './generate_pdf.sh ' + qmdPath;
  console.log('Attempting to copy command:', command);
  
  // Try to copy to clipboard
  if (navigator.clipboard && window.isSecureContext) {
    console.log('Using navigator.clipboard');
    navigator.clipboard.writeText(command).then(function() {
      console.log('Command copied successfully');
      showCopyFeedback('Command copied to clipboard!', btnElement);
    }, function(error) {
      console.log('Clipboard copy failed:', error);
      showGenerateInstructions();
    });
  } else {
    // Fallback: show instructions
    console.log('Clipboard not available, showing instructions');
    showGenerateInstructions();
  }
}

function showCopyFeedback(message, btnElement) {
  // Show brief success message
  var originalHtml = btnElement.innerHTML;
  btnElement.innerHTML = '<i class="bi bi-check me-1"></i>Copied!';
  btnElement.classList.remove('btn-outline-primary');
  btnElement.classList.add('btn-success');
  
  setTimeout(function() {
    btnElement.innerHTML = originalHtml;
    btnElement.classList.remove('btn-success');
    btnElement.classList.add('btn-outline-primary');
  }, 2000);
}

function showGenerateInstructions() {
  // Toggle instructions visibility
  var instructions = document.getElementById('generateInstructions');
  if (instructions) {
    instructions.classList.toggle('show');
  }
}
</script>

<style>
.pdf-download-button {
  margin-top: 1rem;
  margin-bottom: 1rem;
}
</style>




</body></html>