{"title":"Writing a simple R package in S3.","markdown":{"yaml":{"title":" Writing a simple R package in S3. ","description":"Getting started with S3 OO programming in R","categories":["AWS"],"image":"img/oop.png","date":"last-modified"},"headingText":"Introduction","containsRefs":false,"markdown":"\n\n```{r init, include=FALSE}\n\n\n```\n::: column-margin\n![S3 OOP in R](img/oop.png)\n:::\n\n\n\n\nIf you, like me, feel its time to expand your  R programming armamentarium  to\ninclude  S3 methods. This blog may help. Where to start? \n\n\nIn this post we'll walk through an example of a simple \"table 1\" function using\nS3 methods. \n\nWe'll start with the 'raw' data from a sample of the Penguins data set and\nreturn a dataframe with summary measures. \n\n\nLet's begin by reading the relevant chapters in Advanced R (add reference). \n\nAlso useful other references: \n\nIntroduction to Scientific Programming and Simulation using R. Jomes.\nMaillardet, Robinson. \n\n[1608.07161] A Simple Guide to S3 Methods https://arxiv.org/abs/1608.07161\n\nWhy your S3 method isn't working | R-bloggers\n\nDealing with S3 methods in R with a simple example | R-bloggers\n\nVideo on S3 Classes in R by Dr Andrew Robinson | R-bloggers\n\nUnexported S3 Methods and R Packages | R-bloggers\n\nSimple Guide to S3 Methods | R-bloggers\n\nThe S3 OOP system | R-bloggers\n\n\nS3 methods allow coders to write functions that perform differently for\ndifferent classes of objects. \n\nIn our project we want to build a function that creates a row in the 'Table 1'\ntable for each factor in the formula regardless of the mode of the factor. \n\n7/1/23\nNow reading Nick Tierney R journal paper. \n\n\n\n```{r}\nsource(\"~/shr/zz.tools.R\")\nlibrary(pacman)\np_load(tidyverse, dplyr, gapminder, thematic, palmerpenguins, tidyverse, knitr, lubridate, readxl)\nknitr::opts_chunk$set(collapse = T)\nset.seed(101)\ndat <- palmerpenguins::penguins %>% \n  filter(!is.na(sex))  \ndat1  <- slice_sample(dat, n=10) |> \nsel(species, island, bill_length_mm)\n```\n\n```sh\n\ntable1  <- function (df, form, ...) {\nUseMethod(\"table1\")\t\n} \n\nrow_name  <- function (x, nm, ...) {\nUseMethod(\"row_name\")\t\n}\n\nrow_name.character <- function (x, nm, annot=TRUE, annot_cat_text=\"-- no. (%)\", ... ) {\nif (annot) nm = paste(nm, annot_cat_text)\nreturn(c(nm, unique(x)) )\n}\n\nrow_name.numeric <- function (x, nm, ...) {\n\treturn(nm)\n}\nrow_summary  <- function (x) {\nUseMethod(\"row_summary\")\t\n}\nrow_summary.character <- function (x) {\ndf = data.frame(x = x, y = dep)\nt1 = df |> tabyl(x, y) |>     \nadorn_percentages(\"col\") |>    \nadorn_pct_formatting(digits = 0)|>\nadorn_ns(position = \"front\")    |>\nselect(-x)\nt1= as_tibble(t1)\n t2 = table(df$x,df$y) |> as.data.frame.matrix() \nrbind(NA, t1)\n}\n\nrow_summary.numeric <- function (x) {\nsp = split(x, dep) \nnms = names(sp)\nmm = sp |> map_vec(mean) |> round(2)  |> as.character() |> matrix(1)\nss = sp |> map_vec(sd) |> round(2)|> paste0(\"(\",x = _ ,\")\") |>  matrix(1)\nbb = paste(unlist(mm), unlist(ss)) |>    matrix( nrow = nrow(mm)) \ncolnames(bb) = nms\nbb = bb |> as_tibble()\nbb\n}\nrow_pv  <- function (x) {\nUseMethod(\"row_pv\")\t\n}\nrow_pv.character <- function (x) {\n\tdf = data.frame(x = x, y = dep)\ntab =  table(df[,1], df[,2])\npv  <- ifelse((nrow(tab) >=2 & ncol(tab) >=2), \n       stats::fisher.test(tab,simulate.p.value=T)$p.value, NA) \nreturn(c(pv, rep(NA, nrow(tab))))\n}\nrow_pv.numeric <- function (x) {\n\tdf = data.frame(x = x, y = dep)\npv = tidy(anova(lm(x~y, data = df)))$p.value[1]\nreturn(pv)\n}\n\ntable1.data.frame  <- function (df, form, ...) {\nif (!require(\"pacman\")) install.packages(\"pacman\", repo=\"cran.rstudio.com\")\np_load(janitor, broom, tibble, dplyr, purrr) \nvars  <- all.vars(form)\ndep  <<- df[[vars[1]]]\nindep  <- df[vars[-1]] \ncol_left = indep |> \nimap(row_name, ...) |>\nunlist() |> \nenframe(name=NULL)|>\nsetNames(\"variable\")\ncol_right = indep |> \nmap(row_pv) |>\nunlist() |> \nenframe(name=NULL)|> \nsetNames(\"p-value\")\ncol_mid = indep |> \nmap_dfr(row_summary) |>\nidentity()\ncol_mid = bind_rows(col_mid)\nbind_cols(col_left, col_mid, col_right)\n}\n\n\n\n\n```\n\n\n\n\n\n\n\n\n\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"message":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","number-sections":true,"css":["../../styles.css"],"toc":true,"html-math-method":"katex","include-in-header":{"file":"../../header.html"},"output-file":"index.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.313","theme":"tango","license":"CC BY","toc-title":"Table of contents","toc-location":"left","author":[{"name":"Ronald (Ryy) Glenn Thomas","url":"https://rgtlab.org","affiliation":"UCSD","affiliation-url":"https://ucsd.edu","orcid":"0000-0003-1686-4965"}],"citation":true,"comments":{"giscus":{"repo":"rgt47/qblog","repo-id":"R_kgDOH6TO7A","category":"Announcements","category-id":"DIC_kwDOH5G3U84CRUp9","mapping":"pathname","reactions-enabled":true,"loading":"lazy","input-position":"bottom","theme":"light"}},"title":" Writing a simple R package in S3. ","description":"Getting started with S3 OO programming in R","categories":["AWS"],"image":"img/oop.png","date":"last-modified"},"extensions":{"book":{"multiFile":true}}},"pdf":{"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"message":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","number-sections":true,"toc":true,"output-file":"index.pdf"},"language":{},"metadata":{"block-headings":true,"margin-left":"30mm","margin-right":"60mm","license":"CC BY","toc-title":"Table of contents","toc-location":"left","author":[{"name":"Ronald (Ryy) Glenn Thomas","url":"https://rgtlab.org","affiliation":"UCSD","affiliation-url":"https://ucsd.edu","orcid":"0000-0003-1686-4965"}],"citation":true,"comments":{"giscus":{"repo":"rgt47/qblog","repo-id":"R_kgDOH6TO7A","category":"Announcements","category-id":"DIC_kwDOH5G3U84CRUp9","mapping":"pathname","reactions-enabled":true,"loading":"lazy","input-position":"bottom","theme":"light"}},"title":" Writing a simple R package in S3. ","description":"Getting started with S3 OO programming in R","categories":["AWS"],"image":"img/oop.png","date":"last-modified"},"extensions":{"book":{}}}}}