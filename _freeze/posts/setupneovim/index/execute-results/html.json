{
  "hash": "cbbf3bec47725ce2518fecaeec53b95f",
  "result": {
    "markdown": "---\ntitle: \"Setting up a minimal neovim environment for data science code development\"\ndescription: \"This is the first in a series of posts offering suggested strategies for setting up key tools for data science code development\"\nsubtitle: \"A neovim IDE for R, Python, and Julia\"\n#categories: [Neovim]\n#image: \"img/nvimlogo.png\"\neditor: \n  markdown: \n    wrap: 72\n#format:\n#  pdf:\n#    toc: true\ndate: last-modified\n---\n\n\n\n::: column-margin\n![under construction](img/crane.jpg)\n<font size=\"1\"> Photo by\n<a href=\"https://unsplash.com/@nathangwaters?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Nathan\nWaters</a> on\n<a href=\"https://unsplash.com/s/photos/construction?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a>\n</font>\n:::\n\n\n# Introduction\n\nNeovim (a fork of Vim) is a text editor that has several advantages for data\nscience code development. One of the main attractions is that it is open source\nand has a number of useful plugins to facilitate working on R, python, and julia\ncode. Also, its modal, keyboard-centric system allows text and code manipulation\nat potentially far greater speed than conventional, mouse-centric, systems. \n\nIn this post we describe both a minimal, yet functional setup, as well as a more\nextensive setup utilizing several of the newest neovim-only plugins, for neovim to\nallow IDE style code editing and REPL interaction for the three primary data\nscience coding tools: R, Python, and Julia. \n\nOur presentation here is for a Macos environment. Appendix one contains\nrequired adjustments for a ubuntu linux environment.\n\n# Install the latest stable version of neovim.\n\nWith minimal effort we can install both the terminal and GUI versions of neovim. The simplist approach is to use homebrew: \n\n```sh\n> brew install neovim neovim-qt\n```\nSet up convenience aliases in `zsh`. \n\n```sh\n> alias ng = neovim-qt\n> alias nt = neovim\n```\n(mnemonic: the `t` in `nt` is for terminal, the `g` in `ng` is for GUI)\n\n# Configure neovim\n\nThe standard location for `neovim` configuration files on \"unix-like\" systems is\n`~/.config/nvim`.\nThe main config file is either init.vim (VimL) or init.lua (Lua). In this post\nwe'll focus on lua based configuration.\n\nSpecifically, the following code block creates an `nvim` subdirectory under\n`~/.config` and initialize a configuration file `init.lua`.\n\nHere is the file hierarchy we'll construct. In fact all\nthe code could be bundled into the `init.lua` file, but this approach is clearer\nand cleaner. \n\n```sh\n.\n|-- ginit.vim\n|-- init.lua\n|-- lazy-lock.json\n|-- lua\n|   |-- basics.lua\n|   |-- leap-config.lua\n|   |-- nvim-R-config.lua\n|   |-- nvim-cmp-config.lua\n|   |-- nvim-telescope-config.lua\n|   |-- nvim-tree-config.lua\n|   `-- treesitter-config.lua\n|-- my_snippets\n|   |-- all.snippets\n|   |-- giles.tex.snipppets\n|   |-- mail.snippets\n|   |-- r.snippets\n|   |-- rmd.snippets\n|   |-- snippets.snippets\n|   |-- tex.snippets\n|   |-- text.snippets\n|   `-- txt.snippets\n|-- spell\n|   |-- en.utf-8.add\n|   `-- en.utf-8.add.spl\n```\n\nTo install the `lazy` plugin manager\n```sh\ngit clone https://github.com/folke/lazy.nvim.git \\\n   ~/.local/share/nvim/lazy/lazy.nvim\n```\n\n\nAdd the following code to `init.lua` list the plugins needed to be installed\nfrom `github` and \"feed\" them to `Lazy` for installation. \n\nNvim-R, Leap, UltiSnips, and vimtex need additional configuration. The required\ncode is contained in bespoke files under the `lua` directory. \n\n```sh\n\nvim.g.mapleader = \" \"\nvim.g.maplocalleader = \",\"\nvim.opt.rtp:prepend(\"~/.local/share/nvim/lazy/lazy.nvim\")\nrequire('plugins')\n\nlocal lspconfig = require('lspconfig')\nrequire('nvim-cmp-config')\nrequire'lspconfig'.lua_ls.setup{}\nrequire'lspconfig'.r_language_server.setup{}\n\nrequire('basics')\nrequire('nvim-tree-config')\nrequire('nvim-R-config')\nrequire('nvim-telescope-config')\nrequire('leap').add_default_mappings()\nrequire('leap-config')\n\nvim.api.nvim_create_autocmd('LspAttach', {\n  desc = 'LSP actions',\n  callback = function()\n    local bufmap = function(mode, lhs, rhs)\n      local opts = {buffer = true}\n      vim.keymap.set(mode, lhs, rhs, opts)\n    end\n    bufmap('n', 'K', '<cmd>lua vim.lsp.buf.hover()<cr>')\n    bufmap('n', 'gl', '<cmd>lua vim.diagnostic.open_float()<cr>')\n    bufmap('n', '[d', '<cmd>lua vim.diagnostic.goto_prev()<cr>')\n    bufmap('n', ']d', '<cmd>lua vim.diagnostic.goto_next()<cr>')\n  end\n})\n\n```\n\nList of plugins\n\n```sh\nrequire('lazy').setup({\n'folke/tokyonight.nvim',\n'VonHeikemen/lsp-zero.nvim',\n'neovim/nvim-lspconfig',\n'hrsh7th/cmp-calc',\n'f3fora/cmp-spell',\n'onsails/lspkind.nvim',\n'tamago324/cmp-zsh',\n'hrsh7th/cmp-nvim-lsp-signature-help',\n'hrsh7th/cmp-nvim-lsp',\n'hrsh7th/cmp-buffer',\n'hrsh7th/cmp-path',\n'hrsh7th/cmp-cmdline',\n'SirVer/ultisnips',\n'quangnguyen30192/cmp-nvim-ultisnips',\n'honza/vim-snippets',\n'machakann/vim-highlightedyank',\n'jalvesaq/Nvim-R',\n'jalvesaq/cmp-nvim-r',\n'ggandor/leap.nvim',\n'rhysd/clever-f.vim',\n'hrsh7th/nvim-cmp',\n'kylechui/nvim-surround',\n'lervag/vimtex',\n'nvim-tree/nvim-tree.lua',\n'nvim-telescope/telescope.nvim',\n'nvim-treesitter/nvim-treesitter',\n'quarto-dev/quarto-nvim',\n'jmbuhr/otter.nvim',\n'junegunn/vim-peekaboo',\n'preservim/nerdcommenter',\n'nvim-lua/plenary.nvim',\n'nvim-tree/nvim-web-devicons',\n'jalvesaq/vimcmdline',\n'junegunn/fzf',\n'junegunn/goyo.vim',\n'junegunn/limelight.vim',\n'junegunn/vim-easy-align',\n'voldikss/vim-floaterm',\n'uga-rosa/cmp-dictionary',\n'LuaLS/lua-language-server',\n})\n```\n\n# plugin discussions\n\n# cmp config\n```sh\n\nlocal kind_icons = {\n  Class = \"ﴯ\",\n  Color = \"\",\n  Constant = \"\",\n  Constructor = \"\",\n  Enum = \"\",\n  EnumMember = \"\",\n  Event = \"\",\n  Field = \"\",\n  File = \"\",\n  Folder = \"\",\n  Function = \"\",\n  Interface = \"\",\n  Keyword = \"\",\n  Method = \"\",\n  Module = \"\",\n  Operator = \"\",\n  Property = \"ﰠ\",\n  Reference = \"\",\n  Snippet = \"\",\n  Struct = \"\",\n  Text = \"\",\n  TypeParameter = \"\",\n  Unit = \"\",\n  Value = \"\",\n  Variable = \"\",\n}\n\nlocal cmp_ultisnips_mappings = require(\"cmp_nvim_ultisnips.mappings\")\nlocal cmp = require'cmp'\nlocal lspkind = require('lspkind')\n\nlocal mappings = {\n  [\"<Tab>\"] = cmp.mapping(\n    function(fallback)\n      cmp_ultisnips_mappings.compose { \"select_next_item\" }(fallback)\n    end,\n    { \"i\", \"s\", --[[ \"c\" (to enable the mapping in command mode) ]] }\n  ),\n  [\"<S-Tab>\"] = cmp.mapping(\n    function(fallback)\n      cmp_ultisnips_mappings.compose { \"select_prev_item\" }(fallback)\n    end,\n    { \"i\", \"s\", --[[ \"c\" (to enable the mapping in command mode) ]] }\n  ),\n  ['<C-u>'] = cmp.mapping(cmp.mapping.scroll_docs(-4), { 'i', 'c' }),\n  ['<C-d>'] = cmp.mapping(cmp.mapping.scroll_docs(4), { 'i', 'c' }),\n  ['<C-Space>'] = cmp.mapping(cmp.mapping.complete(), { 'i', 'c' }),\n  ['<C-g>'] = cmp.mapping({ i = cmp.mapping.abort(), c = cmp.mapping.close(), }),\n  ['<CR>'] = cmp.mapping.confirm({ select = false }),\n  [\"<C-j>\"] = cmp.mapping(\n    function()\n      cmp_ultisnips_mappings.compose { \"jump_forwards\", \"expand\" }(function ()\n\n      end)\n    end,\n    { \"i\", \"s\", --[[ \"c\" (to enable the mapping in command mode) ]] }\n  ),\n  [\"<C-k>\"] = cmp.mapping(\n    function(fallback)\n      cmp_ultisnips_mappings.jump_backwards(fallback)\n    end,\n    { \"i\", \"s\", --[[ \"c\" (to enable the mapping in command mode) ]] }\n  ),\n}\n\ncmp.setup({\nwindow = {\n    completion = cmp.config.window.bordered(),\n    documentation = cmp.config.window.bordered(),\n  },\nformatting = {\nformat = function(entry, vim_item)\n      -- Kind icons\n      vim_item.kind = string.format(\"%s %s\", kind_icons[vim_item.kind], vim_item.kind) --Concatonate the icons with name of the item-kind\n      vim_item.menu = ({\n        nvim_lsp = \"[LSP]\",\n        spell = \"[Spellings]\",\n        zsh = \"[Zsh]\",\n        buffer = \"[Buffer]\",\n        ultisnips = \"[Snip]\",\n        treesitter = \"[Treesitter]\",\n        calc = \"[Calculator]\",\n        cmp_nvim_r = \"[R]\",\n        nvim_lua = \"[Lua]\",\n        path = \"[Path]\",\n        nvim_lsp_signature_help = \"[Signature]\",\n        cmdline = \"[Vim Command]\"\n      })[entry.source.name]\n      return vim_item\n    end,\n    },\n-- completion = {\n  --   completeopt = 'menu,menuone,noinsert'\n  -- },\n  snippet = {\n    expand = function(args)\n      vim.fn[\"UltiSnips#Anon\"](args.body) \n    end,\n  },\n\nsources = cmp.config.sources({\n    { name = \"nvim_lsp\" },\n    { name = 'cmp_nvim_r' },\n    { name = 'nvim_lua' },\n    { name = \"ultisnips\" },\n    { name = \"dictionary\", keyword_length=4, },\n    { name = \"buffer\", option = { get_bufnrs = function()\n      return vim.api.nvim_list_bufs()\n    end\n    }},\n    { name = \"path\" },\n    { name = \"calc\" }\n  }),\n  mapping = mappings,\n})\n\n  -- Set up lspconfig.\n  --local capabilities = require('cmp_nvim_lsp').default_capabilities()\n  require('lspconfig')['r_language_server'].setup {\n    capabilities = capabilities\n  }\n\nrequire'cmp_nvim_r'.setup({\n  filetypes = {'r', 'rmd', 'quarto'},\n  doc_width = 58\n  })\n```\n\n\n# basics\n```sh\n\nlocal map = vim.keymap.set\nlocal opts = {noremap = true}\nvim.cmd([[\n\"    copy clipboard to register x for safe keeping\nnnoremap <leader>x :let @x=@*\n\"    paste registers into terminal\ntnoremap <expr> <C-R> '<C-\\><C-N>\"'.nr2char(getchar()).'pi'\nset background=dark\ncolorscheme evening\nlet $FZF_DEFAULT_COMMAND = 'rg --files --hidden'\nset completeopt=menu,menuone,noinsert,noselect\nset number relativenumber\nset textwidth=80\nset cursorline\nset clipboard=unnamed\nset iskeyword-=_ \nset hlsearch   \nset splitright\nset hidden   \nset incsearch    \nset noswapfile\nset showmatch\nset ignorecase\nset smartcase\nset gdefault\nfiletype plugin on\nset encoding=utf-8\nset nobackup\nset nowritebackup\nset updatetime=300\nset signcolumn=yes\nset colorcolumn=80\nautocmd! User GoyoEnter Limelight\nautocmd! User GoyoLeave Limelight!\n\nset dictionary+=/usr/share/dict/words\nset thesaurus+=/Users/zenn/mthesaur.txt\n\nlet g:UltiSnipsSnippetDirectories=[\"UltiSnips\", \"my_snippets\"]\nlet g:UltiSnipsEditSplit=\"vertical\"\nlet g:UltiSnipsUsePythonVersion = 3\n\nautocmd FileType julia,python nnoremap <buffer> <C-CR>  :call VimCmdLineStartApp()<CR>\nautocmd FileType julia,python nnoremap <buffer> <CR>  :call VimCmdLineSendLine()<CR>\n]])\n\nmap('n', ':', ';', opts)\nmap('n', ';', ':', opts)\nmap('n', '<leader>u',':UltiSnipsEdit<cr>', opts)\nmap('n', '<Space><Space>','<C-d>', opts)\nmap('n', '-','$', opts)\nmap('n', '<leader>w','vipgq', opts)\nmap('n', '<leader>v',':edit ~/.config/nvim/init.lua<cr>', opts)\nmap('n', '<leader>n',':edit ~/.config/nvim/lua/basics.lua<cr>', opts)\nmap('n', '<leader>a','ggVG', opts)\nmap('n', '<leader>t',':tab split<cr>', opts)\nmap('n', '<leader>y',':vert sb3<cr>', opts)\nmap('n', '<leader>0',':ls!<CR>:b<Space>', opts)\nmap('n', '<localleader><localleader>','<C-w>w', opts)\nmap('n', '<leader>1','<C-w>:b1<cr>', opts)\nmap('n', '<leader>2','<C-w>:b2<cr>', opts)\nmap('n', '<leader>3','<C-w>:b3<cr>', opts)\nmap('n', '<leader>4','<C-w>:b4<cr>', opts)\nmap('n', '<leader>5','<C-w>:b5<cr>', opts)\nmap('n', '<leader>6','<C-w>:b6<cr>', opts)\nmap('n', '<leader>7','<C-w>:b7<cr>', opts)\nmap('n', '<leader>8','<C-w>:b8<cr>', opts)\nmap('n', '<leader>9','<C-w>:b9<cr>', opts)\nmap('t',  'ZZ', \"q('yes')<CR>\", opts)\nmap('t',  'ZQ', \"q('no')<CR>\", opts)\nmap('v',  '-', '$', opts)\nmap('t',  '<leader>0','<C-\\\\><C-n><C-w>:ls!<cr>:b<Space>', opts)\nmap('t',  '<Escape>','<C-\\\\><C-n>', opts)\nmap('t',  '<localeader><localleader>','<C-\\\\><C-n><C-w>w', opts)\nmap('i',  '<Esc>', '<Esc>`^', opts)\n\n\nvim.api.nvim_create_autocmd(\n    { \"BufRead\", \"BufNewFile\" },\n    { pattern = { \"*.txt\", \"*.md\"}, command = \"setlocal spell\" }\n)\n\n\n\n\n```\n\n# Set up R \n\n```sh\n\nvim.cmd([[\nlet R_auto_start = 2\nlet R_hl_term = 0\nlet R_clear_line = 1\nlet R_pdfviewer = \"zathura\" \nlet R_assign = 2\nlet R_latexcmd = ['xelatex']\naugroup rmarkdown\nautocmd!\nautocmd FileType rmd,r nnoremap <buffer> <CR>  :call SendLineToR(\"down\")<CR>\nautocmd FileType rmd,r nnoremap <buffer> <space>' :call RMakeRmd(\"default\")<cr>\nautocmd FileType rmd,r noremap <space>i :call RAction(\"dim\")<cr>\nautocmd FileType rmd,r noremap <space>h :call RAction(\"head\")<cr>\nautocmd FileType rmd,r noremap <space>p :call RAction(\"print\")<cr>\nautocmd FileType rmd,r noremap <space>q :call RAction(\"length\")<cr>\nautocmd FileType rmd,r noremap <space>n :call RAction(\"nvim.names\")<cr>\nautocmd FileType rmd,r vmap <buffer> <CR> <localleader>sd\nautocmd FileType rmd,r nmap <buffer> <space>j <localleader>gn\nautocmd FileType rmd,r nmap <buffer> <space>k <localleader>gN\nautocmd FileType rmd,r nmap <buffer> <space>l <localleader>cd\naugroup END\n]])\n\n```\n\n# Appendix Ubuntu tweaks\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}