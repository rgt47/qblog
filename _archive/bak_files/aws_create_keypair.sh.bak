#!/usr/bin/env bash
while getopts hp: flag
do
    case "${flag}" in
        p) key_pair_name=${OPTARG};;
        h) help=${OPTARG};;
    esac
done
base=`basename $PWD`
if [ -z "$key_pair_name" ]
then
  proj_name=$base
fi

if [ -n "$help" ]
then
echo "here is some help text"
exit;
fi

echo "key_pair_name is $key_pair_name"

read -p "Continue (y/n)?" CONT
if [ "$CONT" = "y" ]; then
  echo "Here we go!";
else
  echo "too bad. bye."; exit; 
fi

cd ~/.ssh 
rm -f  ~/.ssh/$key_pair_name.pem
aws ec2 create-key-pair  --key-name  $key_pair_name \
   --query 'KeyMaterial' --output text > ~/.ssh/$key_pair_name.pem

wait
chmod 400 ~/.ssh/$key_pair_name.pem
